!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).bc=e()}}(function(){var define,module,exports;return function o(a,s,c){function d(t,e){if(!s[t]){if(!a[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(u)return u(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var i=s[t]={exports:{}};a[t][0].call(i.exports,function(e){return d(a[t][1][e]||e)},i,i.exports,o,a,s,c)}return s[t].exports}for(var u="function"==typeof require&&require,e=0;e<c.length;e++)d(c[e]);return d}({1:[function(l,n,r){(function(t){!function(e){if("object"==typeof r&&void 0!==n)n.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:this).adapter=e()}}(function(){return function o(a,s,c){function d(t,e){if(!s[t]){if(!a[t]){var n="function"==typeof l&&l;if(!e&&n)return n(t,!0);if(u)return u(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var i=s[t]={exports:{}};a[t][0].call(i.exports,function(e){return d(a[t][1][e]||e)},i,i.exports,o,a,s,c)}return s[t].exports}for(var u="function"==typeof l&&l,e=0;e<c.length;e++)d(c[e]);return d}({1:[function(e,t,n){"use strict";var r=(0,e("./adapter_factory.js").adapterFactory)({window:window});t.exports=r},{"./adapter_factory.js":2}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.adapterFactory=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).window,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},n=o.log,r=o.detectBrowser(e),i={browserDetails:r,commonShim:u,extractVersion:o.extractVersion,disableLog:o.disableLog,disableWarnings:o.disableWarnings};switch(r.browser){case"chrome":if(!a||!a.shimPeerConnection||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;n("adapter.js shimming chrome."),(i.browserShim=a).shimGetUserMedia(e),a.shimMediaStream(e),a.shimPeerConnection(e),a.shimOnTrack(e),a.shimAddTrackRemoveTrack(e),a.shimGetSendersWithDtmf(e),a.shimGetStats(e),a.shimSenderReceiverGetStats(e),a.fixNegotiationNeeded(e),u.shimRTCIceCandidate(e),u.shimConnectionState(e),u.shimMaxMessageSize(e),u.shimSendThrowTypeError(e),u.removeAllowExtmapMixed(e);break;case"firefox":if(!c||!c.shimPeerConnection||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),(i.browserShim=c).shimGetUserMedia(e),c.shimPeerConnection(e),c.shimOnTrack(e),c.shimRemoveStream(e),c.shimSenderGetStats(e),c.shimReceiverGetStats(e),c.shimRTCDataChannel(e),c.shimAddTransceiver(e),c.shimCreateOffer(e),c.shimCreateAnswer(e),u.shimRTCIceCandidate(e),u.shimConnectionState(e),u.shimMaxMessageSize(e),u.shimSendThrowTypeError(e);break;case"edge":if(!s||!s.shimPeerConnection||!t.shimEdge)return n("MS edge shim is not included in this adapter release."),i;n("adapter.js shimming edge."),(i.browserShim=s).shimGetUserMedia(e),s.shimGetDisplayMedia(e),s.shimPeerConnection(e),s.shimReplaceTrack(e),u.shimMaxMessageSize(e),u.shimSendThrowTypeError(e);break;case"safari":if(!d||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),(i.browserShim=d).shimRTCIceServerUrls(e),d.shimCreateOfferLegacy(e),d.shimCallbacksAPI(e),d.shimLocalStreamsAPI(e),d.shimRemoteStreamsAPI(e),d.shimTrackEventTransceiver(e),d.shimGetUserMedia(e),u.shimRTCIceCandidate(e),u.shimMaxMessageSize(e),u.shimSendThrowTypeError(e),u.removeAllowExtmapMixed(e);break;default:n("Unsupported browser!")}return i};var o=r(e("./utils")),a=r(e("./chrome/chrome_shim")),s=r(e("./edge/edge_shim")),c=r(e("./firefox/firefox_shim")),d=r(e("./safari/safari_shim")),u=r(e("./common_shim"));function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=n.shimGetUserMedia=void 0;var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=e("./getusermedia");Object.defineProperty(n,"shimGetUserMedia",{enumerable:!0,get:function(){return r.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(n,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),n.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},n.shimOnTrack=function(o){if("object"!==(void 0===o?"undefined":s(o))||!o.RTCPeerConnection||"ontrack"in o.RTCPeerConnection.prototype)c.wrapPeerConnectionEvent(o,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e});else{Object.defineProperty(o.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var e=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){var i=this;return this._ontrackpoly||(this._ontrackpoly=function(r){r.stream.addEventListener("addtrack",function(t){var e=void 0;e=o.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(e){return e.track&&e.track.id===t.track.id}):{track:t.track};var n=new Event("track");n.track=t.track,n.receiver=e,n.transceiver={receiver:e},n.streams=[r.stream],i.dispatchEvent(n)}),r.stream.getTracks().forEach(function(t){var e=void 0;e=o.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(e){return e.track&&e.track.id===t.id}):{track:t};var n=new Event("track");n.track=t,n.receiver=e,n.transceiver={receiver:e},n.streams=[r.stream],i.dispatchEvent(n)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}},n.shimGetSendersWithDtmf=function(e){if("object"===(void 0===e?"undefined":s(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var r=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,t){var n=i.apply(this,arguments);return n||(n=r(this,e),this._senders.push(n)),n};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach(function(e){t._senders.push(r(t,e))})};var t=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var n=this;this._senders=this._senders||[],t.apply(this,[e]),e.getTracks().forEach(function(t){var e=n._senders.find(function(e){return e.track===t});e&&n._senders.splice(n._senders.indexOf(e),1)})}}else if("object"===(void 0===e?"undefined":s(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=a.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},n.shimGetStats=function(e){if(!e.RTCPeerConnection)return;var s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var n=this,e=Array.prototype.slice.call(arguments),t=e[0],r=e[1],i=e[2];if(0<arguments.length&&"function"==typeof t)return s.apply(this,arguments);if(0===s.length&&(0===arguments.length||"function"!=typeof t))return s.apply(this,[]);function o(e){var r={};return e.result().forEach(function(t){var n={id:t.id,timestamp:t.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[t.type]||t.type};t.names().forEach(function(e){n[e]=t.stat(e)}),r[n.id]=n}),r}function a(t){return new Map(Object.keys(t).map(function(e){return[e,t[e]]}))}if(2<=arguments.length){return s.apply(this,[function(e){r(a(o(e)))},t])}return new Promise(function(t,e){s.apply(n,[function(e){t(a(o(e)))},e])}).then(r,i)}},n.shimSenderReceiverGetStats=function(o){if(!("object"===(void 0===o?"undefined":s(o))&&o.RTCPeerConnection&&o.RTCRtpSender&&o.RTCRtpReceiver))return;if(!("getStats"in o.RTCRtpSender.prototype)){var n=o.RTCPeerConnection.prototype.getSenders;n&&(o.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=n.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e});var t=o.RTCPeerConnection.prototype.addTrack;t&&(o.RTCPeerConnection.prototype.addTrack=function(){var e=t.apply(this,arguments);return e._pc=this,e}),o.RTCRtpSender.prototype.getStats=function(){var t=this;return this._pc.getStats().then(function(e){return c.filterStats(e,t.track,!0)})}}if(!("getStats"in o.RTCRtpReceiver.prototype)){var r=o.RTCPeerConnection.prototype.getReceivers;r&&(o.RTCPeerConnection.prototype.getReceivers=function(){var t=this,e=r.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),c.wrapPeerConnectionEvent(o,"track",function(e){return e.receiver._pc=e.srcElement,e}),o.RTCRtpReceiver.prototype.getStats=function(){var t=this;return this._pc.getStats().then(function(e){return c.filterStats(e,t.track,!1)})}}if(!("getStats"in o.RTCRtpSender.prototype&&"getStats"in o.RTCRtpReceiver.prototype))return;var a=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(e){if(0<arguments.length&&e instanceof o.MediaStreamTrack){var t=e,n=void 0,r=void 0,i=void 0;return this.getSenders().forEach(function(e){e.track===t&&(n?i=!0:n=e)}),this.getReceivers().forEach(function(e){return e.track===t&&(r?i=!0:r=e),e.track===t}),i||n&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return a.apply(this,arguments)}},n.shimAddTrackRemoveTrackWithNative=u,n.shimAddTrackRemoveTrack=function(a){if(!a.RTCPeerConnection)return;var e=c.detectBrowser(a);if(a.RTCPeerConnection.prototype.addTrack&&65<=e.version)return u(a);var n=a.RTCPeerConnection.prototype.getLocalStreams;a.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this,e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(function(e){return t._reverseStreams[e.id]})};var r=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(e){var n=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},e.getTracks().forEach(function(t){if(n.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[e.id]){var t=new a.MediaStream(e.getTracks());this._streams[e.id]=t,this._reverseStreams[t.id]=e,e=t}r.apply(this,[e])};var t=a.RTCPeerConnection.prototype.removeStream;function i(r,e){var i=e.sdp;return Object.keys(r._reverseStreams||[]).forEach(function(e){var t=r._reverseStreams[e],n=r._streams[t.id];i=i.replace(new RegExp(n.id,"g"),t.id)}),new RTCSessionDescription({type:e.type,sdp:i})}a.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},a.RTCPeerConnection.prototype.addTrack=function(t,e){var n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var i=this._streams[e.id];if(i)i.addTrack(t),Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))});else{var o=new a.MediaStream([t]);this._streams[e.id]=o,this._reverseStreams[o.id]=e,this.addStream(o)}return this.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(e){var t=a.RTCPeerConnection.prototype[e],n=d({},e,function(){var n=this,r=arguments;return arguments.length&&"function"==typeof arguments[0]?t.apply(this,[function(e){var t=i(n,e);r[0].apply(null,[t])},function(e){r[1]&&r[1].apply(null,e)},arguments[2]]):t.apply(this,arguments).then(function(e){return i(n,e)})});a.RTCPeerConnection.prototype[e]=n[e]});var o=a.RTCPeerConnection.prototype.setLocalDescription;a.RTCPeerConnection.prototype.setLocalDescription=function(e){return arguments.length&&e.type&&(r=this,i=(t=e).sdp,Object.keys(r._reverseStreams||[]).forEach(function(e){var t=r._reverseStreams[e],n=r._streams[t.id];i=i.replace(new RegExp(t.id,"g"),n.id)}),e=new RTCSessionDescription({type:t.type,sdp:i})),o.apply(this,arguments);var r,t,i};var s=Object.getOwnPropertyDescriptor(a.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(a.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=s.get.apply(this);return""===e.type?e:i(this,e)}}),a.RTCPeerConnection.prototype.removeTrack=function(t){var n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!t._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(t._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var r=void 0;Object.keys(this._streams).forEach(function(e){n._streams[e].getTracks().find(function(e){return t.track===e})&&(r=n._streams[e])}),r&&(1===r.getTracks().length?this.removeStream(this._reverseStreams[r.id]):r.removeTrack(t.track),this.dispatchEvent(new Event("negotiationneeded")))}},n.shimPeerConnection=function(r){var n=c.detectBrowser(r);!r.RTCPeerConnection&&r.webkitRTCPeerConnection&&(r.RTCPeerConnection=r.webkitRTCPeerConnection);if(!r.RTCPeerConnection)return;var i=0===r.RTCPeerConnection.prototype.addIceCandidate.length;n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=r.RTCPeerConnection.prototype[e],n=d({},e,function(){return arguments[0]=new("addIceCandidate"===e?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)});r.RTCPeerConnection.prototype[e]=n[e]});var o=r.RTCPeerConnection.prototype.addIceCandidate;r.RTCPeerConnection.prototype.addIceCandidate=function(e,t){return i||e?n.version<78&&e&&""===e.candidate?Promise.resolve():o.apply(this,arguments):(t&&t.apply(null),Promise.resolve())}},n.fixNegotiationNeeded=function(e){c.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){if("stable"===e.target.signalingState)return e})};var c=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../utils.js"));function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(e){return t._shimmedLocalStreams[e][0]})};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,t){if(!t)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=r.apply(this,arguments);return this._shimmedLocalStreams[t.id]?-1===this._shimmedLocalStreams[t.id].indexOf(n)&&this._shimmedLocalStreams[t.id].push(n):this._shimmedLocalStreams[t.id]=[t,n],n};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(t){if(n.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError")});var t=this.getSenders();i.apply(this,arguments);var r=this.getSenders().filter(function(e){return-1===t.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(r)};var t=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],t.apply(this,arguments)};var o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(n){var r=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},n&&Object.keys(this._shimmedLocalStreams).forEach(function(e){var t=r._shimmedLocalStreams[e].indexOf(n);-1!==t&&r._shimmedLocalStreams[e].splice(t,1),1===r._shimmedLocalStreams[e].length&&delete r._shimmedLocalStreams[e]}),o.apply(this,arguments)}}},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=function(o,e){if(o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices)return;if(!o.navigator.mediaDevices)return;if("function"!=typeof e)return void console.error("shimGetDisplayMedia: getSourceId argument is not a function");o.navigator.mediaDevices.getDisplayMedia=function(i){return e(i).then(function(e){var t=i.video&&i.video.width,n=i.video&&i.video.height,r=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxFrameRate:r||3}},t&&(i.video.mandatory.maxWidth=t),n&&(i.video.mandatory.maxHeight=n),o.navigator.mediaDevices.getUserMedia(i)})}}},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.shimGetUserMedia=function(e){var a=e&&e.navigator;if(!a.mediaDevices)return;function s(i){if("object"!==(void 0===i?"undefined":d(i))||i.mandatory||i.optional)return i;var o={};return Object.keys(i).forEach(function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var n="object"===d(i[t])?i[t]:{ideal:i[t]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){o.optional=o.optional||[];var e={};"number"==typeof n.ideal?(e[r("min",t)]=n.ideal,o.optional.push(e),(e={})[r("max",t)]=n.ideal):e[r("",t)]=n.ideal,o.optional.push(e)}void 0!==n.exact&&"number"!=typeof n.exact?(o.mandatory=o.mandatory||{},o.mandatory[r("",t)]=n.exact):["min","max"].forEach(function(e){void 0!==n[e]&&(o.mandatory=o.mandatory||{},o.mandatory[r(e,t)]=n[e])})}}),i.advanced&&(o.optional=(o.optional||[]).concat(i.advanced)),o}function r(n,r){if(61<=c.version)return r(n);if((n=JSON.parse(JSON.stringify(n)))&&"object"===d(n.audio)){var e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};e((n=JSON.parse(JSON.stringify(n))).audio,"autoGainControl","googAutoGainControl"),e(n.audio,"noiseSuppression","googNoiseSuppression"),n.audio=s(n.audio)}if(n&&"object"===d(n.video)){var i=n.video.facingMode;i=i&&("object"===(void 0===i?"undefined":d(i))?i:{ideal:i});var t=c.version<66;if(i&&("user"===i.exact||"environment"===i.exact||"user"===i.ideal||"environment"===i.ideal)&&(!a.mediaDevices.getSupportedConstraints||!a.mediaDevices.getSupportedConstraints().facingMode||t)){delete n.video.facingMode;var o=void 0;if("environment"===i.exact||"environment"===i.ideal?o=["back","rear"]:"user"!==i.exact&&"user"!==i.ideal||(o=["front"]),o)return a.mediaDevices.enumerateDevices().then(function(e){var t=(e=e.filter(function(e){return"videoinput"===e.kind})).find(function(t){return o.some(function(e){return t.label.toLowerCase().includes(e)})});return!t&&e.length&&o.includes("back")&&(t=e[e.length-1]),t&&(n.video.deviceId=i.exact?{exact:t.deviceId}:{ideal:t.deviceId}),n.video=s(n.video),u("chrome: "+JSON.stringify(n)),r(n)})}n.video=s(n.video)}return u("chrome: "+JSON.stringify(n)),r(n)}function i(e){return 64<=c.version?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}}var c=o.detectBrowser(e);if(a.getUserMedia=function(e,t,n){r(e,function(e){a.webkitGetUserMedia(e,t,function(e){n&&n(i(e))})})}.bind(a),a.mediaDevices.getUserMedia){var n=a.mediaDevices.getUserMedia.bind(a.mediaDevices);a.mediaDevices.getUserMedia=function(e){return r(e,function(t){return n(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return e},function(e){return Promise.reject(i(e))})})}}};var o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../utils.js"));var u=o.log},{"../utils.js":15}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.shimRTCIceCandidate=function(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;var i=t.RTCIceCandidate;t.RTCIceCandidate=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var t=new i(e),n=u.default.parseCandidate(e.candidate),r=Object.assign(t,n);return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new i(e)},t.RTCIceCandidate.prototype=i.prototype,a.wrapPeerConnectionEvent(t,"icecandidate",function(e){return e.candidate&&Object.defineProperty(e,"candidate",{value:new t.RTCIceCandidate(e.candidate),writable:"false"}),e})},n.shimMaxMessageSize=function(e){if(!e.RTCPeerConnection)return;var c=a.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var d=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){var t,n;this._sctp=null,"chrome"===c.browser&&76<=c.version&&("plan-b"===this.getConfiguration().sdpSemantics&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0}));if(function(e){if(!e||!e.sdp)return!1;var t=u.default.splitSections(e.sdp);return t.shift(),t.some(function(e){var t=u.default.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})}(e)){var r=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!=n?-1:n}(e),i=(t=r,n=65536,"firefox"===c.browser&&(n=c.version<57?-1===t?16384:2147483637:c.version<60?57===c.version?65535:65536:2147483637),n),o=function(e,t){var n=65536;"firefox"===c.browser&&57===c.version&&(n=65535);var r=u.default.matchPrefix(e.sdp,"a=max-message-size:");return 0<r.length?n=parseInt(r[0].substr(19),10):"firefox"===c.browser&&-1!==t&&(n=2147483637),n}(e,r),a=void 0;a=0===i&&0===o?Number.POSITIVE_INFINITY:0===i||0===o?Math.max(i,o):Math.min(i,o);var s={};Object.defineProperty(s,"maxMessageSize",{get:function(){return a}}),this._sctp=s}return d.apply(this,arguments)}},n.shimSendThrowTypeError=function(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(n,r){var i=n.send;n.send=function(e){var t=e.length||e.size||e.byteLength;if("open"===n.readyState&&r.sctp&&t>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return i.apply(n,arguments)}}var n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=n.apply(this,arguments);return t(e,this),e},a.wrapPeerConnectionEvent(e,"datachannel",function(e){return t(e.channel,e.target),e})},n.shimConnectionState=function(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;var n=e.RTCPeerConnection.prototype;Object.defineProperty(n,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(n,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(e){var t=n[e];n[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),t.apply(this,arguments)}})},n.removeAllowExtmapMixed=function(e){if(!e.RTCPeerConnection)return;var t=a.detectBrowser(e);if("chrome"===t.browser&&71<=t.version)return;var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter(function(e){return"a=extmap-allow-mixed"!==e.trim()}).join("\n")),n.apply(this,arguments)}};var r,i=e("sdp"),u=(r=i)&&r.__esModule?r:{default:r},a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("./utils"))},{"./utils":15,sdp:17}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=n.shimGetUserMedia=void 0;var r=e("./getusermedia");Object.defineProperty(n,"shimGetUserMedia",{enumerable:!0,get:function(){return r.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(n,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),n.shimPeerConnection=function(e){var t=a.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}});e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var r=(0,d.default)(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,s.filterIceServers)(e.iceServers,t.version),a.log("ICE servers after filtering:",e.iceServers)),new r(e)},e.RTCPeerConnection.prototype=r.prototype},n.shimReplaceTrack=function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)};var o,a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../utils")),s=e("./filtericeservers"),c=e("rtcpeerconnection-shim"),d=(o=c)&&o.__esModule?o:{default:o}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.filterIceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&i.deprecated("RTCIceServer.url","RTCIceServer.urls");var n="string"==typeof t;return n&&(t=[t]),t=t.filter(function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!r?r=!0:t&&!r}),delete e.url,e.urls=n?t[0]:t,!!t.length}})};var i=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../utils"))},{"../utils":15}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=function(e){if(!("getDisplayMedia"in e.navigator))return;if(!e.navigator.mediaDevices)return;if(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)return;e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)}},{}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetUserMedia=function(e){var t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch(function(e){return Promise.reject({name:{PermissionDeniedError:"NotAllowedError"}[(t=e).name]||t.name,message:t.message,constraint:t.constraint,toString:function(){return this.name}});var t})}}},{}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=n.shimGetUserMedia=void 0;var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=e("./getusermedia");Object.defineProperty(n,"shimGetUserMedia",{enumerable:!0,get:function(){return r.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(n,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),n.shimOnTrack=function(e){"object"===(void 0===e?"undefined":c(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},n.shimPeerConnection=function(r){var i=s.detectBrowser(r);if("object"!==(void 0===r?"undefined":c(r))||!r.RTCPeerConnection&&!r.mozRTCPeerConnection)return;!r.RTCPeerConnection&&r.mozRTCPeerConnection&&(r.RTCPeerConnection=r.mozRTCPeerConnection);i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=r.RTCPeerConnection.prototype[e],n=function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n;return e}({},e,function(){return arguments[0]=new("addIceCandidate"===e?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)});r.RTCPeerConnection.prototype[e]=n[e]});if(i.version<68){var n=r.RTCPeerConnection.prototype.addIceCandidate;r.RTCPeerConnection.prototype.addIceCandidate=function(e,t){return e?e&&""===e.candidate?Promise.resolve():n.apply(this,arguments):(t&&t.apply(null),Promise.resolve())}}var o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),t=e[0],r=e[1],n=e[2];return a.apply(this,[t||null]).then(function(n){if(i.version<53&&!r)try{n.forEach(function(e){e.type=o[e.type]||e.type})}catch(e){if("TypeError"!==e.name)throw e;n.forEach(function(e,t){n.set(t,Object.assign({},e,{type:o[e.type]||e.type}))})}return n}).then(r,n)}},n.shimSenderGetStats=function(e){if("object"!==(void 0===e?"undefined":c(e))||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;var n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=n.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e});var t=e.RTCPeerConnection.prototype.addTrack;t&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=t.apply(this,arguments);return e._pc=this,e});e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}},n.shimReceiverGetStats=function(e){if("object"!==(void 0===e?"undefined":c(e))||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;var n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){var t=this,e=n.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e});s.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}},n.shimRemoveStream=function(e){if(!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype)return;e.RTCPeerConnection.prototype.removeStream=function(t){var n=this;s.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(e){e.track&&t.getTracks().includes(e.track)&&n.removeTrack(e)})}},n.shimRTCDataChannel=function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},n.shimAddTransceiver=function(e){if("object"!==(void 0===e?"undefined":c(e))||!e.RTCPeerConnection)return;var s=e.RTCPeerConnection.prototype.addTransceiver;s&&(e.RTCPeerConnection.prototype.addTransceiver=function(e,t){this.setParametersPromises=[];var n=t,r=n&&"sendEncodings"in n;r&&n.sendEncodings.forEach(function(e){if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(1<=parseFloat(e.scaleResolutionDownBy)))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(0<=parseFloat(e.maxFramerate)))throw new RangeError("max_framerate must be >= 0.0")});var i=s.apply(this,arguments);if(r){var o=i.sender,a=o.getParameters();"encodings"in a||(a.encodings=n.sendEncodings,this.setParametersPromises.push(o.setParameters(a).catch(function(){})))}return i})},n.shimCreateOffer=function(e){if("object"!==(void 0===e?"undefined":c(e))||!e.RTCPeerConnection)return;var n=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=this,t=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return n.apply(e,t)}).finally(function(){e.setParametersPromises=[]}):n.apply(this,arguments)}},n.shimCreateAnswer=function(e){if("object"!==(void 0===e?"undefined":c(e))||!e.RTCPeerConnection)return;var n=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=this,t=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return n.apply(e,t)}).finally(function(){e.setParametersPromises=[]}):n.apply(this,arguments)}};var s=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=function(n,r){if(n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices)return;if(!n.navigator.mediaDevices)return;n.navigator.mediaDevices.getDisplayMedia=function(e){if(e&&e.video)return!0===e.video?e.video={mediaSource:r}:e.video.mediaSource=r,n.navigator.mediaDevices.getUserMedia(e);var t=new DOMException("getDisplayMedia without video constraints is undefined");return t.name="NotFoundError",t.code=8,Promise.reject(t)}}},{}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.shimGetUserMedia=function(e){var t=d.detectBrowser(e),r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){d.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,n)},!(55<t.version&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var i=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},o=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":c(e))&&"object"===c(e.audio)&&(e=JSON.parse(JSON.stringify(e)),i(e.audio,"autoGainControl","mozAutoGainControl"),i(e.audio,"noiseSuppression","mozNoiseSuppression")),o(e)},n&&n.prototype.getSettings){var a=n.prototype.getSettings;n.prototype.getSettings=function(){var e=a.apply(this,arguments);return i(e,"mozAutoGainControl","autoGainControl"),i(e,"mozNoiseSuppression","noiseSuppression"),e}}if(n&&n.prototype.applyConstraints){var s=n.prototype.applyConstraints;n.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":c(e))&&(e=JSON.parse(JSON.stringify(e)),i(e,"autoGainControl","mozAutoGainControl"),i(e,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[e])}}}};var d=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../utils"))},{"../utils":15}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.shimLocalStreamsAPI=function(e){if("object"!==(void 0===e?"undefined":r(e))||!e.RTCPeerConnection)return;"getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams});if(!("addStream"in e.RTCPeerConnection.prototype)){var o=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(t)||this._localStreams.push(t),t.getAudioTracks().forEach(function(e){return o.call(n,e,t)}),t.getVideoTracks().forEach(function(e){return o.call(n,e,t)})},e.RTCPeerConnection.prototype.addTrack=function(e){for(var t=this,n=arguments.length,r=Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r&&r.forEach(function(e){t._localStreams?t._localStreams.includes(e)||t._localStreams.push(e):t._localStreams=[e]}),o.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var n=this._localStreams.indexOf(e);if(-1!==n){this._localStreams.splice(n,1);var r=e.getTracks();this.getSenders().forEach(function(e){r.includes(e.track)&&t.removeTrack(e)})}})},n.shimRemoteStreamsAPI=function(e){if("object"!==(void 0===e?"undefined":r(e))||!e.RTCPeerConnection)return;"getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]});if(!("onaddstream"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var n=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(n._remoteStreams||(n._remoteStreams=[]),!n._remoteStreams.includes(e)){n._remoteStreams.push(e);var t=new Event("addstream");t.stream=e,n.dispatchEvent(t)}})})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(n._remoteStreams||(n._remoteStreams=[]),!(0<=n._remoteStreams.indexOf(e))){n._remoteStreams.push(e);var t=new Event("addstream");t.stream=e,n.dispatchEvent(t)}})}),t.apply(n,arguments)}}},n.shimCallbacksAPI=function(e){if("object"!==(void 0===e?"undefined":r(e))||!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype,o=t.createOffer,a=t.createAnswer,i=t.setLocalDescription,s=t.setRemoteDescription,c=t.addIceCandidate;t.createOffer=function(e,t,n){var r=2<=arguments.length?n:e,i=o.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t,n){var r=2<=arguments.length?n:e,i=a.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i};var n=function(e,t,n){var r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=n,n=function(e,t,n){var r=s.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=n,n=function(e,t,n){var r=c.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=n},n.shimGetUserMedia=function(e){var r=e&&e.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){var t=r.mediaDevices,n=t.getUserMedia.bind(t);r.mediaDevices.getUserMedia=function(e){return n(i(e))}}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=function(e,t,n){r.mediaDevices.getUserMedia(e).then(t,n)}.bind(r))},n.shimConstraints=i,n.shimRTCIceServerUrls=function(e){var o=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var n=[],r=0;r<e.iceServers.length;r++){var i=e.iceServers[r];!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")?(a.deprecated("RTCIceServer.url","RTCIceServer.urls"),(i=JSON.parse(JSON.stringify(i))).urls=i.url,delete i.url,n.push(i)):n.push(e.iceServers[r])}e.iceServers=n}return new o(e,t)},e.RTCPeerConnection.prototype=o.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return o.generateCertificate}})},n.shimTrackEventTransceiver=function(e){"object"===(void 0===e?"undefined":r(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},n.shimCreateOfferLegacy=function(e){var r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var t=this.getTransceivers().find(function(e){return"audio"===e.receiver.track.kind});!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var n=this.getTransceivers().find(function(e){return"video"===e.receiver.track.kind});!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return r.apply(this,arguments)}};var a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../utils"));function i(e){return e&&void 0!==e.video?Object.assign({},e,{video:a.compactObject(e.video)}):e}},{"../utils":15}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.extractVersion=a,n.wrapPeerConnectionEvent=function(e,r,i){if(!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype,o=t.addEventListener;t.addEventListener=function(e,n){if(e!==r)return o.apply(this,arguments);function t(e){var t=i(e);t&&n(t)}return this._eventMap=this._eventMap||{},this._eventMap[n]=t,o.apply(this,[e,t])};var a=t.removeEventListener;t.removeEventListener=function(e,t){if(e!==r||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);var n=this._eventMap[t];return delete this._eventMap[t],a.apply(this,[e,n])},Object.defineProperty(t,"on"+r,{get:function(){return this["_on"+r]},set:function(e){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),e&&this.addEventListener(r,this["_on"+r]=e)},enumerable:!0,configurable:!0})},n.disableLog=function(e){return"boolean"==typeof e?(i=e)?"adapter.js logging disabled":"adapter.js logging enabled":new Error("Argument type: "+(void 0===e?"undefined":r(e))+". Please use a boolean.")},n.disableWarnings=function(e){return"boolean"==typeof e?(o=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled")):new Error("Argument type: "+(void 0===e?"undefined":r(e))+". Please use a boolean.")},n.log=function(){if("object"===("undefined"==typeof window?"undefined":r(window))){if(i)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},n.deprecated=function(e,t){if(!o)return;console.warn(e+" is deprecated, please use "+t+" instead.")},n.detectBrowser=function(e){var t=e.navigator,n={browser:null,version:null};if(void 0===e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=a(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)n.browser="chrome",n.version=a(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=a(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=a(t.userAgent,/AppleWebKit\/(\d+)\./,1),n.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return n},n.compactObject=function o(a){if(!c(a))return a;return Object.keys(a).reduce(function(e,t){var n=c(a[t]),r=n?o(a[t]):a[t],i=n&&!Object.keys(r).length;return void 0===r||i?e:Object.assign(e,s({},t,r))},{})},n.walkStats=d,n.filterStats=function(n,t,e){var r=e?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var o=[];return n.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(function(t){n.forEach(function(e){e.type===r&&e.trackId===t.id&&d(n,e,i)})}),i};var i=!0,o=!0;function a(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function c(e){return"[object Object]"===Object.prototype.toString.call(e)}function d(t,n,r){n&&!r.has(n.id)&&(r.set(n.id,n),Object.keys(n).forEach(function(e){e.endsWith("Id")?d(t,t.get(n[e]),r):e.endsWith("Ids")&&n[e].forEach(function(e){d(t,t.get(e),r)})}))}},{}],16:[function(e,t,n){"use strict";var L=e("sdp");function c(e,t,n,r,i){var o=L.writeRtpDescription(e.kind,t);if(o+=L.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=L.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":i||"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var s="msid:"+(r?r.id:"-")+" "+a+"\r\n";o+="a="+s,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+L.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+L.localCName+"\r\n"),o}function U(d,u){function l(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]}var f={codecs:[],headerExtensions:[],fecMechanisms:[]};return d.codecs.forEach(function(n){for(var e=0;e<u.codecs.length;e++){var t=u.codecs[e];if(n.name.toLowerCase()===t.name.toLowerCase()&&n.clockRate===t.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&t.parameters.apt&&(r=n,i=t,o=d.codecs,a=u.codecs,c=s=void 0,s=l(r.parameters.apt,o),c=l(i.parameters.apt,a),!s||!c||s.name.toLowerCase()!==c.name.toLowerCase()))continue;(t=JSON.parse(JSON.stringify(t))).numChannels=Math.min(n.numChannels,t.numChannels),f.codecs.push(t),t.rtcpFeedback=t.rtcpFeedback.filter(function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}var r,i,o,a,s,c}),d.headerExtensions.forEach(function(e){for(var t=0;t<u.headerExtensions.length;t++){var n=u.headerExtensions[t];if(e.uri===n.uri){f.headerExtensions.push(n);break}}}),f}function o(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function j(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}function h(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}t.exports=function(M,D){function N(e,t){t.addTrack(e),t.dispatchEvent(new M.MediaStreamTrackEvent("addtrack",{track:e}))}function i(e,t,n,r){var i=new Event("track");i.track=t,i.receiver=n,i.transceiver={receiver:n},i.streams=r,M.setTimeout(function(){e._dispatchEvent("track",i)})}function r(e){var t,r,i,n=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){n[e]=o[e].bind(o)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",e=JSON.parse(JSON.stringify(e||{})),this.usingBundle="max-bundle"===e.bundlePolicy,"negotiate"===e.rtcpMuxPolicy)throw h("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(e.rtcpMuxPolicy||(e.rtcpMuxPolicy="require"),e.iceTransportPolicy){case"all":case"relay":break;default:e.iceTransportPolicy="all"}switch(e.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:e.bundlePolicy="balanced"}if(e.iceServers=(t=e.iceServers||[],r=D,i=!1,(t=JSON.parse(JSON.stringify(t))).filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var n="string"==typeof t;return n&&(t=[t]),t=t.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||i?0===e.indexOf("stun:")&&14393<=r&&-1===e.indexOf("?transport=udp"):i=!0}),delete e.url,e.urls=n?t[0]:t,!!t.length}})),this._iceGatherers=[],e.iceCandidatePoolSize)for(var a=e.iceCandidatePoolSize;0<a;a--)this._iceGatherers.push(new M.RTCIceGatherer({iceServers:e.iceServers,gatherPolicy:e.iceTransportPolicy}));else e.iceCandidatePoolSize=0;this._config=e,this.transceivers=[],this._sdpSessionId=L.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1}Object.defineProperty(r.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(r.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),r.prototype.onicecandidate=null,r.prototype.onaddstream=null,r.prototype.ontrack=null,r.prototype.onremovestream=null,r.prototype.onsignalingstatechange=null,r.prototype.oniceconnectionstatechange=null,r.prototype.onconnectionstatechange=null,r.prototype.onicegatheringstatechange=null,r.prototype.onnegotiationneeded=null,r.prototype.ondatachannel=null,r.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},r.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},r.prototype.getConfiguration=function(){return this._config},r.prototype.getLocalStreams=function(){return this.localStreams},r.prototype.getRemoteStreams=function(){return this.remoteStreams},r.prototype._createTransceiver=function(e,t){var n=0<this.transceivers.length,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();r.iceTransport=i.iceTransport,r.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(r),r},r.prototype.addTrack=function(t,e){if(this._isClosed)throw h("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n;if(this.transceivers.find(function(e){return e.track===t}))throw h("InvalidAccessError","Track already exists.");for(var r=0;r<this.transceivers.length;r++)this.transceivers[r].track||this.transceivers[r].kind!==t.kind||(n=this.transceivers[r]);return n=n||this._createTransceiver(t.kind),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(e)&&this.localStreams.push(e),n.track=t,n.stream=e,n.rtpSender=new M.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},r.prototype.addStream=function(t){var n=this;if(15025<=D)t.getTracks().forEach(function(e){n.addTrack(e,t)});else{var r=t.clone();t.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),r.getTracks().forEach(function(e){n.addTrack(e,r)})}},r.prototype.removeTrack=function(t){if(this._isClosed)throw h("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof M.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var e=this.transceivers.find(function(e){return e.rtpSender===t});if(!e)throw h("InvalidAccessError","Sender was not created by this connection.");var n=e.stream;e.rtpSender.stop(),e.rtpSender=null,e.track=null,e.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(n)&&-1<this.localStreams.indexOf(n)&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},r.prototype.removeStream=function(e){var n=this;e.getTracks().forEach(function(t){var e=n.getSenders().find(function(e){return e.track===t});e&&n.removeTrack(e)})},r.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},r.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},r.prototype._createIceGatherer=function(n,e){var r=this;if(e&&0<n)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new M.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[n].bufferedCandidateEvents=[],this.transceivers[n].bufferCandidates=function(e){var t=!e.candidate||0===Object.keys(e.candidate).length;i.state=t?"completed":"gathering",null!==r.transceivers[n].bufferedCandidateEvents&&r.transceivers[n].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[n].bufferCandidates),i},r.prototype._gather=function(s,c){var d=this,u=this.transceivers[c].iceGatherer;if(!u.onlocalcandidate){var e=this.transceivers[c].bufferedCandidateEvents;this.transceivers[c].bufferedCandidateEvents=null,u.removeEventListener("localcandidate",this.transceivers[c].bufferCandidates),u.onlocalcandidate=function(e){if(!(d.usingBundle&&0<c)){var t=new Event("icecandidate");t.candidate={sdpMid:s,sdpMLineIndex:c};var n=e.candidate,r=!n||0===Object.keys(n).length;if(r)"new"!==u.state&&"gathering"!==u.state||(u.state="completed");else{"new"===u.state&&(u.state="gathering"),n.component=1,n.ufrag=u.getLocalParameters().usernameFragment;var i=L.writeCandidate(n);t.candidate=Object.assign(t.candidate,L.parseCandidate(i)),t.candidate.candidate=i,t.candidate.toJSON=function(){return{candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex,usernameFragment:t.candidate.usernameFragment}}}var o=L.getMediaSections(d._localDescription.sdp);o[t.candidate.sdpMLineIndex]+=r?"a=end-of-candidates\r\n":"a="+t.candidate.candidate+"\r\n",d._localDescription.sdp=L.getDescription(d._localDescription.sdp)+o.join("");var a=d.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==d.iceGatheringState&&(d.iceGatheringState="gathering",d._emitGatheringStateChange()),r||d._dispatchEvent("icecandidate",t),a&&(d._dispatchEvent("icecandidate",new Event("icecandidate")),d.iceGatheringState="complete",d._emitGatheringStateChange())}},M.setTimeout(function(){e.forEach(function(e){u.onlocalcandidate(e)})},0)}},r.prototype._createIceAndDtlsTransports=function(){var e=this,t=new M.RTCIceTransport(null);t.onicestatechange=function(){e._updateIceConnectionState(),e._updateConnectionState()};var n=new M.RTCDtlsTransport(t);return n.ondtlsstatechange=function(){e._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),e._updateConnectionState()},{iceTransport:t,dtlsTransport:n}},r.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},r.prototype._transceive=function(e,t,n){var r=U(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(r.encodings=e.sendEncodingParameters,r.rtcp={cname:L.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(r.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(r)),n&&e.rtpReceiver&&0<r.codecs.length&&("video"===e.kind&&e.recvEncodingParameters&&D<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?r.encodings=e.recvEncodingParameters:r.encodings=[{}],r.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(r.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(r.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(r))},r.prototype.setLocalDescription=function(e){var t,l,f=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(h("TypeError",'Unsupported type "'+e.type+'"'));if(!o("setLocalDescription",e.type,f.signalingState)||f._isClosed)return Promise.reject(h("InvalidStateError","Can not set local "+e.type+" in state "+f.signalingState));if("offer"===e.type)t=L.splitSections(e.sdp),l=t.shift(),t.forEach(function(e,t){var n=L.parseRtpParameters(e);f.transceivers[t].localCapabilities=n}),f.transceivers.forEach(function(e,t){f._gather(e.mid,t)});else if("answer"===e.type){t=L.splitSections(f._remoteDescription.sdp),l=t.shift();var p=0<L.matchPrefix(l,"a=ice-lite").length;t.forEach(function(e,t){var n=f.transceivers[t],r=n.iceGatherer,i=n.iceTransport,o=n.dtlsTransport,a=n.localCapabilities,s=n.remoteCapabilities;if(!(L.isRejected(e)&&0===L.matchPrefix(e,"a=bundle-only").length)&&!n.rejected){var c=L.getIceParameters(e,l),d=L.getDtlsParameters(e,l);p&&(d.role="server"),f.usingBundle&&0!==t||(f._gather(n.mid,t),"new"===i.state&&i.start(r,c,p?"controlling":"controlled"),"new"===o.state&&o.start(d));var u=U(a,s);f._transceive(n,0<u.codecs.length,!1)}})}return f._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?f._updateSignalingState("have-local-offer"):f._updateSignalingState("stable"),Promise.resolve()},r.prototype.setRemoteDescription=function(E){var k=this;if(-1===["offer","answer"].indexOf(E.type))return Promise.reject(h("TypeError",'Unsupported type "'+E.type+'"'));if(!o("setRemoteDescription",E.type,k.signalingState)||k._isClosed)return Promise.reject(h("InvalidStateError","Can not set remote "+E.type+" in state "+k.signalingState));var P={};k.remoteStreams.forEach(function(e){P[e.id]=e});var x=[],e=L.splitSections(E.sdp),O=e.shift(),A=0<L.matchPrefix(O,"a=ice-lite").length,I=0<L.matchPrefix(O,"a=group:BUNDLE ").length;k.usingBundle=I;var t=L.matchPrefix(O,"a=ice-options:")[0];return k.canTrickleIceCandidates=!!t&&0<=t.substr(14).split(" ").indexOf("trickle"),e.forEach(function(e,t){var n=L.splitLines(e),r=L.getKind(e),i=L.isRejected(e)&&0===L.matchPrefix(e,"a=bundle-only").length,o=n[0].substr(2).split(" ")[2],a=L.getDirection(e,O),s=L.parseMsid(e),c=L.getMid(e)||L.generateIdentifier();if(i||"application"===r&&("DTLS/SCTP"===o||"UDP/DTLS/SCTP"===o))k.transceivers[t]={mid:c,kind:r,protocol:o,rejected:!0};else{var d,u,l,f,p,h,m,v,g;!i&&k.transceivers[t]&&k.transceivers[t].rejected&&(k.transceivers[t]=k._createTransceiver(r,!0));var y,b,_=L.parseRtpParameters(e);i||(y=L.getIceParameters(e,O),(b=L.getDtlsParameters(e,O)).role="client"),m=L.parseRtpEncodingParameters(e);var S=L.parseRtcpParameters(e),C=0<L.matchPrefix(e,"a=end-of-candidates",O).length,w=L.matchPrefix(e,"a=candidate:").map(function(e){return L.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===E.type||"answer"===E.type)&&!i&&I&&0<t&&k.transceivers[t]&&(k._disposeIceAndDtlsTransports(t),k.transceivers[t].iceGatherer=k.transceivers[0].iceGatherer,k.transceivers[t].iceTransport=k.transceivers[0].iceTransport,k.transceivers[t].dtlsTransport=k.transceivers[0].dtlsTransport,k.transceivers[t].rtpSender&&k.transceivers[t].rtpSender.setTransport(k.transceivers[0].dtlsTransport),k.transceivers[t].rtpReceiver&&k.transceivers[t].rtpReceiver.setTransport(k.transceivers[0].dtlsTransport)),"offer"!==E.type||i){if("answer"===E.type&&!i){u=(d=k.transceivers[t]).iceGatherer,l=d.iceTransport,f=d.dtlsTransport,p=d.rtpReceiver,h=d.sendEncodingParameters,v=d.localCapabilities,k.transceivers[t].recvEncodingParameters=m,k.transceivers[t].remoteCapabilities=_,k.transceivers[t].rtcpParameters=S,w.length&&"new"===l.state&&(!A&&!C||I&&0!==t?w.forEach(function(e){j(d.iceTransport,e)}):l.setRemoteCandidates(w)),I&&0!==t||("new"===l.state&&l.start(u,y,"controlling"),"new"===f.state&&f.start(b)),!U(d.localCapabilities,d.remoteCapabilities).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&d.sendEncodingParameters[0].rtx&&delete d.sendEncodingParameters[0].rtx,k._transceive(d,"sendrecv"===a||"recvonly"===a,"sendrecv"===a||"sendonly"===a),!p||"sendrecv"!==a&&"sendonly"!==a?delete d.rtpReceiver:(g=p.track,s?(P[s.stream]||(P[s.stream]=new M.MediaStream),N(g,P[s.stream]),x.push([g,p,P[s.stream]])):(P.default||(P.default=new M.MediaStream),N(g,P.default),x.push([g,p,P.default])))}}else{(d=k.transceivers[t]||k._createTransceiver(r)).mid=c,d.iceGatherer||(d.iceGatherer=k._createIceGatherer(t,I)),w.length&&"new"===d.iceTransport.state&&(!C||I&&0!==t?w.forEach(function(e){j(d.iceTransport,e)}):d.iceTransport.setRemoteCandidates(w)),v=M.RTCRtpReceiver.getCapabilities(r),D<15019&&(v.codecs=v.codecs.filter(function(e){return"rtx"!==e.name})),h=d.sendEncodingParameters||[{ssrc:1001*(2*t+2)}];var T,R=!1;if("sendrecv"===a||"sendonly"===a){if(R=!d.rtpReceiver,p=d.rtpReceiver||new M.RTCRtpReceiver(d.dtlsTransport,r),R)g=p.track,s&&"-"===s.stream||(T=s?(P[s.stream]||(P[s.stream]=new M.MediaStream,Object.defineProperty(P[s.stream],"id",{get:function(){return s.stream}})),Object.defineProperty(g,"id",{get:function(){return s.track}}),P[s.stream]):(P.default||(P.default=new M.MediaStream),P.default)),T&&(N(g,T),d.associatedRemoteMediaStreams.push(T)),x.push([g,p,T])}else d.rtpReceiver&&d.rtpReceiver.track&&(d.associatedRemoteMediaStreams.forEach(function(e){var t,n,r=e.getTracks().find(function(e){return e.id===d.rtpReceiver.track.id});r&&(t=r,(n=e).removeTrack(t),n.dispatchEvent(new M.MediaStreamTrackEvent("removetrack",{track:t})))}),d.associatedRemoteMediaStreams=[]);d.localCapabilities=v,d.remoteCapabilities=_,d.rtpReceiver=p,d.rtcpParameters=S,d.sendEncodingParameters=h,d.recvEncodingParameters=m,k._transceive(k.transceivers[t],!1,R)}}}),void 0===k._dtlsRole&&(k._dtlsRole="offer"===E.type?"active":"passive"),k._remoteDescription={type:E.type,sdp:E.sdp},"offer"===E.type?k._updateSignalingState("have-remote-offer"):k._updateSignalingState("stable"),Object.keys(P).forEach(function(e){var r=P[e];if(r.getTracks().length){if(-1===k.remoteStreams.indexOf(r)){k.remoteStreams.push(r);var t=new Event("addstream");t.stream=r,M.setTimeout(function(){k._dispatchEvent("addstream",t)})}x.forEach(function(e){var t=e[0],n=e[1];r.id===e[2].id&&i(k,t,n,[r])})}}),x.forEach(function(e){e[2]||i(k,e[0],e[1],[])}),M.setTimeout(function(){k&&k.transceivers&&k.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&0<e.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},r.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},r.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},r.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,M.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},r.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++}),e="new",0<t.failed?e="failed":0<t.checking?e="checking":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected?e="connected":0<t.completed&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},r.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)}),t.connected+=t.completed,e="new",0<t.failed?e="failed":0<t.connecting?e="connecting":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},r.prototype.createOffer=function(){var s=this;if(s._isClosed)return Promise.reject(h("InvalidStateError","Can not call createOffer after close"));var t=s.transceivers.filter(function(e){return"audio"===e.kind}).length,n=s.transceivers.filter(function(e){return"video"===e.kind}).length,e=arguments[0];if(e){if(e.mandatory||e.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==e.offerToReceiveAudio&&(t=!0===e.offerToReceiveAudio?1:!1===e.offerToReceiveAudio?0:e.offerToReceiveAudio),void 0!==e.offerToReceiveVideo&&(n=!0===e.offerToReceiveVideo?1:!1===e.offerToReceiveVideo?0:e.offerToReceiveVideo)}for(s.transceivers.forEach(function(e){"audio"===e.kind?--t<0&&(e.wantReceive=!1):"video"===e.kind&&--n<0&&(e.wantReceive=!1)});0<t||0<n;)0<t&&(s._createTransceiver("audio"),t--),0<n&&(s._createTransceiver("video"),n--);var r=L.writeSessionBoilerplate(s._sdpSessionId,s._sdpSessionVersion++);s.transceivers.forEach(function(e,t){var n=e.track,r=e.kind,i=e.mid||L.generateIdentifier();e.mid=i,e.iceGatherer||(e.iceGatherer=s._createIceGatherer(t,s.usingBundle));var o=M.RTCRtpSender.getCapabilities(r);D<15019&&(o.codecs=o.codecs.filter(function(e){return"rtx"!==e.name})),o.codecs.forEach(function(t){"H264"===t.name&&void 0===t.parameters["level-asymmetry-allowed"]&&(t.parameters["level-asymmetry-allowed"]="1"),e.remoteCapabilities&&e.remoteCapabilities.codecs&&e.remoteCapabilities.codecs.forEach(function(e){t.name.toLowerCase()===e.name.toLowerCase()&&t.clockRate===e.clockRate&&(t.preferredPayloadType=e.payloadType)})}),o.headerExtensions.forEach(function(t){(e.remoteCapabilities&&e.remoteCapabilities.headerExtensions||[]).forEach(function(e){t.uri===e.uri&&(t.id=e.id)})});var a=e.sendEncodingParameters||[{ssrc:1001*(2*t+1)}];n&&15019<=D&&"video"===r&&!a[0].rtx&&(a[0].rtx={ssrc:a[0].ssrc+1}),e.wantReceive&&(e.rtpReceiver=new M.RTCRtpReceiver(e.dtlsTransport,r)),e.localCapabilities=o,e.sendEncodingParameters=a}),"max-compat"!==s._config.bundlePolicy&&(r+="a=group:BUNDLE "+s.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),r+="a=ice-options:trickle\r\n",s.transceivers.forEach(function(e,t){r+=c(e,e.localCapabilities,"offer",e.stream,s._dtlsRole),r+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===s.iceGatheringState||0!==t&&s.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,r+="a="+L.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(r+="a=end-of-candidates\r\n"))});var i=new M.RTCSessionDescription({type:"offer",sdp:r});return Promise.resolve(i)},r.prototype.createAnswer=function(){var i=this;if(i._isClosed)return Promise.reject(h("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==i.signalingState&&"have-local-pranswer"!==i.signalingState)return Promise.reject(h("InvalidStateError","Can not call createAnswer in signalingState "+i.signalingState));var o=L.writeSessionBoilerplate(i._sdpSessionId,i._sdpSessionVersion++);i.usingBundle&&(o+="a=group:BUNDLE "+i.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),o+="a=ice-options:trickle\r\n";var a=L.getMediaSections(i._remoteDescription.sdp).length;i.transceivers.forEach(function(e,t){if(!(a<t+1)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?o+="m=application 0 DTLS/SCTP 5000\r\n":o+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?o+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(o+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(o+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var n;if(e.stream)"audio"===e.kind?n=e.stream.getAudioTracks()[0]:"video"===e.kind&&(n=e.stream.getVideoTracks()[0]),n&&15019<=D&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var r=U(e.localCapabilities,e.remoteCapabilities);!r.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,o+=c(e,r,"answer",e.stream,i._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(o+="a=rtcp-rsize\r\n")}});var e=new M.RTCSessionDescription({type:"answer",sdp:o});return Promise.resolve(e)},r.prototype.addIceCandidate=function(c){var d,u=this;return c&&void 0===c.sdpMLineIndex&&!c.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(e,t){if(!u._remoteDescription)return t(h("InvalidStateError","Can not add ICE candidate without a remote description"));if(c&&""!==c.candidate){var n=c.sdpMLineIndex;if(c.sdpMid)for(var r=0;r<u.transceivers.length;r++)if(u.transceivers[r].mid===c.sdpMid){n=r;break}var i=u.transceivers[n];if(!i)return t(h("OperationError","Can not add ICE candidate"));if(i.rejected)return e();var o=0<Object.keys(c.candidate).length?L.parseCandidate(c.candidate):{};if("tcp"===o.protocol&&(0===o.port||9===o.port))return e();if(o.component&&1!==o.component)return e();if((0===n||0<n&&i.iceTransport!==u.transceivers[0].iceTransport)&&!j(i.iceTransport,o))return t(h("OperationError","Can not add ICE candidate"));var a=c.candidate.trim();0===a.indexOf("a=")&&(a=a.substr(2)),(d=L.getMediaSections(u._remoteDescription.sdp))[n]+="a="+(o.type?a:"end-of-candidates")+"\r\n",u._remoteDescription.sdp=L.getDescription(u._remoteDescription.sdp)+d.join("")}else for(var s=0;s<u.transceivers.length&&(u.transceivers[s].rejected||(u.transceivers[s].iceTransport.addRemoteCandidate({}),(d=L.getMediaSections(u._remoteDescription.sdp))[s]+="a=end-of-candidates\r\n",u._remoteDescription.sdp=L.getDescription(u._remoteDescription.sdp)+d.join(""),!u.usingBundle));s++);e()})},r.prototype.getStats=function(t){if(t&&t instanceof M.MediaStreamTrack){var n=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)}),!n)throw h("InvalidAccessError","Invalid selector.");return n.getStats()}var r=[];return this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(e){t[e]&&r.push(t[e].getStats())})}),Promise.all(r).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(e){var t=M[e];if(t&&t.prototype&&t.prototype.getStats){var n=t.prototype.getStats;t.prototype.getStats=function(){return n.apply(this).then(function(n){var r=new Map;return Object.keys(n).forEach(function(e){var t;n[e].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(t=n[e]).type]||t.type,r.set(e,n[e])}),r})}}});var e=["createOffer","createAnswer"];return e.forEach(function(e){var n=r.prototype[e];r.prototype[e]=function(){var t=arguments;return"function"==typeof t[0]||"function"==typeof t[1]?n.apply(this,[arguments[2]]).then(function(e){"function"==typeof t[0]&&t[0].apply(null,[e])},function(e){"function"==typeof t[1]&&t[1].apply(null,[e])}):n.apply(this,arguments)}}),(e=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var n=r.prototype[e];r.prototype[e]=function(){var t=arguments;return"function"==typeof t[1]||"function"==typeof t[2]?n.apply(this,arguments).then(function(){"function"==typeof t[1]&&t[1].apply(null)},function(e){"function"==typeof t[2]&&t[2].apply(null,[e])}):n.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=r.prototype[e];r.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),r}},{sdp:17}],17:[function(e,t,n){"use strict";var u={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};u.localCName=u.generateIdentifier(),u.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},u.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(0<t?"m="+e:e).trim()+"\r\n"})},u.getDescription=function(e){var t=u.splitSections(e);return t&&t[0]},u.getMediaSections=function(e){var t=u.splitSections(e);return t.shift(),t},u.matchPrefix=function(e,t){return u.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},u.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},u.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},u.parseIceOptions=function(e){return e.substr(14).split(" ")},u.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},u.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},u.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:0<t[0].indexOf("/")?t[0].split("/")[1]:"sendrecv",uri:t[1]}},u.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},u.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},u.writeFmtp=function(t){var e="",n=t.payloadType;if(void 0!==t.preferredPayloadType&&(n=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){var r=[];Object.keys(t.parameters).forEach(function(e){t.parameters[e]?r.push(e+"="+t.parameters[e]):r.push(e)}),e+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return e},u.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},u.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},u.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return-1<r?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},u.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},u.getMid=function(e){var t=u.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},u.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},u.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:u.matchPrefix(e+t,"a=fingerprint:").map(u.parseFingerprint)}},u.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},u.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},u.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?u.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},u.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},u.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},u.getCryptoParameters=function(e,t){return u.matchPrefix(e+t,"a=crypto:").map(u.parseCryptoLine)},u.getIceParameters=function(e,t){var n=u.matchPrefix(e+t,"a=ice-ufrag:")[0],r=u.matchPrefix(e+t,"a=ice-pwd:")[0];return n&&r?{usernameFragment:n.substr(12),password:r.substr(10)}:null},u.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},u.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=u.splitLines(e)[0].split(" "),r=3;r<n.length;r++){var i=n[r],o=u.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(o){var a=u.parseRtpMap(o),s=u.matchPrefix(e,"a=fmtp:"+i+" ");switch(a.parameters=s.length?u.parseFmtp(s[0]):{},a.rtcpFeedback=u.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(u.parseRtcpFb),t.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(a.name.toUpperCase())}}}return u.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(u.parseExtmap(e))}),t},u.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=0<t.codecs.length?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=u.writeRtpMap(e),n+=u.writeFmtp(e),n+=u.writeRtcpFb(e)});var r=0;return t.codecs.forEach(function(e){e.maxptime>r&&(r=e.maxptime)}),0<r&&(n+="a=maxptime:"+r+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){n+=u.writeExtmap(e)}),n},u.parseRtpEncodingParameters=function(e){var n,r=[],t=u.parseRtpParameters(e),i=-1!==t.fecMechanisms.indexOf("RED"),o=-1!==t.fecMechanisms.indexOf("ULPFEC"),a=u.matchPrefix(e,"a=ssrc:").map(function(e){return u.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),s=0<a.length&&a[0].ssrc,c=u.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});0<c.length&&1<c[0].length&&c[0][0]===s&&(n=c[0][1]),t.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&n&&(t.rtx={ssrc:n}),r.push(t),i&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:s,mechanism:o?"red+ulpfec":"red"},r.push(t))}}),0===r.length&&s&&r.push({ssrc:s});var d=u.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,r.forEach(function(e){e.maxBitrate=d})),r},u.parseRtcpParameters=function(e){var t={},n=u.matchPrefix(e,"a=ssrc:").map(function(e){return u.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var r=u.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=0<r.length,t.compound=0===r.length;var i=u.matchPrefix(e,"a=rtcp-mux");return t.mux=0<i.length,t},u.parseMsid=function(e){var t,n=u.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var r=u.matchPrefix(e,"a=ssrc:").map(function(e){return u.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return 0<r.length?{stream:(t=r[0].value.split(" "))[0],track:t[1]}:void 0},u.parseSctpDescription=function(e){var t,n=u.parseMLine(e),r=u.matchPrefix(e,"a=max-message-size:");0<r.length&&(t=parseInt(r[0].substr(19),10)),isNaN(t)&&(t=65536);var i=u.matchPrefix(e,"a=sctp-port:");if(0<i.length)return{port:parseInt(i[0].substr(12),10),protocol:n.fmt,maxMessageSize:t};if(0<u.matchPrefix(e,"a=sctpmap:").length){var o=u.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(o[0],10),protocol:o[1],maxMessageSize:t}}},u.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},u.generateSessionId=function(){return Math.random().toString().substr(2,21)},u.writeSessionBoilerplate=function(e,t,n){var r=void 0!==t?t:2;return"v=0\r\no="+(n||"thisisadapterortc")+" "+(e||u.generateSessionId())+" "+r+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},u.writeMediaSection=function(e,t,n,r){var i=u.writeRtpDescription(e.kind,t);if(i+=u.writeIceParameters(e.iceGatherer.getLocalParameters()),i+=u.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),i+="a=mid:"+e.mid+"\r\n",e.direction?i+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?i+="a=sendrecv\r\n":e.rtpSender?i+="a=sendonly\r\n":e.rtpReceiver?i+="a=recvonly\r\n":i+="a=inactive\r\n",e.rtpSender){var o="msid:"+r.id+" "+e.rtpSender.track.id+"\r\n";i+="a="+o,i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,i+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+u.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+u.localCName+"\r\n"),i},u.getDirection=function(e,t){for(var n=u.splitLines(e),r=0;r<n.length;r++)switch(n[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[r].substr(2)}return t?u.getDirection(t):"sendrecv"},u.getKind=function(e){return u.splitLines(e)[0].split(" ")[0].substr(2)},u.isRejected=function(e){return"0"===e.split(" ",2)[1]},u.parseMLine=function(e){var t=u.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},u.parseOLine=function(e){var t=u.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},u.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=u.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=u)},{}]},{},[1])(1)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils":void 0,"../utils.js":void 0,"./adapter_factory.js":void 0,"./chrome/chrome_shim":void 0,"./common_shim":void 0,"./edge/edge_shim":void 0,"./filtericeservers":void 0,"./firefox/firefox_shim":void 0,"./getdisplaymedia":void 0,"./getusermedia":void 0,"./safari/safari_shim":void 0,"./utils":void 0,"rtcpeerconnection-shim":void 0,sdp:void 0}],2:[function(require,module,exports){var JSON;JSON=JSON||{},function(){function str(e,t){var n,r,i,o,a,s=gap,c=t[e];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,a=[],"[object Array]"===Object.prototype.toString.apply(c)){for(o=c.length,n=0;n<o;n+=1)a[n]=str(n,c)||"null";return i=0===a.length?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+s+"]":"["+a.join(",")+"]",gap=s,i}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;n<o;n+=1)"string"==typeof rep[n]&&((i=str(r=rep[n],c))&&a.push(quote(r)+(gap?": ":":")+i));else for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&((i=str(r,c))&&a.push(quote(r)+(gap?": ":":")+i));return i=0===a.length?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+s+"}":"{"+a.join(",")+"}",gap=s,i}}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function f(e){return e<10?"0"+e:e}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var r;if(indent=gap="","number"==typeof n)for(r=0;r<n;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(!(rep=t)||"function"==typeof t||"object"==typeof t&&"number"==typeof t.length)return str("",{"":e});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&"object"==typeof i)for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(void 0!==(r=walk(i,n))?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),SockJS=function(){function e(){}var u=document,l=window,f={};e.prototype.addEventListener=function(e,t){this._listeners||(this._listeners={}),e in this._listeners||(this._listeners[e]=[]);var n=this._listeners[e];-1===f.arrIndexOf(n,t)&&n.push(t)},e.prototype.removeEventListener=function(e,t){if(this._listeners&&e in this._listeners){var n=this._listeners[e],r=f.arrIndexOf(n,t);-1===r||(1<n.length?this._listeners[e]=n.slice(0,r).concat(n.slice(r+1)):delete this._listeners[e])}},e.prototype.dispatchEvent=function(e){var t=e.type,n=Array.prototype.slice.call(arguments,0);if(this["on"+t]&&this["on"+t].apply(this,n),this._listeners&&t in this._listeners)for(var r=0;r<this._listeners[t].length;r++)this._listeners[t][r].apply(this,n)};function s(e,t){if(this.type=e,void 0!==t)for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n])}s.prototype.toString=function(){var e=[];for(var t in this)if(this.hasOwnProperty(t)){var n=this[t];"function"==typeof n&&(n="[function]"),e.push(t+"="+n)}return"SimpleEvent("+e.join(", ")+")"};function t(e){this._events=e||[],this._listeners={}}t.prototype.emit=function(e){var t=this;if(t._verifyType(e),!t._nuked){var n=Array.prototype.slice.call(arguments,1);if(t["on"+e]&&t["on"+e].apply(t,n),e in t._listeners)for(var r=0;r<t._listeners[e].length;r++)t._listeners[e][r].apply(t,n)}},t.prototype.on=function(e,t){var n=this;n._verifyType(e),n._nuked||(e in n._listeners||(n._listeners[e]=[]),n._listeners[e].push(t))},t.prototype._verifyType=function(e){-1===f.arrIndexOf(this._events,e)&&f.log("Event "+JSON.stringify(e)+" not listed "+JSON.stringify(this._events)+" in "+this)},t.prototype.nuke=function(){var e=this;e._nuked=!0;for(var t=0;t<e._events.length;t++)delete e[e._events[t]];e._listeners={}};var i="abcdefghijklmnopqrstuvwxyz0123456789_";f.random_string=function(e,t){t=t||i.length;var n,r=[];for(n=0;n<e;n++)r.push(i.substr(Math.floor(Math.random()*t),1));return r.join("")},f.random_number=function(e){return Math.floor(Math.random()*e)},f.random_number_string=function(e){var t=(""+(e-1)).length;return(Array(t+1).join("0")+f.random_number(e)).slice(-t)},f.getOrigin=function(e){return(e+="/").split("/").slice(0,3).join("/")},f.isSameOriginUrl=function(e,t){return t=t||l.location.href,e.split("/").slice(0,3).join("/")===t.split("/").slice(0,3).join("/")},f.getParentDomain=function(e){return!/^[0-9.]*$/.test(e)&&!/^\[/.test(e)&&/[.]/.test(e)?e.split(".").slice(1).join("."):e},f.objectExtend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e};var n="_jp";f.polluteGlobalNamespace=function(){n in l||(l._jp={})},f.closeFrame=function(e,t){return"c"+JSON.stringify([e,t])},f.userSetCode=function(e){return 1e3===e||3e3<=e&&e<=4999},f.countRTO=function(e){return 100<e?3*e:e+200},f.log=function(){l.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)},f.bind=function(e,t){return e.bind?e.bind(t):function(){return e.apply(t,arguments)}},f.flatUrl=function(e){return-1===e.indexOf("?")&&-1===e.indexOf("#")},f.amendUrl=function(e){var t=u.location;if(!e)throw new Error("Wrong url for SockJS");if(!f.flatUrl(e))throw new Error("Only basic urls are supported in SockJS");return 0===e.indexOf("//")&&(e=t.protocol+e),0===e.indexOf("/")&&(e=t.protocol+"//"+t.host+e),e=e.replace(/[/]+$/,"")},f.arrIndexOf=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1},f.arrSkip=function(e,t){var n=f.arrIndexOf(e,t);return-1===n?e.slice():e.slice(0,n).concat(e.slice(n+1))},f.isArray=Array.isArray||function(e){return 0<={}.toString.call(e).indexOf("Array")},f.delay=function(e,t){return"function"==typeof e&&(t=e,e=0),setTimeout(t,e)};var r,o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a={"\0":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","\t":"\\t","\n":"\\n","\v":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","":"\\u0080","":"\\u0081","":"\\u0082","":"\\u0083","":"\\u0084","":"\\u0085","":"\\u0086","":"\\u0087","":"\\u0088","":"\\u0089","":"\\u008a","":"\\u008b","":"\\u008c","":"\\u008d","":"\\u008e","":"\\u008f","":"\\u0090","":"\\u0091","":"\\u0092","":"\\u0093","":"\\u0094","":"\\u0095","":"\\u0096","":"\\u0097","":"\\u0098","":"\\u0099","":"\\u009a","":"\\u009b","":"\\u009c","":"\\u009d","":"\\u009e","":"\\u009f","­":"\\u00ad","؀":"\\u0600","؁":"\\u0601","؂":"\\u0602","؃":"\\u0603","؄":"\\u0604","܏":"\\u070f","឴":"\\u17b4","឵":"\\u17b5","‌":"\\u200c","‍":"\\u200d","‎":"\\u200e","‏":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","‪":"\\u202a","‫":"\\u202b","‬":"\\u202c","‭":"\\u202d","‮":"\\u202e"," ":"\\u202f","⁠":"\\u2060","⁡":"\\u2061","⁢":"\\u2062","⁣":"\\u2063","⁤":"\\u2064","⁥":"\\u2065","⁦":"\\u2066","⁧":"\\u2067","⁨":"\\u2068","⁩":"\\u2069","⁪":"\\u206a","⁫":"\\u206b","⁬":"\\u206c","⁭":"\\u206d","⁮":"\\u206e","⁯":"\\u206f","\ufeff":"\\ufeff","￰":"\\ufff0","￱":"\\ufff1","￲":"\\ufff2","￳":"\\ufff3","￴":"\\ufff4","￵":"\\ufff5","￶":"\\ufff6","￷":"\\ufff7","￸":"\\ufff8","￹":"\\ufff9","￺":"\\ufffa","￻":"\\ufffb","￼":"\\ufffc","�":"\\ufffd","￾":"\\ufffe","￿":"\\uffff"},c=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,d=JSON&&JSON.stringify||function(e){return o.lastIndex=0,o.test(e)&&(e=e.replace(o,function(e){return a[e]})),'"'+e+'"'};f.quote=function(e){var t=d(e);return c.lastIndex=0,c.test(t)?(r=r||function(e){var t,n={},r=[];for(t=0;t<65536;t++)r.push(String.fromCharCode(t));return e.lastIndex=0,r.join("").replace(e,function(e){return n[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,n}(c),t.replace(c,function(e){return r[e]})):t};var p=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];f.probeProtocols=function(){for(var e={},t=0;t<p.length;t++){var n=p[t];e[n]=_[n]&&_[n].enabled()}return e},f.detectProtocols=function(e,t,n){var r={},i=[];t=t||p;for(var o=0;o<t.length;o++){var a=t[o];r[a]=e[a]}var s=function(e){var t=e.shift();r[t]?i.push(t):0<e.length&&s(e)};return!1!==n.websocket&&s(["websocket"]),r["xhr-streaming"]&&!n.null_origin?i.push("xhr-streaming"):!r["xdr-streaming"]||n.cookie_needed||n.null_origin?s(["iframe-eventsource","iframe-htmlfile"]):i.push("xdr-streaming"),r["xhr-polling"]&&!n.null_origin?i.push("xhr-polling"):!r["xdr-polling"]||n.cookie_needed||n.null_origin?s(["iframe-xhr-polling","jsonp-polling"]):i.push("xdr-polling"),i};var h="_sockjs_global";f.createHook=function(){var e="a"+f.random_string(8);if(!(h in l)){var t={};l[h]=function(e){return e in t||(t[e]={id:e,del:function(){delete t[e]}}),t[e]}}return l[h](e)},f.attachMessage=function(e){f.attachEvent("message",e)},f.attachEvent=function(e,t){void 0!==l.addEventListener?l.addEventListener(e,t,!1):(u.attachEvent("on"+e,t),l.attachEvent("on"+e,t))},f.detachMessage=function(e){f.detachEvent("message",e)},f.detachEvent=function(e,t){void 0!==l.addEventListener?l.removeEventListener(e,t,!1):(u.detachEvent("on"+e,t),l.detachEvent("on"+e,t))};function m(){for(var e in v)v[e](),delete v[e]}var v={},g=!1;f.attachEvent("unload",function(){g||(g=!0,m())}),f.unload_add=function(e){var t=f.random_string(8);return v[t]=e,g&&f.delay(m),t},f.unload_del=function(e){e in v&&delete v[e]},f.createIframe=function(e,t){function n(){clearTimeout(o);try{s.onload=null}catch(e){}s.onerror=null}function r(){s&&(n(),setTimeout(function(){s&&s.parentNode.removeChild(s),s=null},0),f.unload_del(a))}function i(e){s&&(r(),t(e))}var o,a,s=u.createElement("iframe");return s.src=e,s.style.display="none",s.style.position="absolute",s.onerror=function(){i("onerror")},s.onload=function(){clearTimeout(o),o=setTimeout(function(){i("onload timeout")},2e3)},u.body.appendChild(s),o=setTimeout(function(){i("timeout")},15e3),a=f.unload_add(r),{post:function(e,t){try{s&&s.contentWindow&&s.contentWindow.postMessage(e,t)}catch(e){}},cleanup:r,loaded:n}},f.createHtmlfile=function(e,t){function n(){clearTimeout(i)}function r(){s&&(n(),f.unload_del(o),a.parentNode.removeChild(a),a=s=null,CollectGarbage())}var i,o,a,s=new ActiveXObject("htmlfile");s.open(),s.write('<html><script>document.domain="'+document.domain+'";<\/script></html>'),s.close(),s.parentWindow._jp=l._jp;var c=s.createElement("div");return s.body.appendChild(c),a=s.createElement("iframe"),c.appendChild(a),a.src=e,i=setTimeout(function(){var e;e="timeout",s&&(r(),t(e))},15e3),o=f.unload_add(r),{post:function(e,t){try{a&&a.contentWindow&&a.contentWindow.postMessage(e,t)}catch(e){}},cleanup:r,loaded:n}};function y(){}(y.prototype=new t(["chunk","finish"]))._start=function(e,t,n,r){var i=this;try{i.xhr=new XMLHttpRequest}catch(e){}if(!i.xhr)try{i.xhr=new l.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}(l.ActiveXObject||l.XDomainRequest)&&(t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date),i.unload_ref=f.unload_add(function(){i._cleanup(!0)});try{i.xhr.open(e,t,!0)}catch(e){return i.emit("finish",0,""),void i._cleanup()}if(r&&r.no_credentials||(i.xhr.withCredentials="true"),r&&r.headers)for(var o in r.headers)i.xhr.setRequestHeader(o,r.headers[o]);i.xhr.onreadystatechange=function(){if(i.xhr){var e=i.xhr;switch(e.readyState){case 3:try{var t=e.status,n=e.responseText}catch(e){}1223===t&&(t=204),n&&0<n.length&&i.emit("chunk",t,n);break;case 4:1223===(t=e.status)&&(t=204),i.emit("finish",t,e.responseText),i._cleanup(!1)}}},i.xhr.send(n)},y.prototype._cleanup=function(e){var t=this;if(t.xhr){if(f.unload_del(t.unload_ref),t.xhr.onreadystatechange=function(){},e)try{t.xhr.abort()}catch(e){}t.unload_ref=t.xhr=null}},y.prototype.close=function(){this.nuke(),this._cleanup(!0)},(f.XHRCorsObject=function(){var e=this,t=arguments;f.delay(function(){e._start.apply(e,t)})}).prototype=new y,(f.XHRLocalObject=function(e,t,n){var r=this;f.delay(function(){r._start(e,t,n,{no_credentials:!0})})}).prototype=new y;var b=f.XDRObject=function(e,t,n){var r=this;f.delay(function(){r._start(e,t,n)})};b.prototype=new t(["chunk","finish"]),b.prototype._start=function(e,t,n){var r=this,i=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date;var o=i.ontimeout=i.onerror=function(){r.emit("finish",0,""),r._cleanup(!1)};i.onprogress=function(){r.emit("chunk",200,i.responseText)},i.onload=function(){r.emit("finish",200,i.responseText),r._cleanup(!1)},r.xdr=i,r.unload_ref=f.unload_add(function(){r._cleanup(!0)});try{r.xdr.open(e,t),r.xdr.send(n)}catch(e){o()}},b.prototype._cleanup=function(e){var t=this;if(t.xdr){if(f.unload_del(t.unload_ref),t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null,e)try{t.xdr.abort()}catch(e){}t.unload_ref=t.xdr=null}},b.prototype.close=function(){this.nuke(),this._cleanup(!0)},f.isXHRCorsCapable=function(){return l.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:l.XDomainRequest&&u.domain?2:M.enabled()?3:4};var _=function(e,t,n){if(this===l)return new _(e,t,n);var r,i=this;i._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},n&&f.objectExtend(i._options,n),i._base_url=f.amendUrl(e),i._server=i._options.server||f.random_number_string(1e3),i._options.protocols_whitelist&&i._options.protocols_whitelist.length?r=i._options.protocols_whitelist:(r="string"==typeof t&&0<t.length?[t]:f.isArray(t)?t:null)&&i._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.'),i._protocols=[],i.protocol=null,i.readyState=_.CONNECTING,i._ir=B(i._base_url),i._ir.onfinish=function(e,t){i._ir=null,e?(i._options.info&&(e=f.objectExtend(e,i._options.info)),i._options.rtt&&(t=i._options.rtt),i._applyInfo(e,t,r),i._didClose()):i._didClose(1002,"Can't connect to server",!0)}};_.prototype=new e,_.version="0.3.4",_.CONNECTING=0,_.OPEN=1,_.CLOSING=2,_.CLOSED=3,_.prototype._debug=function(){this._options.debug&&f.log.apply(f,arguments)},_.prototype._dispatchOpen=function(){var e=this;e.readyState===_.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=_.OPEN,e.dispatchEvent(new s("open"))):e._didClose(1006,"Server lost session")},_.prototype._dispatchMessage=function(e){this.readyState===_.OPEN&&this.dispatchEvent(new s("message",{data:e}))},_.prototype._dispatchHeartbeat=function(e){this.readyState===_.OPEN&&this.dispatchEvent(new s("heartbeat",{}))},_.prototype._didClose=function(e,t,n){var r=this;if(r.readyState!==_.CONNECTING&&r.readyState!==_.OPEN&&r.readyState!==_.CLOSING)throw new Error("INVALID_STATE_ERR");r._ir&&(r._ir.nuke(),r._ir=null),r._transport&&(r._transport.doCleanup(),r._transport=null);var i=new s("close",{code:e,reason:t,wasClean:f.userSetCode(e)});if(!f.userSetCode(e)&&r.readyState===_.CONNECTING&&!n){if(r._try_next_protocol(i))return;i=new s("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:i})}r.readyState=_.CLOSED,f.delay(function(){r.dispatchEvent(i)})},_.prototype._didMessage=function(e){var t=this;switch(e.slice(0,1)){case"o":t._dispatchOpen();break;case"a":for(var n=JSON.parse(e.slice(1)||"[]"),r=0;r<n.length;r++)t._dispatchMessage(n[r]);break;case"m":n=JSON.parse(e.slice(1)||"null");t._dispatchMessage(n);break;case"c":n=JSON.parse(e.slice(1)||"[]");t._didClose(n[0],n[1]);break;case"h":t._dispatchHeartbeat()}},_.prototype._try_next_protocol=function(e){var t=this;for(t.protocol&&(t._debug("Closed transport:",t.protocol,""+e),t.protocol=null),t._transport_tref&&(clearTimeout(t._transport_tref),t._transport_tref=null);;){var n=t.protocol=t._protocols.shift();if(!n)return!1;if(_[n]&&!0===_[n].need_body&&(!u.body||void 0!==u.readyState&&"complete"!==u.readyState))return t._protocols.unshift(n),t.protocol="waiting-for-load",f.attachEvent("load",function(){t._try_next_protocol()}),!0;if(_[n]&&_[n].enabled(t._options)){var r=_[n].roundTrips||1,i=(t._options.rto||0)*r||5e3;t._transport_tref=f.delay(i,function(){t.readyState===_.CONNECTING&&t._didClose(2007,"Transport timeouted")});var o=f.random_string(8),a=t._base_url+"/"+t._server+"/"+o;return t._debug("Opening transport:",n," url:"+a," RTO:"+t._options.rto),t._transport=new _[n](t,a,t._base_url),!0}t._debug("Skipping transport:",n)}},_.prototype.close=function(e,t){if(e&&!f.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");return(this.readyState===_.CONNECTING||this.readyState===_.OPEN)&&(this.readyState=_.CLOSING,this._didClose(e||1e3,t||"Normal closure"),!0)},_.prototype.send=function(e){if(this.readyState===_.CONNECTING)throw new Error("INVALID_STATE_ERR");return this.readyState===_.OPEN&&this._transport.doSend(f.quote(""+e)),!0},_.prototype._applyInfo=function(e,t,n){var r=this;r._options.info=e,r._options.rtt=t,r._options.rto=f.countRTO(t),r._options.info.null_origin=!u.domain;var i=f.probeProtocols();r._protocols=f.detectProtocols(i,n,e)};var S=_.websocket=function(e,t){var n=this,r=t+"/websocket";r="https"===r.slice(0,5)?"wss"+r.slice(5):"ws"+r.slice(4),n.ri=e,n.url=r;var i=l.WebSocket||l.MozWebSocket;n.ws=new i(n.url),n.ws.onmessage=function(e){n.ri._didMessage(e.data)},n.unload_ref=f.unload_add(function(){n.ws.close()}),n.ws.onclose=function(){n.ri._didMessage(f.closeFrame(1006,"WebSocket connection broken"))}};S.prototype.doSend=function(e){this.ws.send("["+e+"]")},S.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),f.unload_del(e.unload_ref),e.unload_ref=e.ri=e.ws=null)},S.enabled=function(){return!(!l.WebSocket&&!l.MozWebSocket)},S.roundTrips=2;function C(){}C.prototype.send_constructor=function(e){this.send_buffer=[],this.sender=e},C.prototype.doSend=function(e){this.send_buffer.push(e),this.send_stop||this.send_schedule()},C.prototype.send_schedule_wait=function(){var e,t=this;t.send_stop=function(){t.send_stop=null,clearTimeout(e)},e=f.delay(25,function(){t.send_stop=null,t.send_schedule()})},C.prototype.send_schedule=function(){var n=this;if(0<n.send_buffer.length){var e="["+n.send_buffer.join(",")+"]";n.send_stop=n.sender(n.trans_url,e,function(e,t){n.send_stop=null,!1===e?n.ri._didClose(1006,"Sending error "+t):n.send_schedule_wait()}),n.send_buffer=[]}},C.prototype.send_destructor=function(){this._send_stop&&this._send_stop(),this._send_stop=null};function w(e,t,n){var r=this;if(!("_send_form"in r)){var i=r._send_form=u.createElement("form");(a=r._send_area=u.createElement("textarea")).name="d",i.style.display="none",i.style.position="absolute",i.method="POST",i.enctype="application/x-www-form-urlencoded",i.acceptCharset="UTF-8",i.appendChild(a),u.body.appendChild(i)}i=r._send_form;var o,a=r._send_area,s="a"+f.random_string(8);i.target=s,i.action=e+"/jsonp_send?i="+s;try{o=u.createElement('<iframe name="'+s+'">')}catch(e){(o=u.createElement("iframe")).name=s}o.id=s,i.appendChild(o),o.style.display="none";try{a.value=t}catch(e){f.log("Your browser is seriously broken. Go home! "+e.message)}function c(e){o.onerror&&(o.onreadystatechange=o.onerror=o.onload=null,f.delay(500,function(){o.parentNode.removeChild(o),o=null}),a.value="",n(!0))}return i.submit(),o.onerror=o.onload=c,o.onreadystatechange=function(e){"complete"==o.readyState&&c()},c}function T(e,t){function n(e){i&&(i.parentNode.removeChild(i),i=null),o&&(clearTimeout(r),o.parentNode.removeChild(o),o.onreadystatechange=o.onerror=o.onload=o.onclick=null,o=null,t(e),t=null)}var r,i,o=u.createElement("script"),a=!1,s=null;if(o.id="a"+f.random_string(8),o.src=e,o.type="text/javascript",o.charset="UTF-8",o.onerror=function(e){s=s||setTimeout(function(){a||n(f.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3)},o.onload=function(e){n(f.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},o.onreadystatechange=function(e){if(/loaded|closed/.test(o.readyState)){if(o&&o.htmlFor&&o.onclick){a=!0;try{o.onclick()}catch(e){}}o&&n(f.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},void 0===o.async&&u.attachEvent)if(/opera/i.test(navigator.userAgent))(i=u.createElement("script")).text="try{var a = document.getElementById('"+o.id+"'); if(a)a.onerror();}catch(x){};",o.async=i.async=!1;else{try{o.htmlFor=o.id,o.event="onclick"}catch(e){}o.async=!0}void 0!==o.async&&(o.async=!0),r=setTimeout(function(){n(f.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var c=u.getElementsByTagName("head")[0];return c.insertBefore(o,c.firstChild),i&&c.insertBefore(i,c.firstChild),n}var R=_["jsonp-polling"]=function(e,t){f.polluteGlobalNamespace();this.ri=e,this.trans_url=t,this.send_constructor(w),this._schedule_recv()};R.prototype=new C,R.prototype._schedule_recv=function(){var t=this;t._recv_stop=k(t.trans_url+"/jsonp",T,function(e){t._recv_stop=null,e&&(t._is_closing||t.ri._didMessage(e)),t._is_closing||t._schedule_recv()})},R.enabled=function(){return!0},R.need_body=!0,R.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};function E(){}var k=function(e,t,n){var r="a"+f.random_string(6),i=e+"?c="+escape("_jp."+r),o=0,a=t(i,function(e){switch(o){case 0:delete l._jp[r],n(e);break;case 1:n(e),o=2;break;case 2:delete l._jp[r]}});l._jp[r]=a;return function(){l._jp[r]&&(o=1,l._jp[r](f.closeFrame(1e3,"JSONP user aborted read")))}};(E.prototype=new C).run=function(e,t,n,r,i){var o;this.ri=e,this.trans_url=t,this.send_constructor((o=i,function(e,t,n){return new o("POST",e+"/xhr_send",t).onfinish=function(e,t){n(200===e||204===e,"http status "+e)},function(e){n(!1,e)}})),this.poll=new q(e,r,t+n,i)},E.prototype.doCleanup=function(){this.poll&&(this.poll.abort(),this.poll=null)};var P=_["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",Y,f.XHRCorsObject)};P.prototype=new E,P.enabled=function(){return l.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},P.roundTrips=2,P.need_body=!0;var x=_["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",Y,f.XDRObject)};x.prototype=new E,x.enabled=function(){return!!l.XDomainRequest},x.roundTrips=2;var O=_["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",Y,f.XHRCorsObject)};O.prototype=new E,O.enabled=P.enabled,O.roundTrips=2;var A=_["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",Y,f.XDRObject)};A.prototype=new E,A.enabled=x.enabled,A.roundTrips=2;var I,M=function(){};M.prototype.i_constructor=function(e,t,n){var r=this;r.ri=e,r.origin=f.getOrigin(n),r.base_url=n,r.trans_url=t;var i=n+"/iframe.html";r.ri._options.devel&&(i+="?t="+ +new Date),r.window_id=f.random_string(8),i+="#"+r.window_id,r.iframeObj=f.createIframe(i,function(e){r.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),r.onmessage_cb=f.bind(r.onmessage,r),f.attachMessage(r.onmessage_cb)},M.prototype.doCleanup=function(){var e=this;if(e.iframeObj){f.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(e){}e.iframeObj.cleanup(),e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},M.prototype.onmessage=function(e){var t=this;if(e.origin===t.origin){var n=e.data.slice(0,8),r=e.data.slice(8,9),i=e.data.slice(9);if(n===t.window_id)switch(r){case"s":t.iframeObj.loaded(),t.postMessage("s",JSON.stringify([_.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(i)}}},M.prototype.postMessage=function(e,t){this.iframeObj.post(this.window_id+e+(t||""),this.origin)},M.prototype.doSend=function(e){this.postMessage("m",e)},M.enabled=function(){var e=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof l.postMessage||"object"==typeof l.postMessage)&&!e};function D(e,t){parent!==l?parent.postMessage(I+e+(t||""),"*"):f.log("Can't postMessage, no parent window.",e,t)}function N(){}N.prototype._didClose=function(e,t){D("t",f.closeFrame(e,t))},N.prototype._didMessage=function(e){D("t",e)},N.prototype._doSend=function(e){this._transport.doSend(e)},N.prototype._doCleanup=function(){this._transport.doCleanup()},f.parent_origin=void 0,_.bootstrap_iframe=function(){var d;I=u.location.hash.slice(1);f.attachMessage(function(e){if(e.source===parent&&(void 0===f.parent_origin&&(f.parent_origin=e.origin),e.origin===f.parent_origin)){var t=e.data.slice(0,8),n=e.data.slice(8,9),r=e.data.slice(9);if(t===I)switch(n){case"s":var i=JSON.parse(r),o=i[0],a=i[1],s=i[2],c=i[3];if(o!==_.version&&f.log('Incompatibile SockJS! Main site uses: "'+o+'", the iframe: "'+_.version+'".'),!f.flatUrl(s)||!f.flatUrl(c))return void f.log("Only basic urls are supported in SockJS");if(!f.isSameOriginUrl(s)||!f.isSameOriginUrl(c))return void f.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([l.location.href,s,c])+")");(d=new N)._transport=new N[a](d,s,c);break;case"m":d._doSend(r);break;case"c":d&&d._doCleanup(),d=null}}}),D("s")};function L(e,t){var n=this;f.delay(function(){n.doXhr(e,t)})}(L.prototype=new t(["finish"])).doXhr=function(e,t){var i=this,o=(new Date).getTime(),n=new t("GET",e+"/info"),a=f.delay(8e3,function(){n.ontimeout()});n.onfinish=function(e,t){if(clearTimeout(a),a=null,200===e){var n=(new Date).getTime()-o,r=JSON.parse(t);"object"!=typeof r&&(r={}),i.emit("finish",r,n)}else i.emit("finish")},n.ontimeout=function(){n.close(),i.emit("finish")}};function U(n){function e(){var i=new M;function e(e){if("string"==typeof e&&"m"===e.substr(0,1)){var t=JSON.parse(e.substr(1)),n=t[0],r=t[1];o.emit("finish",n,r)}else o.emit("finish");i.doCleanup(),i=null}i.protocol="w-iframe-info-receiver";var t={_options:{},_didClose:e,_didMessage:e};i.i_constructor(t,n,n)}var o=this;u.body?e():f.attachEvent("load",e)}U.prototype=new t(["finish"]);function j(){var e=this;f.delay(function(){e.emit("finish",{},2e3)})}j.prototype=new t(["finish"]);var B=function(e){if(f.isSameOriginUrl(e))return new L(e,f.XHRLocalObject);switch(f.isXHRCorsCapable()){case 1:return new L(e,f.XHRLocalObject);case 2:return new L(e,f.XDRObject);case 3:return new U(e);default:return new j}};(N["w-iframe-info-receiver"]=function(n,e,t){new L(t,f.XHRLocalObject).onfinish=function(e,t){n._didMessage("m"+JSON.stringify([e,t])),n._didClose()}}).prototype.doCleanup=function(){};var F=_["iframe-eventsource"]=function(){this.protocol="w-iframe-eventsource",this.i_constructor.apply(this,arguments)};F.prototype=new M,F.enabled=function(){return"EventSource"in l&&M.enabled()},F.need_body=!0,F.roundTrips=3,(N["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",J,f.XHRLocalObject)}).prototype=new E;var z=_["iframe-xhr-polling"]=function(){this.protocol="w-iframe-xhr-polling",this.i_constructor.apply(this,arguments)};z.prototype=new M,z.enabled=function(){return l.XMLHttpRequest&&M.enabled()},z.need_body=!0,z.roundTrips=3,(N["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",Y,f.XHRLocalObject)}).prototype=new E;var G=_["iframe-htmlfile"]=function(){this.protocol="w-iframe-htmlfile",this.i_constructor.apply(this,arguments)};G.prototype=new M,G.enabled=function(){return M.enabled()},G.need_body=!0,G.roundTrips=3,(N["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",H,f.XHRLocalObject)}).prototype=new E;var q=function(e,t,n,r){var i=this;i.ri=e,i.Receiver=t,i.recv_url=n,i.AjaxObject=r,i._scheduleRecv()};q.prototype._scheduleRecv=function(){var t=this,n=t.poll=new t.Receiver(t.recv_url,t.AjaxObject);n.onmessage=function(e){t.ri._didMessage(e.data)},n.onclose=function(e){t.poll=n=n.onmessage=n.onclose=null,t.poll_is_closing||("permanent"===e.reason?t.ri._didClose(1006,"Polling error ("+e.reason+")"):t._scheduleRecv())}},q.prototype.abort=function(){this.poll_is_closing=!0,this.poll&&this.poll.abort()};var V,J=function(e){var r=this,i=new EventSource(e);i.onmessage=function(e){r.dispatchEvent(new s("message",{data:unescape(e.data)}))},r.es_close=i.onerror=function(e,t){var n=t?"user":2!==i.readyState?"network":"permanent";r.es_close=i.onmessage=i.onerror=null,i.close(),i=null,f.delay(200,function(){r.dispatchEvent(new s("close",{reason:n}))})}};J.prototype=new e,J.prototype.abort=function(){this.es_close&&this.es_close({},!0)};var H=function(e){var n=this;f.polluteGlobalNamespace(),n.id="a"+f.random_string(6,26),e+=(-1===e.indexOf("?")?"?":"&")+"c="+escape("_jp."+n.id);var r,t=function(){if(void 0===V)if("ActiveXObject"in l)try{V=!!new ActiveXObject("htmlfile")}catch(e){}else V=!1;return V}()?f.createHtmlfile:f.createIframe;l._jp[n.id]={start:function(){r.loaded()},message:function(e){n.dispatchEvent(new s("message",{data:e}))},stop:function(){n.iframe_close({},"network")}},n.iframe_close=function(e,t){r.cleanup(),n.iframe_close=r=null,delete l._jp[n.id],n.dispatchEvent(new s("close",{reason:t}))},r=t(e,function(e){n.iframe_close({},"permanent")})};H.prototype=new e,H.prototype.abort=function(){this.iframe_close&&this.iframe_close({},"user")};var Y=function(e,t){var o=this,a=0;o.xo=new t("POST",e,null),o.xo.onchunk=function(e,t){if(200===e)for(;;){var n=t.slice(a),r=n.indexOf("\n");if(-1===r)break;a+=r+1;var i=n.slice(0,r);o.dispatchEvent(new s("message",{data:i}))}},o.xo.onfinish=function(e,t){o.xo.onchunk(e,t),o.xo=null;var n=200===e?"network":"permanent";o.dispatchEvent(new s("close",{reason:n}))}};return Y.prototype=new e,Y.prototype.abort=function(){this.xo&&(this.xo.close(),this.dispatchEvent(new s("close",{reason:"user"})),this.xo=null)},_.getUtils=function(){return f},_.getIframeTransport=function(){return M},_}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS})},{}],3:[function(e,t,n){"use strict";function r(e){return this.timer=null,this.abort=!1,this.timeout=e.timeout||void 0,this.url=e.url||location.pathname,this.data=e.data||{},this.type=e.type||"GET",this.onSuccess=e.onSuccess||function(){},this.onError=e.onError||function(){},this.dataType=e.dataType||"text",this.xhr=new XMLHttpRequest,this.xhr.onreadystatechange=this._readystatechange.bind(this),this._doRequest()}r.prototype={_get:function(){var e="?";for(var t in this.data)1<e.length&&(e+="&"),e+=t+"="+this.data[t];this.xhr.open(this.type,this.url+e,!0),this.xhr.send(null)},_post:function(){this.xhr.open(this.type,this.url,!0),this.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.xhr.send(this.data)},_doRequest:function(){this["POST"==this.type?"_post":"_get"](),this.timeout&&(this.timer=setTimeout(function(){this.abort=!0,this.xhr.abort()}.bind(this),1e3*this.timeout))},_readystatechange:function(){if(4==this.xhr.readyState)if(this.timer&&clearTimeout(this.timer),200==this.xhr.status){if("function"==typeof this.onSuccess){var e;switch(this.dataType){case"json":try{e=JSON.parse(this.xhr.responseText)}catch(e){log("[Ajax]",e)}break;case"xml":e=this.xhr.responseXML;break;case"text":default:e=this.xhr.responseText}this.onSuccess(e)}}else"function"==typeof this.onError&&this.onError(this.xhr,this.abort?"timeout":"error",this.xhr.statusText)}},t.exports=r},{}],4:[function(e,t,n){"use strict";var r=e("./Log");if(window.AudioContext=window.AudioContext||window.webkitAudioContext,AudioContext)var s=new AudioContext;function i(){this.processors={},this.range_start=20,this.range_end=80}i.prototype={add:function(e,i){if(AudioContext&&!e.isTemMediaStream)if(!e.getAudioTracks||e.getAudioTracks().length){var o=s.createAnalyser(),t=s.createMediaStreamSource(e),n=this.processors[e.id]=s.createScriptProcessor(2048,1,1),a=new Uint8Array(o.frequencyBinCount);o.smoothingTimeConstant=.4,o.fftSize=1024,t.connect(o),o.connect(n),n.connect(s.destination),n.onaudioprocess=function(){o.getByteFrequencyData(a);for(var e=0,t=this.range_start;t<this.range_end;t++)e+=a[t];var n=e/(this.range_end-this.range_start),r=100*Math.log(n/100+1);r=100<r?100:Math.round(r),"function"==typeof i&&i(r)}.bind(this)}else r("[AudioActivityMonitor] Current stream has no audio track to monitor")},remove:function(e){e.id in this.processors&&(this.processors[e.id].onaudioprocess=null,delete this.processors[e.id])},resume:function(){s.resume&&s.resume()}},t.exports=new i},{"./Log":14}],5:[function(e,i,t){(function(e,v){"use strict";function n(e){var t=0,n=0,r=0,i=new ArrayBuffer(e[0].byte_length+e[0].header_size),o=new DataView(i);for(n=0;n<e.length;n++){e[n].header_size;var a=e[n].type,s=e[n].length,c=e[n].value,d=e[n].byte_length,u=C[a],l=null===u?0:g[u+"Array"].BYTES_PER_ELEMENT;switch(a===S.BUFFER?o.setUint8(t,S.BLOB,!1):o.setUint8(t,a,!1),t+=y,a!==S.ARRAY&&a!==S.OBJECT||(o.setUint16(t,s,!1),t+=b),o.setUint32(t,d,!1),t+=_,a){case S.NULL:case S.UNDEFINED:break;case S.STRING:for(0,r=0;r<s;r++,t+=l)o.setUint16(t,c.charCodeAt(r),!1);break;case S.NUMBER:case S.BOOLEAN:0,o["set"+u](t,c,!1),t+=l;break;case S.INT8ARRAY:case S.INT16ARRAY:case S.INT32ARRAY:case S.UINT8ARRAY:case S.UINT16ARRAY:case S.UINT32ARRAY:case S.FLOAT32ARRAY:case S.FLOAT64ARRAY:new Uint8Array(o.buffer,t,d).set(new Uint8Array(c.buffer)),t+=d;break;case S.ARRAYBUFFER:case S.BUFFER:new Uint8Array(o.buffer,t,d).set(new Uint8Array(c)),t+=d;break;case S.BLOB:case S.ARRAY:case S.OBJECT:break;default:throw"TypeError: Unexpected type found."}0}return o}function f(e,i){for(var o=e.length,a=[],s=0,c=0,t=0;t<e.length;t++)!function(r){d(e[r],function(e){if(a[r]=e,c+=e[0].header_size+e[0].byte_length,++s===o){for(var t=[],n=0;n<a.length;n++)t=t.concat(a[n]);i(t,c)}})}(t)}function r(e,t){var n=new DataView(e);return w(n,0).value}var g,y,b,_,S,C,w,d,t;g=void 0!==e?e:this,y=Uint8Array.BYTES_PER_ELEMENT,b=Uint16Array.BYTES_PER_ELEMENT,_=Uint32Array.BYTES_PER_ELEMENT,S={NULL:0,UNDEFINED:1,STRING:2,NUMBER:3,BOOLEAN:4,ARRAY:5,OBJECT:6,INT8ARRAY:7,INT16ARRAY:8,INT32ARRAY:9,UINT8ARRAY:10,UINT16ARRAY:11,UINT32ARRAY:12,FLOAT32ARRAY:13,FLOAT64ARRAY:14,ARRAYBUFFER:15,BLOB:16,FILE:16,BUFFER:17},C=[null,null,"Uint16","Float64","Uint8",null,null,"Int8","Int16","Int32","Uint8","Uint16","Uint32","Float32","Float64","Uint8","Uint8","Uint8"],w=function(e,t){var n,r,i,o,a,s=0;n=e.getUint8(t,!1),t+=y,n!==S.ARRAY&&n!==S.OBJECT||(r=e.getUint16(t,!1),t+=b),i=e.getUint32(t,!1),t+=_;var c=C[n],d=null===c?0:g[c+"Array"].BYTES_PER_ELEMENT;switch(n){case S.NULL:case S.UNDEFINED:0,o=null;break;case S.STRING:r=i/d;var u=[];for(s=0;s<r;s++){var l=e.getUint16(t,!1);t+=d,u.push(String.fromCharCode(l))}o=u.join("");break;case S.NUMBER:o=e.getFloat64(t,!1),t+=d;break;case S.BOOLEAN:o=1===e.getUint8(t,!1),t+=d;break;case S.INT8ARRAY:case S.INT16ARRAY:case S.INT32ARRAY:case S.UINT8ARRAY:case S.UINT16ARRAY:case S.UINT32ARRAY:case S.FLOAT32ARRAY:case S.FLOAT64ARRAY:case S.ARRAYBUFFER:a=e.buffer.slice(t,t+i),t+=i,o=n===S.ARRAYBUFFER?a:new g[c+"Array"](a);break;case S.BLOB:if(0,g.Blob){var f=w(e,t),p=w(e,f.cursor);t=p.cursor,o=new Blob([p.value],{type:f.value})}else a=e.buffer.slice(t,t+i),t+=i,o=new v(a);break;case S.ARRAY:for(0,o=[],s=0;s<r;s++)t=(a=w(e,t)).cursor,o.push(a.value);break;case S.OBJECT:for(0,o={},s=0;s<r;s++){var h=w(e,t),m=w(e,h.cursor);t=m.cursor,o[h.value]=m.value}break;default:throw"TypeError: Type not supported."}return{value:o,cursor:t}},d=function(n,r){var e,i,o=y+_,t=0,a=0,s=n;switch(i=function(e){var t=void 0;if(void 0===e)t=S.UNDEFINED;else if(null===e)t=S.NULL;else{var n=e.constructor.name;if(void 0!==n)t=S[n.toUpperCase()];else switch(typeof e){case"string":t=S.STRING;break;case"number":t=S.NUMBER;break;case"boolean":t=S.BOOLEAN;break;case"object":e instanceof Array?t=S.ARRAY:e instanceof Int8Array?t=S.INT8ARRAY:e instanceof Int16Array?t=S.INT16ARRAY:e instanceof Int32Array?t=S.INT32ARRAY:e instanceof Uint8Array?t=S.UINT8ARRAY:e instanceof Uint16Array?t=S.UINT16ARRAY:e instanceof Uint32Array?t=S.UINT32ARRAY:e instanceof Float32Array?t=S.FLOAT32ARRAY:e instanceof Float64Array?t=S.FLOAT64ARRAY:e instanceof ArrayBuffer?t=S.ARRAYBUFFER:e instanceof Blob?t=S.BLOB:e instanceof v?t=S.BUFFER:e instanceof Object&&(t=S.OBJECT)}}return t}(n),e=null==C[i]?0:g[C[i]+"Array"].BYTES_PER_ELEMENT,i){case S.UNDEFINED:case S.NULL:break;case S.NUMBER:case S.BOOLEAN:t=e;break;case S.STRING:t+=(a=n.length)*e;break;case S.INT8ARRAY:case S.INT16ARRAY:case S.INT32ARRAY:case S.UINT8ARRAY:case S.UINT16ARRAY:case S.UINT32ARRAY:case S.FLOAT32ARRAY:case S.FLOAT64ARRAY:t+=(a=n.length)*e;break;case S.ARRAY:return void f(n,function(e,t){r([{type:i,length:n.length,header_size:o+b,byte_length:t,value:null}].concat(e))});case S.OBJECT:var c=[];for(var d in n)n.hasOwnProperty(d)&&(c.push(d),c.push(n[d]),a++);return void f(c,function(e,t){r([{type:i,length:a,header_size:o+b,byte_length:t,value:null}].concat(e))});case S.ARRAYBUFFER:t+=n.byteLength;break;case S.BLOB:var u=n.type,l=new FileReader;return l.onload=function(e){f([u,e.target.result],function(e,t){r([{type:i,length:a,header_size:o,byte_length:t,value:null}].concat(e))})},l.onerror=function(e){throw"FileReader Error: "+e},void l.readAsArrayBuffer(n);case S.BUFFER:t+=n.length;break;default:throw'TypeError: Type "'+n.constructor.name+'" not supported.'}r([{type:i,length:a,header_size:o,byte_length:t,value:s}].concat([]))},t={pack:function(e,t){try{0,d(e,function(e){t(n(e))})}catch(e){throw e}},unpack:function(e,t){try{0;var n=r(e);0,t(n)}catch(e){throw e}}},void 0!==i&&i.exports?i.exports=t:g.binarize=t}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer)},{buffer:37}],6:[function(e,t,n){"use strict";e("./Log");var r=e("./Utils");function p(e,t){this.username=e,this.credential=t,this.urls=[]}function i(){this.VERSION="3.4.0b33",this.API_SERVER="https://signaling.bistri.com",this.DEBUG=!1,this.AUTO_CALL=!0,this.FORCE_TURN=!1,this.TCP_ONLY=!1,this.TURN_SERVERS=[],this.STUN_SERVERS=[],this.PLUGIN_URL=void 0,this.CHROME_EXT_ID=void 0,this.FIREFOX_EXT_ID=void 0,this.EXT_AUTO_RELOAD=!0,this.AUTO_RECONNECT=!1,this.STATS_INTERVAL=4,this.USER_ID=void 0,this.localTurnServers=!1,this.localStunServers=!1}i.prototype={set:function(e){var d=r.isChrome(),u=r.isFirefox(),t=r.isEdgeORTC(),l=r.getBrowser().version,f=t?["udp"]:["udp","tcp"];e.hasOwnProperty("debug")&&(this.DEBUG=e.debug),e.hasOwnProperty("autoAcceptCall")&&(this.AUTO_CALL=e.autoAcceptCall),e.apiServer&&(this.API_SERVER=e.apiServer),e.userId&&(this.USER_ID=e.userId),e.chromeExtId&&(this.CHROME_EXT_ID=e.chromeExtId),e.firefoxExtId&&(this.FIREFOX_EXT_ID=e.firefoxExtId),e.hasOwnProperty("forceTURN")&&(this.FORCE_TURN=e.forceTURN),e.hasOwnProperty("tcpOnly")&&(this.TCP_ONLY=e.tcpOnly),e.hasOwnProperty("extAutoReload")&&(this.EXT_AUTO_RELOAD=e.extAutoReload),e.hasOwnProperty("autoReconnect")&&(this.AUTO_RECONNECT=e.autoReconnect),e.hasOwnProperty("statsInterval")&&(this.STATS_INTERVAL=e.statsInterval),e.turn&&!this.localTurnServers&&(this.TURN_SERVERS=[],e.turn.forEach(function(e){for(var t=e.url.split("@"),n=t[0],r=t[1],i=e.credential,o=d&&38<=l||u&&53<=l?"turns:":"turn:",a=null,s=0;s<this.TURN_SERVERS.length;s++){var c=this.TURN_SERVERS[s];c.username==n&&c.credential==i&&(a=c)}a||(a=new p(n,i),this.TURN_SERVERS.push(a)),f.forEach(function(e){a.urls.push(o+r+"?transport="+e)})}.bind(this))),e.stun&&!this.localStunServers&&(this.STUN_SERVERS=[{urls:[]}],e.stun.forEach(function(e){this.STUN_SERVERS[0].urls.push("stun:"+e)}.bind(this))),e.turnServers&&e.turnServers.length&&(this.localTurnServers=!0,this.TURN_SERVERS=e.turnServers),e.stunServers&&e.stunServers.length&&(this.localStunServers=!0,this.STUN_SERVERS=e.stunServers)}},t.exports=new i},{"./Log":14,"./Utils":32}],7:[function(e,t,n){"use strict";function r(e,t,n){this.name=e,this.size=t,this.type=n,this.buffer=[],this.totalChunksSize=0}r.prototype={onFileReady:function(){},onFileComplete:function(){},start:function(){this.onFileReady()},append:function(e){if(this.buffer[e.id]=e.chunk,this.totalChunksSize+=e.chunk.byteLength||e.chunk.size,this.totalChunksSize==this.size){var t=new window.Blob(this.buffer,{type:this.type});this.buffer=null,this.onFileComplete(URL.createObjectURL(t))}}},t.exports=r},{}],8:[function(e,t,n){"use strict";var o=e("./Log"),a=e("./PubSub");function r(e,t,n){var r=e.label,i="[Data Channel "+n+"-"+t+"-"+r+"] ";e.onopen=function(){o(i+"On Open"),this.onOpen.apply(this,arguments),a.publish("_onDataChannelOpened",t,n,r)}.bind(this),e.onclose=function(){o(i+"On Close"),this.onClose.apply(this,arguments),a.publish("_onDataChannelClosed",t,n,r)}.bind(this),e.onmessage=function(e){o(i+"On Message",e),this.onMessage.apply(this,arguments)}.bind(this),e.onerror=function(e){o(i+"On Error",e),this.onError.apply(this,arguments),a.publish("_onDataChannelError",t,n,r)}.bind(this),this.label=e.label,this.onOpen=function(){},this.onClose=function(){},this.onMessage=function(){},this.onError=function(){},this._channel=e}r.prototype={send:function(){this._channel.send.apply(this._channel,arguments)},close:function(){this._channel.close.apply(this._channel,arguments)}},t.exports=r},{"./Log":14,"./PubSub":22}],9:[function(e,t,n){"use strict";var r=e("./Log"),i=e("./PubSub");function o(){}o.prototype={bind:function(e,t){return/^on/.test(e)||(e="on"+e.charAt(0).toUpperCase()+e.slice(1)),-1!=this._events.indexOf(e)?"function"!=typeof t?(r("[DataChannels] Handler is not a function"),null):i.subscribe(e,t.bind(this)):(r("[DataChannels] Unknown event: "+e),null)},unbind:function(e){return i.unsubscribe(e)},addHandler:function(e,t){this.bind.apply(this,arguments)},removeHandler:function(){this.unbind.apply(this,arguments)},_events:["onDataChannelCreated","onDataChannelRequested"]},t.exports=new o},{"./Log":14,"./PubSub":22}],10:[function(e,t,n){"use strict";var r=e("./Log"),i=e("./PubSub");function o(){}o.prototype={bind:function(e,t){return/^on/.test(e)||(e="on"+e.charAt(0).toUpperCase()+e.slice(1)),-1!=this._events.indexOf(e)?"function"!=typeof t?(r("[FileTransfer] Handler is not a function"),null):i.subscribe(e,t.bind(this)):(r("[FileTransfer] Unknown event: "+e),null)},unbind:function(e){return i.unsubscribe(e)},addHandler:function(e,t){this.bind.apply(this,arguments)},removeHandler:function(){this.unbind.apply(this,arguments)},_events:["onFileSent","onFileReceived","onFileTransferProgress","onFileTransferBitrate","onFileTransferWaiting","onFileTransferAborted","onNewFileTransfer"]},t.exports=new o},{"./Log":14,"./PubSub":22}],11:[function(e,t,n){"use strict";var d=e("./Log"),u=e("./PubSub"),l=e("./TransferManager");t.exports=function(t,n,r,i,e,o,a){var s=new l(e,i,o),c="[Send File "+i+"-"+n+"-"+r+"] ";s.onEmit=function(e){t.send(e)},s.onEnd=function(e){t.close()},t.onmessage=function(e){s.onReceive(e)},t.onopen=function(){d(c+"On Open"),a&&s.sendFile(),u.publish("_onFileTransferOpened",n,i,r)},t.onclose=function(){d(c+"On Close"),s.onClose(),u.publish("_onFileTransferClosed",n,i,r)},t.onerror=function(e){d(c+"On Error",e),s.onError(),u.publish("_onFileTransferError",n,i,r)}}},{"./Log":14,"./PubSub":22,"./TransferManager":30}],12:[function(e,t,n){"use strict";var r=e("./MD5");function i(t,n){var r=[];return t instanceof Array?t.forEach(function(e){r.push(n(e))}):t instanceof Object&&Object.keys(t).forEach(function(e){r.push(n(t[e]))}),r}t.exports=r([navigator.userAgent,[screen.height,screen.width,screen.colorDepth].join("x"),(new Date).getTimezoneOffset(),i(navigator.plugins,function(e){return[e.name,e.description,i(e,function(e){return[e.type,e.suffixes].join("~")}).join(",")].join("::")}).join(";")].join("###"))},{"./MD5":15}],13:[function(e,t,n){"use strict";var o=e("./Log"),a=e("./Ajax"),s=e("./Config"),c=(a=e("./PubSub"),e("./Utils")),d={},u=!1,l=!1;c.isChrome()&&window.addEventListener("message",function(e){if(e.origin==window.location.origin){var t=e.data;if(t.answer){var n=d[t.requestId];if(n)switch(t.state){case"completed":t.streamId?(n.constraints.video.mandatory.chromeMediaSourceId=t.streamId,navigator.mediaDevices.getUserMedia(n.constraints).then(n.onSuccess).catch(n.onError)):n.onError({code:1,text:"action canceled by the user"}),delete d[t.requestId]}else o("[GetScreenSharing] Cached data related to request id '"+t.requestId+"' not found")}}}),t.exports=function(e,t,n){var r=c.getBrowser();if("https:"!=window.location.protocol)throw new Error("The screen-sharing feature is not allowed on non-secured connection. SSL is required by the browser.");if(c.isChrome()){if(!s.CHROME_EXT_ID)return void o("[GetScreenSharing] No Chrome ScreenSharing Extension ID configured !");if(34<=r.version)if(!(!document.querySelector("#bistri-screen-sharing-installed")&&!document.querySelector("#extension-is-installed-"+s.CHROME_EXT_ID))){o("[GetScreenSharing] ScreenSharing Extension is installed");var i=Math.random().toString().substr(2);d[i]={constraints:e,onSuccess:t,onError:n},window.postMessage({requestId:i,action:"screen-sharing",data:["screen","window"]},"*")}else if(o("[GetScreenSharing] ScreenSharing Extension is required"),chrome.webstore){if(u)return;u=!0,chrome.webstore.onInstallStageChanged.addListener(function(e){"downloading"!=e||l||(o("[GetScreenSharing] ScreenSharing Extension installation has started"),l=!0,a.publish("onExtensionInstallStarted"))}),chrome.webstore.install("https://chrome.google.com/webstore/detail/"+s.CHROME_EXT_ID,function(){setTimeout(function(){o("[GetScreenSharing] ScreenSharing Extension has been installed"),a.publish("onExtensionInstalled"),s.EXT_AUTO_RELOAD&&window.location.reload()},2e3)},function(e){o("[GetScreenSharing] ScreenSharing Extension installation has failed",e),a.publish("onExtensionInstallFailed",e),"function"==typeof n&&n(e)})}else n(),window.open("https://chrome.google.com/webstore/detail/"+s.CHROME_EXT_ID)}else if(c.isFirefox()){if(!s.FIREFOX_EXT_ID&&r.version<52)return void o("[GetScreenSharing] No Firefox ScreenSharing Extension ID configured !");if(33<=r.version)!(!document.querySelector("#bistri-screen-sharing-installed")&&!document.querySelector("#extension-is-installed"))||52<=r.version?navigator.mediaDevices.getUserMedia(e).then(t).catch(n):InstallTrigger.install({bistriScreenSharing:{URL:"https://addons.mozilla.org/firefox/downloads/latest/"+s.FIREFOX_EXT_ID+"/addon-"+s.FIREFOX_EXT_ID+"-latest.xpi",toString:function(){return this.URL}}})}else n("The screen sharing feature is not supported by your browser")}},{"./Ajax":3,"./Config":6,"./Log":14,"./PubSub":22,"./Utils":32}],14:[function(e,t,n){"use strict";var r=e("./Config");function i(e,t){return t=t||2,String(Array(t).join(0)+e).slice(-t)}t.exports=function(){if(console&&console.log&&r.DEBUG){var e=new Date,t=i(e.getMonth()+1)+"/"+i(e.getDate())+"/"+i(e.getFullYear()),n=i(e.getUTCHours())+":"+i(e.getUTCMinutes())+":"+i(e.getUTCSeconds())+"."+i(e.getUTCMilliseconds(),3);Array.prototype.unshift.call(arguments,"%s %s -",t,n),console.log.apply(console,arguments)}}},{"./Config":6}],15:[function(e,t,n){function o(e,t){var n=e[0],r=e[1],i=e[2],o=e[3];n=a(n,r,i,o,t[0],7,-680876936),o=a(o,n,r,i,t[1],12,-389564586),i=a(i,o,n,r,t[2],17,606105819),r=a(r,i,o,n,t[3],22,-1044525330),n=a(n,r,i,o,t[4],7,-176418897),o=a(o,n,r,i,t[5],12,1200080426),i=a(i,o,n,r,t[6],17,-1473231341),r=a(r,i,o,n,t[7],22,-45705983),n=a(n,r,i,o,t[8],7,1770035416),o=a(o,n,r,i,t[9],12,-1958414417),i=a(i,o,n,r,t[10],17,-42063),r=a(r,i,o,n,t[11],22,-1990404162),n=a(n,r,i,o,t[12],7,1804603682),o=a(o,n,r,i,t[13],12,-40341101),i=a(i,o,n,r,t[14],17,-1502002290),n=c(n,r=a(r,i,o,n,t[15],22,1236535329),i,o,t[1],5,-165796510),o=c(o,n,r,i,t[6],9,-1069501632),i=c(i,o,n,r,t[11],14,643717713),r=c(r,i,o,n,t[0],20,-373897302),n=c(n,r,i,o,t[5],5,-701558691),o=c(o,n,r,i,t[10],9,38016083),i=c(i,o,n,r,t[15],14,-660478335),r=c(r,i,o,n,t[4],20,-405537848),n=c(n,r,i,o,t[9],5,568446438),o=c(o,n,r,i,t[14],9,-1019803690),i=c(i,o,n,r,t[3],14,-187363961),r=c(r,i,o,n,t[8],20,1163531501),n=c(n,r,i,o,t[13],5,-1444681467),o=c(o,n,r,i,t[2],9,-51403784),i=c(i,o,n,r,t[7],14,1735328473),n=d(n,r=c(r,i,o,n,t[12],20,-1926607734),i,o,t[5],4,-378558),o=d(o,n,r,i,t[8],11,-2022574463),i=d(i,o,n,r,t[11],16,1839030562),r=d(r,i,o,n,t[14],23,-35309556),n=d(n,r,i,o,t[1],4,-1530992060),o=d(o,n,r,i,t[4],11,1272893353),i=d(i,o,n,r,t[7],16,-155497632),r=d(r,i,o,n,t[10],23,-1094730640),n=d(n,r,i,o,t[13],4,681279174),o=d(o,n,r,i,t[0],11,-358537222),i=d(i,o,n,r,t[3],16,-722521979),r=d(r,i,o,n,t[6],23,76029189),n=d(n,r,i,o,t[9],4,-640364487),o=d(o,n,r,i,t[12],11,-421815835),i=d(i,o,n,r,t[15],16,530742520),n=u(n,r=d(r,i,o,n,t[2],23,-995338651),i,o,t[0],6,-198630844),o=u(o,n,r,i,t[7],10,1126891415),i=u(i,o,n,r,t[14],15,-1416354905),r=u(r,i,o,n,t[5],21,-57434055),n=u(n,r,i,o,t[12],6,1700485571),o=u(o,n,r,i,t[3],10,-1894986606),i=u(i,o,n,r,t[10],15,-1051523),r=u(r,i,o,n,t[1],21,-2054922799),n=u(n,r,i,o,t[8],6,1873313359),o=u(o,n,r,i,t[15],10,-30611744),i=u(i,o,n,r,t[6],15,-1560198380),r=u(r,i,o,n,t[13],21,1309151649),n=u(n,r,i,o,t[4],6,-145523070),o=u(o,n,r,i,t[11],10,-1120210379),i=u(i,o,n,r,t[2],15,718787259),r=u(r,i,o,n,t[9],21,-343485551),e[0]=f(n,e[0]),e[1]=f(r,e[1]),e[2]=f(i,e[2]),e[3]=f(o,e[3])}function s(e,t,n,r,i,o){return t=f(f(t,e),f(r,o)),f(t<<i|t>>>32-i,n)}function a(e,t,n,r,i,o,a){return s(t&n|~t&r,e,t,i,o,a)}function c(e,t,n,r,i,o,a){return s(t&r|n&~r,e,t,i,o,a)}function d(e,t,n,r,i,o,a){return s(t^n^r,e,t,i,o,a)}function u(e,t,n,r,i,o,a){return s(n^(t|~r),e,t,i,o,a)}function l(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}var r="0123456789abcdef".split("");function i(e){for(var t="",n=0;n<4;n++)t+=r[e>>8*n+4&15]+r[e>>8*n&15];return t}function f(e,t){return e+t&4294967295}if(md5=function(e){return function(e){for(var t=0;t<e.length;t++)e[t]=i(e[t]);return e.join("")}(function(e){/[\x80-\xFF]/.test(e)&&(e=unescape(encodeURI(e))),txt="";var t,n=e.length,r=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)o(r,l(e.substring(t-64,t)));e=e.substring(t-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)i[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),55<t)for(o(r,i),t=0;t<16;t++)i[t]=0;return i[14]=8*n,o(r,i),r}(e))},"5d41402abc4b2a76b9719d911017c592"!=md5("hello"))function f(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}t.exports=md5},{}],16:[function(e,t,n){"use strict";var r=e("./PubSub"),f=e("./MeanOpinionScoreUtils");function i(){this.remoteMedia={}}i.prototype.add=function(e,t,n,r){var i=t+n;"function"==typeof r&&(i in this.remoteMedia||(this.remoteMedia[i]={node:e,pid:t,room:n,stats:[],fn:r}))};new Array(0);i.prototype.remove=function(e,t){var n=e+t;n in this.remoteMedia&&delete this.remoteMedia[n]},i.prototype.processStats=function(e,t,n){var r=t+n;if(r in this.remoteMedia&&(this.remoteMedia[r].stats.push(e),!(this.remoteMedia[r].stats.length<2))){for(;2<this.remoteMedia[r].stats.length;)this.remoteMedia[r].stats.shift();var i,o,a,s,c=this.remoteMedia[r].stats,d={width:this.remoteMedia[r].node.videoWidth,height:this.remoteMedia[r].node.videoHeight},u=f.calculateVideoScore(d,(s=c)[s.length-1].recv.video[Object.keys(s[s.length-1].recv.video)[0]],(a=c)[a.length-2].recv.video[Object.keys(a[a.length-2].recv.video)[0]]),l=f.calculateAudioScore((o=c)[o.length-1].recv.audio[Object.keys(o[o.length-1].recv.audio)[0]],(i=c)[i.length-2].recv.audio[Object.keys(i[i.length-2].recv.audio)[0]]);this.remoteMedia[r].fn(Math.min(l,u),t,n)}};var o=new i;r.subscribe("onStreamStatsUpdated",function(e,t,n){o.processStats(e,t,n)}),r.subscribe("onStreamRemoved",function(e,t){o.remove(t,e.room)}),r.subscribe("onStreamClosed",function(e,t){o.remove(t,e.room)}),t.exports=o},{"./MeanOpinionScoreUtils":17,"./PubSub":22}],17:[function(e,t,n){"use strict";e("./Log"),e("./PubSub");t.exports={calculateAudioScore:function(e,t){var n=e.packetsLost-t.packetsLost+(e.packetsReceived-t.packetsReceived);if(0==n)return 0;var r,i,o,a=(e.packetsLost-t.packetsLost)/n;return o=a,(r=94.2-(.024*(i=0+20)+.11*(i-177.3)*(i-177.3<0?0:1))-(0+19.8*Math.log(1+29.7*o)))<0?1:100<r?4.5:1+.035*r+71e-7*r*(r-60)*(100-r)},calculateVideoScore:function(e,t,n){var r,i,o=t.timestamp-n.timestamp,a=8*(t.bytesReceived-n.bytesReceived)/(o/1e3),s=e.width*e.height,c=(r=s,i=2.069924867*Math.pow(Math.log10(r),.6250223771),Math.pow(10,i));return a<3e4?0:(a=Math.min(a,c),Math.log(a/3e4)/Math.log(c/3e4)*4+1)}}},{"./Log":14,"./PubSub":22}],18:[function(e,t,n){"use strict";var l=e("./Log"),f=e("./Utils"),p=e("./PubSub"),h=e("./DataChannelWrapper"),m=e("./FileTransferWrapper"),v=e("./PeerConnection"),g=e("./AudioActivityMonitor");function y(e){return e||"unnamed"}function b(e,t){return t&&(t._uid||t.from)?e+"_"+(t.from||t._uid):e}function r(){this.peerConns=new i,this.dataChannels=new o,this.fileTransfers=new o,this.waitingFiles={},p.subscribe("_onDataChannelClosed",this._onDataChannelClosed.bind(this)),p.subscribe("_onDataChannelError",this._onDataChannelClosed.bind(this)),p.subscribe("_onFileTransferClosed",this._onFileTransferClosed.bind(this)),p.subscribe("_onFileTransferError",this._onFileTransferClosed.bind(this)),p.subscribe("_onFileWaitingTransfer",this._onFileTransferWaiting.bind(this))}function i(){this.peerConns={}}function o(){this.channels={}}r.prototype={createPeer:function(e,t,n,o,r,i,a){var s=y(t),c=b(e,i),d=new v(a,o,n,r||{},i,c,s),u="call_"+c+"_"+t+"_"+(new Date).getTime();return d.onAddStream=function(e){e.room=s,p.publish("onStreamAdded",e,c),n&&p.publish("_onCallStart",{pid:c,room:s,callId:u,browsers:f.getCallClientsId(o),type:"call:"+this._getCallType(d.getLocalTracks())+"|"+this._getCallType(d.getRemoteTracks())})}.bind(this),d.onUpdateStream=function(e,t){e.room=s,p.publish("onStreamUpdated",e,c)}.bind(this),d.onCloseStream=function(e){e.room=s,g.remove(e),p.publish("onStreamClosed",e,c),n&&p.publish("_onCallStop",{pid:c,room:s,callId:u,browsers:f.getCallClientsId(o),type:"call:"+this._getCallType(d.getLocalTracks())+"|"+this._getCallType(d.getRemoteTracks())})}.bind(this),d.onAddTrack=function(e,t){t.room=s,p.publish("onTrackAdded",e,t,c)}.bind(this),d.onRemoveTrack=function(e,t){t.room=s,p.publish("onTrackRemoved",e,t,c)}.bind(this),d.onStatsUpdated=function(e){p.publish("onStreamStatsUpdated",e,c,s)}.bind(this),d.onFailed=function(e,t){p.publish("onCallFailed",s,c,e.message,t),n&&p.publish("_onCallFail",{pid:c,room:s,callId:u,browsers:f.getCallClientsId(o),type:"call",message:e.message})}.bind(this),d.onClosePeer=function(){l("[Peers Manager] Clear peer "+c+" for room "+s),p.publish("onCallEnded",c,s),this._clearPeer(c,s)}.bind(this),d.onDataChannel=function(e){var t=e.channel.label;if(0==t.indexOf("__file_transfert_")){var n=this.waitingFiles[t];if(n){var r=new m(e.channel,s,t,c,n.id,n,!1);this.fileTransfers.add(s,c,t,r),delete this.waitingFiles[t]}}else{var i=new h(e.channel,s,c);this.dataChannels.add(s,c,t,i),p.publish("onDataChannelRequested",i,c),p.publish("_onDataChannelStart",{pid:c,room:s,callId:u,browsers:f.getCallClientsId(o),type:"datachannel"})}}.bind(this),this.peerConns.add(s,c,d),d},closePeer:function(e,t,n){var r=y(t),i=b(e,n);if(this.peerConns.exists(r,i)){this.dataChannels.exists(r,i)&&this.dataChannels.close(r,i);var o=this.peerConns.get(r,i);o&&setTimeout(function(){o.close()},300)}},closeAllPeers:function(e){var t=y(e);this.peerConns.forEachPeer(t,function(e){this.closePeer(e,t)}.bind(this))},createDataChannel:function(e,t,n,r,i){var o=y(n),a=b(e,i);if(this.peerConns.exists(o,a)){var s=this.peerConns.get(o,a).addDataChannel(t,r),c=new h(s,o,a);c&&(this.dataChannels.add(o,a,t,c),p.publish("onDataChannelCreated",c,a))}},createFileTransfer:function(e,t,n,r,i,o){var a=y(n),s=b(e,o);if(this.peerConns.exists(a,s)){var c=this.peerConns.get(a,s).addDataChannel(t,{ordered:!1,binaryType:"arraybuffer"}),d=new m(c,a,t,s,r,i,!0);d&&this.fileTransfers.add(a,s,t,d)}},getDataChannels:function(t){var n={};return this.dataChannels.forEachRoom(function(e){t&&e!=t||this.dataChannels.forEachPeer(e,function(e,t){n[e]=t})}.bind(this)),n},getFileTransferts:function(t){var n={};return this.fileTransfers.forEachRoom(function(e){t&&e!=t||this.fileTransfers.forEachPeer(e,function(e,t){n[e]=t})}.bind(this)),n},addStream:function(n,e,r){var t=y(e);this.peerConns.exists(t,n)&&r&&this.peerConns.forEachPeer(t,function(e,t){n&&e!=n||t.addStream(r)}.bind(this))},removeStream:function(n,e,r){var t=y(e);this.peerConns.exists(t,n)&&r&&this.peerConns.forEachPeer(t,function(e,t){n&&e!=n||t.removeStream(r)}.bind(this))},updateStream:function(n,e,r){var t=y(e);this.peerConns.exists(t,n)&&r&&this.peerConns.forEachPeer(t,function(e,t){n&&e!=n||t.updateStream(r)}.bind(this))},copyStream:function(n,e,r,i){var t=y(e);this.peerConns.exists(t,n)&&r&&i&&this.peerConns.forEachPeer(t,function(e,t){n&&e!=n||t.copyStream(r,i)}.bind(this))},updateBitrate:function(n,e,r,i){var t=y(e);this.peerConns.exists(t,n)&&r&&this.peerConns.forEachPeer(t,function(e,t){n&&e!=n||t.updateBitrate(r,i)}.bind(this))},addTrack:function(n,e,r,i){var t=y(e);this.peerConns.exists(t,n)&&r&&this.peerConns.forEachPeer(t,function(e,t){n&&e!=n||t.addTrack(r,i)}.bind(this))},removeTrack:function(n,e,r){var t=y(e);this.peerConns.exists(t,n)&&r&&this.peerConns.forEachPeer(t,function(e,t){n&&e!=n||t.removeTrack(r)}.bind(this))},replaceTrack:function(n,e,r,i){var t=y(e);this.peerConns.exists(t,n)&&r&&i&&this.peerConns.forEachPeer(t,function(e,t){n&&e!=n||t.replaceTrack(r,i)}.bind(this))},setSignal:function(e,t,n){var r=y(t),i=b(e,n.extra);this.peerConns.exists(r,i)&&this.peerConns.get(r,i).signalingChannel.onReceive(n)},isCaller:function(e,t){var n=y(t);return this.peerConns.get(n,e).isCaller},getPeersId:function(e){var t=y(e),n=[];return this.peerConns.forEachPeer(t,function(e,t){n.push(e)}.bind(this)),n},getPeer:function(e,t,n,r){var i=y(t),o=b(e,r);if(this.peerConns.exists(i,o)){var a=this.peerConns.get(i,o);return n&&a.setOptions(n),a}},getRemoteStreams:function(t){var r={};for(var e in this.peerConns.forEachRoom(function(e){t&&e!=t||this.peerConns.forEachPeer(e,function(e,t){var n=t.getRemoteStreams();r.hasOwnProperty(e)||(r[e]=[]),r[e]=r[e].concat(n)})}.bind(this)),r)1==r[e].length&&(r[e]=r[e][0]);return r},getRemoteTracks:function(t){var r={};return this.peerConns.forEachRoom(function(e){t&&e!=t||this.peerConns.forEachPeer(e,function(e,t){var n=t.getRemoteTracks();r.hasOwnProperty(e)||(r[e]=[]),r[e]=r[e].concat(n)})}.bind(this)),r},getLocalTracks:function(t){var r={};return this.peerConns.forEachRoom(function(e){t&&e!=t||this.peerConns.forEachPeer(e,function(e,t){var n=t.getLocalTracks();r.hasOwnProperty(e)||(r[e]=[]),r[e]=r[e].concat(n)})}.bind(this)),r},_clearPeer:function(e,t){var n=y(t);this.peerConns.removePeer(n,e),this._clearRoom(t)},_clearRoom:function(e){var t=y(e);this.peerConns.removeRoom(t)},_onDataChannelClosed:function(e,t,n){this.dataChannels.removeChannel(e,t,n,"dataChannels")},_onFileTransferClosed:function(e,t,n){this.fileTransfers.removeChannel(e,t,n,"fileTransfers")},_onFileTransferWaiting:function(e,t){this.waitingFiles[e]=t},_getCallType:function(e){var t="";return e.forEach(function(e){e&&(t&&(t+="&"),"video"==e.kind?t+="video":"audio"==e.kind?t+="audio":t+="unknown")}),t}},i.prototype.add=function(e,t,n){e in this.peerConns||(this.peerConns[e]={},l("[Peers Manager] Room "+e+" added to manager")),l("[Peers Manager] Peer "+t+"-"+e+" added to room "+e),this.peerConns[e][t]=n},i.prototype.removePeer=function(e,t){this.peerConns[e]&&t in this.peerConns[e]&&(delete this.peerConns[e][t],l("[Peers Manager] Peer "+t+"-"+e+" removed from room "+e))},i.prototype.removeRoom=function(e){e in this.peerConns&&(Object.keys(this.peerConns[e]).length||(delete this.peerConns[e],l("[Peers Manager] Room "+e+" removed from manager")))},i.prototype.exists=function(e,t){return this.peerConns[e]&&t in this.peerConns[e]},i.prototype.get=function(e,t){return this.peerConns[e]?"failed"===this.peerConns[e][t].pc.iceConnectionState?(peerConn.close(),delete this.peerConns[e][t],l("[Peers Manager] Peer "+t+"-"+e+" has failed and is closed and removed from room "+e),null):this.peerConns[e][t]:null},i.prototype.forEachRoom=function(e){for(var t in this.peerConns)e(t)},i.prototype.forEachPeer=function(e,t){if(this.peerConns[e])for(var n in this.peerConns[e])t(n,this.peerConns[e][n])},o.prototype.add=function(e,t,n,r){e in this.channels||(this.channels[e]={}),t in this.channels[e]||(this.channels[e][t]={}),this.channels[e][t][n]=r},o.prototype.removeChannel=function(e,t,n,r){this.channels[e]&&t in this.channels[e]&&this.channels[e][t]&&n in this.channels[e][t]&&(delete this.channels[e][t][n],l("[Channels Manager] Data Channel '"+n+"' has been removed from "+t+"-"+e),Object.keys(this.channels[e][t]).length||(delete this.channels[e][t],l("[Channels Manager] Reference "+t+"-"+e+" removed from Data Channels list")))},o.prototype.exists=function(e,t){return this.channels[e]&&t in this.channels[e]},o.prototype.get=function(e,t){return this.channels[e][t]},o.prototype.forEachRoom=function(e){for(var t in this.channels)e(t)},o.prototype.forEachPeer=function(e,t){if(this.channels[e])for(var n in this.channels[e])t(n,this.channels[e][n])},o.prototype.close=function(e,t){for(var n in this.channels[e][t])this.channels[e][t][n].close(),l("[Channels Manager] Data Channel '"+n+"' with reference "+t+"-"+e+" has been closed");f.isSafari()&&(this.channels[e][t][n].onClose(),this.channels[e]&&t in this.channels[e]&&(delete this.channels[e][t],l("[Channels Manager] Reference "+t+"-"+e+" removed from Data Channels list")))},t.exports=new r},{"./AudioActivityMonitor":4,"./DataChannelWrapper":8,"./FileTransferWrapper":11,"./Log":14,"./PeerConnection":21,"./PubSub":22,"./Utils":32}],19:[function(e,t,n){"use strict";var i=e("./Log");function r(e){this.events=[],this.index=0,this.offset=0,this.file=e,this.state=!0,this.buffer=[],this.chunkSize=15e3,this.bufferHigh=5e7,this.bufferLow=5e6,this.bufferSize=0,this.slicesNb=Math.ceil(e.size/this.chunkSize),this.flag=!0,this.done=!1,this.stopped=!1,this._slice()}r.prototype={_slice:function(){var n=this.slicesNb,r=function(){var e,t=new window.FileReader;t.addEventListener("load",function(e){2==e.target.readyState&&(this.buffer["slice_"+this.index]={id:this.index,chunk:e.target.result},this.bufferSize+=e.target.result.byteLength,this.offset+e.target.result.byteLength<this.file.size?(this.index+=1,this.offset+=this.chunkSize,this.bufferSize<this.bufferHigh?r():(this.stopped=!0,i("[PacketsMaker] Buffer high level warning"))):(this.done=!0,i("[PacketsMaker] Slice operation finished")),this.flag&&(this.bufferSize>=this.bufferHigh||this.done)&&(this.flag=!1,this.events.buffered({fileName:this.file.name,fileSize:this.file.size,fileType:this.file.type,chunksNb:n})))}.bind(this)),t.addEventListener("error",function(e){this.buffer=[],i("Error reading file:",e)}.bind(this)),t.addEventListener("abort",function(e){this.buffer=[],i("File reading aborted:",e)}.bind(this)),e=this.file.slice(this.offset,this.offset+this.chunkSize),t.readAsArrayBuffer(e)}.bind(this);this.stopped=!1,r()},on:function(e,t){this.events[e]=t},removePacket:function(e){this.buffer["slice_"+e]?(this.bufferSize-=this.buffer["slice_"+e].chunk.byteLength,delete this.buffer["slice_"+e],this.bufferSize<this.bufferLow&&!this.done&&this.stopped&&(i("[PacketsMaker] Buffer low level warning"),this._slice())):i("[PacketsMaker] Packet not found: ",e)},getPacket:function(e){return this.buffer["slice_"+e]},getPacketsNb:function(){return this.slicesNb}},t.exports=r},{"./Log":14}],20:[function(e,t,n){"use strict";var r=e("./Log"),i=e("./CreateFile");function o(){this._sysFile=null,this._index=0,this._timeout=5e3,this._requests={},this._maxRequest=5,this._maxThread=6,this._events=[],this._received=0,this._ttl_chunks=0}o.prototype={init:function(e){this._ttl_chunks=e.chunksNb,this._sysFile=new i(e.fileName,e.fileSize,e.fileType),this._sysFile.onFileReady=function(){for(var e=0;e<this._maxThread;e++)this._requestNext()}.bind(this),this._sysFile.onFileComplete=function(e,t,n){this._events.completed(e,t,n),this._events.end(),r("[PacketsRequester] File transfer completed: ",e,t,n)}.bind(this),this._sysFile.start()},on:function(e,t){this._events[e]=t},addPacket:function(e){var t=this._requests[e.id];t?(clearTimeout(t.timer),this._received+=e.chunk.byteLength||e.chunk.size,this._events.progress(),this._events.acknowledge(e.id),this._sysFile.append(e),delete this._requests[e.id],this._received!=this._size&&this._index<this._ttl_chunks&&this._requestNext()):r("[PacketsRequester] Unknown request id: ",e.id)},_requestNext:function(){var e=this._index;e>=this._ttl_chunks||(this._index++,this._events.next(e),this._requests[e]={timer:setTimeout(this._askAgain.bind(this),this._timeout,e),attempt:0})},_askAgain:function(e){var t=this._requests[e];t.attempt<=this._maxRequest?(r("[PacketsRequester] Ask packet again: ",e),this._events.resend(e),t.timer=setTimeout(this._askAgain.bind(this),this._timeout,e),t.attempt++):this._events.failed("[PacketsRequester] Transfer interrupted: too many retries")}},t.exports=o},{"./CreateFile":7,"./Log":14}],21:[function(e,t,n){"use strict";var r=e("./Log"),o=e("./Utils"),d=e("./Config"),i=e("./SdpUtils"),u=e("./StatsParser"),a="connected",s="completed";function c(e,t,n,r,i,o,a){this.label=o+"-"+a,this.signalingChannel=e,this.isCaller=n,this.defaultStream=null,this.autoAttachStream=!0,this.sendOnly=!1,this.audioBitrate=!1,this.videoBitrate=!1,this.preferedAudioCodec=!1,this.preferedVideoCodec=!1,this.forceTurn=d.FORCE_TURN,this.tcpOnly=d.TCP_ONLY,this.mergeCandidates=!1,this.extra=i,this.tracksDesc=[],this.pc=null,this.remoteIceCandidates=[],this.isNegotiating=!0,this.remoteClient=t,this.remoteStreamsId=[],this.statsInterval=d.STATS_INTERVAL,this.statsParser=new u,this.trace=[],this.onAddStream=function(e){},this.onUpdateStream=function(e){},this.onCloseStream=function(e){},this.onAddTrack=function(e){},this.onRemoveTrack=function(e){},this.onConnectionState=function(e){this._log("Connection state changed to",e)},this.onIceConnectionState=function(e){this._log("Ice Connection state changed to",e)},this.onSignalingState=function(e){this._log("Signaling state changed to",e)},this.onStatsUpdated=function(e){this._log("Stats updated",e)},this.onClosePeer=function(e){},this.onFailed=function(e){this._log("On failed",e)},"sendonly"in r&&this.isCaller&&(this.sendOnly=!0,this._log("Option sendonly true")),"merge-candidates"in r&&(this.mergeCandidates=r["merge-candidates"],this._log("Option merge-candidates is set to "+this.mergeCandidates)),"audio-codec"in r&&(this.preferedAudioCodec=r["audio-codec"],this._log("Option audio-codec is set to "+this.preferedAudioCodec)),"video-codec"in r&&(this.preferedVideoCodec=r["video-codec"],this._log("Option video-codec is set to "+this.preferedVideoCodec)),"audio-bitrate"in r&&("NaN"!=Number(r["audio-bitrate"])?(this.audioBitrate=r["audio-bitrate"],this._log("Option audio-bitrate is set to "+this.audioBitrate+"kbs")):this._log("Option audio-bitrate must be an integer")),"video-bitrate"in r&&("NaN"!=Number(r["audio-bitrate"])?(this.videoBitrate=r["video-bitrate"],this._log("Option video-bitrate is set to "+this.videoBitrate+"kbs")):this._log("Option video-bitrate must be an integer")),"force-turn"in r&&("boolean"==typeof r["force-turn"]?(this.forceTurn=r["force-turn"],this._log("Option force-turn is set to "+this.forceTurn)):this._log("Option force-turn must be a boolean")),"tcp-only"in r&&("boolean"==typeof r["tcp-only"]?(this.tcpOnly=r["tcp-only"],this._log("Option tcp-only is set to "+this.tcpOnly)):this._log("Option tcp-only must be a boolean"));var s=this,c={sdpSemantics:"unified-plan",iceServers:d.TURN_SERVERS.concat(d.STUN_SERVERS),iceTransportPolicy:this.forceTurn?"relay":"all"};this.pc=new RTCPeerConnection(c,{optional:[]}),this.pc.onconnectionstatechange=function(e){if(s.pc)switch(s.onConnectionState(s.pc.connectionState),s.pc.connectionState){case"checking":case"disconnected":s._stopStatsPolling();break;case"connected":s._checkNegotiationSate(),s._startStatsPolling();break;case"failed":s._stopStatsPolling(),s._failed(new Error("Connection state changed to 'disconnected'")),s._iceRestart()}},this.pc.oniceconnectionstatechange=function(){if(s.pc)switch(s.onIceConnectionState(s.pc.iceConnectionState),s.pc.iceConnectionState){case"completed":s._checkNegotiationSate()}},this.pc.onsignalingstatechange=function(){if(s.pc)switch(s.onSignalingState(s.pc.signalingState),s.pc.signalingState){case"stable":s._checkNegotiationSate()}},this.pc.onnegotiationneeded=function(){s._log("Negotiation needed"),s.isNegotiating||(s.negoTimer&&(clearTimeout(s.negoTimer),s.negoTimer=null),s.negoTimer=setTimeout(s._requestRenegotiation.bind(s),300))},this.mergeCandidates?this.pc.onicecandidate=function(e){e&&e.candidate||(s._log("Send ",{type:s.pc.localDescription.type,sdp:s.pc.localDescription.sdp}),s.signalingChannel.send({sd:s.pc.localDescription,extra:s.extra}))}:this.pc.onicecandidate=function(e){var t={candidate:null,extra:s.extra};if(!e||!e.candidate)return s._log("All Ice Candidates have been sent"),s.signalingChannel.send({eoc:1,extra:s.extra});t.candidate=JSON.parse(JSON.stringify(e.candidate)),-1==t.candidate.candidate.indexOf("a=candidate")&&(t.candidate.candidate=t.candidate.candidate.replace("candidate","a=candidate")),s._log("Send Ice Candidate:",t.candidate),s.signalingChannel.send(t)},this.pc.ontrack=function(e){var t,r=(t=e).streams.filter(function(e){return-1<e.getTracks().map(function(e){return e.id}).indexOf(t.track.id)})[0],i=e.track;if(s.tracksDesc.forEach(function(e){r.id===e.stream&&e.desc&&(r[e.kind+"Desc"]=i.desc=e.desc)}),r.addEventListener){var n=function(e){s._log("Remote "+i.kind+" Track Removed",i,r),r.getTracks().length?(s.onUpdateStream(r,i),s._log("Remote Stream updated",r,i)):(r.removeEventListener("removetrack",n),s.remoteStreamsId.splice(s.remoteStreamsId.indexOf(r.id),1),s.onCloseStream(r),s._log("Remote Stream closed",r)),s.onRemoveTrack(i,r)};r.addEventListener("removetrack",n)}i.addEventListener&&i.addEventListener("ended",function(e){var t,n;s._log("Remote "+i.kind+" Track Ended",i,r),n=!0,(t=r).getTracks().length&&(t.getTracks().forEach(function(e){n="ended"===e.readyState&&n}),n)?(s.remoteStreamsId.splice(s.remoteStreamsId.indexOf(r.id),1),s.onCloseStream(r),s._log("Remote Stream closed",r)):(s.onUpdateStream(r,i),s._log("Remote Stream updated",r,i))}),s.onAddTrack(i,r),s._log("Remote "+i.kind+" Track Added",i),-1==s.remoteStreamsId.indexOf(r.id)?(s.remoteStreamsId.push(r.id),s.onAddStream(r),s._log("Remote Stream Added",r)):(s.onUpdateStream(r,i),s._log("Remote Stream updated",r,i))},this.pc.ondatachannel=function(e){s.onDataChannel(e)},this.signalingChannel.onReceive=function(e){s._processSignaling(e)},this._log("Peer instanciated",c)}c.prototype={_saveLog:function(e){this.trace.push({on:new Date,data:e})},_log:function(){this._saveLog(arguments),Array.prototype.unshift.call(arguments,"[Peer "+this.label+"]"),r.apply(r,arguments)},_failed:function(e){this.signalingChannel.onFailed({error:e.message,extra:this.extra}),this.onFailed(e,this.trace),this._log(e)},_checkNegotiationSate:function(){(this.pc.iceConnectionState!==a&&this.pc.iceConnectionState!==s||"stable"!==this.pc.signalingState)&&"closed"!==this.pc.iceConnectionState||(this.isNegotiating=!1)},_onAcceptRenegotiation:function(){this._log("Renegotiation accepted by remote peer"),this.renegotiationId=void 0,this._createOffer()},_requestRenegotiation:function(){this._log("Renegotiation request sent to remote peer"),this.renegotiationId=Math.round(1e4*Math.random()),this.signalingChannel.send({negorequested:this.renegotiationId,extra:this.extra})},_onRequestRenegotiation:function(e){if(this._log("Renegotiation request received from remote peer"),void 0===this.renegotiationId||this.renegotiationId<=e)return this._log("Renegotiation accepted and notified to remote peer"),this.isNegotiating=!0,this.renegotiationId=void 0,void this.signalingChannel.send({negoaccepted:e,extra:this.extra});this._log("---\x3e Renegotiation request silently ignored <---")},_iceRestart:function(){this.pc.restartIce?(this._log("------------ ICE Restart -------------"),this.pc.restartIce()):(this._log("------------ ICE Restart -------------"),this.isCaller&&this._createOffer(!0))},_addTrack:function(e,t){e&&this.pc&&this.pc.addTrack&&(this.pc.addTrack(e,t),this._log("Local Track added",e))},_removeTrack:function(t){if(t&&this.pc&&this.pc.removeTrack){var e=this.pc.getSenders().find(function(e){return e.track&&e.track.id==t.id});e&&(this.pc.removeTrack(e),this._log("Local Track removed",t))}},_replaceTrack:function(t){if(t&&this.pc&&this.pc.getSenders){var e=this.pc.getSenders().find(function(e){return e.track&&e.track.kind==t.kind&&e.track.stream==t.stream});e&&(e.replaceTrack?e.replaceTrack(t):(this.pc.removeTrack(e),this.pc.addTrack(t,stream)),this._log("Local track replaced",t))}},_processSignaling:function(e){this.pc&&"closed"!=this.pc.signalingState&&("sd"in e?(this._log("Receive "+e.sd.type,e.sd),this._setRemoteDescription(e.sd),"td"in e&&(this._log("Receive tracks description",e.td),this._setTracksExtraData(e.td))):"candidate"in e?(this._log("Receive candidate",e.candidate),this.hasRemoteDescription?this._addRemoteCandidate(e.candidate):(this._log("Remote candidate has been stacked",e.candidate),this.remoteIceCandidates.push(e.candidate))):"eoc"in e?(o.isEdgeORTC()&&this._addRemoteCandidate(null),this._log("Receive End of Candidates")):"negorequested"in e?this._onRequestRenegotiation(e.negorequested):"negoaccepted"in e&&this._onAcceptRenegotiation(e.negoaccepted))},_createOffer:function(e){var t={offerToReceiveAudio:this.sendOnly?0:1,offerToReceiveVideo:this.sendOnly?0:1};e&&(t=Object.assign(t,{iceRestart:!0})),this.isNegotiating=!0,this.pc.createOffer(t).then(this._setLocalDescription.bind(this)).catch(this._failed.bind(this))},_createAnswer:function(){var e={offerToReceiveAudio:this.sendOnly?0:1,offerToReceiveVideo:this.sendOnly?0:1};this.pc.createAnswer(e).then(this._setLocalDescription.bind(this)).catch(this._failed.bind(this))},_addRemoteCandidate:function(e){this.tcpOnly&&-1===e.candidate.toLowerCase().indexOf("tcp")?this._log("UDP candidate has been ignored",e):this.pc.addIceCandidate(e?new RTCIceCandidate(e):{candidate:""}).then(function(){this._log("Processed remote candidate",e)}.bind(this)).catch(this._failed.bind(this))},_processEndOfCandidates:function(){(this.pc.transceivers||[]).forEach(function(e){e.iceTransport&&e.iceTransport.addRemoteCandidate({})})},_setLocalDescription:function(n){this.audioBitrate&&(n.sdp=i.setMediaBitrate(n.sdp,"audio",this.audioBitrate,this.remoteClient)),this.videoBitrate&&(n.sdp=i.setMediaBitrate(n.sdp,"video",this.videoBitrate,this.remoteClient)),this.preferedAudioCodec&&(n.sdp=i.setPreferedCodec("audio",n.sdp,this.preferedAudioCodec)),this.preferedVideoCodec&&(n.sdp=i.setPreferedCodec("video",n.sdp,this.preferedVideoCodec)),this.pc.setLocalDescription(n).then(function(){var e=this.pc.getSenders?this.pc.getSenders().filter(function(e){return e.track}).map(function(e){return{stream:e.track.stream,kind:e.track.kind,desc:e.track.desc}}):[],t={sd:JSON.parse(JSON.stringify(n)),extra:this.extra,td:e};this._log("Local Description has been set"),this.hasLocalDescription=!0,this.mergeCandidates||(this._log("Send SDP "+t.sd.type,t.sd),this.signalingChannel.send(t))}.bind(this)).catch(this._failed.bind(this))},_setRemoteDescription:function(e){var t="have-local-offer"!==this.pc.signalingState;this.isNegotiating=!0,this.pc.setRemoteDescription(new RTCSessionDescription(e)).then(function(){for(this._log("Remote Description has been set"),this.hasRemoteDescription=!0;this.remoteIceCandidates.length;)this._addRemoteCandidate(this.remoteIceCandidates.shift());t&&this._createAnswer()}.bind(this)).catch(this._failed.bind(this))},_setTracksExtraData:function(e){this.tracksDesc=e},_startStatsPolling:function(){0<this.statsInterval&&(this.statsPolling=setInterval(function(){this._getStats()}.bind(this),1e3*this.statsInterval))},_stopStatsPolling:function(){this.statsPolling&&clearInterval(this.statsPolling)},_getStats:function(){if(this.pc&&this.pc.getStats&&!o.isEdgeORTC()){var t,n=this;t=this.statsParser,this.pc.getStats(null).then(function(e){return t.parse(e)}).then(function(e){e.client={local:o.getBrowser(),remote:n.remoteClient},e.transport.state=n.pc.iceConnectionState,n.onStatsUpdated(e)}).catch(function(e){throw e})}},close:function(){(o.isEdgeORTC()||o.isFirefox()&&o.getVersion()<50)&&this.getRemoteStreams().forEach(function(e){this.onCloseStream(e)}.bind(this)),this.pc&&"closed"!=this.pc.iceConnectionState&&(this.pc.close(),this._stopStatsPolling(),this._checkNegotiationSate(),this.onClosePeer())},addStream:function(t){return t&&this.pc&&t.getTracks().forEach(function(e){"ended"!==e.readyState&&(e.stream=t.id,this._addTrack(e,t))}.bind(this)),this},removeStream:function(e){return e&&this.pc&&e.getTracks().forEach(function(e){this._removeTrack(e)}.bind(this)),this},updateStream:function(t){return t&&this.pc&&t.getTracks().forEach(function(e){"ended"!==e.readyState&&(e.stream=t.id,this._replaceTrack(e))}.bind(this)),this},copyStream:function(e,n){if(e&&n&&this.pc&&this.pc.getSenders){var r=this.pc.getSenders(),t=e.getTracks(),i=n.getTracks();t.forEach(function(t){if("ended"!==t.readyState){var e=r.find(function(e){return!!e.track&&(-1!==i.map(function(e){return e.id}).indexOf(e.track.id)&&e.track.kind===t.kind)});t.stream=n.id,e?(n.removeTrack(e.track),n.addTrack(t),e.replaceTrack?e.replaceTrack(t):(this.pc.removeTrack(e),this.pc.addTrack(t,n)),this._log("Copy Stream --\x3e Replace track",t,n)):(n.addTrack(t),this.pc.addTrack(t,n),this._log("Copy Stream --\x3e Add track",t,n))}}.bind(this))}return this},getRemoteStreams:function(){return this.pc?this.pc.getRemoteStreams():[]},getLocalStreams:function(){return this.pc?this.pc.getLocalStreams():[]},addTrack:function(e,t){return e.stream=t.id,this._addTrack(e,t),this},removeTrack:function(e){return this._removeTrack(e),this},replaceTrack:function(e){return this._replaceTrack(e),this},getRemoteTracks:function(){if(this.pc){if(o.isEdgeORTC()||this.pc.getRemoteStreams&&!this.pc.getReceivers){var t=[];return this.pc.getRemoteStreams().forEach(function(e){t=t.concat(e.getTracks())}),t}if(this.pc.getReceivers)return this.pc.getReceivers().map(function(e){return e.track})}return[]},getLocalTracks:function(){if(this.pc){if(o.isEdgeORTC()||this.pc.getLocalStreams&&!this.pc.getSenders){var t=[];return this.pc.getLocalStreams().forEach(function(e){t=t.concat(e.getTracks())}),t}if(this.pc.getSenders)return this.pc.getSenders().map(function(e){return e.track})}return[]},addDataChannel:function(e,t){if(!this.pc.createDataChannel)return!1;var n={},r=o.getBrowser();"chrome"==r.name&&r.version<31?n.reliable=!1:(n.reliable=!0,t&&"reliable"in t&&(n.reliable=t.reliable)),t&&"ordered"in t&&(n.ordered=t.ordered),this._log("Data Channel created",e,n);var i=this.pc.createDataChannel(e,n);return t&&"binaryType"in t&&(i.binaryType=t.binaryType),i},updateBitrate:function(n,r){if(n&&!isNaN(r)){var e=(o.isChrome()||o.isSafari()||o.isFirefox&&64<=o.getVersion())&&"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype;if(this[n+"Bitrate"]=r,!e)return this.pc.iceConnectionState!==a&&this.pc.iceConnectionState!==s||this.pc.onnegotiationneeded(),this;this.pc.getSenders().filter(function(e){return e.track&&e.track.kind==n}).forEach(function(e){var t=e.getParameters();if(t.encodings){if(0===t.encodings.length)return}else t.encodings=[{}];0===r?delete t.encodings[0].maxBitrate:t.encodings[0].maxBitrate=1e3*r,e.setParameters(t).then(function(){this._log("Successfully set "+n+" bitrate to "+r+" kbps")}.bind(this)).catch(function(e){this._log("Failed to set sender bitrate ",e)}.bind(this))}.bind(this))}},setOptions:function(e){"isCaller"in e&&(this.isCaller=e.isCaller)},start:function(){this.startTimer&&(clearTimeout(this.startTimer),this.startTimer=null),this.startTimer=setTimeout(this._createOffer.bind(this),300)}},t.exports=c},{"./Config":6,"./Log":14,"./SdpUtils":23,"./StatsParser":28,"./Utils":32}],22:[function(e,t,n){"use strict";var r=e("./Log"),i=e("./MD5");function o(){this._handlersList={},this._eventsList={}}o.prototype={publish:function(e){var t=arguments;e in this._eventsList&&this._eventsList[e].forEach(function(e){"function"==typeof e&&e.apply(this,Array.prototype.slice.call(t,1))})},subscribe:function(e,t){if("function"!=typeof t)return r("[PubSub] Handler is a function"),null;e in this._eventsList||(this._eventsList[e]=[]);var n=i(e)+i(t.toString()+new Date);return this._handlersList[n]=this._eventsList[e][this._eventsList[e].push(t)-1],{event:e,key:n}},unsubscribe:function(n){if("string"==typeof n){if(n in this._eventsList){var e=i(n);for(var t in this._handlersList)0==t.indexOf(e)&&delete this._handlersList[t];return delete this._eventsList[n],!0}return!1}if("object"==typeof n&&n.hasOwnProperty("key")&&n.hasOwnProperty("event"))return n.event in this._eventsList&&(this._eventsList[n.event].forEach(function(e,t){e==this._handlersList[n.key]&&this._eventsList[n.event].splice(t,1)}.bind(this)),delete this._handlersList[n.key],this._eventsList[n.event].length||delete this._eventsList[n.event],!0);throw new Error("unsubscribe event: unexpected arguments")}},t.exports=new o},{"./Log":14,"./MD5":15}],23:[function(e,t,n){"use strict";var h=e("./Log");e("./Utils");function m(e,t){for(var n=e.split(" "),r=new Array,i=0,o=0;o<n.length;o++)3===i&&(r[i++]=t),n[o]!==t&&(r[i++]=n[o]);return r.join(" ")}t.exports={setPreferedCodec:function(e,t,n){var r=n.split("/");if(2!=r.length)return h("[SdpUtils] Invalid codec setting: "+n),t;for(var i,o,a,s=r[0],c=r[1],d=t.split("\r\n"),u=0;u<d.length;u++)if(-1!==d[u].search("m="+e)){var l=u;break}if(void 0===l)return t;for(u=0;u<d.length;u++)if(-1!==d[u].search(s+"/"+c)){var f=new RegExp(":(\\d+) "+s+"\\/"+c,"i"),p=(i=d[u],o=f,(a=i.match(o))&&2==a.length?a[1]:null);p&&(d[l]=m(d[l],p));break}return t=d.join("\r\n")},setMediaBitrate:function(e,t,n,r){var i=e.split("\n"),o="firefox"===r.name?"TIAS":"AS",a="firefox"===r.name?1e3*(n>>>0):n;if(0!==n){for(var s=0;s<i.length;s++)0===i[s].indexOf("m="+t)&&(s=c(s));return i.join("\n")}function c(e){for(e++;0===i[e].indexOf("i=")||0===i[e].indexOf("c=");)e++;if(0===i[e].indexOf("b"))i[e]="b="+o+":"+a;else{var t=i.slice(0,e);t.push("b="+o+":"+a),i=t.concat(i.slice(e,i.length))}return e}},extractMediaTrackIds:function(e){for(var t,n={},r=/msid:({?[A-Za-z0-9-]+}?)\s({?[A-Za-z0-9-]+}?)/g;null!==(t=r.exec(e));){var i=t[1],o=t[2];i in n||(n[i]=[]),-1===n[i].indexOf(o)&&n[i].push(o)}return n}}},{"./Log":14,"./Utils":32}],24:[function(e,t,n){"use strict";var i=e("./Log"),r=(e("./Utils"),e("./Config")),o=e("./Websocket"),a=e("./PubSub"),s=e("./Fingerprint");function c(){this._socket=null}function d(){this._appId=void 0,this._appKey=void 0,this._id=void 0,this._useSip=void 0,this._socket=void 0}d.prototype={init:function(e,t,n){this._appId=e,this._appKey=t,this._useSip=n},clearSocket:function(){this._socket=void 0},connect:function(e,t){if(this._socket)i("[Signaling] Can't connect. A connection has already been instantiated");else{if(!this._appId||!this._appKey)throw new Error("appId and appKey properties are not defined; init() method must be called prior to connect() method");this._id=e,this._socket=new o(r.API_SERVER),this._socket.on("socket-ready",function(e){this._send("connect",{id:this._id,name:t,appId:this._appId,appKey:this._appKey,useSip:this._useSip,fingerprint:s}),r.set(e)}.bind(this)),this._socket.on("connection-error",c.bind(this)),this._socket.on("disconnect",c.bind(this)),this._setSocketEvents()}},disconnect:function(){this._isSocketSet()&&this._socket.disconnect()},getPresence:function(e){this._isSocketSet()&&this._send("get-presence",e)},setPresence:function(e){this._isSocketSet()&&this._send("set-presence",e)},joinRoom:function(e,t){this._isSocketSet()&&this._send("join-room",{room:e,capacity:t})},quitRoom:function(e){this._isSocketSet()&&this._send("quit-room",{room:e})},sendSignal:function(e,t,n){this._isSocketSet()&&this._send("send-signal",{pid:e,room:t,data:n})},sendSipSignal:function(e,t,n){this._isSocketSet()&&this._send("send-sip-signal",{pid:e,room:t,data:n})},sendSipDtmf:function(e,t){this._isSocketSet()&&this._send("send-sip-dtmf",{room:e,tones:t})},setInternalId:function(e){this._id=e},log:function(e,t){this._isSocketSet()&&this._send("log",{action:e,load:t})},bind:function(e,t){return/^on/.test(e)||(e="on"+e.charAt(0).toUpperCase()+e.slice(1)),-1!=this._events.indexOf(e)?"function"!=typeof t?(i("[Signaling] handler is not a function"),null):a.subscribe(e,t.bind(this)):(i("[Signaling] Unknown event: "+e),null)},unbind:function(){return a.unsubscribe(arguments[0])},addHandler:function(e,t){this.bind.apply(this,arguments)},removeHandler:function(){this.unbind.apply(this,arguments)},_send:function(e,t){"send-signal"!==e&&i("[Signaling] Emit: ",e,t),this._socket.emit(e,t)},_eventsMap:{error:"onError",connected:"onConnected",resumed:"onConnectionResumed","connection-error":"onConnectionError",disconnect:"onDisconnected","joined-room":"onJoinedRoom","join-room-error":"onJoinRoomError","quitted-room":"onQuittedRoom","quit-room-error":"onQuitRoomError","receive-signal":"onSignalReceived","peer-joined-room":"onPeerJoinedRoom","peer-quitted-room":"onPeerQuittedRoom","incoming-request":"onIncomingRequest",presence:"onPresence","sip-progress":"onSipCallProgress","sip-dtmf":"onSipCallDtmf"},_events:["onError","onConnected","onConnectionResumed","onConnectionError","onDisconnected","onJoinedRoom","onJoinRoomError","onQuittedRoom","onQuitRoomError","onPeerJoinedRoom","onPeerQuittedRoom","onSignalReceived","onIncomingRequest","onIncomingCall","onClientUpdateRequired","onExtensionInstalled","onExtensionInstallStarted","onExtensionInstallFailed","onPresence","onSipCallProgress","onSipCallDtmf","onCallFailed","onCallRejected","onCallEnded"],_isSocketSet:function(){return!!this._socket},_setSocketEvents:function(){for(var e in this._eventsMap)this._socket.on(e,function(t,n){var r=e;return function(e){"receive-signal"!==r&&i("[Signaling] Receive: ",r,e),t._fireHandler(n,e)}}(this,this._eventsMap[e]))},_fireHandler:function(e,t){a.publish("_"+e,t),a.publish(e,t)}},t.exports=d},{"./Config":6,"./Fingerprint":12,"./Log":14,"./PubSub":22,"./Utils":32,"./Websocket":33}],25:[function(e,t,n){"use strict";function r(e,t){this.pid=e,this.room=t}r.prototype={send:function(){},onReceive:function(){},onFailed:function(){}},t.exports=r},{}],26:[function(e,t,n){"use strict";var i=e("./Log"),o=e("./Utils"),a=e("./SipSignalingChannel"),s=(e("./UserMedia"),e("./PCManager"));function r(e){this.parent=e}r.prototype={call:function(e,t,n){if(e||i("[BistriConference] You must indicate a call id"),t||i("[BistriConference] You must indicate a number"),o.validateNumber(t)){var r=this.parent.getRemoteStreams(o.sanitizeString(t));r&&r.hasOwnProperty(e)?i('[BistriConference] Cannot call "'+e+'", call already exists'):((n=o.validateOptions(n,["sendonly","receiveonly","audio-codec","video-codec","audio-bitrate","video-bitrate","stream","force-turn","tcp-only","merge-candidates"]))["merge-candidates"]=!0,s.createPeer(e,t,!0,null,n,{},new a(e,t)).addStream(n.stream).start())}},endCall:function(e,t){if(e||i("[BistriConference] You must indicate a call id"),t||i("[BistriConference] You must indicate a number"),o.validateNumber(t)){var n=o.sanitizeString(t);this.parent.signaling.sendSipSignal(o.sanitizeString(e),n,{call:"stop"}),s.closePeer(o.sanitizeString(e),n)}},dtmf:function(e,t){e||i("[BistriConference] You must indicate a number"),t.match(/[0-9#*]+/)||i("[BistriConference] DTMF tone is missing or invalid. 0-9 # * allowed"),this.parent.signaling.sendSipDtmf(e,t)}},t.exports=r},{"./Log":14,"./PCManager":18,"./SipSignalingChannel":27,"./UserMedia":31,"./Utils":32}],27:[function(e,t,n){"use strict";function r(e,t){this.pid=e,this.room=t}r.prototype={send:function(){},onReceive:function(){},onFailed:function(){}},t.exports=r},{}],28:[function(e,t,n){"use strict";var s=e("./MeanOpinionScoreUtils");function r(){this.stats=[],this.computed={send:{video:{},audio:{}},recv:{video:{},audio:{}},transport:{local:{},remote:{},inboundBandwidth:0,outboundBandwidth:0,bytesReceived:0,bytesSent:0,timestamp:0},candidates:{local:{},remote:{}}}}r.prototype.parse=function(e){return this.stats=e,this.stats.forEach(function(e){var t="_"+e.type.replace(/-([a-z])/gi,function(e,t){return t.toUpperCase()});"function"==typeof this[t]&&this[t](e)}.bind(this)),JSON.parse(JSON.stringify(this.computed))},r.prototype._candidatePair=function(e){if(this._isSelectedCandidatePair(e)){var t=e.timestamp-this.computed.transport.timestamp,n=this._findById(e.localCandidateId),r=this._findById(e.remoteCandidateId);this.computed.transport.local.type=n.candidateType,this.computed.transport.local.ip=n.ip,this.computed.transport.local.protocol=n.protocol,this.computed.transport.local.port=n.port,this.computed.transport.remote.type=r.candidateType,this.computed.transport.remote.ip=r.ip,this.computed.transport.remote.protocol=r.protocol,this.computed.transport.remote.port=r.port,this.computed.transport.inboundBandwidth=t?8*Math.round((e.bytesReceived-this.computed.transport.bytesReceived)/(t/1e3)):0,this.computed.transport.outboundBandwidth=t?8*Math.round((e.bytesSent-this.computed.transport.bytesSent)/(t/1e3)):0,this.computed.transport.bytesReceived=e.bytesReceived,this.computed.transport.bytesSent=e.bytesSent,this.computed.transport.timestamp=e.timestamp}},r.prototype._localCandidate=function(e){this.computed.candidates.local[e.id]={type:e.candidateType,ip:e.ip,port:e.port,protocol:e.protocol}},r.prototype._remoteCandidate=function(e){this.computed.candidates.remote[e.id]={type:e.candidateType,ip:e.ip,port:e.port,protocol:e.protocol}},r.prototype._rtp=function(e,t){var n,r=this.computed[e][t.mediaType][t.id],i=this._findById(t.trackId),o=this._findById(t.codecId),a="recv"==e;r?n=(t.timestamp-r.timestamp)/1e3:(n=0,r=this.computed[e][t.mediaType][t.id]={timestamp:t.timestamp}),r.track=i,r.codec=o,"video"==t.mediaType?(r.firCount=t.firCount,r.pliCount=t.pliCount,r.nackCount=t.nackCount,a?(r.framesDecoded=t.framesDecoded,r.track&&(r.mos=s.calculateVideoScore({width:r.track.frameWidth,height:r.track.frameHeight},t,r))):r.framesEncoded=t.framesEncoded,r.qualityLimitationReason&&(r.qLimiReason=t.qualityLimitationReason)):(a&&(r.mos=s.calculateAudioScore(t,r)),r.jitter=t.jitter),a?(r.bitRate=n?8*Math.round((t.bytesReceived-r.bytesReceived)/n):0,r.packetsLost=t.packetsLost,r.packetsReceived=t.packetsReceived,r.bytesReceived=t.bytesReceived):(r.bitRate=n?8*Math.round((t.bytesSent-r.bytesSent)/n):0,r.packetsSent=t.packetsSent,r.bytesSent=t.bytesSent),r.timestamp=t.timestamp},r.prototype._inboundRtp=function(e){this._rtp("recv",e)},r.prototype._outboundRtp=function(e){this._rtp("send",e)},r.prototype._findById=function(t){var n;return this.stats.forEach(function(e){e.id==t&&(n=e)}),n},r.prototype._isSelectedCandidatePair=function(e){var t;return!0===e.nominated&&"succeeded"===e.state&&("selected"in e?e.selected:(this.stats.forEach(function(e){"transport"==e.type&&(t=e)}),!(!t||t.selectedCandidatePairId!=e.id)))},t.exports=r},{"./MeanOpinionScoreUtils":17}],29:[function(e,t,n){"use strict";var r=e("./Log"),i=e("./PubSub");function o(){}o.prototype={bind:function(e,t){return/^on/.test(e)||(e="on"+e.charAt(0).toUpperCase()+e.slice(1)),-1!=this._events.indexOf(e)?"function"!=typeof t?(r("[Streams] handler is not a function"),null):i.subscribe(e,t.bind(this)):(r("[Streams] Unknown event: "+e),null)},unbind:function(){return i.unsubscribe(arguments[0])},addHandler:function(e,t){this.bind.apply(this,arguments)},removeHandler:function(){this.unbind.apply(this,arguments)},_events:["onStreamMuteChange","onStreamError","onStreamAdded","onStreamUpdated","onStreamClosed","onTrackAdded","onTrackRemoved","onStreamStatsUpdated"]},t.exports=new o},{"./Log":14,"./PubSub":22}],30:[function(e,t,n){"use strict";var i=e("./Log"),o=e("./PubSub"),a=e("./Binarize"),s=e("./PacketsMaker"),r=e("./PacketsRequester");function c(e,t,n){this._id=e,this._pid=t,this._file=n,this._data={},this._events=[],this._ttl_chunks=0,this._ack_chunks=0,this._transfered=!1,this._transmitted=0,this._ptransmitted=0,this._timestamp=0,this._ptimestamp=0}function d(e){for(var t,n,r,i=0,o=e;1<o/1e3;)i++,o/=1e3;return t=o,n=2,r=Math.pow(10,n),Math.round(t*r)/r+" "+{1:"KB",2:"MB",3:"GB"}[i]}c.prototype={on:function(e,t){this._events[e]=t},onReceive:function(e){!function(e,t){if(e instanceof Blob){var n=new window.FileReader;n.onloadend=function(e){a.unpack(e.target.result,t)},n.readAsArrayBuffer(e)}else a.unpack(e,t)}(e.data,function(e){switch(e.type){case 7:this._progress(),this._acknowledge(e.data);break;case 1:this._getBitrate(),this._newTransfer(e.data);break;case 2:this._addPacket(e.data);break;case 3:case 4:this._sendPacket(e.data);break;case 5:this._fileSent();break;case 6:this._failed()}}.bind(this))},onError:function(){o.publish("onFileTransferAborted",this._id)},onClose:function(){this._transfered||o.publish("onFileTransferAborted",this._id)},sendFile:function(){o.publish("onFileTransferWaiting",this._pid,{id:this._id,name:this._file.name,size:d(this._file.size)});var r=new s(this._file);this._ttl_chunks=r.getPacketsNb(),r.on("buffered",function(e){this._send(1,e)}.bind(this)),this.on("acknowledgePacket",function(e){r.removePacket(e)}),this.on("sendingPacket",function(e,t){if(e>=this._ttl_chunks)i("[TransferManager] Requested packet is out of range: ",e);else{var n=r.getPacket(e);t&&i("[TransferManager] Try to resend id: ",e),n?(this._send(2,n),this._transmitted+=n.chunk.byteLength||n.chunk.size):(i("[TransferManager] Delay packet: ",e),setTimeout(this._events.sendingPacket.bind(this),200,e,!0))}}.bind(this)),this._getBitrate()},_send:function(e,t){var n,r;n={type:e,data:t},r=function(e){this.onEmit(e)}.bind(this),a.pack(n,function(e){r(e.buffer)})},_newTransfer:function(e){this._file={name:e.fileName,size:e.fileSize,type:e.fileType},this._ttl_chunks=e.chunksNb;var t={ok:function(){this._acceptTransfer(e)}.bind(this),cancel:function(){this.onEnd()}.bind(this)};o.publish("onNewFileTransfer",this._pid,{id:this._id,name:this._file.name,size:d(this._file.size)},t)},_acceptTransfer:function(e){var t=new r;t.on("completed",function(e){this._transfered=!0,this._bitrate(0),o.publish("onFileReceived",this._id,{name:this._file.name,size:d(this._file.size),url:e})}.bind(this)),t.on("progress",function(){this._progress()}.bind(this)),t.on("acknowledge",function(e){this._send(7,{id:e})}.bind(this)),t.on("next",function(e){this._send(3,{id:e})}.bind(this)),t.on("resend",function(e){this._send(4,{id:e})}.bind(this)),t.on("end",function(){this._send(5,null)}.bind(this)),t.on("failed",function(){this._failed()}.bind(this)),this.on("incomingPacket",function(e){t.addPacket(e)}),t.init(e)},_addPacket:function(e){this._transmitted+=e.chunk.byteLength||e.chunk.size,this._events.incomingPacket(e)},_acknowledge:function(e){this._events.acknowledgePacket(e.id)},_progress:function(){var e=100*++this._ack_chunks/this._ttl_chunks;o.publish("onFileTransferProgress",this._id,Math.round(e))},_bitrate:function(e){o.publish("onFileTransferBitrate",this._id,e)},_sendPacket:function(e){this._events.sendingPacket(e.id)},_getBitrate:function(){var e=(new Date).getTime(),t=this._transmitted,n=Math.round((t-this._ptransmitted)/(e-this._ptimestamp));this._bitrate(n),this._transfered||setTimeout(this._getBitrate.bind(this),1e3),this._ptimestamp=e,this._ptransmitted=t},_fileSent:function(){this._transfered=!0,o.publish("onFileSent",this._id),this.onEnd()},_failed:function(){this.onEnd()}},t.exports=c},{"./Binarize":5,"./Log":14,"./PacketsMaker":19,"./PacketsRequester":20,"./PubSub":22}],31:[function(e,t,n){"use strict";var c=e("./Log"),s=e("./PubSub"),d=e("./Config"),u=(e("./Utils"),e("./GetScreenSharing")),l=e("./AudioActivityMonitor");function f(e){var t=!0;return e.getTracks().forEach(function(e){t="ended"===e.readyState&&t}),t}function r(){this._streams=[]}r.prototype={start:function(e,t,n){function r(e){c("[UserMedia] Start Stream failure",e),"function"==typeof n?n(e):s.publish("onStreamError",e)}var i,o,a=function(r){r.localStream=!0,r.type=i,this._streams.push(r),c("[UserMedia] Start Stream ",o,r),r.getTracks().forEach(function(n){/screen(-sharing)?/.test(i)&&(n.desc="screen-sharing"),n.addEventListener("ended",function(e){var t=/screen(-sharing)?/.test(n.desc);f(r)?(l.remove(r),this._streams=this._streams.filter(function(e){return r.id!==e.id}),t&&s.publish("onStreamClosed",r,d.USER_ID),c("[UserMedia] Local Stream Stopped",r)):(t&&s.publish("onStreamUpdated",r,d.USER_ID),c("[UserMedia] Local Track Stopped",r))}.bind(this))}.bind(this)),"function"==typeof t?t(r,d.USER_ID):s.publish("onStreamAdded",r,d.USER_ID)}.bind(this);"object"==typeof e?(e.video?i="video":e.audio&&(i="audio"),o=e,navigator.mediaDevices.getUserMedia(o).then(a).catch(r)):"string"==typeof e&&(i=e,o=this._getConstraints(e),/screen(-sharing)?/.test(e)?window.navigator.mediaDevices&&"getDisplayMedia"in window.navigator.mediaDevices?navigator.mediaDevices.getDisplayMedia(o).then(function(e){a(e)}).catch(r):"getDisplayMedia"in window.navigator?navigator.getDisplayMedia({video:!0}).then(function(e){e.getTracks()[0].applyConstraints({frameRate:o.video.frameRate}),a(e)}).catch(r):u(o,a,r):navigator.mediaDevices.getUserMedia(o).then(a).catch(r))},stop:function(e,t){e&&(console.log("------\x3e stop stream",e),f(e)||e.getTracks().forEach(function(e){console.log("------\x3e stop track",e),e.stop(),e.dispatchEvent(new CustomEvent("ended"))}),"function"==typeof t&&t(e,d.USER_ID))},isGetDisplayMediaAvailable:function(){return"getDisplayMedia"in window.navigator||"getDisplayMedia"in window.navigator.mediaDevices},getDefaultStream:function(){return this._streams.length?this._streams[0]:void 0},getStreams:function(){return this._streams},getTracks:function(){return this._streams.map(function(e){return e.getTracks()})},updateConstraints:function(n,r,i,o){n.getTracks().forEach(function(e){var t=r[e.kind];t&&e.applyConstraints(t).then(function(){"function"==typeof i&&i(n)}).catch(function(e){"function"==typeof o&&o(e)})})},_getConstraints:function(e){var t,n=/screen(-sharing)?(:(browser|monitor|application|window))?(:(\d+)\|(\d+))?/,r={video:!0};if("pure-audio"==e||"audio"==e)delete r.video,r.audio=!0;else if(n.test(e)){var i=(s=e.match(n))[3],o=s[5],a=s[6];r={video:!0,width:{max:window.screen.width},height:{max:window.screen.height},frameRate:{min:o||3,max:a||30},displaySurface:i||"window"}}else{switch(e){case"webcamHD":case"webcam-hd":t="1080x720";break;case"webcamSD":case"webcam-sd":t="640x480";break;default:t=e}var s;(s=t.match(/([0-9]{2,4})x([0-9]{2,4})(:([0-9]{1,2}))*/))?(r.audio=!0,r.video={width:{max:s[1]},height:{max:s[2]}},s[4]&&(r.video.frameRate={max:s[4]})):c("[UserMedia] unexpected constraints format. Correct pattern should be {width}x{height}[:{frame rate}]")}return c("[UserMedia] media constraints: ",r),r}},t.exports=new r},{"./AudioActivityMonitor":4,"./Config":6,"./GetScreenSharing":13,"./Log":14,"./PubSub":22,"./Utils":32}],32:[function(e,t,n){"use strict";var i=e("./Log"),r=e("../ua-parser/ua-parser-0.7.21")(navigator.userAgent),o={os:r.os.name.replace(/\s+/,"").toLowerCase(),name:r.browser.name.replace(/\s+/,"").toLowerCase(),version:r.browser.major,vendor:navigator.vendor.toLowerCase()};function a(){}a.prototype={isCompatible:function(){return!("chrome"==o.name&&o.version<45||"firefox"==o.name&&o.version<38||"edge"==o.name&&o.version<15||"opera"==o.name&&o.version<32||("safari"==o.name||"mobilesafari"===o.name)&&o.version<11)&&!!((navigator.mediaDevices?navigator.mediaDevices.getUserMedia:navigator.getUserMedia)&&window.URL&&window.RTCPeerConnection&&window.RTCSessionDescription&&window.RTCIceCandidate)},getBrowser:function(){return o},getClientProperties:function(e){return o},getCallClientsId:function(e){return o.name+"/"+o.version+">"+(e?e.name+"/"+e.version:"mobile sdk")},isFirefox:function(){return"firefox"===o.name},isChrome:function(){return"chrome"===o.name},isSafari:function(){return"safari"===o.name||"mobilesafari"===o.name},isSafariIOS:function(){return"mobilesafari"===o.name&&"ios"===o.os},isOpera:function(){return"opera"===o.name},isEdge:function(){return"edge"===o.name},isEdgeORTC:function(){return"edge"===o.name&&o.version<=18},getVersion:function(){return o.version},sanitizeString:function(e){return"string"==typeof e?e.replace(/^\s+|\s+$/g,"").replace(/\s/g,"_"):e},validateString:function(e,t){if(!e&&!t)return!0;if(e&&"string"==typeof e){if(e.match(/^[a-zA-Z0-9-_\s]+$/))return!0;throw new Error("string contains unauthorized chars. Use only a-z, A-Z, 0-9, hyphen, underscore or space")}throw new Error("value can't be undefined or empty, string expected")},validateNumber:function(e,t){if(!e&&!t)return!0;if(e&&"string"==typeof e){if(e.match(/^[a-z0-9-:]+$/))return!0;throw"Error: string contains unauthorized chars. Use only a-z 0-9 - :"}throw"Error: value can't be undefined or empty, string expected"},random:function(e){for(var t=e||20,n="",r=0;r<t;r++)n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_".charAt(63*Math.random());return n},insertExtensionTag:function(e){var t=document.createElement("link");document.querySelector("head").appendChild(t),t.setAttribute("rel","chrome-webstore-item"),t.setAttribute("href","https://chrome.google.com/webstore/detail/"+e)},validateOptions:function(e,t){var n={};if(e){if("object"!=typeof e)return i("[BistriConference] Options should be an object"),n;for(var r in e)-1!=t.indexOf(r)&&(n[r]=e[r])}return n}},t.exports=new a},{"../ua-parser/ua-parser-0.7.21":35,"./Log":14}],33:[function(e,t,n){"use strict";var l=e("./Log"),r=(e("../sockjs/sockjs-0.3.4"),e("./Config"));function i(e){this._url=e,this._eventsHandlers={},this._socket=null,this._socketId=void 0,this._opened=!1,this._retry=2e3,this._maxRetry=12,this._retryCount=0,this._heartbeatCheck=25e3,this._heartbeatTimeout=5e4,this._heartbeatInterval=void 0,this._lastHeartbeat=0,this._reconnectionTimer=void 0,this._reconnectionDelay=6e4,this.connect()}i.prototype={connect:function(){if(!this._opened){this._reconnectionTimer&&this._clearTimer();var e,t,n,r,i,o,a,s,c,d,u=this;this._socket=new SockJS(this._url+"/conference",null,{debug:!1,protocols_whitelist:["websocket","xhr-polling","iframe-xhr-polling","jsonp-polling"]}),this._socketId=this._socket._server,this._socket.onheartbeat=(e=this._socketId,t=u,function(){e==t._socketId&&(t._reconnectionTimer&&(l("[Websocket] Connection resumed, reconnection process aborted"),t._clearTimer(),t._startHeartBeatCheck(),t._fireHandler("resumed")),t._lastHeartbeat=(new Date).getTime(),t.emit("heartbeat",{}))}),this._socket.onerror=(n=this._socketId,r=u,function(e){n==r._socketId&&(l("[Websocket] Error (%s)",n),r._fireHandler("error",e))}),this._socket.onopen=(i=this._socketId,o=u,function(){i==o._socketId&&(o._retryCount=0,o._opened=!0,o._fireHandler("open"),o._startHeartBeatCheck())}),this._socket.onclose=(a=this._socketId,s=u,function(e){if(a==s._socketId)switch(l("[Websocket] Disconnection: "+e.reason+" ("+e.code+")"),s._stopHeartbeatCheck(),s._opened&&(s._opened=!1,s._socket=null,s._socketId=void 0),e.code){case 1e3:s._fireHandler("disconnect");case 56:break;case 1003:case 1007:case 1008:case 1009:case 1010:case 1001:s._fireHandler("connection-error",e);break;case 1002:case 1011:default:s._autoReconnect()}}),this._socket.onmessage=(c=this._socketId,d=u,function(e){var t;if(c==d._socketId){try{t=JSON.parse(e.data)}catch(e){l("[Websocket] Fail to parse string:",t)}t&&d._fireHandler(t.type,t.data)}})}},reconnect:function(){this._opened=!1,this._socket=null,this._socketId=void 0,this.connect()},disconnect:function(){this._socket&&this._socket.close()},on:function(e,t){"function"!=typeof t?l('[Websocket] Fail to add handler "'+e+'": function expected'):(e in this._eventsHandlers||(this._eventsHandlers[e]=[]),this._eventsHandlers[e].push(t))},emit:function(e,t){try{var n=JSON.stringify({type:e,data:t});this._socket.send(n)}catch(e){l("[Websocket] Fail to stringify JSON object:",t)}},_fireHandler:function(e,t){if(e in this._eventsHandlers)for(var n=this._eventsHandlers[e],r=0,i=n.length;r<i;r++)n[r](t)},_autoReconnect:function(){r.AUTO_RECONNECT&&((this._retryCount<this._maxRetry||!this._maxRetry)&&this._retryCount++,setTimeout(function(){this.reconnect()}.bind(this),1e3*this._fibonacci(this._retryCount)+this._randomDelay()))},_startHeartBeatCheck:function(){this._heartbeatInterval||(l("[Websocket] Start heartbeat check process"),this._heartbeatInterval=setInterval(function(){(new Date).getTime()-this._lastHeartbeat>this._heartbeatTimeout&&(l("[Websocket] No heartbeat detected. Auto-reconnection in "+this._reconnectionDelay/6e4+" minutes"),this._reconnectionTimer=setTimeout(function(){l("[Websocket] Auto-reconnection after "+this._reconnectionDelay/6e4+" minutes of inactivity"),this._autoReconnect(),this._reconnectionTimer=void 0}.bind(this),this._reconnectionDelay),this._stopHeartbeatCheck())}.bind(this),this._heartbeatCheck))},_stopHeartbeatCheck:function(){this._heartbeatInterval&&(l("[Websocket] Stop heartbeat check process"),clearInterval(this._heartbeatInterval),this._heartbeatInterval=void 0,this._lastHeartbeat=0)},_fibonacci:function(e){var t=1;return 0==e?t:1==e?t+=1:this._fibonacci(e-1)+this._fibonacci(e-2)},_clearTimer:function(){clearTimeout(this._reconnectionTimer),this._reconnectionTimer=void 0},_randomDelay:function(){return Math.round(4*Math.random())+1}},t.exports=i},{"../sockjs/sockjs-0.3.4":2,"./Config":6,"./Log":14}],34:[function(e,t,n){"use strict";e("../adapter/adapter-7.5.1");var u=e("./Log"),l=e("./Utils"),f=e("./Config"),r=e("./Sip"),i=e("./Signaling"),p=e("./SignalingChannel"),o=e("./SipSignalingChannel"),a=e("./Streams"),s=e("./DataChannels"),c=e("./FileTransfer"),h=e("./UserMedia"),m=e("./PCManager"),v=e("./PubSub"),d=e("./AudioActivityMonitor"),g=e("./MeanOpinionScore");function y(){this.version=f.VERSION,this.connected=!1,this.appId=void 0,this.appKey=void 0,this.userId=void 0,this.userName=void 0,this.autoCloseOnExit=!0,this.streams=a,this.channels=s,this.files=c,this.signaling=new i,this._rooms={},this._calls={},this._files={},this._isMicrophoneMuted=!1,this._isVideoMuted=!1,this._isAllSoundsMuted=!1,this._init()}function b(e,t,n,r){if(e&&e.localStream&&"muted"in t&&(t.muted="muted"),"autoplay"in t&&(!n||!n.hasOwnProperty("autoplay")||n&&n.autoplay)&&(t.setAttribute("autoplay",""),l.isSafariIOS()&&(t.setAttribute("muted",""),t.setAttribute("playsinline",""))),"controls"in t&&n&&n.controls&&(t.controls="controls"),n&&n.mirror){var i="transform: rotateY( 180deg )";switch(l.getBrowser().name){case"chrome":case"safari":i="-webkit-"+i;break;case"firefox":i="-moz-"+i}t.setAttribute("style",i)}n&&n.fullscreen&&r&&t.addEventListener("click",function(){t.requestFullScreen?t.requestFullScreen():t.webkitRequestFullScreen?t.webkitRequestFullScreen():t.mozRequestFullScreen&&t.mozRequestFullScreen()})}y.prototype={presence:{online:"1",away:"2",busy:"3",offline:"4"},init:function(e){var t=l.getBrowser();if(!(e=e||{}).appId||!e.appKey)throw new Error("appId and appKey parameters are mandatory");e.hasOwnProperty("userId")&&"string"==typeof e.userId&&(e.userId=l.sanitizeString(e.userId)),e.useSip&&(this.sip=new r(this)),this.userId=e.userId||void 0,this.userName=e.userName||void 0,this.appId=e.appId,this.appKey=e.appKey,e.hasOwnProperty("autoCloseOnExit")&&(this.autoCloseOnExit=e.autoCloseOnExit),this.signaling.init(this.appId,this.appKey,e.useSip||void 0),e.hasOwnProperty("chromeExtentionId")&&(e.chromeExtensionId=e.chromeExtentionId),f.set({userId:this.userId,chromeExtId:e.chromeExtensionId,firefoxExtId:e.firefoxExtensionId,extAutoReload:!e.hasOwnProperty("extAutoReload")||e.extAutoReload,turnServers:e.hasOwnProperty("turnServers")?e.turnServers:[],stunServers:e.hasOwnProperty("stunServers")?e.stunServers:[],forceTURN:!!e.hasOwnProperty("forceTURN")&&e.forceTURN,tcpOnly:!!e.hasOwnProperty("tcpOnly")&&e.tcpOnly,autoReconnect:!!e.hasOwnProperty("autoReconnect")&&e.autoReconnect,statsInterval:e.hasOwnProperty("statsInterval")?e.statsInterval:4,autoAcceptCall:!e.hasOwnProperty("autoAcceptCall")||e.autoAcceptCall,debug:!!e.hasOwnProperty("debug")&&e.debug,apiServer:e.apiServer}),"chrome"==t.name&&34<=t.version&&!h.isGetDisplayMediaAvailable()&&l.insertExtensionTag(e.chromeExtensionId),this.autoCloseOnExit&&"undefined"!=typeof window&&(void 0!==window.onbeforeunload?window.addEventListener("beforeunload",function(){this.disconnect()}.bind(this)):void 0!==window.onunload&&window.addEventListener("unload",function(){this.disconnect()}.bind(this)))},connect:function(){this.signaling.connect(this.userId,this.userName)},disconnect:function(){this.signaling.disconnect()},joinRoom:function(e,t){if(l.validateString(e,!0)){if(t&&isNaN(Number(t)))throw new Error("capacity must an integer comprised between 2 and 256");if(Number(t)<2||256<Number(t))throw new Error("capacity must an integer comprised between 2 and 256");this.signaling.joinRoom(l.sanitizeString(e),t)}},quitRoom:function(e){e||u("[BistriConference] API CHANGE WARNING: you must indicate a room name -> quitRoom( room )"),l.validateString(e)&&this.signaling.quitRoom(l.sanitizeString(e))},call:function(e,t,n){if(t||u("[BistriConference] API CHANGE WARNING: you must indicate a room name -> call( id, room )"),l.validateString(t)){var r=this.getRemoteStreams(l.sanitizeString(t));if(r&&r.hasOwnProperty(e))u('[BistriConference] Cannot call "'+e+'", call already exists');else{var i=l.random(8),o=l.validateOptions(n,["sendonly","receiveonly","audio-codec","video-codec","audio-bitrate","video-bitrate","stream","force-turn","tcp-only","merge-candidates"]);this._calls[i]=o.stream,o.hasOwnProperty("stream")&&delete o.stream,this.signaling.sendSignal(l.sanitizeString(e),l.sanitizeString(t),{call:"init",id:i,client:l.getClientProperties(),options:o,extra:{}}),u("[BistriConference] Send call request to remote peer",e,t)}}},updateCall:function(t,n,e){if(n||u("[BistriConference] API CHANGE WARNING: you must indicate a room name -> call( id, room )"),l.validateString(n)){var r=l.validateOptions(e,["audio-codec","video-codec","audio-bitrate","video-bitrate","stream","force-turn","tcp-only","merge-candidates"]);if("stream"in r){var i=r.stream;(i instanceof Array?i:[i]).forEach(function(e){"add"in e?m.addStream(l.sanitizeString(t),l.sanitizeString(n),e.add):"remove"in e?m.removeStream(l.sanitizeString(t),l.sanitizeString(n),e.remove):"update"in e?m.updateStream(l.sanitizeString(t),l.sanitizeString(n),e.update):"copy"in e&&m.copyStream(l.sanitizeString(t),l.sanitizeString(n),e.copy[0],e.copy[1])})}"audio-bitrate"in r&&m.updateBitrate(l.sanitizeString(t),l.sanitizeString(n),"audio",r["audio-bitrate"]),"video-bitrate"in r&&m.updateBitrate(l.sanitizeString(t),l.sanitizeString(n),"video",r["video-bitrate"])}},openDataChannel:function(e,t,n,r){if(l.isEdgeORTC())return u("[BistriConference] Edge doesn't support data channel yet, request silently ignored");if(l.validateString(n)){var i=m.getDataChannels(l.sanitizeString(n));if(i&&i.hasOwnProperty(e)&&i[e].hasOwnProperty(t))return u('[BistriConference] Cannot open datachannel "'+e+'", datachannel already exists');this.signaling.sendSignal(l.sanitizeString(e),l.sanitizeString(n),{channel:"init",id:l.random(8),label:t,client:l.getClientProperties(),options:l.validateOptions(r,["reliable","binaryType"]),extra:{}}),u("[BistriConference] Send data channel request to remote peer",e,t,n)}},sendFile:function(e,t,n){if(l.validateString(t))if(0!=n.size){var r=l.random(12);this._files[r]=n,this.signaling.sendSignal(l.sanitizeString(e),l.sanitizeString(t),{channel:"init",id:r,label:"__file_transfert_"+r,client:l.getClientProperties(),file:{id:r,name:n.name,size:n.size},extra:{}}),u("[BistriConference] Send file sharing request to remote peer",e,t,n)}else u("[BistriConference] Cannot send empty file")},endCall:function(e,t){if(t||u("[BistriConference] API CHANGE WARNING: you must indicate a room name -> endCall( room )"),l.validateString(t)){var n=l.sanitizeString(t);this.signaling.sendSignal(l.sanitizeString(e),n,{call:"stop"}),m.closePeer(l.sanitizeString(e),n),u("[BistriConference] End connection with remote peer",e,t)}},endCalls:function(e){if(e||u("[BistriConference] API CHANGE WARNING: you must indicate a room name -> endCalls( room )"),l.validateString(e))for(var t=l.sanitizeString(e),n=m.getPeersId(t),r=0;r<n.length;r++)this.signaling.sendSignal(n[r],t,{call:"stop"}),m.closePeer(n[r],t)},startStream:function(e,t,n){if(t&&"function"!=typeof t||n&&"function"!=typeof n)throw new Error("successCallback/errorCallback is not a valid function, function expected");h.start(e,t,n)},updateStream:function(e,t,n,r){if(!e||!t)throw new Error("stream and constraints arguments are mandatory");h.updateConstraints(e,t,n,r)},stopStream:function(){1<arguments.length?h.stop(arguments[0],arguments[1]):(u("[BistriConference] API CHANGE WARNING: stream to stop must be specified."),h.stop(h.getDefaultStream(),arguments[0]))},getMediaSources:function(e){if("function"!=typeof e)throw new Error(e+" is not a valid callback, function expected");navigator.mediaDevices.enumerateDevices().then(e).catch(function(e){throw new Error(e.name+": "+error.message)})},getLocalStreams:function(){return h.getStreams()},getRemoteStreams:function(e){return e&&!l.validateString(e)?{}:m.getRemoteStreams(l.sanitizeString(e))},getLocalTracks:function(){return m.getLocalTracks()},getRemoteTracks:function(e){return e&&!l.validateString(e)?{}:m.getRemoteTracks(l.sanitizeString(e))},getPeersInRoom:function(e){return l.validateString(e)?m.getPeersId(l.sanitizeString(e)):[]},getRoomMembers:function(e){if(!l.validateString(e))return[];var t=l.sanitizeString(e);return this._rooms[t]?this._rooms[t].members:[]},getDataChannels:function(e){return e&&!l.validateString(e)?{}:m.getDataChannels(l.sanitizeString(e))},getFileTransferts:function(e){return e&&!l.validateString(e)?{}:m.getFileTransferts(l.sanitizeString(e))},attachStream:function(e,t,n){var r=!!e.getVideoTracks()&&!!e.getVideoTracks().length;if(!!e.getAudioTracks()&&!!e.getAudioTracks().length&&this.isAllSoundsMuted()&&this._muteSound(e,!0),t&&"VIDEO"!=t.nodeName&&"AUDIO"!=t.nodeName)try{var i=document.createElement(r?"VIDEO":"AUDIO");t.appendChild(i),t=i}catch(e){u("[BistriConference] Node must be a VIDEO/AUDIO element or a container (DIV, SPAN, ...)")}return"VIDEO"!=t.nodeName&&"AUDIO"!=t.nodeName||(t.srcObject=e,t.setAttribute("id",e.id),b(e,t,n,r)),t},reattachStream:function(e,t){var n=!!e.getVideoTracks()&&!!e.getVideoTracks().length,r=!!e.getAudioTracks()&&!!e.getAudioTracks().length,i=document.getElementById(e.id);if((n||r)&&i){if(r&&this.isAllSoundsMuted()&&this._muteSound(e,!0),n&&"audio"==i.nodeName.toLowerCase()||!n&&"video"==i.nodeName.toLowerCase()){for(var o=i.attributes,a=document.createElement(n?"VIDEO":"AUDIO"),s=0,c=o.length;s<c;s++)a.setAttribute(o[s].name,o[s].value);i.parentNode.replaceChild(a,i),b(e,i=a,t,n),i.srcObject=e}return i}},detachStream:function(e){var t=document.getElementById(e.id);t&&t.parentNode.removeChild(t)},cloneStream:function(e){return e?e.clone():new MediaStream},mergeStream:function(e,n,r){return e.getTracks().forEach(function(t){var e=n.getTracks().find(function(e){return e.kind===t.kind});e&&(r&&(e.stop(),e.dispatchEvent(new Event("ended"))),n.removeTrack(e)),n.addTrack(t)}),n},dummyStream:function(){return new MediaStream},setTrackDescription:function(e,t,n){var r=e.getTracks().find(function(e){return e.kind===t});r&&(r.desc=n)},stopTrack:function(e,t,n){var r=e.getTracks().find(function(e){return e.kind===t});r&&(r.stop(),r.dispatchEvent(new Event("ended")),n&&e.removeTrack(r))},getPresence:function(e){this.signaling.getPresence(l.sanitizeString(e))},setPresence:function(e){var t=this.presence[e];if(!t)throw new Error("unkown status");this.signaling.setPresence(t)},allowMonitorAudioActivity:function(e,t){d.resume()},monitorAudioActivity:function(e,t){d.add(e,t)},meanOpinionScore:function(e,t,n,r){g.add(e,t,n,r)},_muteSound:function(e,r){(e instanceof Array?e:[e]).forEach(function(e){for(var t=e.getAudioTracks()||[],n=0;n<t.length;n++)t[n].enabled=!r})},muteSound:function(e,t){this._muteSound(e,t)},isSoundMuted:function(e){var t=e.getAudioTracks();return!!t.length&&!t[0].enabled},muteAllSounds:function(e){var t=this.getRemoteStreams();for(var n in t)bc._muteSound(t[n],e);this._isAllSoundsMuted=e},isAllSoundsMuted:function(){return this._isAllSoundsMuted},muteVideo:function(e,t){var n=e.getVideoTracks()||[],r=[];this._isVideoMuted=t||!this._isVideoMuted;for(var i=0;i<n.length;i++)n[i].enabled=!t,r.push(n[i].id);for(var o in this._rooms)this._rooms[o].members.forEach(function(e){this.signaling.sendSignal(e.id,o,{mute:t,ids:r})}.bind(this));v.publish("onStreamMuteChange",t,this.userId)},toggleVideo:function(t){var n=t.getVideoTracks()||[],r=n.map(function(e){return e.id});for(var i in this._isVideoMuted=!this._isVideoMuted,n.forEach(function(e){e.enabled=!this._isVideoMuted}.bind(this)),this._rooms)this._rooms[i].members.forEach(function(e){m[this._isVideoMuted?"removeTrack":"addTrack"](l.sanitizeString(e.id),l.sanitizeString(i),n[0],t),this.signaling.sendSignal(e.id,i,{mute:this._isVideoMuted,ids:r})}.bind(this));return v.publish("onStreamMuteChange",this._isVideoMuted,this.userId),this._isVideoMuted},isVideoMuted:function(){return this._isVideoMuted},muteMicrophone:function(t){this._isMicrophoneMuted=t,this.getLocalStreams().forEach(function(e){this._muteSound(e,t)}.bind(this))},isMicrophoneMuted:function(){return this._isMicrophoneMuted},isConnected:function(){return!!this.connected},isCompatible:function(){return!!l.isCompatible()},isScreenSharingCompatible:function(){if(h.isGetDisplayMediaAvailable())return!0;var e=l.getBrowser();return"chrome"==e.name&&34<=e.version||"firefox"==e.name&&33<=e.version},getWebRTCPluginURL:function(){return""},getWebRTCPluginPageId:function(){return 0},isWebRTCPluginUsed:function(){return!1},isWebRTCPluginAvailable:function(){return!1},getBrowser:function(){return l.getBrowser()},_init:function(){var d=this.signaling;f.API_SERVER.match(/^(https?:\/\/)(.*)$/);v.subscribe("_onConnected",function(e){for(var t in this.connected=!0,this.userId=e.id,d.setInternalId(e.id),f.set({userId:e.id}),this._rooms)t.match(/^__/)||this.signaling.joinRoom(t,this._rooms[t].capacity)}.bind(this)),v.subscribe("_onDisconnected",function(e){this.signaling.clearSocket(),this.connected=!1}.bind(this)),v.subscribe("_onJoinedRoom",function(e){this._rooms[e.room]={capacity:e.capacity,members:e.members}}.bind(this)),v.subscribe("_onQuittedRoom",function(e){delete this._rooms[e.room],m.closeAllPeers(e.room)}.bind(this)),v.subscribe("_onPeerJoinedRoom",function(e){this._rooms[e.room]&&this._rooms[e.room].members.push({id:e.pid,name:e.name})}.bind(this)),v.subscribe("_onPeerQuittedRoom",function(n){this._rooms[n.room]&&this._rooms[n.room].members.forEach(function(e,t){e.id==n.pid&&this._rooms[n.room].members.splice(t,1)}.bind(this)),m.closePeer(n.pid,n.room)}.bind(this)),v.subscribe("_onSignalReceived",function(n){if(n.data&&n.data.hasOwnProperty("warning"))return u("[BistriConference] Warning:",n.data.warning,n.pid,n.room,n.data.client);if(n.data&&n.data.hasOwnProperty("error"))return u("[BistriConference] Connection with callee has failed: ",n.data.error),m.closePeer(n.pid,n.room,n.data.extra);if(n.data&&n.data.hasOwnProperty("mute")){var e=m.getRemoteTracks(),t=n.data.ids;e[n.pid].length&&e[n.pid].forEach(function(e){"video"==e.kind&&-1!=t.indexOf(e.id)&&(e.enabled=!n.data.mute)}),v.publish("onStreamMuteChange",n.data.mute,n.pid,n.data.ids)}if(n.data&&(n.data.hasOwnProperty("call")||n.data.hasOwnProperty("channel"))){var r,i=!1;if(n.data.hasOwnProperty("turnArray")&&f.set({turn:n.data.turnArray}),n.data.hasOwnProperty("stunArray")&&f.set({stun:n.data.stunArray}),"init"===n.data.call||"init"===n.data.channel){u("[BistriConference] "+(n.data.call?"Call":"Data Channel")+" requested by remote peer",n.pid,n.room,n.data.client);var o=n.data.client;if("channel"in n.data&&(l.isEdgeORTC()||"object"==typeof o&&("edge"==o.name&&o.version<=18))){return u("[BistriConference] Remote Data Channel request has been ignored",n.pid,n.room),d.sendSignal(n.pid,n.room,{warning:"Browser doesn't support data channel yet, request ignored",client:l.getClientProperties()})}r=m.getPeer(n.pid,n.room,n.data.options,n.data.extra)||m.createPeer(n.pid,n.room,!1,n.data.client,n.data.options,n.data.extra,new p(n.pid,n.room));var a={id:n.data.id,client:l.getClientProperties(),options:n.data.options,extra:n.data.extra};if(a[n.data.call?"call":"channel"]="ready",n.data.call){if(!f.AUTO_CALL){var s={type:"media",pid:n.pid,room:n.room,client:n.data.client,sendonly:"sendonly"in n.data.options&&n.data.options.sendonly,accept:function(e){if(!("sendonly"in n.data.options&&n.data.options.sendonly)){if("stream"in e){var t=e.stream;(t instanceof Array?t:[t]).forEach(function(e){r.addStream(e)})}"audio-bitrate"in e&&r.updateBitrate("audio",e["audio-bitrate"]),"video-bitrate"in e&&r.updateBitrate("video",e["video-bitrate"])}d.sendSignal(n.pid,n.room,a)},reject:function(){a.call="cancel",m.closePeer(n.pid,n.room,n.data.extra),d.sendSignal(n.pid,n.room,a)}};return v.publish("onIncomingCall",s)}r.addStream(h.getDefaultStream()),"audio-bitrate"in n.data.options&&r.updateBitrate("audio",n.data.options["audio-bitrate"]),"video-bitrate"in n.data.options&&r.updateBitrate("video",n.data.options["video-bitrate"])}if(n.data.channel)if(a.label=n.data.label,n.data.file)v.publish("_onFileWaitingTransfer",n.data.label,n.data.file);else if(!f.AUTO_CALL){s={type:"datachannel",pid:n.pid,room:n.room,client:n.data.client,accept:function(e){d.sendSignal(n.pid,n.room,a)},reject:function(){a.call="cancel",m.closePeer(n.pid,n.room,n.data.extra),d.sendSignal(n.pid,n.room,a)}};return v.publish("onIncomingCall",s)}d.sendSignal(n.pid,n.room,a)}else if("stop"===n.data.call)m.closePeer(n.pid,n.room,n.data.extra);else{if("cancel"===n.data.call||"cancel"===n.data.channel)return this._calls[n.data.id]&&delete this._calls[n.data.id],v.publish("onCallRejected",n.pid,n.room);var c;u("[BistriConference] "+(n.data.call?"Call":"Data Channel")+" request accepted by remote peer",n.pid,n.room,n.data.client),(r=m.getPeer(n.pid,n.room,n.data.options,n.data.extra))||(i=!0,r=m.createPeer(n.pid,n.room,!0,n.data.client,n.data.options,n.data.extra,new p(n.pid,n.room))),n.data.call?(this._calls[n.data.id]?(c=this._calls[n.data.id],delete this._calls[n.data.id]):c=h.getDefaultStream(),(c instanceof Array?c:[c]).forEach(function(e){r.addStream(e)}),"audio-bitrate"in n.data.options&&r.updateBitrate("audio",n.data.options["audio-bitrate"]),"video-bitrate"in n.data.options&&r.updateBitrate("video",n.data.options["video-bitrate"])):n.data.channel&&(this._files[n.data.id]?(m.createFileTransfer(n.pid,n.data.label,n.room,n.data.id,this._files[n.data.id],n.data.extra),delete this._files[n.data.id]):m.createDataChannel(n.pid,n.data.label,n.room,n.data.options,n.data.extra));i&&r.start()}}n.data&&(n.data.hasOwnProperty("sd")||n.data.hasOwnProperty("candidate")||n.data.hasOwnProperty("eoc")||n.data.hasOwnProperty("negorequested")||n.data.hasOwnProperty("negoaccepted"))&&m.setSignal(n.pid,n.room,n.data)}.bind(this)),v.subscribe("_onCallStart",function(e){d.log("call-start",e)}),v.subscribe("_onCallStop",function(e){d.log("call-stop",e)}),v.subscribe("_onCallFail",function(e){d.log("call-fail",e)}),v.subscribe("_onDataChannelStart",function(e){d.log("datachannel-open",e)}),v.subscribe("_updateApiClient",function(e){this._updateApiClient(e)}.bind(this)),p.prototype={send:function(e){d.sendSignal(this.pid,this.room,e)},onFailed:function(e){d.sendSignal(this.pid,this.room,e)}},o.prototype={send:function(e){d.sendSipSignal(this.pid,this.room,e)},onFailed:function(e){d.sendSignal(this.pid,this.room,e)}}}},t.exports=new y},{"../adapter/adapter-7.5.1":1,"./AudioActivityMonitor":4,"./Config":6,"./DataChannels":9,"./FileTransfer":10,"./Log":14,"./MeanOpinionScore":16,"./PCManager":18,"./PubSub":22,"./Signaling":24,"./SignalingChannel":25,"./Sip":26,"./SipSignalingChannel":27,"./Streams":29,"./UserMedia":31,"./Utils":32}],35:[function(e,C,w){!function(i,l){"use strict";var f="function",e="undefined",t="model",n="name",r="type",o="vendor",a="version",s="architecture",c="console",d="mobile",u="tablet",p="smarttv",h="wearable",m={extend:function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n},has:function(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()},major:function(e){return"string"==typeof e?e.replace(/[^\d\.]/g,"").split(".")[0]:l},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},v={rgx:function(e,t){for(var n,r,i,o,a,s,c=0;c<t.length&&!a;){var d=t[c],u=t[c+1];for(n=r=0;n<d.length&&!a;)if(a=d[n++].exec(e))for(i=0;i<u.length;i++)s=a[++r],"object"==typeof(o=u[i])&&0<o.length?2==o.length?typeof o[1]==f?this[o[0]]=o[1].call(this,s):this[o[0]]=o[1]:3==o.length?typeof o[1]!=f||o[1].exec&&o[1].test?this[o[0]]=s?s.replace(o[1],o[2]):l:this[o[0]]=s?o[1].call(this,s,o[2]):l:4==o.length&&(this[o[0]]=s?o[3].call(this,s.replace(o[1],o[2])):l):this[o]=s||l;c+=2}},str:function(e,t){for(var n in t)if("object"==typeof t[n]&&0<t[n].length){for(var r=0;r<t[n].length;r++)if(m.has(t[n][r],e))return"?"===n?l:n}else if(m.has(t[n],e))return"?"===n?l:n;return e}},g={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},y={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[n,a],[/(opios)[\/\s]+([\w\.]+)/i],[[n,"Opera Mini"],a],[/\s(opr)\/([\w\.]+)/i],[[n,"Opera"],a],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim)(?:browser)?[\/\s]?([\w\.]*)/i,/(bidubrowser|baidubrowser)[\/\s]?([\w\.]+)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon)\/([\w\.-]+)/i],[n,a],[/(konqueror)\/([\w\.]+)/i],[[n,"Konqueror"],a],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[n,"IE"],a],[/(edge|edgios|edga|edg)\/((\d+)?[\w\.]+)/i],[[n,"Edge"],a],[/(yabrowser)\/([\w\.]+)/i],[[n,"Yandex"],a],[/(Avast)\/([\w\.]+)/i],[[n,"Avast Secure Browser"],a],[/(AVG)\/([\w\.]+)/i],[[n,"AVG Secure Browser"],a],[/(puffin)\/([\w\.]+)/i],[[n,"Puffin"],a],[/(focus)\/([\w\.]+)/i],[[n,"Firefox Focus"],a],[/(opt)\/([\w\.]+)/i],[[n,"Opera Touch"],a],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[n,"UCBrowser"],a],[/(comodo_dragon)\/([\w\.]+)/i],[[n,/_/g," "],a],[/(windowswechat qbcore)\/([\w\.]+)/i],[[n,"WeChat(Win) Desktop"],a],[/(micromessenger)\/([\w\.]+)/i],[[n,"WeChat"],a],[/(brave)\/([\w\.]+)/i],[[n,"Brave"],a],[/(qqbrowserlite)\/([\w\.]+)/i],[n,a],[/(QQ)\/([\d\.]+)/i],[n,a],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[n,a],[/(baiduboxapp)[\/\s]?([\w\.]+)/i],[n,a],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[n,a],[/(MetaSr)[\/\s]?([\w\.]+)/i],[n],[/(LBBROWSER)/i],[n],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[a,[n,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[a,[n,"Facebook"]],[/safari\s(line)\/([\w\.]+)/i,/android.+(line)\/([\w\.]+)\/iab/i],[n,a],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[a,[n,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[n,/(.+)/,"$1 WebView"],a],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[n,/(.+(?:g|us))(.+)/,"$1 $2"],a],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[a,[n,"Android Browser"]],[/(sailfishbrowser)\/([\w\.]+)/i],[[n,"Sailfish Browser"],a],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[n,a],[/(dolfin)\/([\w\.]+)/i],[[n,"Dolphin"],a],[/(qihu|qhbrowser|qihoobrowser|360browser)/i],[[n,"360 Browser"]],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[n,"Chrome"],a],[/(coast)\/([\w\.]+)/i],[[n,"Opera Coast"],a],[/fxios\/([\w\.-]+)/i],[a,[n,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[a,[n,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[a,n],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[n,"GSA"],a],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[n,[a,v.str,g.browser.oldsafari.version]],[/(webkit|khtml)\/([\w\.]+)/i],[n,a],[/(navigator|netscape)\/([\w\.-]+)/i],[[n,"Netscape"],a],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[n,a]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[s,"amd64"]],[/(ia32(?=;))/i],[[s,m.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[s,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[s,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[s,/ower/,"",m.lowerize]],[/(sun4\w)[;\)]/i],[[s,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+[;l]))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[s,m.lowerize]]],device:[[/\((ipad|playbook);[\w\s\),;-]+(rim|apple)/i],[t,o,[r,u]],[/applecoremedia\/[\w\.]+ \((ipad)/],[t,[o,"Apple"],[r,u]],[/(apple\s{0,1}tv)/i],[[t,"Apple TV"],[o,"Apple"],[r,p]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[o,t,[r,u]],[/(kf[A-z]+)\sbuild\/.+silk\//i],[t,[o,"Amazon"],[r,u]],[/(sd|kf)[0349hijorstuw]+\sbuild\/.+silk\//i],[[t,v.str,g.device.amazon.model],[o,"Amazon"],[r,d]],[/android.+aft([bms])\sbuild/i],[t,[o,"Amazon"],[r,p]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[t,o,[r,d]],[/\((ip[honed|\s\w*]+);/i],[t,[o,"Apple"],[r,d]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[o,t,[r,d]],[/\(bb10;\s(\w+)/i],[t,[o,"BlackBerry"],[r,d]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone|p00c)/i],[t,[o,"Asus"],[r,u]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[o,"Sony"],[t,"Xperia Tablet"],[r,u]],[/android.+\s([c-g]\d{4}|so[-l]\w+)(?=\sbuild\/|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[t,[o,"Sony"],[r,d]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[o,t,[r,c]],[/android.+;\s(shield)\sbuild/i],[t,[o,"Nvidia"],[r,c]],[/(playstation\s[34portablevi]+)/i],[t,[o,"Sony"],[r,c]],[/(sprint\s(\w+))/i],[[o,v.str,g.device.sprint.vendor],[t,v.str,g.device.sprint.model],[r,d]],[/(htc)[;_\s-]+([\w\s]+(?=\)|\sbuild)|\w+)/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[o,[t,/_/g," "],[r,d]],[/(nexus\s9)/i],[t,[o,"HTC"],[r,u]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p|vog-l29|ane-lx1|eml-l29)/i],[t,[o,"Huawei"],[r,d]],[/android.+(bah2?-a?[lw]\d{2})/i],[t,[o,"Huawei"],[r,u]],[/(microsoft);\s(lumia[\s\w]+)/i],[o,t,[r,d]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[t,[o,"Microsoft"],[r,c]],[/(kin\.[onetw]{3})/i],[[t,/\./g," "],[o,"Microsoft"],[r,d]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[t,[o,"Motorola"],[r,d]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[t,[o,"Motorola"],[r,u]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[o,m.trim],[t,m.trim],[r,p]],[/hbbtv.+maple;(\d+)/i],[[t,/^/,"SmartTV"],[o,"Samsung"],[r,p]],[/\(dtv[\);].+(aquos)/i],[t,[o,"Sharp"],[r,p]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[o,"Samsung"],t,[r,u]],[/smart-tv.+(samsung)/i],[o,[r,p],t],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[o,"Samsung"],t,[r,d]],[/sie-(\w*)/i],[t,[o,"Siemens"],[r,d]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[o,"Nokia"],t,[r,d]],[/android[x\d\.\s;]+\s([ab][1-7]\-?[0178a]\d\d?)/i],[t,[o,"Acer"],[r,u]],[/android.+([vl]k\-?\d{3})\s+build/i],[t,[o,"LG"],[r,u]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[o,"LG"],t,[r,u]],[/(lg) netcast\.tv/i],[o,t,[r,p]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[t,[o,"LG"],[r,d]],[/(lenovo)\s?(s(?:5000|6000)(?:[\w-]+)|tab(?:[\s\w]+))/i],[o,t,[r,u]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[t,[o,"Lenovo"],[r,u]],[/(lenovo)[_\s-]?([\w-]+)/i],[o,t,[r,d]],[/linux;.+((jolla));/i],[o,t,[r,d]],[/((pebble))app\/[\d\.]+\s/i],[o,t,[r,h]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[o,t,[r,d]],[/crkey/i],[[t,"Chromecast"],[o,"Google"],[r,p]],[/android.+;\s(glass)\s\d/i],[t,[o,"Google"],[r,h]],[/android.+;\s(pixel c)[\s)]/i],[t,[o,"Google"],[r,u]],[/android.+;\s(pixel( [23])?( xl)?)[\s)]/i],[t,[o,"Google"],[r,d]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:a\d|one|one[\s_]plus|note lte)?[\s_]*(?:\d?\w?)[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+))\s+build/i],[[t,/_/g," "],[o,"Xiaomi"],[r,d]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+))\s+build/i],[[t,/_/g," "],[o,"Xiaomi"],[r,u]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[t,[o,"Meizu"],[r,d]],[/(mz)-([\w-]{2,})/i],[[o,"Meizu"],t,[r,d]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})[\s)]/i],[t,[o,"OnePlus"],[r,d]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[t,[o,"RCA"],[r,u]],[/android.+[;\/\s]+(Venue[\d\s]{2,7})\s+build/i],[t,[o,"Dell"],[r,u]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[t,[o,"Verizon"],[r,u]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[o,"Barnes & Noble"],t,[r,u]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[t,[o,"NuVision"],[r,u]],[/android.+;\s(k88)\sbuild/i],[t,[o,"ZTE"],[r,u]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[t,[o,"Swiss"],[r,d]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[t,[o,"Swiss"],[r,u]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[t,[o,"Zeki"],[r,u]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[o,"Dragon Touch"],t,[r,u]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[t,[o,"Insignia"],[r,u]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[t,[o,"NextBook"],[r,u]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[o,"Voice"],t,[r,d]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[o,"LvTel"],t,[r,d]],[/android.+;\s(PH-1)\s/i],[t,[o,"Essential"],[r,d]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[t,[o,"Envizen"],[r,u]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[o,t,[r,u]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[t,[o,"MachSpeed"],[r,u]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[o,t,[r,u]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[t,[o,"Rotor"],[r,u]],[/android.+(KS(.+))\s+build/i],[t,[o,"Amazon"],[r,u]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[o,t,[r,u]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[r,m.lowerize],o,t],[/[\s\/\(](smart-?tv)[;\)]/i],[[r,p]],[/(android[\w\.\s\-]{0,9});.+build/i],[t,[o,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[a,[n,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[a,[n,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[n,a],[/rv\:([\w\.]{1,9}).+(gecko)/i],[a,n]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[n,a],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[n,[a,v.str,g.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[n,"Windows"],[a,v.str,g.os.windows.version]],[/\((bb)(10);/i],[[n,"BlackBerry"],a],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen|kaios)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|sailfish|contiki)[\/\s-]?([\w\.]*)/i],[n,a],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[n,"Symbian"],a],[/\((series40);/i],[n],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[n,"Firefox OS"],a],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[n,a],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[n,"Chromium OS"],a],[/(sunos)\s?([\w\.\d]*)/i],[[n,"Solaris"],a],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[n,a],[/(haiku)\s(\w+)/i],[n,a],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[a,/_/g,"."],[n,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[n,"Mac OS"],[a,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i,/(unix)\s?([\w\.]*)/i],[n,a]]},b=function(e,t){if("object"==typeof e&&(t=e,e=l),!(this instanceof b))return new b(e,t).getResult();var n=e||(i&&i.navigator&&i.navigator.userAgent?i.navigator.userAgent:""),r=t?m.extend(y,t):y;return this.getBrowser=function(){var e={name:l,version:l};return v.rgx.call(e,n,r.browser),e.major=m.major(e.version),e},this.getCPU=function(){var e={architecture:l};return v.rgx.call(e,n,r.cpu),e},this.getDevice=function(){var e={vendor:l,model:l,type:l};return v.rgx.call(e,n,r.device),e},this.getEngine=function(){var e={name:l,version:l};return v.rgx.call(e,n,r.engine),e},this.getOS=function(){var e={name:l,version:l};return v.rgx.call(e,n,r.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(e){return n=e,this},this};b.VERSION="0.7.21",b.BROWSER={NAME:n,MAJOR:"major",VERSION:a},b.CPU={ARCHITECTURE:s},b.DEVICE={MODEL:t,VENDOR:o,TYPE:r,CONSOLE:c,MOBILE:d,SMARTTV:p,TABLET:u,WEARABLE:h,EMBEDDED:"embedded"},b.ENGINE={NAME:n,VERSION:a},b.OS={NAME:n,VERSION:a},typeof w!=e?(typeof C!=e&&C.exports&&(w=C.exports=b),w.UAParser=b):"function"==typeof define&&define.amd?define(function(){return b}):i&&(i.UAParser=b);var _=i&&(i.jQuery||i.Zepto);if(_&&!_.ua){var S=new b;_.ua=S.getResult(),_.ua.get=function(){return S.getUA()},_.ua.set=function(e){S.setUA(e);var t=S.getResult();for(var n in t)_.ua[n]=t[n]}}}("object"==typeof window?window:this)},{}],36:[function(e,t,n){"use strict";n.byteLength=function(e){var t=l(e),n=t[0],r=t[1];return 3*(n+r)/4-r},n.toByteArray=function(e){var t,n,r=l(e),i=r[0],o=r[1],a=new u(function(e,t){return 3*(e+t)/4-t}(i,o)),s=0,c=0<o?i-4:i;for(n=0;n<c;n+=4)t=d[e.charCodeAt(n)]<<18|d[e.charCodeAt(n+1)]<<12|d[e.charCodeAt(n+2)]<<6|d[e.charCodeAt(n+3)],a[s++]=t>>16&255,a[s++]=t>>8&255,a[s++]=255&t;2===o&&(t=d[e.charCodeAt(n)]<<2|d[e.charCodeAt(n+1)]>>4,a[s++]=255&t);1===o&&(t=d[e.charCodeAt(n)]<<10|d[e.charCodeAt(n+1)]<<4|d[e.charCodeAt(n+2)]>>2,a[s++]=t>>8&255,a[s++]=255&t);return a},n.fromByteArray=function(e){for(var t,n=e.length,r=n%3,i=[],o=0,a=n-r;o<a;o+=16383)i.push(c(e,o,a<o+16383?a:o+16383));1==r?(t=e[n-1],i.push(s[t>>2]+s[t<<4&63]+"==")):2==r&&(t=(e[n-2]<<8)+e[n-1],i.push(s[t>>10]+s[t>>4&63]+s[t<<2&63]+"="));return i.join("")};for(var s=[],d=[],u="undefined"!=typeof Uint8Array?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,o=r.length;i<o;++i)s[i]=r[i],d[r.charCodeAt(i)]=i;function l(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,n){for(var r,i,o=[],a=t;a<n;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(s[(i=r)>>18&63]+s[i>>12&63]+s[i>>6&63]+s[63&i]);return o.join("")}d["-".charCodeAt(0)]=62,d["_".charCodeAt(0)]=63},{}],37:[function(e,t,U){(function(l){"use strict";var r=e("base64-js"),o=e("ieee754");U.Buffer=l,U.SlowBuffer=function(e){+e!=e&&(e=0);return l.alloc(+e)},U.INSPECT_MAX_BYTES=50;var n=2147483647;function a(e){if(n<e)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return t.__proto__=l.prototype,t}function l(e,t,n){if("number"!=typeof e)return i(e,t,n);if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return c(e)}function i(e,t,n){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!l.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|f(e,t),r=a(n),i=r.write(e,t);i!==n&&(r=r.slice(0,i));return r}(e,t);if(ArrayBuffer.isView(e))return d(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(N(e,ArrayBuffer)||e&&N(e.buffer,ArrayBuffer))return function(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var r;r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n);return r.__proto__=l.prototype,r}(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return l.from(r,t,n);var i=function(e){if(l.isBuffer(e)){var t=0|u(e.length),n=a(t);return 0===n.length?n:(e.copy(n,0,0,t),n)}if(void 0!==e.length)return"number"!=typeof e.length||L(e.length)?a(0):d(e);if("Buffer"===e.type&&Array.isArray(e.data))return d(e.data)}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return l.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function s(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function c(e){return s(e),a(e<0?0:0|u(e))}function d(e){for(var t=e.length<0?0:0|u(e.length),n=a(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}function u(e){if(n<=e)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return 0|e}function f(e,t){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||N(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,r=2<arguments.length&&!0===arguments[2];if(!r&&0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return I(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return M(e).length;default:if(i)return r?-1:I(e).length;t=(""+t).toLowerCase(),i=!0}}function p(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function h(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):2147483647<n?n=2147483647:n<-2147483648&&(n=-2147483648),L(n=+n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=l.from(t,r)),l.isBuffer(t))return 0===t.length?-1:m(e,t,n,r,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):m(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function m(e,t,n,r,i){var o,a=1,s=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s/=a=2,c/=2,n/=2}function d(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var u=-1;for(o=n;o<s;o++)if(d(e,o)===d(t,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===c)return u*a}else-1!==u&&(o-=o-u),u=-1}else for(s<n+c&&(n=s-c),o=n;0<=o;o--){for(var l=!0,f=0;f<c;f++)if(d(e,o+f)!==d(t,f)){l=!1;break}if(l)return o}return-1}function v(e,t,n,r){n=Number(n)||0;var i=e.length-n;(!r||i<(r=Number(r)))&&(r=i);var o=t.length;o/2<r&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(t.substr(2*a,2),16);if(L(s))return a;e[n+a]=s}return a}function g(e,t,n,r){return D(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function y(e,t,n,r){return D(function(e,t){for(var n,r,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function b(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function _(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,a,s,c,d=e[i],u=null,l=239<d?4:223<d?3:191<d?2:1;if(i+l<=n)switch(l){case 1:d<128&&(u=d);break;case 2:128==(192&(o=e[i+1]))&&127<(c=(31&d)<<6|63&o)&&(u=c);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&2047<(c=(15&d)<<12|(63&o)<<6|63&a)&&(c<55296||57343<c)&&(u=c);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&65535<(c=(15&d)<<18|(63&o)<<12|(63&a)<<6|63&s)&&c<1114112&&(u=c)}null===u?(u=65533,l=1):65535<u&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),i+=l}return function(e){var t=e.length;if(t<=S)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=S));return n}(r)}U.kMaxLength=n,(l.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),l.poolSize=8192,l.from=function(e,t,n){return i(e,t,n)},l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,l.alloc=function(e,t,n){return i=t,o=n,s(r=e),r<=0||void 0===i?a(r):"string"==typeof o?a(r).fill(i,o):a(r).fill(i);var r,i,o},l.allocUnsafe=function(e){return c(e)},l.allocUnsafeSlow=function(e){return c(e)},l.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==l.prototype},l.compare=function(e,t){if(N(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),N(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var n;if(void 0===t)for(n=t=0;n<e.length;++n)t+=e[n].length;var r=l.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(N(o,Uint8Array)&&(o=l.from(o)),!l.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},l.byteLength=f,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},l.prototype.toLocaleString=l.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?_(this,0,e):function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":return T(this,t,n);case"utf8":case"utf-8":return _(this,t,n);case"ascii":return C(this,t,n);case"latin1":case"binary":return w(this,t,n);case"base64":return b(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",t=U.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},l.prototype.compare=function(e,t,n,r,i){if(N(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(i<=r&&n<=t)return 0;if(i<=r)return-1;if(n<=t)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),a=(n>>>=0)-(t>>>=0),s=Math.min(o,a),c=this.slice(r,i),d=e.slice(t,n),u=0;u<s;++u)if(c[u]!==d[u]){o=c[u],a=d[u];break}return o<a?-1:a<o?1:0},l.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},l.prototype.indexOf=function(e,t,n){return h(this,e,t,n,!0)},l.prototype.lastIndexOf=function(e,t,n){return h(this,e,t,n,!1)},l.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||i<n)&&(n=i),0<e.length&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r=r||"utf8";for(var o,a,s,c,d,u,l=!1;;)switch(r){case"hex":return v(this,e,t,n);case"utf8":case"utf-8":return d=t,u=n,D(I(e,(c=this).length-d),c,d,u);case"ascii":return g(this,e,t,n);case"latin1":case"binary":return g(this,e,t,n);case"base64":return o=this,a=t,s=n,D(M(e),o,a,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return y(this,e,t,n);default:if(l)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),l=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function C(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function w(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function T(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||r<n)&&(n=r);for(var i="",o=t;o<n;++o)i+=A(e[o]);return i}function R(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function E(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(n<e+t)throw new RangeError("Trying to access beyond buffer length")}function k(e,t,n,r,i,o){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(i<t||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function P(e,t,n,r){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function x(e,t,n,r,i){return t=+t,n>>>=0,i||P(e,0,n,4),o.write(e,t,n,r,23,4),n+4}function O(e,t,n,r,i){return t=+t,n>>>=0,i||P(e,0,n,8),o.write(e,t,n,r,52,8),n+8}l.prototype.slice=function(e,t){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):n<e&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):n<t&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return r.__proto__=l.prototype,r},l.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},l.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var r=this[e+--t],i=1;0<t&&(i*=256);)r+=this[e+--t]*i;return r},l.prototype.readUInt8=function(e,t){return e>>>=0,t||E(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return e>>>=0,t||E(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return e>>>=0,t||E(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return e>>>=0,t||E(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return e>>>=0,t||E(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return(i*=128)<=r&&(r-=Math.pow(2,8*t)),r},l.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||E(e,t,this.length);for(var r=t,i=1,o=this[e+--r];0<r&&(i*=256);)o+=this[e+--r]*i;return(i*=128)<=o&&(o-=Math.pow(2,8*t)),o},l.prototype.readInt8=function(e,t){return e>>>=0,t||E(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){e>>>=0,t||E(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(e,t){e>>>=0,t||E(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(e,t){return e>>>=0,t||E(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e>>>=0,t||E(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return e>>>=0,t||E(e,4,this.length),o.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e>>>=0,t||E(e,4,this.length),o.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e>>>=0,t||E(e,8,this.length),o.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e>>>=0,t||E(e,8,this.length),o.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||k(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},l.prototype.writeUIntBE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||k(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;0<=--i&&(o*=256);)this[t+i]=e/o&255;return t+n},l.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,1,255,0),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);k(this,e,t,n,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},l.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);k(this,e,t,n,i-1,-i)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;0<=--o&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},l.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||k(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeFloatLE=function(e,t,n){return x(this,e,t,!0,n)},l.prototype.writeFloatBE=function(e,t,n){return x(this,e,t,!1,n)},l.prototype.writeDoubleLE=function(e,t,n){return O(this,e,t,!0,n)},l.prototype.writeDoubleBE=function(e,t,n){return O(this,e,t,!1,n)},l.prototype.copy=function(e,t,n,r){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n=n||0,r||0===r||(r=this.length),t>=e.length&&(t=e.length),t=t||0,0<r&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i=r-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,r);else if(this===e&&n<t&&t<r)for(var o=i-1;0<=o;--o)e[o+t]=this[o+n];else Uint8Array.prototype.set.call(e,this.subarray(n,r),t);return i},l.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){var i=e.charCodeAt(0);("utf8"===r&&i<128||"latin1"===r)&&(e=i)}}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,"number"==typeof(e=e||0))for(o=t;o<n;++o)this[o]=e;else{var a=l.isBuffer(e)?e:l.from(e,r),s=a.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<n-t;++o)this[o+t]=a[o%s]}return this};var t=/[^+/0-9A-Za-z-_]/g;function A(e){return e<16?"0"+e.toString(16):e.toString(16)}function I(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],a=0;a<r;++a){if(55295<(n=e.charCodeAt(a))&&n<57344){if(!i){if(56319<n){-1<(t-=3)&&o.push(239,191,189);continue}if(a+1===r){-1<(t-=3)&&o.push(239,191,189);continue}i=n;continue}if(n<56320){-1<(t-=3)&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&-1<(t-=3)&&o.push(239,191,189);if(i=null,n<128){if(--t<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function M(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(t,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function D(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function N(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function L(e){return e!=e}}).call(this,e("buffer").Buffer)},{"base64-js":36,buffer:37,ieee754:38}],38:[function(e,t,n){n.read=function(e,t,n,r,i){var o,a,s=8*i-r-1,c=(1<<s)-1,d=c>>1,u=-7,l=n?i-1:0,f=n?-1:1,p=e[t+l];for(l+=f,o=p&(1<<-u)-1,p>>=-u,u+=s;0<u;o=256*o+e[t+l],l+=f,u-=8);for(a=o&(1<<-u)-1,o>>=-u,u+=r;0<u;a=256*a+e[t+l],l+=f,u-=8);if(0===o)o=1-d;else{if(o===c)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),o-=d}return(p?-1:1)*a*Math.pow(2,o-r)},n.write=function(e,t,n,r,i,o){var a,s,c,d=8*o-i-1,u=(1<<d)-1,l=u>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,h=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-a))<1&&(a--,c*=2),2<=(t+=1<=a+l?f/c:f*Math.pow(2,1-l))*c&&(a++,c/=2),u<=a+l?(s=0,a=u):1<=a+l?(s=(t*c-1)*Math.pow(2,i),a+=l):(s=t*Math.pow(2,l-1)*Math.pow(2,i),a=0));8<=i;e[n+p]=255&s,p+=h,s/=256,i-=8);for(a=a<<i|s,d+=i;0<d;e[n+p]=255&a,p+=h,a/=256,d-=8);e[n+p-h]|=128*m}},{}]},{},[34])(34)});
