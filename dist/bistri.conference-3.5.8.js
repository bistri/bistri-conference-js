/*eslint-disable*/
!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).bc=e()}(function(){var define,module,exports;return function i(r,o,s){function a(t,e){if(!o[t]){if(!r[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(c)return c(t,!0);throw(n=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",n}n=o[t]={exports:{}},r[t][0].call(n.exports,function(e){return a(r[t][1][e]||e)},n,n.exports,i,r,o,s)}return o[t].exports}for(var c="function"==typeof require&&require,e=0;e<s.length;e++)a(s[e]);return a}({1:[function(d,n,i){!function(t){!function(){!function(e){"object"==typeof i&&void 0!==n?n.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:this).adapter=e()}(function(){return function i(r,o,s){function a(t,e){if(!o[t]){if(!r[t]){var n="function"==typeof d&&d;if(!e&&n)return n(t,!0);if(c)return c(t,!0);throw(n=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",n}n=o[t]={exports:{}},r[t][0].call(n.exports,function(e){return a(r[t][1][e]||e)},n,n.exports,i,r,o,s)}return o[t].exports}for(var c="function"==typeof d&&d,e=0;e<s.length;e++)a(s[e]);return a}({1:[function(e,t,n){"use strict";e=(0,e("./adapter_factory.js").adapterFactory)({window:"undefined"==typeof window?void 0:window});t.exports=e},{"./adapter_factory.js":2}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.adapterFactory=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).window,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},n=o.log,i=o.detectBrowser(e),r={browserDetails:i,commonShim:u,extractVersion:o.extractVersion,disableLog:o.disableLog,disableWarnings:o.disableWarnings};switch(i.browser){case"chrome":if(!s||!s.shimPeerConnection||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=s,u.shimAddIceCandidateNullOrEmpty(e,i),s.shimGetUserMedia(e,i),s.shimMediaStream(e,i),s.shimPeerConnection(e,i),s.shimOnTrack(e,i),s.shimAddTrackRemoveTrack(e,i),s.shimGetSendersWithDtmf(e,i),s.shimGetStats(e,i),s.shimSenderReceiverGetStats(e,i),s.fixNegotiationNeeded(e,i),u.shimRTCIceCandidate(e,i),u.shimConnectionState(e,i),u.shimMaxMessageSize(e,i),u.shimSendThrowTypeError(e,i),u.removeExtmapAllowMixed(e,i);break;case"firefox":if(!c||!c.shimPeerConnection||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=c,u.shimAddIceCandidateNullOrEmpty(e,i),c.shimGetUserMedia(e,i),c.shimPeerConnection(e,i),c.shimOnTrack(e,i),c.shimRemoveStream(e,i),c.shimSenderGetStats(e,i),c.shimReceiverGetStats(e,i),c.shimRTCDataChannel(e,i),c.shimAddTransceiver(e,i),c.shimGetParameters(e,i),c.shimCreateOffer(e,i),c.shimCreateAnswer(e,i),u.shimRTCIceCandidate(e,i),u.shimConnectionState(e,i),u.shimMaxMessageSize(e,i),u.shimSendThrowTypeError(e,i);break;case"edge":if(!a||!a.shimPeerConnection||!t.shimEdge)return n("MS edge shim is not included in this adapter release."),r;n("adapter.js shimming edge."),(r.browserShim=a).shimGetUserMedia(e,i),a.shimGetDisplayMedia(e,i),a.shimPeerConnection(e,i),a.shimReplaceTrack(e,i),u.shimMaxMessageSize(e,i),u.shimSendThrowTypeError(e,i);break;case"safari":if(!d||!t.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=d,u.shimAddIceCandidateNullOrEmpty(e,i),d.shimRTCIceServerUrls(e,i),d.shimCreateOfferLegacy(e,i),d.shimCallbacksAPI(e,i),d.shimLocalStreamsAPI(e,i),d.shimRemoteStreamsAPI(e,i),d.shimTrackEventTransceiver(e,i),d.shimGetUserMedia(e,i),d.shimAudioContext(e,i),u.shimRTCIceCandidate(e,i),u.shimMaxMessageSize(e,i),u.shimSendThrowTypeError(e,i),u.removeExtmapAllowMixed(e,i);break;default:n("Unsupported browser!")}return r};var o=i(e("./utils")),s=i(e("./chrome/chrome_shim")),a=i(e("./edge/edge_shim")),c=i(e("./firefox/firefox_shim")),d=i(e("./safari/safari_shim")),u=i(e("./common_shim"));function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=n.shimGetUserMedia=void 0;var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("./getusermedia");Object.defineProperty(n,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}});var r=e("./getdisplaymedia");Object.defineProperty(n,"shimGetDisplayMedia",{enumerable:!0,get:function(){return r.shimGetDisplayMedia}}),n.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},n.shimOnTrack=function(o){{var e;"object"!==(void 0===o?"undefined":a(o))||!o.RTCPeerConnection||"ontrack"in o.RTCPeerConnection.prototype?s.wrapPeerConnectionEvent(o,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}):(Object.defineProperty(o.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0}),e=o.RTCPeerConnection.prototype.setRemoteDescription,o.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._ontrackpoly||(this._ontrackpoly=function(i){i.stream.addEventListener("addtrack",function(t){var e=void 0,e=o.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===t.track.id}):{track:t.track},n=new Event("track");n.track=t.track,n.receiver=e,n.transceiver={receiver:e},n.streams=[i.stream],r.dispatchEvent(n)}),i.stream.getTracks().forEach(function(t){var e=void 0,e=o.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===t.id}):{track:t},n=new Event("track");n.track=t,n.receiver=e,n.transceiver={receiver:e},n.streams=[i.stream],r.dispatchEvent(n)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)})}},n.shimGetSendersWithDtmf=function(e){{var i,r,t,n,o,s;"object"===(void 0===e?"undefined":a(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype?(i=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}},e.RTCPeerConnection.prototype.getSenders||(e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()},r=e.RTCPeerConnection.prototype.addTrack,e.RTCPeerConnection.prototype.addTrack=function(e,t){var n=r.apply(this,arguments);return n||(n=i(this,e),this._senders.push(n)),n},t=e.RTCPeerConnection.prototype.removeTrack,e.RTCPeerConnection.prototype.removeTrack=function(e){t.apply(this,arguments);e=this._senders.indexOf(e);-1!==e&&this._senders.splice(e,1)}),n=e.RTCPeerConnection.prototype.addStream,e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(function(e){t._senders.push(i(t,e))})},o=e.RTCPeerConnection.prototype.removeStream,e.RTCPeerConnection.prototype.removeStream=function(e){var n=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach(function(t){var e=n._senders.find(function(e){return e.track===t});e&&n._senders.splice(n._senders.indexOf(e),1)})}):"object"===(void 0===e?"undefined":a(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&(s=e.RTCPeerConnection.prototype.getSenders,e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=s.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}}))}},n.shimGetStats=function(e){var s;e.RTCPeerConnection&&(s=e.RTCPeerConnection.prototype.getStats,e.RTCPeerConnection.prototype.getStats=function(){var n=this,e=Array.prototype.slice.call(arguments),t=e[0],i=e[1],e=e[2];if(0<arguments.length&&"function"==typeof t)return s.apply(this,arguments);if(0===s.length&&(0===arguments.length||"function"!=typeof t))return s.apply(this,[]);function r(e){var i={};return e.result().forEach(function(t){var n={id:t.id,timestamp:t.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[t.type]||t.type};t.names().forEach(function(e){n[e]=t.stat(e)}),i[n.id]=n}),i}function o(t){return new Map(Object.keys(t).map(function(e){return[e,t[e]]}))}if(2<=arguments.length)return s.apply(this,[function(e){i(o(r(e)))},t]);return new Promise(function(t,e){s.apply(n,[function(e){t(o(r(e)))},e])}).then(i,e)})},n.shimSenderReceiverGetStats=function(e){var n,t,i,o;"object"===(void 0===e?"undefined":a(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver&&("getStats"in e.RTCRtpSender.prototype||((n=e.RTCPeerConnection.prototype.getSenders)&&(e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=n.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),(t=e.RTCPeerConnection.prototype.addTrack)&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=t.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var t=this;return this._pc.getStats().then(function(e){return s.filterStats(e,t.track,!0)})}),"getStats"in e.RTCRtpReceiver.prototype||((i=e.RTCPeerConnection.prototype.getReceivers)&&(e.RTCPeerConnection.prototype.getReceivers=function(){var t=this,e=i.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),s.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var t=this;return this._pc.getStats().then(function(e){return s.filterStats(e,t.track,!1)})}),"getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype&&(o=e.RTCPeerConnection.prototype.getStats,e.RTCPeerConnection.prototype.getStats=function(){if(0<arguments.length&&arguments[0]instanceof e.MediaStreamTrack){var t=arguments[0],n=void 0,i=void 0,r=void 0;return this.getSenders().forEach(function(e){e.track===t&&(n?r=!0:n=e)}),this.getReceivers().forEach(function(e){return e.track===t&&(i?r=!0:i=e),e.track===t}),r||n&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return o.apply(this,arguments)}))},n.shimAddTrackRemoveTrackWithNative=d,n.shimAddTrackRemoveTrack=function(r,e){if(r.RTCPeerConnection){if(r.RTCPeerConnection.prototype.addTrack&&65<=e.version)return d(r);var n=r.RTCPeerConnection.prototype.getLocalStreams;r.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this,e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(function(e){return t._reverseStreams[e.id]})};var i=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(e){var t,n=this;this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},e.getTracks().forEach(function(t){if(n.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError")}),this._reverseStreams[e.id]||(t=new r.MediaStream(e.getTracks()),this._streams[e.id]=t,this._reverseStreams[t.id]=e,e=t),i.apply(this,[e])};var t=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[(this._streams[e.id]||e).id],delete this._streams[e.id]},r.RTCPeerConnection.prototype.addTrack=function(t,e){var n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};i=this._streams[e.id];return i?(i.addTrack(t),Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))})):(i=new r.MediaStream([t]),this._streams[e.id]=i,this._reverseStreams[i.id]=e,this.addStream(i)),this.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(e){var i=r.RTCPeerConnection.prototype[e],t=c({},e,function(){var t=this,n=arguments;return arguments.length&&"function"==typeof arguments[0]?i.apply(this,[function(e){e=a(t,e);n[0].apply(null,[e])},function(e){n[1]&&n[1].apply(null,e)},arguments[2]]):i.apply(this,arguments).then(function(e){return a(t,e)})});r.RTCPeerConnection.prototype[e]=t[e]});var o=r.RTCPeerConnection.prototype.setLocalDescription;r.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type&&(arguments[0]=(n=this,i=(e=arguments[0]).sdp,Object.keys(n._reverseStreams||[]).forEach(function(e){var t=n._reverseStreams[e],e=n._streams[t.id];i=i.replace(new RegExp(t.id,"g"),e.id)}),new RTCSessionDescription({type:e.type,sdp:i}))),o.apply(this,arguments);var n,e,i};var s=Object.getOwnPropertyDescriptor(r.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(r.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=s.get.apply(this);return""===e.type?e:a(this,e)}}),r.RTCPeerConnection.prototype.removeTrack=function(t){var n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!t._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(t._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var i=void 0;Object.keys(this._streams).forEach(function(e){n._streams[e].getTracks().find(function(e){return t.track===e})&&(i=n._streams[e])}),i&&(1===i.getTracks().length?this.removeStream(this._reverseStreams[i.id]):i.removeTrack(t.track),this.dispatchEvent(new Event("negotiationneeded")))}}function a(n,e){var i=e.sdp;return Object.keys(n._reverseStreams||[]).forEach(function(e){var t=n._reverseStreams[e],e=n._streams[t.id];i=i.replace(new RegExp(e.id,"g"),t.id)}),new RTCSessionDescription({type:e.type,sdp:i})}},n.shimPeerConnection=function(i,e){!i.RTCPeerConnection&&i.webkitRTCPeerConnection&&(i.RTCPeerConnection=i.webkitRTCPeerConnection);i.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=i.RTCPeerConnection.prototype[e],n=c({},e,function(){return arguments[0]=new("addIceCandidate"===e?i.RTCIceCandidate:i.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)});i.RTCPeerConnection.prototype[e]=n[e]})},n.fixNegotiationNeeded=function(e,n){s.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){var t=e.target;if(!(n.version<72||t.getConfiguration&&"plan-b"===t.getConfiguration().sdpSemantics)||"stable"===t.signalingState)return e})};var s=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../utils.js"));function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(e){return t._shimmedLocalStreams[e][0]})};var i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,t){if(!t)return i.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=i.apply(this,arguments);return this._shimmedLocalStreams[t.id]?-1===this._shimmedLocalStreams[t.id].indexOf(n)&&this._shimmedLocalStreams[t.id].push(n):this._shimmedLocalStreams[t.id]=[t,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(t){if(n.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError")});var t=this.getSenders();r.apply(this,arguments);var i=this.getSenders().filter(function(e){return-1===t.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(i)};var t=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],t.apply(this,arguments)};var o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(n){var i=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},n&&Object.keys(this._shimmedLocalStreams).forEach(function(e){var t=i._shimmedLocalStreams[e].indexOf(n);-1!==t&&i._shimmedLocalStreams[e].splice(t,1),1===i._shimmedLocalStreams[e].length&&delete i._shimmedLocalStreams[e]}),o.apply(this,arguments)}}},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=function(o,e){o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||o.navigator.mediaDevices&&("function"==typeof e?o.navigator.mediaDevices.getDisplayMedia=function(r){return e(r).then(function(e){var t=r.video&&r.video.width,n=r.video&&r.video.height,i=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxFrameRate:i||3}},t&&(r.video.mandatory.maxWidth=t),n&&(r.video.mandatory.maxHeight=n),o.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.shimGetUserMedia=function(e,t){var s,i,r,n,a=e&&e.navigator;a.mediaDevices&&(s=function(r){if("object"!==(void 0===r?"undefined":c(r))||r.mandatory||r.optional)return r;var o={};return Object.keys(r).forEach(function(t){var n,i,e;"require"!==t&&"advanced"!==t&&"mediaSource"!==t&&(void 0!==(n="object"===c(r[t])?r[t]:{ideal:r[t]}).exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact),i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t},void 0!==n.ideal&&(o.optional=o.optional||[],e={},"number"==typeof n.ideal?(e[i("min",t)]=n.ideal,o.optional.push(e),(e={})[i("max",t)]=n.ideal):e[i("",t)]=n.ideal,o.optional.push(e)),void 0!==n.exact&&"number"!=typeof n.exact?(o.mandatory=o.mandatory||{},o.mandatory[i("",t)]=n.exact):["min","max"].forEach(function(e){void 0!==n[e]&&(o.mandatory=o.mandatory||{},o.mandatory[i(e,t)]=n[e])}))}),r.advanced&&(o.optional=(o.optional||[]).concat(r.advanced)),o},i=function(n,i){if(61<=t.version)return i(n);if((n=JSON.parse(JSON.stringify(n)))&&"object"===c(n.audio)&&((e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])})((n=JSON.parse(JSON.stringify(n))).audio,"autoGainControl","googAutoGainControl"),e(n.audio,"noiseSuppression","googNoiseSuppression"),n.audio=s(n.audio)),n&&"object"===c(n.video)){var r=(r=n.video.facingMode)&&("object"===(void 0===r?"undefined":c(r))?r:{ideal:r}),e=t.version<66;if(r&&("user"===r.exact||"environment"===r.exact||"user"===r.ideal||"environment"===r.ideal)&&(!a.mediaDevices.getSupportedConstraints||!a.mediaDevices.getSupportedConstraints().facingMode||e)){delete n.video.facingMode;var o=void 0;if("environment"===r.exact||"environment"===r.ideal?o=["back","rear"]:"user"!==r.exact&&"user"!==r.ideal||(o=["front"]),o)return a.mediaDevices.enumerateDevices().then(function(e){var t=(e=e.filter(function(e){return"videoinput"===e.kind})).find(function(t){return o.some(function(e){return t.label.toLowerCase().includes(e)})});return(t=!t&&e.length&&o.includes("back")?e[e.length-1]:t)&&(n.video.deviceId=r.exact?{exact:t.deviceId}:{ideal:t.deviceId}),n.video=s(n.video),d("chrome: "+JSON.stringify(n)),i(n)})}n.video=s(n.video)}return d("chrome: "+JSON.stringify(n)),i(n)},r=function(e){return 64<=t.version?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},a.getUserMedia=function(e,t,n){i(e,function(e){a.webkitGetUserMedia(e,t,function(e){n&&n(r(e))})})}.bind(a),a.mediaDevices.getUserMedia&&(n=a.mediaDevices.getUserMedia.bind(a.mediaDevices),a.mediaDevices.getUserMedia=function(e){return i(e,function(t){return n(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return e},function(e){return Promise.reject(r(e))})})}))};var d=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../utils.js")).log},{"../utils.js":15}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.shimRTCIceCandidate=function(t){var r;!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype||(r=t.RTCIceCandidate,t.RTCIceCandidate=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var t=new r(e),n=s.default.parseCandidate(e.candidate),i=Object.assign(t,n);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new r(e)},t.RTCIceCandidate.prototype=r.prototype,a.wrapPeerConnectionEvent(t,"icecandidate",function(e){return e.candidate&&Object.defineProperty(e,"candidate",{value:new t.RTCIceCandidate(e.candidate),writable:"false"}),e}))},n.shimMaxMessageSize=function(e,r){var o;e.RTCPeerConnection&&("sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}}),o=e.RTCPeerConnection.prototype.setRemoteDescription,e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e,t,n,i;return this._sctp=null,"chrome"===r.browser&&76<=r.version&&"plan-b"===this.getConfiguration().sdpSemantics&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0}),function(e){if(!e||!e.sdp)return!1;e=s.default.splitSections(e.sdp);return e.shift(),e.some(function(e){e=s.default.parseMLine(e);return e&&"application"===e.kind&&-1!==e.protocol.indexOf("SCTP")})}(arguments[0])&&(t=function(e){e=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===e||e.length<2)return-1;e=parseInt(e[1],10);return e!=e?-1:e}(arguments[0]),n=t,i=65536,i=i="firefox"===r.browser?r.version<57?-1===n?16384:2147483637:r.version<60?57===r.version?65535:65536:2147483637:i,t=function(e,t){var n=65536;"firefox"===r.browser&&57===r.version&&(n=65535);e=s.default.matchPrefix(e.sdp,"a=max-message-size:");return 0<e.length?n=parseInt(e[0].substr(19),10):"firefox"===r.browser&&-1!==t&&(n=2147483637),n}(arguments[0],t),e=void 0,e=0===i&&0===t?Number.POSITIVE_INFINITY:0===i||0===t?Math.max(i,t):Math.min(i,t),t={},Object.defineProperty(t,"maxMessageSize",{get:function(){return e}}),this._sctp=t),o.apply(this,arguments)})},n.shimSendThrowTypeError=function(e){var t;function n(t,n){var i=t.send;t.send=function(){var e=arguments[0],e=e.length||e.size||e.byteLength;if("open"===t.readyState&&n.sctp&&e>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return i.apply(t,arguments)}}e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype&&(t=e.RTCPeerConnection.prototype.createDataChannel,e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return n(e,this),e},a.wrapPeerConnectionEvent(e,"datachannel",function(e){return n(e.channel,e.target),e}))},n.shimConnectionState=function(e){var n;!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype||(n=e.RTCPeerConnection.prototype,Object.defineProperty(n,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(n,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(e){var t=n[e];n[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t,n=e.target;return n._lastConnectionState!==n.connectionState&&(n._lastConnectionState=n.connectionState,t=new Event("connectionstatechange",e),n.dispatchEvent(t)),e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),t.apply(this,arguments)}}))},n.removeExtmapAllowMixed=function(n,e){var i;n.RTCPeerConnection&&("chrome"===e.browser&&71<=e.version||"safari"===e.browser&&605<=e.version||(i=n.RTCPeerConnection.prototype.setRemoteDescription,n.RTCPeerConnection.prototype.setRemoteDescription=function(e){var t;return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(t=e.sdp.split("\n").filter(function(e){return"a=extmap-allow-mixed"!==e.trim()}).join("\n"),n.RTCSessionDescription&&e instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:e.type,sdp:t}):e.sdp=t),i.apply(this,arguments)}))},n.shimAddIceCandidateNullOrEmpty=function(e,t){var n;e.RTCPeerConnection&&e.RTCPeerConnection.prototype&&((n=e.RTCPeerConnection.prototype.addIceCandidate)&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}))};var i,r=e("sdp"),s=(i=r)&&i.__esModule?i:{default:i},a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("./utils"))},{"./utils":15,sdp:17}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=n.shimGetUserMedia=void 0;var i=e("./getusermedia");Object.defineProperty(n,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}});var r=e("./getdisplaymedia");Object.defineProperty(n,"shimGetDisplayMedia",{enumerable:!0,get:function(){return r.shimGetDisplayMedia}}),n.shimPeerConnection=function(e,t){{var n;e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025&&(n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled"),Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})))}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}});e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var i=(0,d.default)(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,a.filterIceServers)(e.iceServers,t.version),s.log("ICE servers after filtering:",e.iceServers)),new i(e)},e.RTCPeerConnection.prototype=i.prototype},n.shimReplaceTrack=function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)};var o,s=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../utils")),a=e("./filtericeservers"),c=e("rtcpeerconnection-shim"),d=(o=c)&&o.__esModule?o:{default:o}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.filterIceServers=function(e,t){var i=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&r.deprecated("RTCIceServer.url","RTCIceServer.urls");var n="string"==typeof t,t=(t=n?[t]:t).filter(function(e){if(0===e.indexOf("stun:"))return!1;e=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return e&&!i&&(i=!0)});return delete e.url,e.urls=n?t[0]:t,!!t.length}})};var r=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../utils"))},{"../utils":15}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=function(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}},{}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetUserMedia=function(e){var e=e&&e.navigator,t=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(e){return t(e).catch(function(e){return Promise.reject({name:{PermissionDeniedError:"NotAllowedError"}[(e=e).name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}})})}}},{}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=n.shimGetUserMedia=void 0;var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("./getusermedia");Object.defineProperty(n,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}});var r=e("./getdisplaymedia");Object.defineProperty(n,"shimGetDisplayMedia",{enumerable:!0,get:function(){return r.shimGetDisplayMedia}}),n.shimOnTrack=function(e){"object"===(void 0===e?"undefined":s(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},n.shimPeerConnection=function(i,r){var o,n;"object"===(void 0===i?"undefined":s(i))&&(i.RTCPeerConnection||i.mozRTCPeerConnection)&&(!i.RTCPeerConnection&&i.mozRTCPeerConnection&&(i.RTCPeerConnection=i.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=i.RTCPeerConnection.prototype[e],n=function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n;return e}({},e,function(){return arguments[0]=new("addIceCandidate"===e?i.RTCIceCandidate:i.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)});i.RTCPeerConnection.prototype[e]=n[e]}),o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=i.RTCPeerConnection.prototype.getStats,i.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),t=e[0],i=e[1],e=e[2];return n.apply(this,[t||null]).then(function(n){if(r.version<53&&!i)try{n.forEach(function(e){e.type=o[e.type]||e.type})}catch(e){if("TypeError"!==e.name)throw e;n.forEach(function(e,t){n.set(t,Object.assign({},e,{type:o[e.type]||e.type}))})}return n}).then(i,e)})},n.shimSenderGetStats=function(e){var n,t;"object"===(void 0===e?"undefined":s(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype||((n=e.RTCPeerConnection.prototype.getSenders)&&(e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=n.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),(t=e.RTCPeerConnection.prototype.addTrack)&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=t.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}))},n.shimReceiverGetStats=function(e){var n;"object"===(void 0===e?"undefined":s(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype||((n=e.RTCPeerConnection.prototype.getReceivers)&&(e.RTCPeerConnection.prototype.getReceivers=function(){var t=this,e=n.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),o.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}))},n.shimRemoveStream=function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){var n=this;o.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(e){e.track&&t.getTracks().includes(e.track)&&n.removeTrack(e)})})},n.shimRTCDataChannel=function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},n.shimAddTransceiver=function(e){var r;"object"!==(void 0===e?"undefined":s(e))||!e.RTCPeerConnection||(r=e.RTCPeerConnection.prototype.addTransceiver)&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1],t=e&&"sendEncodings"in e;t&&e.sendEncodings.forEach(function(e){if("rid"in e)if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(1<=parseFloat(e.scaleResolutionDownBy)))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(0<=parseFloat(e.maxFramerate)))throw new RangeError("max_framerate must be >= 0.0")});var n,i=r.apply(this,arguments);return t&&("encodings"in(t=(n=i.sender).getParameters())&&(1!==t.encodings.length||0!==Object.keys(t.encodings[0]).length)||(t.encodings=e.sendEncodings,n.sendEncodings=e.sendEncodings,this.setParametersPromises.push(n.setParameters(t).then(function(){delete n.sendEncodings}).catch(function(){delete n.sendEncodings})))),i})},n.shimGetParameters=function(e){var t;"object"!==(void 0===e?"undefined":s(e))||!e.RTCRtpSender||(t=e.RTCRtpSender.prototype.getParameters)&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})},n.shimCreateOffer=function(e){var n;"object"===(void 0===e?"undefined":s(e))&&e.RTCPeerConnection&&(n=e.RTCPeerConnection.prototype.createOffer,e.RTCPeerConnection.prototype.createOffer=function(){var e=this,t=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return n.apply(e,t)}).finally(function(){e.setParametersPromises=[]}):n.apply(this,arguments)})},n.shimCreateAnswer=function(e){var n;"object"===(void 0===e?"undefined":s(e))&&e.RTCPeerConnection&&(n=e.RTCPeerConnection.prototype.createAnswer,e.RTCPeerConnection.prototype.createAnswer=function(){var e=this,t=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return n.apply(e,t)}).finally(function(){e.setParametersPromises=[]}):n.apply(this,arguments)})};var o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=function(t,n){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(e){if(e&&e.video)return!0===e.video?e.video={mediaSource:n}:e.video.mediaSource=n,t.navigator.mediaDevices.getUserMedia(e);e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)})}},{}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.shimGetUserMedia=function(e,t){var i=e&&e.navigator,e=e&&e.MediaStreamTrack;{var n,r,o,s;i.getUserMedia=function(e,t,n){c.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(e).then(t,n)},55<t.version&&"autoGainControl"in i.mediaDevices.getSupportedConstraints()||(n=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},r=i.mediaDevices.getUserMedia.bind(i.mediaDevices),i.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":a(e))&&"object"===a(e.audio)&&(e=JSON.parse(JSON.stringify(e)),n(e.audio,"autoGainControl","mozAutoGainControl"),n(e.audio,"noiseSuppression","mozNoiseSuppression")),r(e)},e&&e.prototype.getSettings&&(o=e.prototype.getSettings,e.prototype.getSettings=function(){var e=o.apply(this,arguments);return n(e,"mozAutoGainControl","autoGainControl"),n(e,"mozNoiseSuppression","noiseSuppression"),e}),e&&e.prototype.applyConstraints&&(s=e.prototype.applyConstraints,e.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":a(e))&&(e=JSON.parse(JSON.stringify(e)),n(e,"autoGainControl","mozAutoGainControl"),n(e,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[e])}))}};var c=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../utils"))},{"../utils":15}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n.shimLocalStreamsAPI=function(e){var o;"object"===(void 0===e?"undefined":c(e))&&e.RTCPeerConnection&&("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"addStream"in e.RTCPeerConnection.prototype||(o=e.RTCPeerConnection.prototype.addTrack,e.RTCPeerConnection.prototype.addStream=function(t){var n=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(t)||this._localStreams.push(t),t.getAudioTracks().forEach(function(e){return o.call(n,e,t)}),t.getVideoTracks().forEach(function(e){return o.call(n,e,t)})},e.RTCPeerConnection.prototype.addTrack=function(e){for(var t=this,n=arguments.length,i=Array(1<n?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return i&&i.forEach(function(e){t._localStreams?t._localStreams.includes(e)||t._localStreams.push(e):t._localStreams=[e]}),o.apply(this,arguments)}),"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var n,i=this._localStreams.indexOf(e);-1!==i&&(this._localStreams.splice(i,1),n=e.getTracks(),this.getSenders().forEach(function(e){n.includes(e.track)&&t.removeTrack(e)}))}))},n.shimRemoteStreamsAPI=function(e){var t;"object"===(void 0===e?"undefined":c(e))&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams||[]}),"onaddstream"in e.RTCPeerConnection.prototype||(Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var n=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){var t;n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.includes(e)||(n._remoteStreams.push(e),(t=new Event("addstream")).stream=e,n.dispatchEvent(t))})})}}),t=e.RTCPeerConnection.prototype.setRemoteDescription,e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){var t;n._remoteStreams||(n._remoteStreams=[]),0<=n._remoteStreams.indexOf(e)||(n._remoteStreams.push(e),(t=new Event("addstream")).stream=e,n.dispatchEvent(t))})}),t.apply(n,arguments)}))},n.shimCallbacksAPI=function(e){var t,i,r,o,s,a;"object"===(void 0===e?"undefined":c(e))&&e.RTCPeerConnection&&(t=e.RTCPeerConnection.prototype,i=t.createOffer,r=t.createAnswer,o=t.setLocalDescription,s=t.setRemoteDescription,a=t.addIceCandidate,t.createOffer=function(e,t){var n=i.apply(this,[2<=arguments.length?arguments[2]:e]);return t?(n.then(e,t),Promise.resolve()):n},t.createAnswer=function(e,t){var n=r.apply(this,[2<=arguments.length?arguments[2]:e]);return t?(n.then(e,t),Promise.resolve()):n},e=function(e,t,n){e=o.apply(this,[e]);return n?(e.then(t,n),Promise.resolve()):e},t.setLocalDescription=e,e=function(e,t,n){e=s.apply(this,[e]);return n?(e.then(t,n),Promise.resolve()):e},t.setRemoteDescription=e,e=function(e,t,n){e=a.apply(this,[e]);return n?(e.then(t,n),Promise.resolve()):e},t.addIceCandidate=e)},n.shimGetUserMedia=function(e){var i=e&&e.navigator;{var t;i.mediaDevices&&i.mediaDevices.getUserMedia&&(e=i.mediaDevices,t=e.getUserMedia.bind(e),i.mediaDevices.getUserMedia=function(e){return t(r(e))})}!i.getUserMedia&&i.mediaDevices&&i.mediaDevices.getUserMedia&&(i.getUserMedia=function(e,t,n){i.mediaDevices.getUserMedia(e).then(t,n)}.bind(i))},n.shimConstraints=r,n.shimRTCIceServerUrls=function(e){var o;e.RTCPeerConnection&&(o=e.RTCPeerConnection,e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var r=e.iceServers[i];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(s.deprecated("RTCIceServer.url","RTCIceServer.urls"),(r=JSON.parse(JSON.stringify(r))).urls=r.url,delete r.url,n.push(r)):n.push(e.iceServers[i])}e.iceServers=n}return new o(e,t)},e.RTCPeerConnection.prototype=o.prototype,"generateCertificate"in o&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return o.generateCertificate}}))},n.shimTrackEventTransceiver=function(e){"object"===(void 0===e?"undefined":c(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},n.shimCreateOfferLegacy=function(e){var n=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var t;return e&&(void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio),t=this.getTransceivers().find(function(e){return"audio"===e.receiver.track.kind}),!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo),t=this.getTransceivers().find(function(e){return"video"===e.receiver.track.kind}),!1===e.offerToReceiveVideo&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveVideo||t||this.addTransceiver("video")),n.apply(this,arguments)}},n.shimAudioContext=function(e){"object"!==(void 0===e?"undefined":c(e))||e.AudioContext||(e.AudioContext=e.webkitAudioContext)};var s=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("../utils"));function r(e){return e&&void 0!==e.video?Object.assign({},e,{video:s.compactObject(e.video)}):e}},{"../utils":15}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.extractVersion=a,n.wrapPeerConnectionEvent=function(e,i,r){var o,s;e.RTCPeerConnection&&(e=e.RTCPeerConnection.prototype,o=e.addEventListener,e.addEventListener=function(e,t){if(e!==i)return o.apply(this,arguments);function n(e){(e=r(e))&&(t.handleEvent?t.handleEvent(e):t(e))}return this._eventMap=this._eventMap||{},this._eventMap[i]||(this._eventMap[i]=new Map),this._eventMap[i].set(t,n),o.apply(this,[e,n])},s=e.removeEventListener,e.removeEventListener=function(e,t){if(e!==i||!this._eventMap||!this._eventMap[i])return s.apply(this,arguments);if(!this._eventMap[i].has(t))return s.apply(this,arguments);var n=this._eventMap[i].get(t);return this._eventMap[i].delete(t),0===this._eventMap[i].size&&delete this._eventMap[i],0===Object.keys(this._eventMap).length&&delete this._eventMap,s.apply(this,[e,n])},Object.defineProperty(e,"on"+i,{get:function(){return this["_on"+i]},set:function(e){this["_on"+i]&&(this.removeEventListener(i,this["_on"+i]),delete this["_on"+i]),e&&this.addEventListener(i,this["_on"+i]=e)},enumerable:!0,configurable:!0}))},n.disableLog=function(e){return"boolean"==typeof e?(r=e)?"adapter.js logging disabled":"adapter.js logging enabled":new Error("Argument type: "+(void 0===e?"undefined":i(e))+". Please use a boolean.")},n.disableWarnings=function(e){return"boolean"==typeof e?(o=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled")):new Error("Argument type: "+(void 0===e?"undefined":i(e))+". Please use a boolean.")},n.log=function(){"object"===("undefined"==typeof window?"undefined":i(window))&&(r||"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments))},n.deprecated=function(e,t){o&&console.warn(e+" is deprecated, please use "+t+" instead.")},n.detectBrowser=function(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var n=e.navigator;if(n.mozGetUserMedia)t.browser="firefox",t.version=a(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=a(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.mediaDevices&&n.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=a(n.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=a(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t},n.compactObject=function r(o){if(!c(o))return o;return Object.keys(o).reduce(function(e,t){var n=c(o[t]),i=n?r(o[t]):o[t],n=n&&!Object.keys(i).length;return void 0===i||n?e:Object.assign(e,s({},t,i))},{})},n.walkStats=d,n.filterStats=function(n,t,e){var i=e?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;var o=[];return n.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(function(t){n.forEach(function(e){e.type===i&&e.trackId===t.id&&d(n,e,r)})}),r};var r=!0,o=!0;function a(e,t,n){t=e.match(t);return t&&t.length>=n&&parseInt(t[n],10)}function c(e){return"[object Object]"===Object.prototype.toString.call(e)}function d(t,n,i){n&&!i.has(n.id)&&(i.set(n.id,n),Object.keys(n).forEach(function(e){e.endsWith("Id")?d(t,t.get(n[e]),i):e.endsWith("Ids")&&n[e].forEach(function(e){d(t,t.get(e),i)})}))}},{}],16:[function(e,t,n){"use strict";var A=e("sdp");function s(e,t,n,i,r){t=A.writeRtpDescription(e.kind,t);return t+=A.writeIceParameters(e.iceGatherer.getLocalParameters()),t+=A.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":r||"active"),t+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?t+="a=sendrecv\r\n":e.rtpSender?t+="a=sendonly\r\n":e.rtpReceiver?t+="a=recvonly\r\n":t+="a=inactive\r\n",e.rtpSender&&(r=e.rtpSender._initialTrackId||e.rtpSender.track.id,e.rtpSender._initialTrackId=r,t+="a="+(r="msid:"+(i?i.id:"-")+" "+r+"\r\n"),t+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+r,e.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+r,t+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")),t+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+A.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+A.localCName+"\r\n"),t}function I(i,r){function o(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]}var s={codecs:[],headerExtensions:[],fecMechanisms:[]};return i.codecs.forEach(function(n){for(var e=0;e<r.codecs.length;e++){var t=r.codecs[e];if(n.name.toLowerCase()===t.name.toLowerCase()&&n.clockRate===t.clockRate&&("rtx"!==n.name.toLowerCase()||!n.parameters||!t.parameters.apt||function(e,t,n,i){n=o(e.parameters.apt,n),i=o(t.parameters.apt,i);return n&&i&&n.name.toLowerCase()===i.name.toLowerCase()}(n,t,i.codecs,r.codecs))){(t=JSON.parse(JSON.stringify(t))).numChannels=Math.min(n.numChannels,t.numChannels),s.codecs.push(t),t.rtcpFeedback=t.rtcpFeedback.filter(function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),i.headerExtensions.forEach(function(e){for(var t=0;t<r.headerExtensions.length;t++){var n=r.headerExtensions[t];if(e.uri===n.uri){s.headerExtensions.push(n);break}}}),s}function o(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function M(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}function p(e,t){t=new Error(t);return t.name=e,t.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],t}t.exports=function(P,x){function O(e,t){t.addTrack(e),t.dispatchEvent(new P.MediaStreamTrackEvent("addtrack",{track:e}))}function r(e,t,n,i){var r=new Event("track");r.track=t,r.receiver=n,r.transceiver={receiver:n},r.streams=i,P.setTimeout(function(){e._dispatchEvent("track",r)})}function i(e){var t,i,r,n=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){n[e]=o[e].bind(o)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",e=JSON.parse(JSON.stringify(e||{})),this.usingBundle="max-bundle"===e.bundlePolicy,"negotiate"===e.rtcpMuxPolicy)throw p("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(e.rtcpMuxPolicy||(e.rtcpMuxPolicy="require"),e.iceTransportPolicy){case"all":case"relay":break;default:e.iceTransportPolicy="all"}switch(e.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:e.bundlePolicy="balanced"}if(e.iceServers=(t=e.iceServers||[],i=x,r=!1,(t=JSON.parse(JSON.stringify(t))).filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var n="string"==typeof t,t=(t=n?[t]:t).filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||r?0===e.indexOf("stun:")&&14393<=i&&-1===e.indexOf("?transport=udp"):r=!0});return delete e.url,e.urls=n?t[0]:t,!!t.length}})),this._iceGatherers=[],e.iceCandidatePoolSize)for(var s=e.iceCandidatePoolSize;0<s;s--)this._iceGatherers.push(new P.RTCIceGatherer({iceServers:e.iceServers,gatherPolicy:e.iceTransportPolicy}));else e.iceCandidatePoolSize=0;this._config=e,this.transceivers=[],this._sdpSessionId=A.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1}Object.defineProperty(i.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(i.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),i.prototype.onicecandidate=null,i.prototype.onaddstream=null,i.prototype.ontrack=null,i.prototype.onremovestream=null,i.prototype.onsignalingstatechange=null,i.prototype.oniceconnectionstatechange=null,i.prototype.onconnectionstatechange=null,i.prototype.onicegatheringstatechange=null,i.prototype.onnegotiationneeded=null,i.prototype.ondatachannel=null,i.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},i.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},i.prototype.getConfiguration=function(){return this._config},i.prototype.getLocalStreams=function(){return this.localStreams},i.prototype.getRemoteStreams=function(){return this.remoteStreams},i.prototype._createTransceiver=function(e,t){var n=0<this.transceivers.length,e={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};return this.usingBundle&&n?(e.iceTransport=this.transceivers[0].iceTransport,e.dtlsTransport=this.transceivers[0].dtlsTransport):(n=this._createIceAndDtlsTransports(),e.iceTransport=n.iceTransport,e.dtlsTransport=n.dtlsTransport),t||this.transceivers.push(e),e},i.prototype.addTrack=function(t,e){if(this._isClosed)throw p("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n;if(this.transceivers.find(function(e){return e.track===t}))throw p("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(n=this.transceivers[i]);return n=n||this._createTransceiver(t.kind),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(e)&&this.localStreams.push(e),n.track=t,n.stream=e,n.rtpSender=new P.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},i.prototype.addStream=function(t){var i,n=this;15025<=x?t.getTracks().forEach(function(e){n.addTrack(e,t)}):(i=t.clone(),t.getTracks().forEach(function(e,t){var n=i.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),i.getTracks().forEach(function(e){n.addTrack(e,i)}))},i.prototype.removeTrack=function(t){if(this._isClosed)throw p("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof P.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var e=this.transceivers.find(function(e){return e.rtpSender===t});if(!e)throw p("InvalidAccessError","Sender was not created by this connection.");var n=e.stream;e.rtpSender.stop(),e.rtpSender=null,e.track=null,e.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(n)&&-1<this.localStreams.indexOf(n)&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},i.prototype.removeStream=function(e){var n=this;e.getTracks().forEach(function(t){var e=n.getSenders().find(function(e){return e.track===t});e&&n.removeTrack(e)})},i.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},i.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},i.prototype._createIceGatherer=function(n,e){var i=this;if(e&&0<n)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var r=new P.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(r,"state",{value:"new",writable:!0}),this.transceivers[n].bufferedCandidateEvents=[],this.transceivers[n].bufferCandidates=function(e){var t=!e.candidate||0===Object.keys(e.candidate).length;r.state=t?"completed":"gathering",null!==i.transceivers[n].bufferedCandidateEvents&&i.transceivers[n].bufferedCandidateEvents.push(e)},r.addEventListener("localcandidate",this.transceivers[n].bufferCandidates),r},i.prototype._gather=function(r,o){var e,s=this,a=this.transceivers[o].iceGatherer;a.onlocalcandidate||(e=this.transceivers[o].bufferedCandidateEvents,this.transceivers[o].bufferedCandidateEvents=null,a.removeEventListener("localcandidate",this.transceivers[o].bufferCandidates),a.onlocalcandidate=function(e){var t,n,i;s.usingBundle&&0<o||((t=new Event("icecandidate")).candidate={sdpMid:r,sdpMLineIndex:o},(e=!(n=e.candidate)||0===Object.keys(n).length)?"new"!==a.state&&"gathering"!==a.state||(a.state="completed"):("new"===a.state&&(a.state="gathering"),n.component=1,n.ufrag=a.getLocalParameters().usernameFragment,i=A.writeCandidate(n),t.candidate=Object.assign(t.candidate,A.parseCandidate(i)),t.candidate.candidate=i,t.candidate.toJSON=function(){return{candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex,usernameFragment:t.candidate.usernameFragment}}),(i=A.getMediaSections(s._localDescription.sdp))[t.candidate.sdpMLineIndex]+=e?"a=end-of-candidates\r\n":"a="+t.candidate.candidate+"\r\n",s._localDescription.sdp=A.getDescription(s._localDescription.sdp)+i.join(""),i=s.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}),"gathering"!==s.iceGatheringState&&(s.iceGatheringState="gathering",s._emitGatheringStateChange()),e||s._dispatchEvent("icecandidate",t),i&&(s._dispatchEvent("icecandidate",new Event("icecandidate")),s.iceGatheringState="complete",s._emitGatheringStateChange()))},P.setTimeout(function(){e.forEach(function(e){a.onlocalcandidate(e)})},0))},i.prototype._createIceAndDtlsTransports=function(){var e=this,t=new P.RTCIceTransport(null);t.onicestatechange=function(){e._updateIceConnectionState(),e._updateConnectionState()};var n=new P.RTCDtlsTransport(t);return n.ondtlsstatechange=function(){e._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),e._updateConnectionState()},{iceTransport:t,dtlsTransport:n}},i.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);t=this.transceivers[e].iceTransport;t&&(delete t.onicestatechange,delete this.transceivers[e].iceTransport);t=this.transceivers[e].dtlsTransport;t&&(delete t.ondtlsstatechange,delete t.onerror,delete this.transceivers[e].dtlsTransport)},i.prototype._transceive=function(e,t,n){var i=I(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:A.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),n&&e.rtpReceiver&&0<i.codecs.length&&("video"===e.kind&&e.recvEncodingParameters&&x<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?i.encodings=e.recvEncodingParameters:i.encodings=[{}],i.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(i.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},i.prototype.setLocalDescription=function(e){var t,d,u,l=this;return-1===["offer","answer"].indexOf(e.type)?Promise.reject(p("TypeError",'Unsupported type "'+e.type+'"')):!o("setLocalDescription",e.type,l.signalingState)||l._isClosed?Promise.reject(p("InvalidStateError","Can not set local "+e.type+" in state "+l.signalingState)):("offer"===e.type?(t=A.splitSections(e.sdp),d=t.shift(),t.forEach(function(e,t){e=A.parseRtpParameters(e);l.transceivers[t].localCapabilities=e}),l.transceivers.forEach(function(e,t){l._gather(e.mid,t)})):"answer"===e.type&&(d=(t=A.splitSections(l._remoteDescription.sdp)).shift(),u=0<A.matchPrefix(d,"a=ice-lite").length,t.forEach(function(e,t){var n,i=l.transceivers[t],r=i.iceGatherer,o=i.iceTransport,s=i.dtlsTransport,a=i.localCapabilities,c=i.remoteCapabilities;A.isRejected(e)&&0===A.matchPrefix(e,"a=bundle-only").length||i.rejected||(n=A.getIceParameters(e,d),e=A.getDtlsParameters(e,d),u&&(e.role="server"),l.usingBundle&&0!==t||(l._gather(i.mid,t),"new"===o.state&&o.start(r,n,u?"controlling":"controlled"),"new"===s.state&&s.start(e)),c=I(a,c),l._transceive(i,0<c.codecs.length,!1))})),l._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?l._updateSignalingState("have-local-offer"):l._updateSignalingState("stable"),Promise.resolve())},i.prototype.setRemoteDescription=function(S){var C=this;if(-1===["offer","answer"].indexOf(S.type))return Promise.reject(p("TypeError",'Unsupported type "'+S.type+'"'));if(!o("setRemoteDescription",S.type,C.signalingState)||C._isClosed)return Promise.reject(p("InvalidStateError","Can not set remote "+S.type+" in state "+C.signalingState));var w={};C.remoteStreams.forEach(function(e){w[e.id]=e});var T=[],e=A.splitSections(S.sdp),R=e.shift(),E=0<A.matchPrefix(R,"a=ice-lite").length,k=0<A.matchPrefix(R,"a=group:BUNDLE ").length;C.usingBundle=k;var t=A.matchPrefix(R,"a=ice-options:")[0];return C.canTrickleIceCandidates=!!t&&0<=t.substr(14).split(" ").indexOf("trickle"),e.forEach(function(e,t){var n,i,r,o,s,a,c,d,u,l,p,f,h=A.splitLines(e),m=A.getKind(e),g=A.isRejected(e)&&0===A.matchPrefix(e,"a=bundle-only").length,v=h[0].substr(2).split(" ")[2],y=A.getDirection(e,R),b=A.parseMsid(e),_=A.getMid(e)||A.generateIdentifier();g||"application"===m&&("DTLS/SCTP"===v||"UDP/DTLS/SCTP"===v)?C.transceivers[t]={mid:_,kind:m,protocol:v,rejected:!0}:(!g&&C.transceivers[t]&&C.transceivers[t].rejected&&(C.transceivers[t]=C._createTransceiver(m,!0)),r=A.parseRtpParameters(e),g||(o=A.getIceParameters(e,R),(s=A.getDtlsParameters(e,R)).role="client"),a=A.parseRtpEncodingParameters(e),c=A.parseRtcpParameters(e),d=0<A.matchPrefix(e,"a=end-of-candidates",R).length,h=A.matchPrefix(e,"a=candidate:").map(function(e){return A.parseCandidate(e)}).filter(function(e){return 1===e.component}),("offer"===S.type||"answer"===S.type)&&!g&&k&&0<t&&C.transceivers[t]&&(C._disposeIceAndDtlsTransports(t),C.transceivers[t].iceGatherer=C.transceivers[0].iceGatherer,C.transceivers[t].iceTransport=C.transceivers[0].iceTransport,C.transceivers[t].dtlsTransport=C.transceivers[0].dtlsTransport,C.transceivers[t].rtpSender&&C.transceivers[t].rtpSender.setTransport(C.transceivers[0].dtlsTransport),C.transceivers[t].rtpReceiver&&C.transceivers[t].rtpReceiver.setTransport(C.transceivers[0].dtlsTransport)),"offer"!==S.type||g?"answer"!==S.type||g||(v=(n=C.transceivers[t]).iceGatherer,e=n.iceTransport,g=n.dtlsTransport,f=n.rtpReceiver,u=n.sendEncodingParameters,i=n.localCapabilities,C.transceivers[t].recvEncodingParameters=a,C.transceivers[t].remoteCapabilities=r,C.transceivers[t].rtcpParameters=c,h.length&&"new"===e.state&&(!E&&!d||k&&0!==t?h.forEach(function(e){M(n.iceTransport,e)}):e.setRemoteCandidates(h)),k&&0!==t||("new"===e.state&&e.start(v,o,"controlling"),"new"===g.state&&g.start(s)),!I(n.localCapabilities,n.remoteCapabilities).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&n.sendEncodingParameters[0].rtx&&delete n.sendEncodingParameters[0].rtx,C._transceive(n,"sendrecv"===y||"recvonly"===y,"sendrecv"===y||"sendonly"===y),!f||"sendrecv"!==y&&"sendonly"!==y?delete n.rtpReceiver:(p=f.track,b?(w[b.stream]||(w[b.stream]=new P.MediaStream),O(p,w[b.stream]),T.push([p,f,w[b.stream]])):(w.default||(w.default=new P.MediaStream),O(p,w.default),T.push([p,f,w.default])))):((n=C.transceivers[t]||C._createTransceiver(m)).mid=_,n.iceGatherer||(n.iceGatherer=C._createIceGatherer(t,k)),h.length&&"new"===n.iceTransport.state&&(!d||k&&0!==t?h.forEach(function(e){M(n.iceTransport,e)}):n.iceTransport.setRemoteCandidates(h)),i=P.RTCRtpReceiver.getCapabilities(m),x<15019&&(i.codecs=i.codecs.filter(function(e){return"rtx"!==e.name})),u=n.sendEncodingParameters||[{ssrc:1001*(2*t+2)}],h=!1,"sendrecv"===y||"sendonly"===y?(h=!n.rtpReceiver,f=n.rtpReceiver||new P.RTCRtpReceiver(n.dtlsTransport,m),h&&(p=f.track,(l=!b||"-"!==b.stream?b?(w[b.stream]||(w[b.stream]=new P.MediaStream,Object.defineProperty(w[b.stream],"id",{get:function(){return b.stream}})),Object.defineProperty(p,"id",{get:function(){return b.track}}),w[b.stream]):(w.default||(w.default=new P.MediaStream),w.default):l)&&(O(p,l),n.associatedRemoteMediaStreams.push(l)),T.push([p,f,l]))):n.rtpReceiver&&n.rtpReceiver.track&&(n.associatedRemoteMediaStreams.forEach(function(e){var t=e.getTracks().find(function(e){return e.id===n.rtpReceiver.track.id});t&&(t=t,(e=e).removeTrack(t),e.dispatchEvent(new P.MediaStreamTrackEvent("removetrack",{track:t})))}),n.associatedRemoteMediaStreams=[]),n.localCapabilities=i,n.remoteCapabilities=r,n.rtpReceiver=f,n.rtcpParameters=c,n.sendEncodingParameters=u,n.recvEncodingParameters=a,C._transceive(C.transceivers[t],!1,h)))}),void 0===C._dtlsRole&&(C._dtlsRole="offer"===S.type?"active":"passive"),C._remoteDescription={type:S.type,sdp:S.sdp},"offer"===S.type?C._updateSignalingState("have-remote-offer"):C._updateSignalingState("stable"),Object.keys(w).forEach(function(e){var t,i=w[e];i.getTracks().length&&(-1===C.remoteStreams.indexOf(i)&&(C.remoteStreams.push(i),(t=new Event("addstream")).stream=i,P.setTimeout(function(){C._dispatchEvent("addstream",t)})),T.forEach(function(e){var t=e[0],n=e[1];i.id===e[2].id&&r(C,t,n,[i])}))}),T.forEach(function(e){e[2]||r(C,e[0],e[1],[])}),P.setTimeout(function(){C&&C.transceivers&&C.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&0<e.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},i.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},i.prototype._updateSignalingState=function(e){this.signalingState=e;e=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",e)},i.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,P.setTimeout(function(){var e;t.needNegotiation&&(t.needNegotiation=!1,e=new Event("negotiationneeded"),t._dispatchEvent("negotiationneeded",e))},0))},i.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++}),e="new",0<t.failed?e="failed":0<t.checking?e="checking":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected?e="connected":0<t.completed&&(e="completed"),e!==this.iceConnectionState&&(this.iceConnectionState=e,e=new Event("iceconnectionstatechange"),this._dispatchEvent("iceconnectionstatechange",e))},i.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)}),t.connected+=t.completed,e="new",0<t.failed?e="failed":0<t.connecting?e="connecting":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected&&(e="connected"),e!==this.connectionState&&(this.connectionState=e,e=new Event("connectionstatechange"),this._dispatchEvent("connectionstatechange",e))},i.prototype.createOffer=function(){var o=this;if(o._isClosed)return Promise.reject(p("InvalidStateError","Can not call createOffer after close"));var t=o.transceivers.filter(function(e){return"audio"===e.kind}).length,n=o.transceivers.filter(function(e){return"video"===e.kind}).length,e=arguments[0];if(e){if(e.mandatory||e.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==e.offerToReceiveAudio&&(t=!0===e.offerToReceiveAudio?1:!1===e.offerToReceiveAudio?0:e.offerToReceiveAudio),void 0!==e.offerToReceiveVideo&&(n=!0===e.offerToReceiveVideo?1:!1===e.offerToReceiveVideo?0:e.offerToReceiveVideo)}for(o.transceivers.forEach(function(e){"audio"===e.kind?--t<0&&(e.wantReceive=!1):"video"===e.kind&&--n<0&&(e.wantReceive=!1)});0<t||0<n;)0<t&&(o._createTransceiver("audio"),t--),0<n&&(o._createTransceiver("video"),n--);var i=A.writeSessionBoilerplate(o._sdpSessionId,o._sdpSessionVersion++);o.transceivers.forEach(function(e,t){var n=e.track,i=e.kind,r=e.mid||A.generateIdentifier();e.mid=r,e.iceGatherer||(e.iceGatherer=o._createIceGatherer(t,o.usingBundle));r=P.RTCRtpSender.getCapabilities(i);x<15019&&(r.codecs=r.codecs.filter(function(e){return"rtx"!==e.name})),r.codecs.forEach(function(t){"H264"===t.name&&void 0===t.parameters["level-asymmetry-allowed"]&&(t.parameters["level-asymmetry-allowed"]="1"),e.remoteCapabilities&&e.remoteCapabilities.codecs&&e.remoteCapabilities.codecs.forEach(function(e){t.name.toLowerCase()===e.name.toLowerCase()&&t.clockRate===e.clockRate&&(t.preferredPayloadType=e.payloadType)})}),r.headerExtensions.forEach(function(t){(e.remoteCapabilities&&e.remoteCapabilities.headerExtensions||[]).forEach(function(e){t.uri===e.uri&&(t.id=e.id)})});t=e.sendEncodingParameters||[{ssrc:1001*(2*t+1)}];n&&15019<=x&&"video"===i&&!t[0].rtx&&(t[0].rtx={ssrc:t[0].ssrc+1}),e.wantReceive&&(e.rtpReceiver=new P.RTCRtpReceiver(e.dtlsTransport,i)),e.localCapabilities=r,e.sendEncodingParameters=t}),"max-compat"!==o._config.bundlePolicy&&(i+="a=group:BUNDLE "+o.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),i+="a=ice-options:trickle\r\n",o.transceivers.forEach(function(e,t){i+=s(e,e.localCapabilities,"offer",e.stream,o._dtlsRole),i+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===o.iceGatheringState||0!==t&&o.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,i+="a="+A.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(i+="a=end-of-candidates\r\n"))});e=new P.RTCSessionDescription({type:"offer",sdp:i});return Promise.resolve(e)},i.prototype.createAnswer=function(){var i=this;if(i._isClosed)return Promise.reject(p("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==i.signalingState&&"have-local-pranswer"!==i.signalingState)return Promise.reject(p("InvalidStateError","Can not call createAnswer in signalingState "+i.signalingState));var r=A.writeSessionBoilerplate(i._sdpSessionId,i._sdpSessionVersion++);i.usingBundle&&(r+="a=group:BUNDLE "+i.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),r+="a=ice-options:trickle\r\n";var o=A.getMediaSections(i._remoteDescription.sdp).length;i.transceivers.forEach(function(e,t){if(!(o<t+1)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?r+="m=application 0 DTLS/SCTP 5000\r\n":r+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?r+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(r+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(r+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");e.stream&&("audio"===e.kind?n=e.stream.getAudioTracks()[0]:"video"===e.kind&&(n=e.stream.getVideoTracks()[0]),n&&15019<=x&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var n=I(e.localCapabilities,e.remoteCapabilities);!n.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,r+=s(e,n,"answer",e.stream,i._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(r+="a=rtcp-rsize\r\n")}});var e=new P.RTCSessionDescription({type:"answer",sdp:r});return Promise.resolve(e)},i.prototype.addIceCandidate=function(a){var c,d=this;return a&&void 0===a.sdpMLineIndex&&!a.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(e,t){if(!d._remoteDescription)return t(p("InvalidStateError","Can not add ICE candidate without a remote description"));if(a&&""!==a.candidate){var n=a.sdpMLineIndex;if(a.sdpMid)for(var i=0;i<d.transceivers.length;i++)if(d.transceivers[i].mid===a.sdpMid){n=i;break}var r=d.transceivers[n];if(!r)return t(p("OperationError","Can not add ICE candidate"));if(r.rejected)return e();var o=0<Object.keys(a.candidate).length?A.parseCandidate(a.candidate):{};if("tcp"===o.protocol&&(0===o.port||9===o.port))return e();if(o.component&&1!==o.component)return e();if((0===n||0<n&&r.iceTransport!==d.transceivers[0].iceTransport)&&!M(r.iceTransport,o))return t(p("OperationError","Can not add ICE candidate"));t=a.candidate.trim();0===t.indexOf("a=")&&(t=t.substr(2)),(c=A.getMediaSections(d._remoteDescription.sdp))[n]+="a="+(o.type?t:"end-of-candidates")+"\r\n",d._remoteDescription.sdp=A.getDescription(d._remoteDescription.sdp)+c.join("")}else for(var s=0;s<d.transceivers.length&&(d.transceivers[s].rejected||(d.transceivers[s].iceTransport.addRemoteCandidate({}),(c=A.getMediaSections(d._remoteDescription.sdp))[s]+="a=end-of-candidates\r\n",d._remoteDescription.sdp=A.getDescription(d._remoteDescription.sdp)+c.join(""),!d.usingBundle));s++);e()})},i.prototype.getStats=function(t){if(t&&t instanceof P.MediaStreamTrack){var n=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)}),!n)throw p("InvalidAccessError","Invalid selector.");return n.getStats()}var i=[];return this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(e){t[e]&&i.push(t[e].getStats())})}),Promise.all(i).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(e){var t,e=P[e];e&&e.prototype&&e.prototype.getStats&&(t=e.prototype.getStats,e.prototype.getStats=function(){return t.apply(this).then(function(n){var i=new Map;return Object.keys(n).forEach(function(e){var t;n[e].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(t=n[e]).type]||t.type,i.set(e,n[e])}),i})})});var e=["createOffer","createAnswer"];return e.forEach(function(e){var n=i.prototype[e];i.prototype[e]=function(){var t=arguments;return"function"==typeof t[0]||"function"==typeof t[1]?n.apply(this,[arguments[2]]).then(function(e){"function"==typeof t[0]&&t[0].apply(null,[e])},function(e){"function"==typeof t[1]&&t[1].apply(null,[e])}):n.apply(this,arguments)}}),(e=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var n=i.prototype[e];i.prototype[e]=function(){var t=arguments;return"function"==typeof t[1]||"function"==typeof t[2]?n.apply(this,arguments).then(function(){"function"==typeof t[1]&&t[1].apply(null)},function(e){"function"==typeof t[2]&&t[2].apply(null,[e])}):n.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),i}},{sdp:17}],17:[function(e,t,n){"use strict";var d={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};d.localCName=d.generateIdentifier(),d.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},d.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(0<t?"m="+e:e).trim()+"\r\n"})},d.getDescription=function(e){e=d.splitSections(e);return e&&e[0]},d.getMediaSections=function(e){e=d.splitSections(e);return e.shift(),e},d.matchPrefix=function(e,t){return d.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},d.parseCandidate=function(e){for(var t=(0===e.indexOf("a=candidate:")?e.substring(12):e.substring(10)).split(" "),n={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1];break;case"ufrag":n.ufrag=t[i+1],n.usernameFragment=t[i+1];break;default:n[t[i]]=t[i+1]}return n},d.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},d.parseIceOptions=function(e){return e.substr(14).split(" ")},d.parseRtpMap=function(e){var t=e.substr(9).split(" "),e={payloadType:parseInt(t.shift(),10)},t=t[0].split("/");return e.name=t[0],e.clockRate=parseInt(t[1],10),e.channels=3===t.length?parseInt(t[2],10):1,e.numChannels=e.channels,e},d.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},d.parseExtmap=function(e){e=e.substr(9).split(" ");return{id:parseInt(e[0],10),direction:0<e[0].indexOf("/")?e[0].split("/")[1]:"sendrecv",uri:e[1]}},d.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},d.parseFmtp=function(e){for(var t,n={},i=e.substr(e.indexOf(" ")+1).split(";"),r=0;r<i.length;r++)n[(t=i[r].trim().split("="))[0].trim()]=t[1];return n},d.writeFmtp=function(t){var n,e="",i=t.payloadType;return void 0!==t.preferredPayloadType&&(i=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length&&(n=[],Object.keys(t.parameters).forEach(function(e){t.parameters[e]?n.push(e+"="+t.parameters[e]):n.push(e)}),e+="a=fmtp:"+i+" "+n.join(";")+"\r\n"),e},d.parseRtcpFb=function(e){e=e.substr(e.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},d.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},d.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},i=e.indexOf(":",t);return-1<i?(n.attribute=e.substr(t+1,i-t-1),n.value=e.substr(i+1)):n.attribute=e.substr(t+1),n},d.parseSsrcGroup=function(e){e=e.substr(13).split(" ");return{semantics:e.shift(),ssrcs:e.map(function(e){return parseInt(e,10)})}},d.getMid=function(e){e=d.matchPrefix(e,"a=mid:")[0];if(e)return e.substr(6)},d.parseFingerprint=function(e){e=e.substr(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1]}},d.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:d.matchPrefix(e+t,"a=fingerprint:").map(d.parseFingerprint)}},d.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},d.parseCryptoLine=function(e){e=e.substr(9).split(" ");return{tag:parseInt(e[0],10),cryptoSuite:e[1],keyParams:e[2],sessionParams:e.slice(3)}},d.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?d.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},d.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;e=e.substr(7).split("|");return{keyMethod:"inline",keySalt:e[0],lifeTime:e[1],mkiValue:e[2]?e[2].split(":")[0]:void 0,mkiLength:e[2]?e[2].split(":")[1]:void 0}},d.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},d.getCryptoParameters=function(e,t){return d.matchPrefix(e+t,"a=crypto:").map(d.parseCryptoLine)},d.getIceParameters=function(e,t){var n=d.matchPrefix(e+t,"a=ice-ufrag:")[0],t=d.matchPrefix(e+t,"a=ice-pwd:")[0];return n&&t?{usernameFragment:n.substr(12),password:t.substr(10)}:null},d.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},d.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=d.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var r=n[i],o=d.matchPrefix(e,"a=rtpmap:"+r+" ")[0];if(o){var s=d.parseRtpMap(o),o=d.matchPrefix(e,"a=fmtp:"+r+" ");switch(s.parameters=o.length?d.parseFmtp(o[0]):{},s.rtcpFeedback=d.matchPrefix(e,"a=rtcp-fb:"+r+" ").map(d.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return d.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(d.parseExtmap(e))}),t},d.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=0<t.codecs.length?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=d.writeRtpMap(e),n+=d.writeFmtp(e),n+=d.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),0<i&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){n+=d.writeExtmap(e)}),n},d.parseRtpEncodingParameters=function(e){var t,n=[],i=d.parseRtpParameters(e),r=-1!==i.fecMechanisms.indexOf("RED"),o=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=d.matchPrefix(e,"a=ssrc:").map(function(e){return d.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),a=0<s.length&&s[0].ssrc,s=d.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});0<s.length&&1<s[0].length&&s[0][0]===a&&(t=s[0][1]),i.codecs.forEach(function(e){"RTX"===e.name.toUpperCase()&&e.parameters.apt&&(e={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)},a&&t&&(e.rtx={ssrc:t}),n.push(e),r&&((e=JSON.parse(JSON.stringify(e))).fec={ssrc:a,mechanism:o?"red+ulpfec":"red"},n.push(e)))}),0===n.length&&a&&n.push({ssrc:a});var c=d.matchPrefix(e,"b=");return c.length&&(c=0===c[0].indexOf("b=TIAS:")?parseInt(c[0].substr(7),10):0===c[0].indexOf("b=AS:")?1e3*parseInt(c[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=c})),n},d.parseRtcpParameters=function(e){var t={},n=d.matchPrefix(e,"a=ssrc:").map(function(e){return d.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);n=d.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=0<n.length,t.compound=0===n.length;e=d.matchPrefix(e,"a=rtcp-mux");return t.mux=0<e.length,t},d.parseMsid=function(e){var t,n=d.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};e=d.matchPrefix(e,"a=ssrc:").map(function(e){return d.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return 0<e.length?{stream:(t=e[0].value.split(" "))[0],track:t[1]}:void 0},d.parseSctpDescription=function(e){var t,n=d.parseMLine(e),i=d.matchPrefix(e,"a=max-message-size:");0<i.length&&(t=parseInt(i[0].substr(19),10)),isNaN(t)&&(t=65536);i=d.matchPrefix(e,"a=sctp-port:");if(0<i.length)return{port:parseInt(i[0].substr(12),10),protocol:n.fmt,maxMessageSize:t};if(0<d.matchPrefix(e,"a=sctpmap:").length){e=d.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:t}}},d.writeSctpDescription=function(e,t){var n=[],n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"];return void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},d.generateSessionId=function(){return Math.random().toString().substr(2,21)},d.writeSessionBoilerplate=function(e,t,n){t=void 0!==t?t:2,e=e||d.generateSessionId();return"v=0\r\no="+(n||"thisisadapterortc")+" "+e+" "+t+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},d.writeMediaSection=function(e,t,n,i){t=d.writeRtpDescription(e.kind,t);return t+=d.writeIceParameters(e.iceGatherer.getLocalParameters()),t+=d.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),t+="a=mid:"+e.mid+"\r\n",e.direction?t+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?t+="a=sendrecv\r\n":e.rtpSender?t+="a=sendonly\r\n":e.rtpReceiver?t+="a=recvonly\r\n":t+="a=inactive\r\n",e.rtpSender&&(t+="a="+(i="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n"),t+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+i,e.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+i,t+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")),t+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+d.localCName+"\r\n"),t},d.getDirection=function(e,t){for(var n=d.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?d.getDirection(t):"sendrecv"},d.getKind=function(e){return d.splitLines(e)[0].split(" ")[0].substr(2)},d.isRejected=function(e){return"0"===e.split(" ",2)[1]},d.parseMLine=function(e){e=d.splitLines(e)[0].substr(2).split(" ");return{kind:e[0],port:parseInt(e[1],10),protocol:e[2],fmt:e.slice(3).join(" ")}},d.parseOLine=function(e){e=d.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:e[0],sessionId:e[1],sessionVersion:parseInt(e[2],10),netType:e[3],addressType:e[4],address:e[5]}},d.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=d.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=d)},{}]},{},[1])(1)})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils":void 0,"../utils.js":void 0,"./adapter_factory.js":void 0,"./chrome/chrome_shim":void 0,"./common_shim":void 0,"./edge/edge_shim":void 0,"./filtericeservers":void 0,"./firefox/firefox_shim":void 0,"./getdisplaymedia":void 0,"./getusermedia":void 0,"./safari/safari_shim":void 0,"./utils":void 0,"rtcpeerconnection-shim":void 0,sdp:void 0}],2:[function(require,module,exports){var JSON,JSON=JSON||{};(function(){function str(e,t){var n,i,r,o,s,a=gap,c=t[e];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),typeof(c="function"==typeof rep?rep.call(t,e,c):c)){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(c)){for(o=c.length,n=0;n<o;n+=1)s[n]=str(n,c)||"null";return r=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,r}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;n<o;n+=1)"string"==typeof rep[n]&&((r=str(i=rep[n],c))&&s.push(quote(i)+(gap?": ":":")+r));else for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(r=str(i,c),r&&s.push(quote(i)+(gap?": ":":")+r));return r=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,r}}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function f(e){return e<10?"0"+e:e}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var i;if(indent=gap="","number"==typeof n)for(i=0;i<n;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(!(rep=t)||"function"==typeof t||"object"==typeof t&&"number"==typeof t.length)return str("",{"":e});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,i,r=e[t];if(r&&"object"==typeof r)for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i=walk(r,n),void 0!==i?r[n]=i:delete r[n]);return reviver.call(e,t,r)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})})(),SockJS=function(){function e(){}var d=document,u=window,l={};e.prototype.addEventListener=function(e,t){this._listeners||(this._listeners={}),e in this._listeners||(this._listeners[e]=[]);e=this._listeners[e];-1===l.arrIndexOf(e,t)&&e.push(t)},e.prototype.removeEventListener=function(e,t){var n;this._listeners&&e in this._listeners&&(n=this._listeners[e],-1===(t=l.arrIndexOf(n,t))||(1<n.length?this._listeners[e]=n.slice(0,t).concat(n.slice(t+1)):delete this._listeners[e]))},e.prototype.dispatchEvent=function(e){var t=e.type,n=Array.prototype.slice.call(arguments,0);if(this["on"+t]&&this["on"+t].apply(this,n),this._listeners&&t in this._listeners)for(var i=0;i<this._listeners[t].length;i++)this._listeners[t][i].apply(this,n)};function s(e,t){if(this.type=e,void 0!==t)for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n])}s.prototype.toString=function(){var e,t,n=[];for(e in this)this.hasOwnProperty(e)&&("function"==typeof(t=this[e])&&(t="[function]"),n.push(e+"="+t));return"SimpleEvent("+n.join(", ")+")"};var t=function(e){this._events=e||[],this._listeners={}};t.prototype.emit=function(e){var t=this;if(t._verifyType(e),!t._nuked){var n=Array.prototype.slice.call(arguments,1);if(t["on"+e]&&t["on"+e].apply(t,n),e in t._listeners)for(var i=0;i<t._listeners[e].length;i++)t._listeners[e][i].apply(t,n)}},t.prototype.on=function(e,t){var n=this;n._verifyType(e),n._nuked||(e in n._listeners||(n._listeners[e]=[]),n._listeners[e].push(t))},t.prototype._verifyType=function(e){-1===l.arrIndexOf(this._events,e)&&l.log("Event "+JSON.stringify(e)+" not listed "+JSON.stringify(this._events)+" in "+this)},t.prototype.nuke=function(){var e=this;e._nuked=!0;for(var t=0;t<e._events.length;t++)delete e[e._events[t]];e._listeners={}};var r="abcdefghijklmnopqrstuvwxyz0123456789_";l.random_string=function(e,t){t=t||r.length;for(var n=[],i=0;i<e;i++)n.push(r.substr(Math.floor(Math.random()*t),1));return n.join("")},l.random_number=function(e){return Math.floor(Math.random()*e)},l.random_number_string=function(e){var t=(""+(e-1)).length;return(Array(t+1).join("0")+l.random_number(e)).slice(-t)},l.getOrigin=function(e){return(e+="/").split("/").slice(0,3).join("/")},l.isSameOriginUrl=function(e,t){return t=t||u.location.href,e.split("/").slice(0,3).join("/")===t.split("/").slice(0,3).join("/")},l.getParentDomain=function(e){return!/^[0-9.]*$/.test(e)&&!/^\[/.test(e)&&/[.]/.test(e)?e.split(".").slice(1).join("."):e},l.objectExtend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e};var n="_jp";l.polluteGlobalNamespace=function(){n in u||(u._jp={})},l.closeFrame=function(e,t){return"c"+JSON.stringify([e,t])},l.userSetCode=function(e){return 1e3===e||3e3<=e&&e<=4999},l.countRTO=function(e){e=100<e?3*e:e+200;return e},l.log=function(){u.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)},l.bind=function(e,t){return e.bind?e.bind(t):function(){return e.apply(t,arguments)}},l.flatUrl=function(e){return-1===e.indexOf("?")&&-1===e.indexOf("#")},l.amendUrl=function(e){var t=d.location;if(!e)throw new Error("Wrong url for SockJS");if(!l.flatUrl(e))throw new Error("Only basic urls are supported in SockJS");return e=(e=0===(e=0===e.indexOf("//")?t.protocol+e:e).indexOf("/")?t.protocol+"//"+t.host+e:e).replace(/[/]+$/,"")},l.arrIndexOf=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1},l.arrSkip=function(e,t){t=l.arrIndexOf(e,t);return-1===t?e.slice():e.slice(0,t).concat(e.slice(t+1))},l.isArray=Array.isArray||function(e){return 0<={}.toString.call(e).indexOf("Array")},l.delay=function(e,t){return"function"==typeof e&&(t=e,e=0),setTimeout(t,e)};var i,o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a={"\0":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","\t":"\\t","\n":"\\n","\v":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","":"\\u0080","":"\\u0081","":"\\u0082","":"\\u0083","":"\\u0084","":"\\u0085","":"\\u0086","":"\\u0087","":"\\u0088","":"\\u0089","":"\\u008a","":"\\u008b","":"\\u008c","":"\\u008d","":"\\u008e","":"\\u008f","":"\\u0090","":"\\u0091","":"\\u0092","":"\\u0093","":"\\u0094","":"\\u0095","":"\\u0096","":"\\u0097","":"\\u0098","":"\\u0099","":"\\u009a","":"\\u009b","":"\\u009c","":"\\u009d","":"\\u009e","":"\\u009f","":"\\u00ad","":"\\u0600","":"\\u0601","":"\\u0602","":"\\u0603","":"\\u0604","":"\\u070f","":"\\u17b4","":"\\u17b5","":"\\u200c","":"\\u200d","":"\\u200e","":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","":"\\u202a","":"\\u202b","":"\\u202c","":"\\u202d","":"\\u202e","":"\\u202f","":"\\u2060","":"\\u2061","":"\\u2062","":"\\u2063","":"\\u2064","":"\\u2065","":"\\u2066","":"\\u2067","":"\\u2068","":"\\u2069","":"\\u206a","":"\\u206b","":"\\u206c","":"\\u206d","":"\\u206e","":"\\u206f","\ufeff":"\\ufeff","":"\\ufff0","":"\\ufff1","":"\\ufff2","":"\\ufff3","":"\\ufff4","":"\\ufff5","":"\\ufff6","":"\\ufff7","":"\\ufff8","":"\\ufff9","":"\\ufffa","":"\\ufffb","":"\\ufffc","":"\\ufffd","":"\\ufffe","":"\\uffff"},c=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,p=JSON&&JSON.stringify||function(e){return o.lastIndex=0,'"'+(e=o.test(e)?e.replace(o,function(e){return a[e]}):e)+'"'};l.quote=function(e){e=p(e);return c.lastIndex=0,c.test(e)?(i=i||function(e){for(var t={},n=[],i=0;i<65536;i++)n.push(String.fromCharCode(i));return e.lastIndex=0,n.join("").replace(e,function(e){return t[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,t}(c),e.replace(c,function(e){return i[e]})):e};var f=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];l.probeProtocols=function(){for(var e={},t=0;t<f.length;t++){var n=f[t];e[n]=_[n]&&_[n].enabled()}return e},l.detectProtocols=function(e,t,n){var i={},r=[];t=t||f;for(var o=0;o<t.length;o++){var s=t[o];i[s]=e[s]}var a=function(e){var t=e.shift();i[t]?r.push(t):0<e.length&&a(e)};return!1!==n.websocket&&a(["websocket"]),i["xhr-streaming"]&&!n.null_origin?r.push("xhr-streaming"):!i["xdr-streaming"]||n.cookie_needed||n.null_origin?a(["iframe-eventsource","iframe-htmlfile"]):r.push("xdr-streaming"),i["xhr-polling"]&&!n.null_origin?r.push("xhr-polling"):!i["xdr-polling"]||n.cookie_needed||n.null_origin?a(["iframe-xhr-polling","jsonp-polling"]):r.push("xdr-polling"),r};var h="_sockjs_global";l.createHook=function(){var t,e="a"+l.random_string(8);return h in u||(t={},u[h]=function(e){return e in t||(t[e]={id:e,del:function(){delete t[e]}}),t[e]}),u[h](e)},l.attachMessage=function(e){l.attachEvent("message",e)},l.attachEvent=function(e,t){void 0!==u.addEventListener?u.addEventListener(e,t,!1):(d.attachEvent("on"+e,t),u.attachEvent("on"+e,t))},l.detachMessage=function(e){l.detachEvent("message",e)},l.detachEvent=function(e,t){void 0!==u.addEventListener?u.removeEventListener(e,t,!1):(d.detachEvent("on"+e,t),u.detachEvent("on"+e,t))};function m(){for(var e in g)g[e](),delete g[e]}var g={},v=!1;l.attachEvent("unload",function(){v||(v=!0,m())}),l.unload_add=function(e){var t=l.random_string(8);return g[t]=e,v&&l.delay(m),t},l.unload_del=function(e){e in g&&delete g[e]},l.createIframe=function(e,t){function n(){clearTimeout(o);try{a.onload=null}catch(e){}a.onerror=null}function i(){a&&(n(),setTimeout(function(){a&&a.parentNode.removeChild(a),a=null},0),l.unload_del(s))}function r(e){a&&(i(),t(e))}var o,s,a=d.createElement("iframe");return a.src=e,a.style.display="none",a.style.position="absolute",a.onerror=function(){r("onerror")},a.onload=function(){clearTimeout(o),o=setTimeout(function(){r("onload timeout")},2e3)},d.body.appendChild(a),o=setTimeout(function(){r("timeout")},15e3),s=l.unload_add(i),{post:function(e,t){try{a&&a.contentWindow&&a.contentWindow.postMessage(e,t)}catch(e){}},cleanup:i,loaded:n}},l.createHtmlfile=function(e,t){function n(){clearTimeout(r)}function i(){a&&(n(),l.unload_del(o),s.parentNode.removeChild(s),s=a=null,CollectGarbage())}var r,o,s,a=new ActiveXObject("htmlfile");a.open(),a.write('<html><script>document.domain="'+document.domain+'";<\/script></html>'),a.close(),a.parentWindow._jp=u._jp;var c=a.createElement("div");return a.body.appendChild(c),s=a.createElement("iframe"),c.appendChild(s),s.src=e,r=setTimeout(function(){a&&(i(),t("timeout"))},15e3),o=l.unload_add(i),{post:function(e,t){try{s&&s.contentWindow&&s.contentWindow.postMessage(e,t)}catch(e){}},cleanup:i,loaded:n}};var y=function(){};(y.prototype=new t(["chunk","finish"]))._start=function(e,t,n,i){var r=this;try{r.xhr=new XMLHttpRequest}catch(e){}if(!r.xhr)try{r.xhr=new u.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}(u.ActiveXObject||u.XDomainRequest)&&(t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date),r.unload_ref=l.unload_add(function(){r._cleanup(!0)});try{r.xhr.open(e,t,!0)}catch(e){return r.emit("finish",0,""),void r._cleanup()}if(i&&i.no_credentials||(r.xhr.withCredentials="true"),i&&i.headers)for(var o in i.headers)r.xhr.setRequestHeader(o,i.headers[o]);r.xhr.onreadystatechange=function(){if(r.xhr){var e=r.xhr;switch(e.readyState){case 3:try{var t=e.status,n=e.responseText}catch(e){}1223===t&&(t=204),n&&0<n.length&&r.emit("chunk",t,n);break;case 4:t=e.status;r.emit("finish",t=1223===t?204:t,e.responseText),r._cleanup(!1)}}},r.xhr.send(n)},y.prototype._cleanup=function(e){var t=this;if(t.xhr){if(l.unload_del(t.unload_ref),t.xhr.onreadystatechange=function(){},e)try{t.xhr.abort()}catch(e){}t.unload_ref=t.xhr=null}},y.prototype.close=function(){this.nuke(),this._cleanup(!0)},(l.XHRCorsObject=function(){var e=this,t=arguments;l.delay(function(){e._start.apply(e,t)})}).prototype=new y,(l.XHRLocalObject=function(e,t,n){var i=this;l.delay(function(){i._start(e,t,n,{no_credentials:!0})})}).prototype=new y;var b=l.XDRObject=function(e,t,n){var i=this;l.delay(function(){i._start(e,t,n)})};b.prototype=new t(["chunk","finish"]),b.prototype._start=function(e,t,n){var i=this,r=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date;var o=r.ontimeout=r.onerror=function(){i.emit("finish",0,""),i._cleanup(!1)};r.onprogress=function(){i.emit("chunk",200,r.responseText)},r.onload=function(){i.emit("finish",200,r.responseText),i._cleanup(!1)},i.xdr=r,i.unload_ref=l.unload_add(function(){i._cleanup(!0)});try{i.xdr.open(e,t),i.xdr.send(n)}catch(e){o()}},b.prototype._cleanup=function(e){var t=this;if(t.xdr){if(l.unload_del(t.unload_ref),t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null,e)try{t.xdr.abort()}catch(e){}t.unload_ref=t.xdr=null}},b.prototype.close=function(){this.nuke(),this._cleanup(!0)},l.isXHRCorsCapable=function(){return u.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:u.XDomainRequest&&d.domain?2:k.enabled()?3:4};var _=function(e,t,n){if(this===u)return new _(e,t,n);var i,r=this;r._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},n&&l.objectExtend(r._options,n),r._base_url=l.amendUrl(e),r._server=r._options.server||l.random_number_string(1e3),r._options.protocols_whitelist&&r._options.protocols_whitelist.length?i=r._options.protocols_whitelist:(i="string"==typeof t&&0<t.length?[t]:l.isArray(t)?t:null)&&r._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.'),r._protocols=[],r.protocol=null,r.readyState=_.CONNECTING,r._ir=M(r._base_url),r._ir.onfinish=function(e,t){r._ir=null,e?(r._options.info&&(e=l.objectExtend(e,r._options.info)),r._options.rtt&&(t=r._options.rtt),r._applyInfo(e,t,i),r._didClose()):r._didClose(1002,"Can't connect to server",!0)}};_.prototype=new e,_.version="0.3.4",_.CONNECTING=0,_.OPEN=1,_.CLOSING=2,_.CLOSED=3,_.prototype._debug=function(){this._options.debug&&l.log.apply(l,arguments)},_.prototype._dispatchOpen=function(){var e=this;e.readyState===_.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=_.OPEN,e.dispatchEvent(new s("open"))):e._didClose(1006,"Server lost session")},_.prototype._dispatchMessage=function(e){this.readyState===_.OPEN&&this.dispatchEvent(new s("message",{data:e}))},_.prototype._dispatchHeartbeat=function(e){this.readyState===_.OPEN&&this.dispatchEvent(new s("heartbeat",{}))},_.prototype._didClose=function(e,t,n){var i=this;if(i.readyState!==_.CONNECTING&&i.readyState!==_.OPEN&&i.readyState!==_.CLOSING)throw new Error("INVALID_STATE_ERR");i._ir&&(i._ir.nuke(),i._ir=null),i._transport&&(i._transport.doCleanup(),i._transport=null);var r=new s("close",{code:e,reason:t,wasClean:l.userSetCode(e)});if(!l.userSetCode(e)&&i.readyState===_.CONNECTING&&!n){if(i._try_next_protocol(r))return;r=new s("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:r})}i.readyState=_.CLOSED,l.delay(function(){i.dispatchEvent(r)})},_.prototype._didMessage=function(e){var t=this;switch(e.slice(0,1)){case"o":t._dispatchOpen();break;case"a":for(var n=JSON.parse(e.slice(1)||"[]"),i=0;i<n.length;i++)t._dispatchMessage(n[i]);break;case"m":n=JSON.parse(e.slice(1)||"null");t._dispatchMessage(n);break;case"c":n=JSON.parse(e.slice(1)||"[]");t._didClose(n[0],n[1]);break;case"h":t._dispatchHeartbeat()}},_.prototype._try_next_protocol=function(e){var t=this;for(t.protocol&&(t._debug("Closed transport:",t.protocol,""+e),t.protocol=null),t._transport_tref&&(clearTimeout(t._transport_tref),t._transport_tref=null);;){var n=t.protocol=t._protocols.shift();if(!n)return!1;if(_[n]&&!0===_[n].need_body&&(!d.body||void 0!==d.readyState&&"complete"!==d.readyState))return t._protocols.unshift(n),t.protocol="waiting-for-load",l.attachEvent("load",function(){t._try_next_protocol()}),!0;if(_[n]&&_[n].enabled(t._options)){var i=_[n].roundTrips||1,i=(t._options.rto||0)*i||5e3;t._transport_tref=l.delay(i,function(){t.readyState===_.CONNECTING&&t._didClose(2007,"Transport timeouted")});i=l.random_string(8),i=t._base_url+"/"+t._server+"/"+i;return t._debug("Opening transport:",n," url:"+i," RTO:"+t._options.rto),t._transport=new _[n](t,i,t._base_url),!0}t._debug("Skipping transport:",n)}},_.prototype.close=function(e,t){if(e&&!l.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");return(this.readyState===_.CONNECTING||this.readyState===_.OPEN)&&(this.readyState=_.CLOSING,this._didClose(e||1e3,t||"Normal closure"),!0)},_.prototype.send=function(e){if(this.readyState===_.CONNECTING)throw new Error("INVALID_STATE_ERR");return this.readyState===_.OPEN&&this._transport.doSend(l.quote(""+e)),!0},_.prototype._applyInfo=function(e,t,n){var i=this;i._options.info=e,i._options.rtt=t,i._options.rto=l.countRTO(t),i._options.info.null_origin=!d.domain;t=l.probeProtocols();i._protocols=l.detectProtocols(t,n,e)};var S=_.websocket=function(e,t){var n=this,t="https"===(t=t+"/websocket").slice(0,5)?"wss"+t.slice(5):"ws"+t.slice(4);n.ri=e,n.url=t;t=u.WebSocket||u.MozWebSocket;n.ws=new t(n.url),n.ws.onmessage=function(e){n.ri._didMessage(e.data)},n.unload_ref=l.unload_add(function(){n.ws.close()}),n.ws.onclose=function(){n.ri._didMessage(l.closeFrame(1006,"WebSocket connection broken"))}};S.prototype.doSend=function(e){this.ws.send("["+e+"]")},S.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),l.unload_del(e.unload_ref),e.unload_ref=e.ri=e.ws=null)},S.enabled=function(){return!(!u.WebSocket&&!u.MozWebSocket)},S.roundTrips=2;var C=function(){};C.prototype.send_constructor=function(e){this.send_buffer=[],this.sender=e},C.prototype.doSend=function(e){this.send_buffer.push(e),this.send_stop||this.send_schedule()},C.prototype.send_schedule_wait=function(){var e,t=this;t.send_stop=function(){t.send_stop=null,clearTimeout(e)},e=l.delay(25,function(){t.send_stop=null,t.send_schedule()})},C.prototype.send_schedule=function(){var e,n=this;0<n.send_buffer.length&&(e="["+n.send_buffer.join(",")+"]",n.send_stop=n.sender(n.trans_url,e,function(e,t){n.send_stop=null,!1===e?n.ri._didClose(1006,"Sending error "+t):n.send_schedule_wait()}),n.send_buffer=[])},C.prototype.send_destructor=function(){this._send_stop&&this._send_stop(),this._send_stop=null};function w(e,t,n){"_send_form"in(s=this)||(r=s._send_form=d.createElement("form"),(o=s._send_area=d.createElement("textarea")).name="d",r.style.display="none",r.style.position="absolute",r.method="POST",r.enctype="application/x-www-form-urlencoded",r.acceptCharset="UTF-8",r.appendChild(o),d.body.appendChild(r));var i,r=s._send_form,o=s._send_area,s="a"+l.random_string(8);r.target=s,r.action=e+"/jsonp_send?i="+s;try{i=d.createElement('<iframe name="'+s+'">')}catch(e){(i=d.createElement("iframe")).name=s}i.id=s,r.appendChild(i),i.style.display="none";try{o.value=t}catch(e){l.log("Your browser is seriously broken. Go home! "+e.message)}function a(e){i.onerror&&(i.onreadystatechange=i.onerror=i.onload=null,l.delay(500,function(){i.parentNode.removeChild(i),i=null}),o.value="",n(!0))}return r.submit(),i.onerror=i.onload=a,i.onreadystatechange=function(e){"complete"==i.readyState&&a()},a}function T(e,t){function n(e){i&&(i.parentNode.removeChild(i),i=null),r&&(clearTimeout(a),r.parentNode.removeChild(r),r.onreadystatechange=r.onerror=r.onload=r.onclick=null,r=null,t(e),t=null)}var i,r=d.createElement("script"),o=!1,s=null;if(r.id="a"+l.random_string(8),r.src=e,r.type="text/javascript",r.charset="UTF-8",r.onerror=function(e){s=s||setTimeout(function(){o||n(l.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3)},r.onload=function(e){n(l.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},r.onreadystatechange=function(e){if(/loaded|closed/.test(r.readyState)){if(r&&r.htmlFor&&r.onclick){o=!0;try{r.onclick()}catch(e){}}r&&n(l.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},void 0===r.async&&d.attachEvent)if(/opera/i.test(navigator.userAgent))(i=d.createElement("script")).text="try{var a = document.getElementById('"+r.id+"'); if(a)a.onerror();}catch(x){};",r.async=i.async=!1;else{try{r.htmlFor=r.id,r.event="onclick"}catch(e){}r.async=!0}void 0!==r.async&&(r.async=!0);var a=setTimeout(function(){n(l.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);return(e=d.getElementsByTagName("head")[0]).insertBefore(r,e.firstChild),i&&e.insertBefore(i,e.firstChild),n}y=_["jsonp-polling"]=function(e,t){l.polluteGlobalNamespace();this.ri=e,this.trans_url=t,this.send_constructor(w),this._schedule_recv()};y.prototype=new C,y.prototype._schedule_recv=function(){var t=this;t._recv_stop=R(t.trans_url+"/jsonp",T,function(e){t._recv_stop=null,e&&(t._is_closing||t.ri._didMessage(e)),t._is_closing||t._schedule_recv()})},y.enabled=function(){return!0},y.need_body=!0,y.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};var R=function(e,t,n){var i="a"+l.random_string(6),e=e+"?c="+escape("_jp."+i),r=0,e=t(e,function(e){switch(r){case 0:delete u._jp[i],n(e);break;case 1:n(e),r=2;break;case 2:delete u._jp[i]}});u._jp[i]=e;return function(){u._jp[i]&&(r=1,u._jp[i](l.closeFrame(1e3,"JSONP user aborted read")))}},b=function(){};(b.prototype=new C).run=function(e,t,n,i,r){var o;this.ri=e,this.trans_url=t,this.send_constructor((o=r,function(e,t,n){return new o("POST",e+"/xhr_send",t).onfinish=function(e,t){n(200===e||204===e,"http status "+e)},function(e){n(!1,e)}})),this.poll=new D(e,i,t+n,r)},b.prototype.doCleanup=function(){this.poll&&(this.poll.abort(),this.poll=null)};S=_["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",j,l.XHRCorsObject)};S.prototype=new b,S.enabled=function(){return u.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},S.roundTrips=2,S.need_body=!0;y=_["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",j,l.XDRObject)};y.prototype=new b,y.enabled=function(){return!!u.XDomainRequest},y.roundTrips=2;C=_["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",j,l.XHRCorsObject)};C.prototype=new b,C.enabled=S.enabled,C.roundTrips=2;C=_["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",j,l.XDRObject)};C.prototype=new b,C.enabled=y.enabled,C.roundTrips=2;var E,k=function(){};k.prototype.i_constructor=function(e,t,n){var i=this;i.ri=e,i.origin=l.getOrigin(n),i.base_url=n,i.trans_url=t;n+="/iframe.html";i.ri._options.devel&&(n+="?t="+ +new Date),i.window_id=l.random_string(8),n+="#"+i.window_id,i.iframeObj=l.createIframe(n,function(e){i.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),i.onmessage_cb=l.bind(i.onmessage,i),l.attachMessage(i.onmessage_cb)},k.prototype.doCleanup=function(){var e=this;if(e.iframeObj){l.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(e){}e.iframeObj.cleanup(),e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},k.prototype.onmessage=function(e){var t=this;if(e.origin===t.origin){var n=e.data.slice(0,8),i=e.data.slice(8,9),r=e.data.slice(9);if(n===t.window_id)switch(i){case"s":t.iframeObj.loaded(),t.postMessage("s",JSON.stringify([_.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(r)}}},k.prototype.postMessage=function(e,t){this.iframeObj.post(this.window_id+e+(t||""),this.origin)},k.prototype.doSend=function(e){this.postMessage("m",e)},k.enabled=function(){var e=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof u.postMessage||"object"==typeof u.postMessage)&&!e};function P(e,t){parent!==u?parent.postMessage(E+e+(t||""),"*"):l.log("Can't postMessage, no parent window.",e,t)}function x(){}x.prototype._didClose=function(e,t){P("t",l.closeFrame(e,t))},x.prototype._didMessage=function(e){P("t",e)},x.prototype._doSend=function(e){this._transport.doSend(e)},x.prototype._doCleanup=function(){this._transport.doCleanup()},l.parent_origin=void 0,_.bootstrap_iframe=function(){var c;E=d.location.hash.slice(1);l.attachMessage(function(e){if(e.source===parent&&(void 0===l.parent_origin&&(l.parent_origin=e.origin),e.origin===l.parent_origin)){var t=e.data.slice(0,8),n=e.data.slice(8,9),i=e.data.slice(9);if(t===E)switch(n){case"s":var r=JSON.parse(i),o=r[0],s=r[1],a=r[2],r=r[3];if(o!==_.version&&l.log('Incompatibile SockJS! Main site uses: "'+o+'", the iframe: "'+_.version+'".'),!l.flatUrl(a)||!l.flatUrl(r))return void l.log("Only basic urls are supported in SockJS");if(!l.isSameOriginUrl(a)||!l.isSameOriginUrl(r))return void l.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([u.location.href,a,r])+")");(c=new x)._transport=new x[s](c,a,r);break;case"m":c._doSend(i);break;case"c":c&&c._doCleanup(),c=null}}}),P("s")};function O(e,t){var n=this;l.delay(function(){n.doXhr(e,t)})}(O.prototype=new t(["finish"])).doXhr=function(e,t){var n=this,i=(new Date).getTime(),r=new t("GET",e+"/info"),o=l.delay(8e3,function(){r.ontimeout()});r.onfinish=function(e,t){clearTimeout(o),o=null,200===e?(e=(new Date).getTime()-i,t=JSON.parse(t),n.emit("finish",t="object"!=typeof t?{}:t,e)):n.emit("finish")},r.ontimeout=function(){r.close(),n.emit("finish")}};function A(t){function e(){var n=new k;function e(e){var t;"string"==typeof e&&"m"===e.substr(0,1)?(e=(t=JSON.parse(e.substr(1)))[0],t=t[1],i.emit("finish",e,t)):i.emit("finish"),n.doCleanup(),n=null}n.protocol="w-iframe-info-receiver",n.i_constructor({_options:{},_didClose:e,_didMessage:e},t,t)}var i=this;d.body?e():l.attachEvent("load",e)}A.prototype=new t(["finish"]);function I(){var e=this;l.delay(function(){e.emit("finish",{},2e3)})}I.prototype=new t(["finish"]);var M=function(e){if(l.isSameOriginUrl(e))return new O(e,l.XHRLocalObject);switch(l.isXHRCorsCapable()){case 1:return new O(e,l.XHRLocalObject);case 2:return new O(e,l.XDRObject);case 3:return new A(e);default:return new I}};(x["w-iframe-info-receiver"]=function(n,e,t){new O(t,l.XHRLocalObject).onfinish=function(e,t){n._didMessage("m"+JSON.stringify([e,t])),n._didClose()}}).prototype.doCleanup=function(){};t=_["iframe-eventsource"]=function(){this.protocol="w-iframe-eventsource",this.i_constructor.apply(this,arguments)};t.prototype=new k,t.enabled=function(){return"EventSource"in u&&k.enabled()},t.need_body=!0,t.roundTrips=3,(x["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",N,l.XHRLocalObject)}).prototype=new b;t=_["iframe-xhr-polling"]=function(){this.protocol="w-iframe-xhr-polling",this.i_constructor.apply(this,arguments)};t.prototype=new k,t.enabled=function(){return u.XMLHttpRequest&&k.enabled()},t.need_body=!0,t.roundTrips=3,(x["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",j,l.XHRLocalObject)}).prototype=new b;t=_["iframe-htmlfile"]=function(){this.protocol="w-iframe-htmlfile",this.i_constructor.apply(this,arguments)};t.prototype=new k,t.enabled=function(){return k.enabled()},t.need_body=!0,t.roundTrips=3,(x["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",U,l.XHRLocalObject)}).prototype=new b;var D=function(e,t,n,i){var r=this;r.ri=e,r.Receiver=t,r.recv_url=n,r.AjaxObject=i,r._scheduleRecv()};D.prototype._scheduleRecv=function(){var t=this,n=t.poll=new t.Receiver(t.recv_url,t.AjaxObject);n.onmessage=function(e){t.ri._didMessage(e.data)},n.onclose=function(e){t.poll=n=n.onmessage=n.onclose=null,t.poll_is_closing||("permanent"===e.reason?t.ri._didClose(1006,"Polling error ("+e.reason+")"):t._scheduleRecv())}},D.prototype.abort=function(){this.poll_is_closing=!0,this.poll&&this.poll.abort()};var L,N=function(e){var i=this,r=new EventSource(e);r.onmessage=function(e){i.dispatchEvent(new s("message",{data:unescape(e.data)}))},i.es_close=r.onerror=function(e,t){var n=t?"user":2!==r.readyState?"network":"permanent";i.es_close=r.onmessage=r.onerror=null,r.close(),r=null,l.delay(200,function(){i.dispatchEvent(new s("close",{reason:n}))})}};N.prototype=new e,N.prototype.abort=function(){this.es_close&&this.es_close({},!0)};var U=function(e){var n=this;l.polluteGlobalNamespace(),n.id="a"+l.random_string(6,26),e+=(-1===e.indexOf("?")?"?":"&")+"c="+escape("_jp."+n.id);var i,t=function(){if(void 0===L)if("ActiveXObject"in u)try{L=!!new ActiveXObject("htmlfile")}catch(e){}else L=!1;return L}()?l.createHtmlfile:l.createIframe;u._jp[n.id]={start:function(){i.loaded()},message:function(e){n.dispatchEvent(new s("message",{data:e}))},stop:function(){n.iframe_close({},"network")}},n.iframe_close=function(e,t){i.cleanup(),n.iframe_close=i=null,delete u._jp[n.id],n.dispatchEvent(new s("close",{reason:t}))},i=t(e,function(e){n.iframe_close({},"permanent")})};U.prototype=new e,U.prototype.abort=function(){this.iframe_close&&this.iframe_close({},"user")};var j=function(e,t){var r=this,o=0;r.xo=new t("POST",e,null),r.xo.onchunk=function(e,t){if(200===e)for(;;){var n=t.slice(o),i=n.indexOf("\n");if(-1===i)break;o+=i+1;i=n.slice(0,i);r.dispatchEvent(new s("message",{data:i}))}},r.xo.onfinish=function(e,t){r.xo.onchunk(e,t),r.xo=null,r.dispatchEvent(new s("close",{reason:200===e?"network":"permanent"}))}};return j.prototype=new e,j.prototype.abort=function(){this.xo&&(this.xo.close(),this.dispatchEvent(new s("close",{reason:"user"})),this.xo=null)},_.getUtils=function(){return l},_.getIframeTransport=function(){return k},_}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS})},{}],3:[function(e,t,n){"use strict";function i(e){return this.timer=null,this.abort=!1,this.timeout=e.timeout||void 0,this.url=e.url||location.pathname,this.data=e.data||{},this.type=e.type||"GET",this.onSuccess=e.onSuccess||function(){},this.onError=e.onError||function(){},this.dataType=e.dataType||"text",this.xhr=new XMLHttpRequest,this.xhr.onreadystatechange=this._readystatechange.bind(this),this._doRequest()}i.prototype={_get:function(){var e,t="?";for(e in this.data)1<t.length&&(t+="&"),t+=e+"="+this.data[e];this.xhr.open(this.type,this.url+t,!0),this.xhr.send(null)},_post:function(){this.xhr.open(this.type,this.url,!0),this.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.xhr.send(this.data)},_doRequest:function(){this["POST"==this.type?"_post":"_get"](),this.timeout&&(this.timer=setTimeout(function(){this.abort=!0,this.xhr.abort()}.bind(this),1e3*this.timeout))},_readystatechange:function(){var e;if(4==this.xhr.readyState)if(this.timer&&clearTimeout(this.timer),200==this.xhr.status){if("function"==typeof this.onSuccess){switch(this.dataType){case"json":try{e=JSON.parse(this.xhr.responseText)}catch(e){log("[Ajax]",e)}break;case"xml":e=this.xhr.responseXML;break;case"text":default:e=this.xhr.responseText}this.onSuccess(e)}}else"function"==typeof this.onError&&this.onError(this.xhr,this.abort?"timeout":"error",this.xhr.statusText)}},t.exports=i},{}],4:[function(e,t,n){"use strict";var s,a=e("./Log");function i(){this.processors={},this.range_start=20,this.range_end=80}window.AudioContext=window.AudioContext||window.webkitAudioContext,AudioContext&&(s=new AudioContext),i.prototype={add:function(e,i){var t,r,n,o;AudioContext&&(!e.getAudioTracks||e.getAudioTracks().length?(t=e.getAudioTracks()[0].id,r=s.createAnalyser(),n=s.createMediaStreamSource(e),e=s.createScriptProcessor(2048,1,1),o=new Uint8Array(r.frequencyBinCount),r.smoothingTimeConstant=.4,r.fftSize=1024,n.connect(r),r.connect(e),e.connect(s.destination),e.onaudioprocess=function(){r.getByteFrequencyData(o);for(var e=0,t=this.range_start;t<this.range_end;t++)e+=o[t];var n=e/(this.range_end-this.range_start),n=100<(n=100*Math.log(n/100+1))?100:Math.round(n);"function"==typeof i&&i(n)}.bind(this),this.processors[t]=e):a("[AudioActivityMonitor] Current stream has no audio track to monitor"))},remove:function(e){!e||(e=e.id)in this.processors&&(this.processors[e].onaudioprocess=null,this.processors[e].disconnect(s.destination),delete this.processors[e])},resume:function(){s.resume&&s.resume()}},t.exports=new i},{"./Log":15}],5:[function(e,r,t){!function(t,w){!function(){"use strict";function n(e){for(var t=0,n=0,i=0,r=new ArrayBuffer(e[0].byte_length+e[0].header_size),o=new DataView(r),n=0;n<e.length;n++){e[n].header_size;var s=e[n].type,a=e[n].length,c=e[n].value,d=e[n].byte_length,u=S[s],l=null===u?0:g[u+"Array"].BYTES_PER_ELEMENT;switch(s===_.BUFFER?o.setUint8(t,_.BLOB,!1):o.setUint8(t,s,!1),t+=v,s!==_.ARRAY&&s!==_.OBJECT||(o.setUint16(t,a,!1),t+=y),o.setUint32(t,d,!1),t+=b,s){case _.NULL:case _.UNDEFINED:break;case _.STRING:for(0,i=0;i<a;i++,t+=l)o.setUint16(t,c.charCodeAt(i),!1);break;case _.NUMBER:case _.BOOLEAN:0,o["set"+u](t,c,!1),t+=l;break;case _.INT8ARRAY:case _.INT16ARRAY:case _.INT32ARRAY:case _.UINT8ARRAY:case _.UINT16ARRAY:case _.UINT32ARRAY:case _.FLOAT32ARRAY:case _.FLOAT64ARRAY:new Uint8Array(o.buffer,t,d).set(new Uint8Array(c.buffer)),t+=d;break;case _.ARRAYBUFFER:case _.BUFFER:new Uint8Array(o.buffer,t,d).set(new Uint8Array(c)),t+=d;break;case _.BLOB:case _.ARRAY:case _.OBJECT:break;default:throw"TypeError: Unexpected type found."}0}return o}function p(e,r){for(var o=e.length,s=[],a=0,c=0,t=0;t<e.length;t++)!function(i){d(e[i],function(e){if(s[i]=e,c+=e[0].header_size+e[0].byte_length,++a===o){for(var t=[],n=0;n<s.length;n++)t=t.concat(s[n]);r(t,c)}})}(t)}function i(e,t){return e=new DataView(e),C(e,0).value}var g,v,y,b,_,S,C,d,e;g=void 0!==t?t:this,v=Uint8Array.BYTES_PER_ELEMENT,y=Uint16Array.BYTES_PER_ELEMENT,b=Uint32Array.BYTES_PER_ELEMENT,_={NULL:0,UNDEFINED:1,STRING:2,NUMBER:3,BOOLEAN:4,ARRAY:5,OBJECT:6,INT8ARRAY:7,INT16ARRAY:8,INT32ARRAY:9,UINT8ARRAY:10,UINT16ARRAY:11,UINT32ARRAY:12,FLOAT32ARRAY:13,FLOAT64ARRAY:14,ARRAYBUFFER:15,BLOB:16,FILE:16,BUFFER:17},S=[null,null,"Uint16","Float64","Uint8",null,null,"Int8","Int16","Int32","Uint8","Uint16","Uint32","Float32","Float64","Uint8","Uint8","Uint8"],C=function(e,t){var n,i,r,o=0,s=e.getUint8(t,!1);t+=v,s!==_.ARRAY&&s!==_.OBJECT||(l=e.getUint16(t,!1),t+=y),n=e.getUint32(t,!1),t+=b;var a,c,d=S[s],u=null===d?0:g[d+"Array"].BYTES_PER_ELEMENT;switch(s){case _.NULL:case _.UNDEFINED:0,i=null;break;case _.STRING:for(var l=n/u,p=[],o=0;o<l;o++){var f=e.getUint16(t,!1);t+=u,p.push(String.fromCharCode(f))}i=p.join("");break;case _.NUMBER:i=e.getFloat64(t,!1),t+=u;break;case _.BOOLEAN:i=1===e.getUint8(t,!1),t+=u;break;case _.INT8ARRAY:case _.INT16ARRAY:case _.INT32ARRAY:case _.UINT8ARRAY:case _.UINT16ARRAY:case _.UINT32ARRAY:case _.FLOAT32ARRAY:case _.FLOAT64ARRAY:case _.ARRAYBUFFER:r=e.buffer.slice(t,t+n),t+=n,i=s===_.ARRAYBUFFER?r:new g[d+"Array"](r);break;case _.BLOB:0,i=g.Blob?(a=C(e,t),t=(c=C(e,a.cursor)).cursor,new Blob([c.value],{type:a.value})):(r=e.buffer.slice(t,t+n),t+=n,new w(r));break;case _.ARRAY:for(0,i=[],o=0;o<l;o++)t=(r=C(e,t)).cursor,i.push(r.value);break;case _.OBJECT:for(0,i={},o=0;o<l;o++){var h=C(e,t),m=C(e,h.cursor);t=m.cursor,i[h.value]=m.value}break;default:throw"TypeError: Type not supported."}return{value:i,cursor:t}},d=function(n,i){var r=v+b,e=0,o=0,t=n,s=function(e){var t=void 0;if(void 0===e)t=_.UNDEFINED;else if(null===e)t=_.NULL;else{var n=e.constructor.name;if(void 0!==n)t=_[n.toUpperCase()];else switch(typeof e){case"string":t=_.STRING;break;case"number":t=_.NUMBER;break;case"boolean":t=_.BOOLEAN;break;case"object":e instanceof Array?t=_.ARRAY:e instanceof Int8Array?t=_.INT8ARRAY:e instanceof Int16Array?t=_.INT16ARRAY:e instanceof Int32Array?t=_.INT32ARRAY:e instanceof Uint8Array?t=_.UINT8ARRAY:e instanceof Uint16Array?t=_.UINT16ARRAY:e instanceof Uint32Array?t=_.UINT32ARRAY:e instanceof Float32Array?t=_.FLOAT32ARRAY:e instanceof Float64Array?t=_.FLOAT64ARRAY:e instanceof ArrayBuffer?t=_.ARRAYBUFFER:e instanceof Blob?t=_.BLOB:e instanceof w?t=_.BUFFER:e instanceof Object&&(t=_.OBJECT)}}return t}(n),a=null==S[s]?0:g[S[s]+"Array"].BYTES_PER_ELEMENT;switch(s){case _.UNDEFINED:case _.NULL:break;case _.NUMBER:case _.BOOLEAN:e=a;break;case _.STRING:e+=(o=n.length)*a;break;case _.INT8ARRAY:case _.INT16ARRAY:case _.INT32ARRAY:case _.UINT8ARRAY:case _.UINT16ARRAY:case _.UINT32ARRAY:case _.FLOAT32ARRAY:case _.FLOAT64ARRAY:e+=(o=n.length)*a;break;case _.ARRAY:return void p(n,function(e,t){i([{type:s,length:n.length,header_size:r+y,byte_length:t,value:null}].concat(e))});case _.OBJECT:var c,d=[];for(c in n)n.hasOwnProperty(c)&&(d.push(c),d.push(n[c]),o++);return void p(d,function(e,t){i([{type:s,length:o,header_size:r+y,byte_length:t,value:null}].concat(e))});case _.ARRAYBUFFER:e+=n.byteLength;break;case _.BLOB:var u=n.type,l=new FileReader;return l.onload=function(e){p([u,e.target.result],function(e,t){i([{type:s,length:o,header_size:r,byte_length:t,value:null}].concat(e))})},l.onerror=function(e){throw"FileReader Error: "+e},void l.readAsArrayBuffer(n);case _.BUFFER:e+=n.length;break;default:throw'TypeError: Type "'+n.constructor.name+'" not supported.'}i([{type:s,length:o,header_size:r,byte_length:e,value:t}].concat([]))},e={pack:function(e,t){try{0,d(e,function(e){t(n(e))})}catch(e){throw e}},unpack:function(e,t){try{0;var n=i(e);0,t(n)}catch(e){throw e}}},void 0!==r&&r.exports?r.exports=e:g.binarize=e}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer)},{buffer:39}],6:[function(e,t,n){"use strict";var r=e("./Log");e("./Utils");function i(){this.channels={}}i.prototype.add=function(e,t,n,i){e in this.channels||(this.channels[e]={}),t in this.channels[e]||(this.channels[e][t]={}),this.channels[e][t][n]=i},i.prototype.removeChannel=function(e,t,n,i){this.channels[e]&&t in this.channels[e]&&this.channels[e][t]&&n in this.channels[e][t]&&(delete this.channels[e][t][n],r("[Channels Manager] Data Channel '"+n+"' has been removed from "+t+"-"+e),Object.keys(this.channels[e][t]).length||(delete this.channels[e][t],r("[Channels Manager] Reference "+t+"-"+e+" removed from Data Channels list")))},i.prototype.exists=function(e,t){return this.channels[e]&&t in this.channels[e]},i.prototype.get=function(e,t){return this.channels[e][t]},i.prototype.forEachRoom=function(e){for(var t in this.channels)e(t)},i.prototype.forEachPeer=function(e,t){if(this.channels[e])for(var n in this.channels[e])t(n,this.channels[e][n])},i.prototype.close=function(e,t){for(var n in this.channels[e][t])this.channels[e][t][n].close(),r("[Channels Manager] Data Channel '"+n+"' with reference "+t+"-"+e+" has been locally closed");this.channels[e][t][n].onClose(),this.channels[e]&&t in this.channels[e]&&(delete this.channels[e][t],r("[Channels Manager] Reference "+t+"-"+e+" removed from Data Channels list"))},t.exports=i},{"./Log":15,"./Utils":34}],7:[function(e,t,n){"use strict";e("./Log");var i=e("./Utils");function f(e,t){this.username=e,this.credential=t,this.urls=[]}function r(){this.VERSION="3.5.8",this.API_SERVER="https://signaling.bistri.com",this.DEBUG=!1,this.AUTO_CALL=!0,this.FORCE_TURN=!1,this.TCP_ONLY=!1,this.TURN_SERVERS=[],this.STUN_SERVERS=[],this.PLUGIN_URL=void 0,this.CHROME_EXT_ID=void 0,this.FIREFOX_EXT_ID=void 0,this.EXT_AUTO_RELOAD=!0,this.AUTO_RECONNECT=!1,this.STATS_INTERVAL=4,this.USER_ID=void 0,this.localTurnServers=!1,this.localStunServers=!1}r.prototype={set:function(e){var d=i.isChrome(),u=i.isFirefox(),t=i.isEdgeORTC(),l=i.getBrowser().version,p=t?["udp"]:["udp","tcp"];e.hasOwnProperty("debug")&&(this.DEBUG=e.debug),e.hasOwnProperty("autoAcceptCall")&&(this.AUTO_CALL=e.autoAcceptCall),e.apiServer&&(this.API_SERVER=e.apiServer),e.userId&&(this.USER_ID=e.userId),e.chromeExtId&&(this.CHROME_EXT_ID=e.chromeExtId),e.firefoxExtId&&(this.FIREFOX_EXT_ID=e.firefoxExtId),e.hasOwnProperty("forceTURN")&&(this.FORCE_TURN=e.forceTURN),e.hasOwnProperty("tcpOnly")&&(this.TCP_ONLY=e.tcpOnly),e.hasOwnProperty("extAutoReload")&&(this.EXT_AUTO_RELOAD=e.extAutoReload),e.hasOwnProperty("autoReconnect")&&(this.AUTO_RECONNECT=e.autoReconnect),e.hasOwnProperty("statsInterval")&&(this.STATS_INTERVAL=e.statsInterval),e.turn&&!this.localTurnServers&&(this.TURN_SERVERS=[],e.turn.forEach(function(e){for(var t=e.url.split("@"),n=t[0],i=t[1],r=e.credential,o=d&&38<=l||u&&53<=l?"turns:":"turn:",s=null,a=0;a<this.TURN_SERVERS.length;a++){var c=this.TURN_SERVERS[a];c.username==n&&c.credential==r&&(s=c)}s||(s=new f(n,r),this.TURN_SERVERS.push(s)),p.forEach(function(e){s.urls.push(o+i+"?transport="+e)})}.bind(this))),e.stun&&!this.localStunServers&&(this.STUN_SERVERS=[{urls:[]}],e.stun.forEach(function(e){this.STUN_SERVERS[0].urls.push("stun:"+e)}.bind(this))),e.turnServers&&e.turnServers.length&&(this.localTurnServers=!0,this.TURN_SERVERS=e.turnServers),e.stunServers&&e.stunServers.length&&(this.localStunServers=!0,this.STUN_SERVERS=e.stunServers)}},t.exports=new r},{"./Log":15,"./Utils":34}],8:[function(e,t,n){"use strict";function i(e,t,n){this.name=e,this.size=t,this.type=n,this.buffer=[],this.totalChunksSize=0}i.prototype={onFileReady:function(){},onFileComplete:function(){},start:function(){this.onFileReady()},append:function(e){this.buffer[e.id]=e.chunk,this.totalChunksSize+=e.chunk.byteLength||e.chunk.size,this.totalChunksSize==this.size&&(e=new window.Blob(this.buffer,{type:this.type}),this.buffer=null,this.onFileComplete(URL.createObjectURL(e)))}},t.exports=i},{}],9:[function(e,t,n){"use strict";var o=e("./Log"),s=e("./PubSub");function i(e,t,n){var i=e.label,r="[Data Channel "+n+"-"+t+"-"+i+"] ";e.onopen=function(){o(r+"On Open"),this.onOpen.apply(this,arguments),s.publish("_onDataChannelOpened",t,n,i)}.bind(this),e.onclose=function(){o(r+"On Close"),this.onClose.apply(this,arguments),s.publish("_onDataChannelClosed",t,n,i)}.bind(this),e.onmessage=function(e){o(r+"On Message",e),this.onMessage.apply(this,arguments)}.bind(this),e.onerror=function(e){o(r+"On Error",e),this.onError.apply(this,arguments),s.publish("_onDataChannelError",t,n,i)}.bind(this),this.label=e.label,this.onOpen=function(){},this.onClose=function(){},this.onMessage=function(){},this.onError=function(){},this._channel=e}i.prototype={send:function(){this._channel.send.apply(this._channel,arguments)},close:function(){this._channel.close.apply(this._channel,arguments)}},t.exports=i},{"./Log":15,"./PubSub":24}],10:[function(e,t,n){"use strict";var i=e("./Log"),r=e("./PubSub");function o(){}o.prototype={bind:function(e,t){return/^on/.test(e)||(e="on"+e.charAt(0).toUpperCase()+e.slice(1)),-1!=this._events.indexOf(e)?"function"!=typeof t?(i("[DataChannels] Handler is not a function"),null):r.subscribe(e,t.bind(this)):(i("[DataChannels] Unknown event: "+e),null)},unbind:function(e){return"string"!=typeof e||/^on/.test(e)||(e="on"+e.charAt(0).toUpperCase()+e.slice(1)),r.unsubscribe(e)},addHandler:function(e,t){this.bind.apply(this,arguments)},removeHandler:function(){this.unbind.apply(this,arguments)},_events:["onDataChannelCreated","onDataChannelRequested"]},t.exports=new o},{"./Log":15,"./PubSub":24}],11:[function(e,t,n){"use strict";var i=e("./Log"),r=e("./PubSub");function o(){}o.prototype={bind:function(e,t){return/^on/.test(e)||(e="on"+e.charAt(0).toUpperCase()+e.slice(1)),-1!=this._events.indexOf(e)?"function"!=typeof t?(i("[FileTransfer] Handler is not a function"),null):r.subscribe(e,t.bind(this)):(i("[FileTransfer] Unknown event: "+e),null)},unbind:function(e){return"string"!=typeof e||/^on/.test(e)||(e="on"+e.charAt(0).toUpperCase()+e.slice(1)),r.unsubscribe(e)},addHandler:function(e,t){this.bind.apply(this,arguments)},removeHandler:function(){this.unbind.apply(this,arguments)},_events:["onFileSent","onFileReceived","onFileTransferProgress","onFileTransferBitrate","onFileTransferWaiting","onFileTransferAborted","onNewFileTransfer"]},t.exports=new o},{"./Log":15,"./PubSub":24}],12:[function(e,t,n){"use strict";var u=e("./Log"),l=e("./PubSub"),p=e("./TransferManager");t.exports=function(t,n,i,r,e,o,s,a){var c=new p(e,o,r,s),d="[Send File "+r+"-"+n+"-"+i+"] ";c.onEmit=function(e){t.send(e)},c.onEnd=function(e){t.close()},t.onmessage=function(e){c.onReceive(e)},t.onopen=function(){u(d+"On Open"),a&&c.sendFile(),l.publish("_onFileTransferOpened",n,r,i)},t.onclose=function(){u(d+"On Close"),c.onClose(),l.publish("_onFileTransferClosed",n,r,i)},t.onerror=function(e){u(d+"On Error",e),c.onError(),l.publish("_onFileTransferError",n,r,i)}}},{"./Log":15,"./PubSub":24,"./TransferManager":32}],13:[function(e,t,n){"use strict";e=e("./MD5");function i(t,n){var i=[];return t instanceof Array?t.forEach(function(e){i.push(n(e))}):t instanceof Object&&Object.keys(t).forEach(function(e){i.push(n(t[e]))}),i}t.exports=e([navigator.userAgent,[screen.height,screen.width,screen.colorDepth].join("x"),(new Date).getTimezoneOffset(),i(navigator.plugins,function(e){return[e.name,e.description,i(e,function(e){return[e.type,e.suffixes].join("~")}).join(",")].join("::")}).join(";")].join("###"))},{"./MD5":16}],14:[function(e,t,n){"use strict";var o=e("./Log"),s=e("./Ajax"),a=e("./Config"),s=e("./PubSub"),c=e("./Utils"),d={},u=!1,l=!1;c.isChrome()&&window.addEventListener("message",function(e){var t;e.origin!=window.location.origin||(t=e.data).answer&&((e=d[t.requestId])?"completed"===t.state&&(t.streamId?(e.constraints.video.mandatory.chromeMediaSourceId=t.streamId,navigator.mediaDevices.getUserMedia(e.constraints).then(e.onSuccess).catch(e.onError)):e.onError({code:1,text:"action canceled by the user"}),delete d[t.requestId]):o("[GetScreenSharing] Cached data related to request id '"+t.requestId+"' not found"))}),t.exports=function(e,t,n){var i,r=c.getBrowser();if("https:"!=window.location.protocol)throw new Error("The screen-sharing feature is not allowed on non-secured connection. SSL is required by the browser.");c.isChrome()?a.CHROME_EXT_ID?34<=r.version&&(!(!document.querySelector("#bistri-screen-sharing-installed")&&!document.querySelector("#extension-is-installed-"+a.CHROME_EXT_ID))?(o("[GetScreenSharing] ScreenSharing Extension is installed"),i=Math.random().toString().substr(2),d[i]={constraints:e,onSuccess:t,onError:n},window.postMessage({requestId:i,action:"screen-sharing",data:["screen","window"]},"*")):(o("[GetScreenSharing] ScreenSharing Extension is required"),chrome.webstore?u||(u=!0,chrome.webstore.onInstallStageChanged.addListener(function(e){"downloading"!=e||l||(o("[GetScreenSharing] ScreenSharing Extension installation has started"),l=!0,s.publish("onExtensionInstallStarted"))}),chrome.webstore.install("https://chrome.google.com/webstore/detail/"+a.CHROME_EXT_ID,function(){setTimeout(function(){o("[GetScreenSharing] ScreenSharing Extension has been installed"),s.publish("onExtensionInstalled"),a.EXT_AUTO_RELOAD&&window.location.reload()},2e3)},function(e){o("[GetScreenSharing] ScreenSharing Extension installation has failed",e),s.publish("onExtensionInstallFailed",e),"function"==typeof n&&n(e)})):(n(),window.open("https://chrome.google.com/webstore/detail/"+a.CHROME_EXT_ID)))):o("[GetScreenSharing] No Chrome ScreenSharing Extension ID configured !"):c.isFirefox()?!a.FIREFOX_EXT_ID&&r.version<52?o("[GetScreenSharing] No Firefox ScreenSharing Extension ID configured !"):33<=r.version&&(!(!document.querySelector("#bistri-screen-sharing-installed")&&!document.querySelector("#extension-is-installed"))||52<=r.version?navigator.mediaDevices.getUserMedia(e).then(t).catch(n):InstallTrigger.install({bistriScreenSharing:{URL:"https://addons.mozilla.org/firefox/downloads/latest/"+a.FIREFOX_EXT_ID+"/addon-"+a.FIREFOX_EXT_ID+"-latest.xpi",toString:function(){return this.URL}}})):n("The screen sharing feature is not supported by your browser")}},{"./Ajax":3,"./Config":7,"./Log":15,"./PubSub":24,"./Utils":34}],15:[function(e,t,n){"use strict";var i=e("./Config");function r(e,t){return t=t||2,String(Array(t).join(0)+e).slice(-t)}t.exports=function(){var e,t;console&&console.log&&i.DEBUG&&(e=r((t=new Date).getMonth()+1)+"/"+r(t.getDate())+"/"+r(t.getFullYear()),t=r(t.getUTCHours())+":"+r(t.getUTCMinutes())+":"+r(t.getUTCSeconds())+"."+r(t.getUTCMilliseconds(),3),Array.prototype.unshift.call(arguments,"%s %s -",e,t),console.log.apply(console,arguments))}},{"./Config":7}],16:[function(e,t,n){function o(e,t){var n=s(n=e[0],o=e[1],r=e[2],i=e[3],t[0],7,-680876936),i=s(i,n,o,r,t[1],12,-389564586),r=s(r,i,n,o,t[2],17,606105819),o=s(o,r,i,n,t[3],22,-1044525330);n=s(n,o,r,i,t[4],7,-176418897),i=s(i,n,o,r,t[5],12,1200080426),r=s(r,i,n,o,t[6],17,-1473231341),o=s(o,r,i,n,t[7],22,-45705983),n=s(n,o,r,i,t[8],7,1770035416),i=s(i,n,o,r,t[9],12,-1958414417),r=s(r,i,n,o,t[10],17,-42063),o=s(o,r,i,n,t[11],22,-1990404162),n=s(n,o,r,i,t[12],7,1804603682),i=s(i,n,o,r,t[13],12,-40341101),r=s(r,i,n,o,t[14],17,-1502002290),n=c(n,o=s(o,r,i,n,t[15],22,1236535329),r,i,t[1],5,-165796510),i=c(i,n,o,r,t[6],9,-1069501632),r=c(r,i,n,o,t[11],14,643717713),o=c(o,r,i,n,t[0],20,-373897302),n=c(n,o,r,i,t[5],5,-701558691),i=c(i,n,o,r,t[10],9,38016083),r=c(r,i,n,o,t[15],14,-660478335),o=c(o,r,i,n,t[4],20,-405537848),n=c(n,o,r,i,t[9],5,568446438),i=c(i,n,o,r,t[14],9,-1019803690),r=c(r,i,n,o,t[3],14,-187363961),o=c(o,r,i,n,t[8],20,1163531501),n=c(n,o,r,i,t[13],5,-1444681467),i=c(i,n,o,r,t[2],9,-51403784),r=c(r,i,n,o,t[7],14,1735328473),n=d(n,o=c(o,r,i,n,t[12],20,-1926607734),r,i,t[5],4,-378558),i=d(i,n,o,r,t[8],11,-2022574463),r=d(r,i,n,o,t[11],16,1839030562),o=d(o,r,i,n,t[14],23,-35309556),n=d(n,o,r,i,t[1],4,-1530992060),i=d(i,n,o,r,t[4],11,1272893353),r=d(r,i,n,o,t[7],16,-155497632),o=d(o,r,i,n,t[10],23,-1094730640),n=d(n,o,r,i,t[13],4,681279174),i=d(i,n,o,r,t[0],11,-358537222),r=d(r,i,n,o,t[3],16,-722521979),o=d(o,r,i,n,t[6],23,76029189),n=d(n,o,r,i,t[9],4,-640364487),i=d(i,n,o,r,t[12],11,-421815835),r=d(r,i,n,o,t[15],16,530742520),n=u(n,o=d(o,r,i,n,t[2],23,-995338651),r,i,t[0],6,-198630844),i=u(i,n,o,r,t[7],10,1126891415),r=u(r,i,n,o,t[14],15,-1416354905),o=u(o,r,i,n,t[5],21,-57434055),n=u(n,o,r,i,t[12],6,1700485571),i=u(i,n,o,r,t[3],10,-1894986606),r=u(r,i,n,o,t[10],15,-1051523),o=u(o,r,i,n,t[1],21,-2054922799),n=u(n,o,r,i,t[8],6,1873313359),i=u(i,n,o,r,t[15],10,-30611744),r=u(r,i,n,o,t[6],15,-1560198380),o=u(o,r,i,n,t[13],21,1309151649),n=u(n,o,r,i,t[4],6,-145523070),i=u(i,n,o,r,t[11],10,-1120210379),r=u(r,i,n,o,t[2],15,718787259),o=u(o,r,i,n,t[9],21,-343485551),e[0]=p(n,e[0]),e[1]=p(o,e[1]),e[2]=p(r,e[2]),e[3]=p(i,e[3])}function a(e,t,n,i,r,o){return t=p(p(t,e),p(i,o)),p(t<<r|t>>>32-r,n)}function s(e,t,n,i,r,o,s){return a(t&n|~t&i,e,t,r,o,s)}function c(e,t,n,i,r,o,s){return a(t&i|n&~i,e,t,r,o,s)}function d(e,t,n,i,r,o,s){return a(t^n^i,e,t,r,o,s)}function u(e,t,n,i,r,o,s){return a(n^(t|~i),e,t,r,o,s)}function i(e){/[\x80-\xFF]/.test(e)&&(e=unescape(encodeURI(e))),txt="";for(var t=e.length,n=[1732584193,-271733879,-1732584194,271733878],i=64;i<=e.length;i+=64)o(n,function(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}(e.substring(i-64,i)));e=e.substring(i-64);var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(i=0;i<e.length;i++)r[i>>2]|=e.charCodeAt(i)<<(i%4<<3);if(r[i>>2]|=128<<(i%4<<3),55<i)for(o(n,r),i=0;i<16;i++)r[i]=0;return r[14]=8*t,o(n,r),n}var r="0123456789abcdef".split("");function l(e){for(var t=0;t<e.length;t++)e[t]=function(e){for(var t="",n=0;n<4;n++)t+=r[e>>8*n+4&15]+r[e>>8*n&15];return t}(e[t]);return e.join("")}function p(e,t){return e+t&4294967295}md5=function(e){return l(i(e))};{function p(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}md5("hello")}t.exports=md5},{}],17:[function(e,t,n){"use strict";var i=e("./PubSub"),s=e("./MeanOpinionScoreUtils");function r(){this.remoteMedia={}}r.prototype.add=function(e,t,n,i){var r=t+n;"function"==typeof i&&(r in this.remoteMedia||(this.remoteMedia[r]={node:e,pid:t,room:n,stats:[],fn:i}))};new Array(0);r.prototype.remove=function(e,t){t=e+t;t in this.remoteMedia&&delete this.remoteMedia[t]},r.prototype.processStats=function(e,t,n){var i=t+n;if(i in this.remoteMedia&&(this.remoteMedia[i].stats.push(e),!(this.remoteMedia[i].stats.length<2))){for(;2<this.remoteMedia[i].stats.length;)this.remoteMedia[i].stats.shift();var r=this.remoteMedia[i].stats,o={width:this.remoteMedia[i].node.videoWidth,height:this.remoteMedia[i].node.videoHeight},e=s.calculateVideoScore(o,(e=r)[e.length-1].recv.video[Object.keys(e[e.length-1].recv.video)[0]],(o=r)[o.length-2].recv.video[Object.keys(o[o.length-2].recv.video)[0]]),r=s.calculateAudioScore((o=r)[o.length-1].recv.audio[Object.keys(o[o.length-1].recv.audio)[0]],(r=r)[r.length-2].recv.audio[Object.keys(r[r.length-2].recv.audio)[0]]);this.remoteMedia[i].fn(Math.min(r,e),t,n)}};var o=new r;i.subscribe("onStreamStatsUpdated",function(e,t,n){o.processStats(e,t,n)}),i.subscribe("onStreamRemoved",function(e,t){o.remove(t,e.room)}),i.subscribe("onStreamClosed",function(e,t){o.remove(t,e.room)}),t.exports=o},{"./MeanOpinionScoreUtils":18,"./PubSub":24}],18:[function(e,t,n){"use strict";e("./Log"),e("./PubSub");t.exports={calculateAudioScore:function(e,t){var n;return 0==(n=e.packetsLost-t.packetsLost+(e.packetsReceived-t.packetsReceived))?0:(n=function(e,t){e+=20;return 94.2-(.024*e+.11*(e-177.3)*(e-177.3<0?0:1))-(0+19.8*Math.log(1+29.7*t))}(0,n=n=(e.packetsLost-t.packetsLost)/n))<0?1:100<n?4.5:1+.035*n+71e-7*n*(n-60)*(100-n)},calculateVideoScore:function(e,t,n){var i=t.timestamp-n.timestamp,i=8*(t.bytesReceived-n.bytesReceived)/(i/1e3),e=(e=e=e.width*e.height,e=2.069924867*Math.pow(Math.log10(e),.6250223771),Math.pow(10,e));return i<3e4?0:(i=Math.min(i,e),Math.log(i/3e4)/Math.log(e/3e4)*4+1)}}},{"./Log":15,"./PubSub":24}],19:[function(e,t,n){"use strict";var l=e("./Log"),p=e("./Utils"),f=e("./PubSub"),i=e("./PeersManager"),r=e("./ChannelsManager"),h=e("./DataChannelWrapper"),m=e("./FileTransferWrapper"),g=e("./PeerConnection"),v=e("./AudioActivityMonitor");function y(e){return e||"unnamed"}function o(e){return e}function s(){this.peerConns=new i,this.dataChannels=new r,this.fileTransfers=new r,this.waitingFiles={},f.subscribe("_onDataChannelClosed",this._onDataChannelClosed.bind(this)),f.subscribe("_onDataChannelError",this._onDataChannelClosed.bind(this)),f.subscribe("_onFileTransferClosed",this._onFileTransferClosed.bind(this)),f.subscribe("_onFileTransferError",this._onFileTransferClosed.bind(this)),f.subscribe("_onFileWaitingTransfer",this._onFileTransferWaiting.bind(this))}s.prototype={createPeer:function(e,t,n,i,r,o,s){var a=y(t),c=e,d=new g(s,i,n,r||{},o,c,a),u="call_"+c+"_"+t+"_"+(new Date).getTime();return d.onAddStream=function(e){e.room=a,f.publish("onStreamAdded",e,c),n&&f.publish("_onCallStart",{pid:c,room:a,callId:u,browsers:p.getCallClientsId(i),type:"call:"+this._getCallType(d.getLocalTracks())+"|"+this._getCallType(d.getRemoteTracks())})}.bind(this),d.onUpdateStream=function(e,t){e.room=a,f.publish("onStreamUpdated",e,c)}.bind(this),d.onCloseStream=function(e){e.room=a;var t=e.getAudioTracks();t.length&&t.forEach(function(e){v.remove(e)}),f.publish("onStreamClosed",e,c),n&&f.publish("_onCallStop",{pid:c,room:a,callId:u,browsers:p.getCallClientsId(i),type:"call:"+this._getCallType(d.getLocalTracks())+"|"+this._getCallType(d.getRemoteTracks())})}.bind(this),d.onAddTrack=function(e,t){t.room=a,f.publish("onTrackAdded",e,t,c)}.bind(this),d.onRemoveTrack=function(e,t){t.room=a,f.publish("onTrackRemoved",e,t,c)}.bind(this),d.onStatsUpdated=function(e){f.publish("onStreamStatsUpdated",e,c,a)}.bind(this),d.onFailed=function(e,t){f.publish("onCallFailed",a,c,e.message,t,d.remoteClient),n&&f.publish("_onCallFail",{pid:c,room:a,callId:u,browsers:p.getCallClientsId(i),type:"call",message:e.message})}.bind(this),d.onClosePeer=function(){l("[Peers Manager] Clear peer "+c+" for room "+a),f.publish("onCallEnded",c,a),this._clearPeer(c,a)}.bind(this),d.onDataChannel=function(e){var t,n=e.channel.label;0==n.indexOf("__file_transfert_")?(t=this.waitingFiles[n])&&(t=new m(e.channel,a,n,c,t.id,o.group,t,!1),this.fileTransfers.add(a,c,n,t),delete this.waitingFiles[n]):(e=new h(e.channel,a,c),this.dataChannels.add(a,c,n,e),f.publish("onDataChannelRequested",e,c),f.publish("_onDataChannelStart",{pid:c,room:a,callId:u,browsers:p.getCallClientsId(i),type:"datachannel"}))}.bind(this),this.peerConns.add(a,c,d),d},closePeer:function(e,t,n){t=y(t);this.dataChannels.exists(t,e)&&this.dataChannels.close(t,e);var i=this.peerConns.get(t,e);i&&setTimeout(function(){i.close()},300)},closeAllPeers:function(e){var t=y(e);this.peerConns.forEachPeer(t,function(e){this.closePeer(e,t)}.bind(this))},createDataChannel:function(e,t,n,i,r){n=y(n);this.peerConns.exists(n,e)&&(i=this.peerConns.get(n,e).addDataChannel(t,i),(i=new h(i,n,e))&&(this.dataChannels.add(n,e,t,i),f.publish("onDataChannelCreated",i,e)))},createFileTransfer:function(e,t,n,i,r,o){var s=y(n),n=e;this.peerConns.exists(s,n)&&(e=this.peerConns.get(s,n).addDataChannel(t,{ordered:!1,binaryType:"arraybuffer"}),(r=new m(e,s,t,n,i,o.group,r,!0))&&this.fileTransfers.add(s,n,t,r))},getDataChannels:function(t){var n={};return this.dataChannels.forEachRoom(function(e){t&&e!=t||this.dataChannels.forEachPeer(e,function(e,t){n[e]=t})}.bind(this)),n},getFileTransferts:function(t){var n={};return this.fileTransfers.forEachRoom(function(e){t&&e!=t||this.fileTransfers.forEachPeer(e,function(e,t){n[e]=t})}.bind(this)),n},addStream:function(n,e,i){e=y(e);this.peerConns.exists(e,n)&&i&&this.peerConns.forEachPeer(e,function(e,t){n&&e!=n||t.addStream(i)}.bind(this))},removeStream:function(n,e,i){e=y(e);this.peerConns.exists(e,n)&&i&&this.peerConns.forEachPeer(e,function(e,t){n&&e!=n||t.removeStream(i)}.bind(this))},updateStream:function(n,e,i){e=y(e);this.peerConns.exists(e,n)&&i&&this.peerConns.forEachPeer(e,function(e,t){n&&e!=n||t.updateStream(i)}.bind(this))},copyStream:function(n,e,i,r){e=y(e);this.peerConns.exists(e,n)&&i&&r&&this.peerConns.forEachPeer(e,function(e,t){n&&e!=n||t.copyStream(i,r)}.bind(this))},updateBitrate:function(n,e,i,r){e=y(e);this.peerConns.exists(e,n)&&i&&this.peerConns.forEachPeer(e,function(e,t){n&&e!=n||t.updateBitrate(i,r)}.bind(this))},updateCodec:function(n,e,i,r){e=y(e);this.peerConns.exists(e,n)&&i&&this.peerConns.forEachPeer(e,function(e,t){n&&e!=n||t.updateCodec(i,r)}.bind(this))},addTrack:function(n,e,i,r){e=y(e);this.peerConns.exists(e,n)&&i&&this.peerConns.forEachPeer(e,function(e,t){n&&e!=n||t.addTrack(i,r)}.bind(this))},removeTrack:function(n,e,i){e=y(e);this.peerConns.exists(e,n)&&i&&this.peerConns.forEachPeer(e,function(e,t){n&&e!=n||t.removeTrack(i)}.bind(this))},replaceTrack:function(n,e,i,r){e=y(e);this.peerConns.exists(e,n)&&i&&r&&this.peerConns.forEachPeer(e,function(e,t){n&&e!=n||t.replaceTrack(i,r)}.bind(this))},setSignal:function(e,t,n){t=y(t),e=o(e,n.extra),e=this.peerConns.get(t,e);e&&e.signalingChannel.onReceive(n)},isCaller:function(e,t){t=y(t);return this.peerConns.get(t,e).isCaller},getPeersId:function(e){var e=y(e),n=[];return this.peerConns.forEachPeer(e,function(e,t){n.push(e)}.bind(this)),n},getPeer:function(e,t,n,i){var r=y(t),t=e;if(!this.peerConns.exists(r,t))return null;e=this.peerConns.get(r,t);return e&&e.pc&&"failed"===e.pc.connectionState&&(e.close(),e=null),e||this.dataChannels.exists(r,t)&&this.dataChannels.close(r,t),e&&n&&e.setOptions(n),e},getRemoteStreams:function(t){var e,n={};for(e in this.peerConns.forEachRoom(function(e){t&&e!=t||this.peerConns.forEachPeer(e,function(e,t){t=t.getRemoteStreams();n.hasOwnProperty(e)||(n[e]=[]),n[e]=n[e].concat(t)})}.bind(this)),n)1==n[e].length&&(n[e]=n[e][0]);return n},getRemoteTracks:function(t){var n={};return this.peerConns.forEachRoom(function(e){t&&e!=t||this.peerConns.forEachPeer(e,function(e,t){t=t.getRemoteTracks();n.hasOwnProperty(e)||(n[e]=[]),n[e]=n[e].concat(t)})}.bind(this)),n},getLocalTracks:function(t){var n={};return this.peerConns.forEachRoom(function(e){t&&e!=t||this.peerConns.forEachPeer(e,function(e,t){t=t.getLocalTracks();n.hasOwnProperty(e)||(n[e]=[]),n[e]=n[e].concat(t)})}.bind(this)),n},_clearPeer:function(e,t){var n=y(t);this.peerConns.removePeer(n,e),this._clearRoom(t)},_clearRoom:function(e){e=y(e);this.peerConns.removeRoom(e)},_onDataChannelClosed:function(e,t,n){this.dataChannels.removeChannel(e,t,n,"dataChannels")},_onFileTransferClosed:function(e,t,n){this.fileTransfers.removeChannel(e,t,n,"fileTransfers")},_onFileTransferWaiting:function(e,t){this.waitingFiles[e]=t},_getCallType:function(e){var t="";return e.forEach(function(e){e&&(t&&(t+="&"),"video"==e.kind?t+="video":"audio"==e.kind?t+="audio":t+="unknown")}),t}},t.exports=new s},{"./AudioActivityMonitor":4,"./ChannelsManager":6,"./DataChannelWrapper":9,"./FileTransferWrapper":12,"./Log":15,"./PeerConnection":22,"./PeersManager":23,"./PubSub":24,"./Utils":34}],20:[function(e,t,n){"use strict";var r=e("./Log");function i(e){this.events=[],this.index=0,this.offset=0,this.file=e,this.state=!0,this.buffer=[],this.chunkSize=15e3,this.bufferHigh=5e7,this.bufferLow=5e6,this.bufferSize=0,this.slicesNb=Math.ceil(e.size/this.chunkSize),this.flag=!0,this.done=!1,this.stopped=!1,this._slice()}i.prototype={_slice:function(){var n=this.slicesNb,i=function(){var e,t=new window.FileReader;t.addEventListener("load",function(e){2==e.target.readyState&&(this.buffer["slice_"+this.index]={id:this.index,chunk:e.target.result},this.bufferSize+=e.target.result.byteLength,this.offset+e.target.result.byteLength<this.file.size?(this.index+=1,this.offset+=this.chunkSize,this.bufferSize<this.bufferHigh?i():(this.stopped=!0,r("[PacketsMaker] Buffer high level warning"))):(this.done=!0,r("[PacketsMaker] Slice operation finished")),this.flag&&(this.bufferSize>=this.bufferHigh||this.done)&&(this.flag=!1,this.events.buffered({fileName:this.file.name,fileSize:this.file.size,fileType:this.file.type,chunksNb:n})))}.bind(this)),t.addEventListener("error",function(e){this.buffer=[],r("Error reading file:",e)}.bind(this)),t.addEventListener("abort",function(e){this.buffer=[],r("File reading aborted:",e)}.bind(this)),e=this.file.slice(this.offset,this.offset+this.chunkSize),t.readAsArrayBuffer(e)}.bind(this);this.stopped=!1,i()},on:function(e,t){this.events[e]=t},removePacket:function(e){this.buffer["slice_"+e]?(this.bufferSize-=this.buffer["slice_"+e].chunk.byteLength,delete this.buffer["slice_"+e],this.bufferSize<this.bufferLow&&!this.done&&this.stopped&&(r("[PacketsMaker] Buffer low level warning"),this._slice())):r("[PacketsMaker] Packet not found: ",e)},getPacket:function(e){return this.buffer["slice_"+e]},getPacketsNb:function(){return this.slicesNb}},t.exports=i},{"./Log":15}],21:[function(e,t,n){"use strict";var i=e("./Log"),r=e("./CreateFile");function o(){this._sysFile=null,this._index=0,this._timeout=5e3,this._requests={},this._maxRequest=5,this._maxThread=6,this._events=[],this._received=0,this._ttl_chunks=0}o.prototype={init:function(e){this._ttl_chunks=e.chunksNb,this._sysFile=new r(e.fileName,e.fileSize,e.fileType),this._sysFile.onFileReady=function(){for(var e=0;e<this._maxThread;e++)this._requestNext()}.bind(this),this._sysFile.onFileComplete=function(e,t,n){this._events.completed(e,t,n),this._events.end(),i("[PacketsRequester] File transfer completed: ",e,t,n)}.bind(this),this._sysFile.start()},on:function(e,t){this._events[e]=t},addPacket:function(e){var t=this._requests[e.id];t?(clearTimeout(t.timer),this._received+=e.chunk.byteLength||e.chunk.size,this._events.progress(),this._events.acknowledge(e.id),this._sysFile.append(e),delete this._requests[e.id],this._received!=this._size&&this._index<this._ttl_chunks&&this._requestNext()):i("[PacketsRequester] Unknown request id: ",e.id)},_requestNext:function(){var e=this._index;e>=this._ttl_chunks||(this._index++,this._events.next(e),this._requests[e]={timer:setTimeout(this._askAgain.bind(this),this._timeout,e),attempt:0})},_askAgain:function(e){var t=this._requests[e];t.attempt<=this._maxRequest?(i("[PacketsRequester] Ask packet again: ",e),this._events.resend(e),t.timer=setTimeout(this._askAgain.bind(this),this._timeout,e),t.attempt++):this._events.failed("[PacketsRequester] Transfer interrupted: too many retries")}},t.exports=o},{"./CreateFile":8,"./Log":15}],22:[function(e,t,n){"use strict";var i=e("./Log"),r=e("./Utils"),c=e("./Config"),o=e("./SdpUtils"),d=e("./StatsParser"),s="connecting",a="connected";function u(e,t,n,i,r,o,s){this.label=o+"-"+s,this.signalingChannel=e,this.isCaller=n,this.defaultStream=null,this.autoAttachStream=!0,this.sendOnly=!1,this.audioBitrate=!1,this.videoBitrate=!1,this.preferedAudioCodec=!1,this.preferedVideoCodec=!1,this.forceTurn=c.FORCE_TURN,this.tcpOnly=c.TCP_ONLY,this.mergeCandidates=!1,this.extra=r,this.tracksDesc=[],this.pc=null,this.remoteIceCandidates=[],this.isNegotiating=!0,this.remoteClient=t,this.remoteStreamsId=[],this.statsInterval=c.STATS_INTERVAL,this.statsParser=new d,this.trace=[],this.canRestart=!1,this.onAddStream=function(e){},this.onUpdateStream=function(e){},this.onCloseStream=function(e){},this.onAddTrack=function(e){},this.onRemoveTrack=function(e){},this.onConnectionState=function(e){this._log("Connection state changed to",e)},this.onIceConnectionState=function(e){this._log("Ice Connection state changed to",e)},this.onSignalingState=function(e){this._log("Signaling state changed to",e)},this.onStatsUpdated=function(e){this._log("Stats updated",e)},this.onClosePeer=function(e){},this.onFailed=function(e){this._log("On failed",e)},"sendonly"in i&&this.isCaller&&(this.sendOnly=i.sendonly,this._log("Option sendonly true")),"merge-candidates"in i&&(this.mergeCandidates=i["merge-candidates"],this._log("merge-candidates is set to "+this.mergeCandidates)),"audio-codec"in i&&(this.preferedAudioCodec=i["audio-codec"],this._log("audio-codec is set to "+this.preferedAudioCodec)),"video-codec"in i&&(this.preferedVideoCodec=i["video-codec"],this._log("video-codec is set to "+this.preferedVideoCodec)),"audio-bitrate"in i&&("NaN"!=Number(i["audio-bitrate"])?(this.audioBitrate=i["audio-bitrate"],this._log("audio-bitrate is set to "+this.audioBitrate+" kbs")):this._log("audio-bitrate must be an integer")),"video-bitrate"in i&&("NaN"!=Number(i["audio-bitrate"])?(this.videoBitrate=i["video-bitrate"],this._log("video-bitrate is set to "+this.videoBitrate+" kbs")):this._log("video-bitrate must be an integer")),"force-turn"in i&&("boolean"==typeof i["force-turn"]?(this.forceTurn=i["force-turn"],this._log("force-turn is set to "+this.forceTurn)):this._log("force-turn must be a boolean")),"tcp-only"in i&&("boolean"==typeof i["tcp-only"]?(this.tcpOnly=i["tcp-only"],this._log("tcp-only is set to "+this.tcpOnly)):this._log("tcp-only must be a boolean"));var a=this,i={sdpSemantics:"unified-plan",iceServers:c.TURN_SERVERS.concat(c.STUN_SERVERS),iceTransportPolicy:this.forceTurn?"relay":"all"};this.pc=new RTCPeerConnection(i,{optional:[]}),this.pc.onconnectionstatechange=function(e){if(a.pc)switch(a.onConnectionState(a.pc.connectionState),a.pc.connectionState){case"checking":case"disconnected":a._stopStatsPolling();break;case"connected":a._checkNegotiationSate(),a._startStatsPolling();break;case"failed":a._stopStatsPolling(),a._failed(new Error("Connection state changed to 'failed'")),a._iceRestart()}},this.pc.oniceconnectionstatechange=function(){a.pc&&(a.onIceConnectionState(a.pc.iceConnectionState),"completed"===a.pc.iceConnectionState&&a._checkNegotiationSate())},this.pc.onsignalingstatechange=function(){if(a.pc)switch(a.onSignalingState(a.pc.signalingState),a.pc.signalingState){case"stable":a._checkNegotiationSate();break;case"have-local-offer":case"have-remote-offer":break;case"closed":a._stopStatsPolling(),a._checkNegotiationSate(),a.onClosePeer()}},this.pc.onnegotiationneeded=function(){a._log("Negotiation needed"),a.isNegotiating||(a.negoTimer&&(clearTimeout(a.negoTimer),a.negoTimer=null),a.negoTimer=setTimeout(a._requestRenegotiation.bind(a),300))},this.mergeCandidates?this.pc.onicecandidate=function(e){e&&e.candidate||(a._log("Send ",{type:a.pc.localDescription.type,sdp:a.pc.localDescription.sdp}),a.signalingChannel.send({sd:a.pc.localDescription,extra:a.extra}))}:this.pc.onicecandidate=function(e){var t={candidate:null,extra:a.extra};if(!e||!e.candidate)return a._log("All Ice Candidates have been sent"),a.signalingChannel.send({eoc:1,extra:a.extra});t.candidate=JSON.parse(JSON.stringify(e.candidate)),-1==t.candidate.candidate.indexOf("a=candidate")&&(t.candidate.candidate=t.candidate.candidate.replace("candidate","a=candidate")),a._log("Send Ice Candidate:",t.candidate),a.signalingChannel.send(t)},this.pc.ontrack=function(e){var t,n,i=(t=e).streams.filter(function(e){return-1<e.getTracks().map(function(e){return e.id}).indexOf(t.track.id)})[0],r=e.track;a.tracksDesc.forEach(function(e){i.id===e.stream&&e.kind===r.kind&&(r.paused=e.paused,e.desc&&(i[e.kind+"Desc"]=r.desc=e.desc))}),i.addEventListener&&(n=function(e){a._log("Remote "+r.kind+" track "+r.id+" removed ("+i.id+")"),i.getTracks().length?(a.onUpdateStream(i,r),a._log("Remote stream "+i.id+" updated")):(i.removeEventListener("removetrack",n),a.remoteStreamsId.splice(a.remoteStreamsId.indexOf(i.id),1),a.onCloseStream(i),a._log("Remote stream "+i.id+" closed")),a.onRemoveTrack(r,i)},i.addEventListener("removetrack",n)),r.addEventListener&&r.addEventListener("ended",function(e){var t,n;a._log("Remote "+r.kind+" track "+r.id+" ended ("+i.id+")"),n=!0,(t=i).getTracks().length&&(t.getTracks().forEach(function(e){n="ended"===e.readyState&&n}),n)&&(a.remoteStreamsId.splice(a.remoteStreamsId.indexOf(i.id),1),a.onCloseStream(i),a._log("Remote stream "+i.id+" closed"))}),a.onAddTrack(r,i),a._log("Remote "+r.kind+" track "+r.id+" added ("+i.id+")"),-1===a.remoteStreamsId.indexOf(i.id)?(a.remoteStreamsId.push(i.id),a.onAddStream(i),a._log("Remote stream "+i.id+" added")):(a.onUpdateStream(i,r),a._log("Remote stream "+i.id+" updated"))},this.pc.ondatachannel=function(e){a.onDataChannel(e)},this.signalingChannel.onReceive=function(e){a._processSignaling(e)},this._log("Peer instanciated",i)}u.prototype={_saveLog:function(e){e=Array.prototype.slice.call(e);this.trace.push({on:(new Date).toISOString(),data:e.reduce(function(e,t){return e+" "+(t instanceof Object?JSON.stringify(t):t)})})},_log:function(){this._saveLog(arguments),Array.prototype.unshift.call(arguments,"[Peer "+this.label+"]"),i.apply(i,arguments)},_failed:function(e){this.signalingChannel.onFailed({error:e.message,extra:this.extra}),this.onFailed(e,this.trace),this._log(e)},_checkNegotiationSate:function(){("connected"!==this.pc.iceConnectionState&&"completed"!==this.pc.iceConnectionState||"stable"!==this.pc.signalingState)&&"closed"!==this.pc.iceConnectionState||(this.isNegotiating=!1),this.pc.connectionState===a&&(this.canRestart=!0)},_onAcceptRenegotiation:function(){this._log("Renegotiation accepted by remote peer"),this.renegotiationId=void 0,this._createOffer()},_requestRenegotiation:function(){this.signalingChannel.isConnected()?(this._log("Renegotiation request sent to remote peer"),this.renegotiationId=Math.round(1e4*Math.random()),this.signalingChannel.send({negorequested:this.renegotiationId,extra:this.extra})):(setTimeout(this._requestRenegotiation.bind(this),200),this._log("Failed to start renegotiation: signaling channel closed, retry later"))},_onRequestRenegotiation:function(e){if(this._log("Renegotiation request received from remote peer"),void 0===this.renegotiationId||this.renegotiationId<=e)return this._log("Renegotiation accepted and notified to remote peer"),this.isNegotiating=!0,this.renegotiationId=void 0,void this.signalingChannel.send({negoaccepted:e,extra:this.extra});this._log("---\x3e Renegotiation request silently ignored <---")},_iceRestart:function(){this.isCaller&&this.canRestart&&(this._log("------------ ICE Restart -------------"),this.canRestart=!1,this.pc.restartIce?this.pc.restartIce():this._createOffer(!0))},_addTrack:function(e,t){e&&this.pc&&this.pc.addTrack&&(this.pc.addTrack(e,t),this._log("Local Track added",e))},_removeTrack:function(t){var e;t&&this.pc&&this.pc.removeTrack&&((e=this.pc.getSenders().find(function(e){return e.track&&e.track.id==t.id}))&&(this.pc.removeTrack(e),this._log("Local Track removed",t)))},_replaceTrack:function(t,e){var n;t&&this.pc&&this.pc.getSenders&&((n=this.pc.getSenders().find(function(e){return e.track&&e.track.kind==t.kind&&e.track.stream==t.stream}))&&(n.replaceTrack?(n.replaceTrack(t),this._log("Local track replaced",t)):(this.pc.removeTrack(n),this.pc.addTrack(t,e),this._log("Local track replaced (remove/add)",t))))},_processSignaling:function(e){this.pc&&"closed"!=this.pc.signalingState&&("sd"in e?(this._log("Receive "+e.sd.type,e.sd),this._setRemoteDescription(e.sd),"td"in e&&(this._log("Receive tracks description",e.td),this._setTracksExtraData(e.td))):"candidate"in e?(this._log("Receive candidate",e.candidate),this.hasRemoteDescription?this._addRemoteCandidate(e.candidate):(this._log("Remote candidate has been stacked",e.candidate),this.remoteIceCandidates.push(e.candidate))):"eoc"in e?(r.isEdgeORTC()&&this._addRemoteCandidate(null),this._log("Receive End of Candidates")):"negorequested"in e?this._onRequestRenegotiation(e.negorequested):"negoaccepted"in e&&this._onAcceptRenegotiation(e.negoaccepted))},_createOffer:function(e){var t={offerToReceiveAudio:this.sendOnly?0:1,offerToReceiveVideo:this.sendOnly?0:1};e&&(t=Object.assign(t,{iceRestart:!0})),this.isNegotiating=!0,this.pc.createOffer(t).then(this._setLocalDescription.bind(this)).catch(this._failed.bind(this))},_createAnswer:function(){var e={offerToReceiveAudio:this.sendOnly?0:1,offerToReceiveVideo:this.sendOnly?0:1};this.pc.createAnswer(e).then(this._setLocalDescription.bind(this)).catch(this._failed.bind(this))},_addRemoteCandidate:function(e){this.tcpOnly&&-1===e.candidate.toLowerCase().indexOf("tcp")?this._log("UDP candidate has been ignored",e):this.pc.addIceCandidate(e?new RTCIceCandidate(e):{candidate:""}).then(function(){this._log("Processed remote candidate",e)}.bind(this)).catch(this._failed.bind(this))},_processEndOfCandidates:function(){(this.pc.transceivers||[]).forEach(function(e){e.iceTransport&&e.iceTransport.addRemoteCandidate({})})},_setLocalDescription:function(t){t.sdp=o.removeExtmapAllowMixed(t.sdp),this.audioBitrate&&this.remoteClient&&(t.sdp=o.setMediaBitrate(t.sdp,"audio",this.audioBitrate,this.remoteClient)),this.videoBitrate&&this.remoteClient&&(t.sdp=o.setMediaBitrate(t.sdp,"video",this.videoBitrate,this.remoteClient)),this.preferedAudioCodec&&(t.sdp=o.setPreferedCodec("audio",t.sdp,this.preferedAudioCodec)),this.preferedVideoCodec&&(t.sdp=o.setPreferedCodec("video",t.sdp,this.preferedVideoCodec)),this.pc.setLocalDescription(t).then(function(){var e=this.pc.getSenders?this.pc.getSenders().filter(function(e){return e.track}).map(function(e){return{stream:e.track.stream,kind:e.track.kind,desc:e.track.desc,paused:!e.track.enabled}}):[],e={sd:JSON.parse(JSON.stringify(t)),extra:this.extra,td:e};this._log("Local Description has been set"),this.hasLocalDescription=!0,this.mergeCandidates||(this._log("Send SDP "+e.sd.type,e.sd),this.signalingChannel.send(e))}.bind(this)).catch(this._failed.bind(this))},_setRemoteDescription:function(e){var t="have-local-offer"!==this.pc.signalingState;this.isNegotiating=!0,this.pc.setRemoteDescription(new RTCSessionDescription(e)).then(function(){for(this._log("Remote Description has been set"),this.hasRemoteDescription=!0;this.remoteIceCandidates.length;)this._addRemoteCandidate(this.remoteIceCandidates.shift());t&&this._createAnswer()}.bind(this)).catch(this._failed.bind(this))},_setTracksExtraData:function(e){this.tracksDesc=e},_startStatsPolling:function(){0<this.statsInterval&&!this.statsPolling&&(this.statsPolling=setInterval(function(){this._getStats()}.bind(this),1e3*this.statsInterval))},_stopStatsPolling:function(){this.statsPolling&&(clearInterval(this.statsPolling),this.statsPolling=void 0)},_getStats:function(){var t,n;this.pc&&this.pc.getStats&&!r.isEdgeORTC()&&"closed"===this.pc.connectionState?(n=(t=this).statsParser,this.pc.getStats(null).then(function(e){return n.parse(e)}).then(function(e){e.client={local:r.getBrowser(),remote:t.remoteClient||{}},e.transport.state=t.pc.connectionState,t.onStatsUpdated(e)}).catch(function(e){throw e})):this._stopStatsPolling()},close:function(){(r.isEdgeORTC()||r.isFirefox()&&r.getVersion()<50)&&this.getRemoteStreams().forEach(function(e){this.onCloseStream(e)}.bind(this)),this.pc&&"closed"!=this.pc.connectionState&&(this.pc.close(),this.onClosePeer()),this._stopStatsPolling(),this._checkNegotiationSate()},addStream:function(t){return t&&this.pc&&t.getTracks().forEach(function(e){"ended"!==e.readyState&&(e.stream=t.id,this._addTrack(e,t))}.bind(this)),this},removeStream:function(e){return e&&this.pc&&e.getTracks().forEach(function(e){this._removeTrack(e)}.bind(this)),this},updateStream:function(t){return t&&this.pc&&t.getTracks().forEach(function(e){"ended"!==e.readyState&&(e.stream=t.id,this._replaceTrack(e,t))}.bind(this)),this},copyStream:function(e,n){var i,r;return e&&n&&this.pc&&this.pc.getSenders&&(i=this.pc.getSenders(),e=e.getTracks(),r=n.getTracks(),e.forEach(function(t){var e;"ended"!==t.readyState&&(e=i.find(function(e){return!!e.track&&(-1!==r.map(function(e){return e.id}).indexOf(e.track.id)&&e.track.kind===t.kind)}),t.stream=n.id,e?(n.removeTrack(e.track),n.addTrack(t),e.replaceTrack?e.replaceTrack(t):(this.pc.removeTrack(e),this.pc.addTrack(t,n)),this._log("Copy Stream --\x3e Replace track",t,n)):(n.addTrack(t),this.pc.addTrack(t,n),this._log("Copy Stream --\x3e Add track",t,n)))}.bind(this))),this},getRemoteStreams:function(){return this.pc?this.pc.getRemoteStreams():[]},getLocalStreams:function(){return this.pc?this.pc.getLocalStreams():[]},addTrack:function(e,t){return e.stream=t.id,this._addTrack(e,t),this},removeTrack:function(e){return this._removeTrack(e),this},replaceTrack:function(e){return this._replaceTrack(e),this},getRemoteTracks:function(){if(this.pc){if(r.isEdgeORTC()||this.pc.getRemoteStreams&&!this.pc.getReceivers){var t=[];return this.pc.getRemoteStreams().forEach(function(e){t=t.concat(e.getTracks())}),t}if(this.pc.getReceivers)return this.pc.getReceivers().map(function(e){return e.track})}return[]},getLocalTracks:function(){if(this.pc){if(r.isEdgeORTC()||this.pc.getLocalStreams&&!this.pc.getSenders){var t=[];return this.pc.getLocalStreams().forEach(function(e){t=t.concat(e.getTracks())}),t}if(this.pc.getSenders)return this.pc.getSenders().map(function(e){return e.track})}return[]},addDataChannel:function(e,t){if(!this.pc.createDataChannel)return!1;var n={},i=r.getBrowser();"chrome"==i.name&&i.version<31?n.reliable=!1:(n.reliable=!0,t&&"reliable"in t&&(n.reliable=t.reliable)),t&&"ordered"in t&&(n.ordered=t.ordered),this._log("Data Channel created",e,n);n=this.pc.createDataChannel(e,n);return t&&"binaryType"in t&&(n.binaryType=t.binaryType),n},updateCodec:function(e,t){"audio"===e&&(this.preferedAudioCodec=t,this._log("audio-codec is set to "+this.preferedAudioCodec)),"video"===e&&(this.preferedVideoCodec=t,this._log("video-codec is set to "+this.preferedVideoCodec))},updateBitrate:function(n,i){n&&!isNaN(i)&&(this[n+"Bitrate"]=i,this.pc.connectionState===s||this.pc.connectionState===a?(r.isChrome()||r.isEdge()||r.isOpera()||r.isSafari()||r.isFirefox&&64<=r.getVersion())&&"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype?this.pc.getSenders().filter(function(e){return e.track&&e.track.kind==n}).forEach(function(e){var t=e.getParameters();if(t.encodings){if(0===t.encodings.length)return}else t.encodings=[{}];0===i?delete t.encodings[0].maxBitrate:t.encodings[0].maxBitrate=1e3*i,e.setParameters(t).then(function(){this._log("Successfully set "+n+" bitrate to "+i+" kbps")}.bind(this)).catch(function(e){this._log("Failed to set sender bitrate ",e)}.bind(this))}.bind(this)):this.pc.connectionState!==s&&this.pc.connectionState!==a&&this.pc.onnegotiationneeded():this._log(n+"-bitrate is reset to "+i+" kbs"))},setOptions:function(e){"isCaller"in e&&(this.isCaller=e.isCaller)},start:function(){this.startTimer&&(clearTimeout(this.startTimer),this.startTimer=null),this.startTimer=setTimeout(this._createOffer.bind(this),300)}},t.exports=u},{"./Config":7,"./Log":15,"./SdpUtils":25,"./StatsParser":30,"./Utils":34}],23:[function(e,t,n){"use strict";var i=e("./Log");function r(){this.peerConns={}}r.prototype.add=function(e,t,n){e in this.peerConns||(this.peerConns[e]={},i("[Peers Manager] Room "+e+" added to manager")),i("[Peers Manager] Peer "+t+"-"+e+" added to room "+e),this.peerConns[e][t]=n},r.prototype.removePeer=function(e,t){this.peerConns[e]&&t in this.peerConns[e]&&(delete this.peerConns[e][t],i("[Peers Manager] Peer "+t+"-"+e+" removed from room "+e))},r.prototype.removeRoom=function(e){e in this.peerConns&&(Object.keys(this.peerConns[e]).length||(delete this.peerConns[e],i("[Peers Manager] Room "+e+" removed from manager")))},r.prototype.exists=function(e,t){return this.peerConns[e]&&t in this.peerConns[e]},r.prototype.get=function(e,t){return this.peerConns[e]&&this.peerConns[e][t]?this.peerConns[e][t]:null},r.prototype.forEachRoom=function(e){for(var t in this.peerConns)e(t)},r.prototype.forEachPeer=function(e,t){if(this.peerConns[e])for(var n in this.peerConns[e])t(n,this.peerConns[e][n])},t.exports=r},{"./Log":15}],24:[function(e,t,n){"use strict";var i=e("./Log"),r=e("./MD5");function o(){this._handlersList={},this._eventsList={}}o.prototype={publish:function(e){var t=arguments;e in this._eventsList&&this._eventsList[e].forEach(function(e){"function"==typeof e&&e.apply(this,Array.prototype.slice.call(t,1))})},subscribe:function(e,t){if("function"!=typeof t)return i("[PubSub] Handler is a function"),null;e in this._eventsList||(this._eventsList[e]=[]);var n=r(e)+r(t.toString()+new Date);return this._handlersList[n]=this._eventsList[e][this._eventsList[e].push(t)-1],{event:e,key:n}},unsubscribe:function(n){if("string"==typeof n){if(n in this._eventsList){var e,t=r(n);for(e in this._handlersList)0==e.indexOf(t)&&delete this._handlersList[e];return delete this._eventsList[n],!0}return!1}if("object"==typeof n&&n.hasOwnProperty("key")&&n.hasOwnProperty("event"))return n.event in this._eventsList&&(this._eventsList[n.event].forEach(function(e,t){e==this._handlersList[n.key]&&this._eventsList[n.event].splice(t,1)}.bind(this)),delete this._handlersList[n.key],this._eventsList[n.event].length||delete this._eventsList[n.event],!0);throw new Error("unsubscribe event: unexpected arguments")}},t.exports=new o},{"./Log":15,"./MD5":16}],25:[function(e,t,n){"use strict";var p=e("./Log"),f=e("./Utils");t.exports={setPreferedCodec:function(e,t,n){var i=n.split("/");if(i.length<2)return p("[SdpUtils] Invalid codec setting: "+n),t;var r=i[0],o=i[1],s=i[2],i=f.getBrowser();0===n.indexOf("multiopus")&&{edge:1,chrome:1,opera:1}[i.name]&&79<=i.version&&-1===t.search(r+"/"+o)&&(t=t.replace("opus/48000/2",r+"/"+o+"/"+s).replace("useinbandfec=1","useinbandfec=1;channel_mapping=0,4,1,2,3,5;num_streams=4;coupled_streams=2"));for(var a=(t=0===n.indexOf("opus/48000/2")&&{edge:1,chrome:1,opera:1,safari:1,safarimobile:1}[i.name]?t.replace("minptime=10","minptime=10;stereo=1;sprop-stereo=1"):t).split("\r\n"),c=0,d=0;d<a.length;d++)if(-1!==a[d].search("m="+e)){c=d;break}if(0===typeof c)return t;for(var u,d=c;d<a.length;d++)if(-1!==a[d].search(r+"/"+o)){var l=new RegExp(":(\\d+) "+r+"\\/"+o,"i"),l=(u=a[d],l=l,(l=u.match(l))&&2==l.length?l[1]:null);l&&(a[c]=function(e,t){for(var n=e.split(" "),i=new Array,r=0,o=0;o<n.length;o++)3===r&&(i[r++]=t),n[o]!==t&&(i[r++]=n[o]);return i.join(" ")}(a[c],l));break}return t=a.join("\r\n")},setMediaBitrate:function(e,t,n,i){var r=e.split("\r\n"),o="firefox"===i.name?"TIAS":"AS",s="firefox"===i.name?1e3*(n>>>0):n;if(0!==n){for(var a=0;a<r.length;a++)0===r[a].indexOf("m="+t)&&(a=function(e){for(e++;0===r[e].indexOf("i=")||0===r[e].indexOf("c=");)e++;var t;return 0===r[e].indexOf("b")?r[e]="b="+o+":"+s:((t=r.slice(0,e)).push("b="+o+":"+s),r=t.concat(r.slice(e,r.length))),e}(a));return r.join("\r\n")}},extractMediaTrackIds:function(e){for(var t={},n=/msid:({?[A-Za-z0-9-]+}?)\s({?[A-Za-z0-9-]+}?)/g;null!==(r=n.exec(e));){var i=r[1],r=r[2];i in t||(t[i]=[]),-1===t[i].indexOf(r)&&t[i].push(r)}return t},removeExtmapAllowMixed:function(e){var t=e.split("\r\n"),e=t.indexOf("a=extmap-allow-mixed");return-1!==e&&t.splice(e,1),t.join("\r\n")}}},{"./Log":15,"./Utils":34}],26:[function(e,t,n){"use strict";var r=e("./Log"),i=e("./Config"),o=e("./Websocket"),s=e("./PubSub"),a=e("./Fingerprint");function c(){this._socket=null}function d(){this._appId=void 0,this._appKey=void 0,this._id=void 0,this._useSip=void 0,this._socket=void 0}d.prototype={init:function(e,t,n){this._appId=e,this._appKey=t,this._useSip=n},clearSocket:function(){this._socket=void 0},connect:function(e,t){if(this._socket)r("[Signaling] Can't connect. A connection has already been instantiated");else{if(!this._appId||!this._appKey)throw new Error("appId and appKey properties are not defined; init() method must be called prior to connect() method");this._id=e,this._socket=new o(i.API_SERVER),this._socket.on("socket-ready",function(e){this._send("connect",{id:this._id,name:t,appId:this._appId,appKey:this._appKey,useSip:this._useSip,fingerprint:a}),i.set(e)}.bind(this)),this._socket.on("connection-error",c.bind(this)),this._socket.on("disconnect",c.bind(this)),this._setSocketEvents()}},disconnect:function(){this._isSocketSet()&&this._socket.disconnect()},getPresence:function(e){this._isSocketSet()&&this._send("get-presence",e)},setPresence:function(e){this._isSocketSet()&&this._send("set-presence",e)},joinRoom:function(e,t){this._isSocketSet()&&this._send("join-room",{room:e,capacity:t})},quitRoom:function(e){this._isSocketSet()&&this._send("quit-room",{room:e})},sendSignal:function(e,t,n){this._isSocketSet()&&this._send("send-signal",{pid:e,room:t,data:n})},sendCustomSignal:function(e,t,n){this._isSocketSet()&&this._send("send-signal",{pid:e,room:t,data:{customSignal:n}})},sendSipSignal:function(e,t,n){this._isSocketSet()&&this._send("send-sip-signal",{pid:e,room:t,data:n})},sendSipDtmf:function(e,t){this._isSocketSet()&&this._send("send-sip-dtmf",{room:e,tones:t})},setInternalId:function(e){this._id=e},log:function(e,t){this._isSocketSet()&&this._send("log",{action:e,load:t})},bind:function(e,t){return/^on/.test(e)||(e="on"+e.charAt(0).toUpperCase()+e.slice(1)),-1!=this._events.indexOf(e)?"function"!=typeof t?(r("[Signaling] handler is not a function"),null):s.subscribe(e,t.bind(this)):(r("[Signaling] Unknown event: "+e),null)},unbind:function(e){return"string"!=typeof e||/^on/.test(e)||(e="on"+e.charAt(0).toUpperCase()+e.slice(1)),s.unsubscribe(e)},addHandler:function(e,t){this.bind.apply(this,arguments)},removeHandler:function(){this.unbind.apply(this,arguments)},_send:function(e,t){"send-signal"!==e&&r("[Signaling] Emit: ",e,t),this._socket.emit(e,t)},_eventsMap:{error:"onError",connected:"onConnected",resumed:"onConnectionResumed","connection-error":"onConnectionError",disconnect:"onDisconnected","joined-room":"onJoinedRoom","join-room-error":"onJoinRoomError","quitted-room":"onQuittedRoom","quit-room-error":"onQuitRoomError","receive-signal":"onSignalReceived","peer-joined-room":"onPeerJoinedRoom","peer-quitted-room":"onPeerQuittedRoom","incoming-request":"onIncomingRequest",presence:"onPresence","sip-progress":"onSipCallProgress","sip-dtmf":"onSipCallDtmf"},_events:["onError","onConnected","onConnectionResumed","onConnectionError","onDisconnected","onJoinedRoom","onJoinRoomError","onQuittedRoom","onQuitRoomError","onPeerJoinedRoom","onPeerQuittedRoom","onSignalReceived","onCustomSignal","onIncomingRequest","onIncomingCall","onClientUpdateRequired","onExtensionInstalled","onExtensionInstallStarted","onExtensionInstallFailed","onPresence","onSipCallProgress","onSipCallDtmf","onCallFailed","onCallRejected","onCallEnded"],_isSocketSet:function(){return!!this._socket},_setSocketEvents:function(){for(var e in this._eventsMap)this._socket.on(e,function(t,n){var i=e;return function(e){"receive-signal"!==i&&r("[Signaling] Receive: ",i,e),t._fireHandler(n,e)}}(this,this._eventsMap[e]))},_fireHandler:function(e,t){s.publish("_"+e,t),s.publish(e,t)}},t.exports=d},{"./Config":7,"./Fingerprint":13,"./Log":15,"./PubSub":24,"./Websocket":35}],27:[function(e,t,n){"use strict";function i(e,t){this.pid=e,this.room=t}i.prototype={send:function(){},onReceive:function(){},onFailed:function(){}},t.exports=i},{}],28:[function(e,t,n){"use strict";var r=e("./Log"),o=e("./Utils"),s=e("./SipSignalingChannel"),a=e("./PCManager");function i(e){this.parent=e}i.prototype={call:function(e,t,n){var i;e||r("[BistriConference] You must indicate a call id"),t||r("[BistriConference] You must indicate a number"),o.validateNumber(t)&&((i=this.parent.getRemoteStreams(o.sanitizeString(t)))&&i.hasOwnProperty(e)?r('[BistriConference] Cannot call "'+e+'", call already exists'):((n=o.validateOptions(n,["sendonly","receiveonly","audio-codec","video-codec","audio-bitrate","video-bitrate","stream","force-turn","tcp-only","merge-candidates"]))["merge-candidates"]=!0,a.createPeer(e,t,!0,null,n,{},new s(e,t)).addStream(n.stream).start()))},endCall:function(e,t){e||r("[BistriConference] You must indicate a call id"),t||r("[BistriConference] You must indicate a number"),o.validateNumber(t)&&(t=o.sanitizeString(t),this.parent.signaling.sendSipSignal(o.sanitizeString(e),t,{call:"stop"}),a.closePeer(o.sanitizeString(e),t))},dtmf:function(e,t){e||r("[BistriConference] You must indicate a number"),t.match(/[0-9#*]+/)||r("[BistriConference] DTMF tone is missing or invalid. 0-9 # * allowed"),this.parent.signaling.sendSipDtmf(e,t)}},t.exports=i},{"./Log":15,"./PCManager":19,"./SipSignalingChannel":29,"./Utils":34}],29:[function(e,t,n){"use strict";function i(e,t){this.pid=e,this.room=t}i.prototype={send:function(){},onReceive:function(){},onFailed:function(){}},t.exports=i},{}],30:[function(e,t,n){"use strict";var a=e("./MeanOpinionScoreUtils");function i(){this.stats=[],this.computed={send:{video:{},audio:{}},recv:{video:{},audio:{}},transport:{local:{},remote:{},inboundBandwidth:0,outboundBandwidth:0,bytesReceived:0,bytesSent:0,timestamp:0},candidates:{local:{},remote:{}}}}i.prototype.parse=function(e){return this.stats=e,this.stats.forEach(function(e){var t="_"+e.type.replace(/-([a-z])/gi,function(e,t){return t.toUpperCase()});"function"==typeof this[t]&&this[t](e)}.bind(this)),JSON.parse(JSON.stringify(this.computed))},i.prototype._candidatePair=function(e){var t,n,i;this._isSelectedCandidatePair(e)&&(t=e.timestamp-this.computed.transport.timestamp,n=this._findById(e.localCandidateId),i=this._findById(e.remoteCandidateId),this.computed.transport.local.type=n.candidateType,this.computed.transport.local.ip=n.ip,this.computed.transport.local.protocol=n.protocol,this.computed.transport.local.port=n.port,this.computed.transport.remote.type=i.candidateType,this.computed.transport.remote.ip=i.ip,this.computed.transport.remote.protocol=i.protocol,this.computed.transport.remote.port=i.port,this.computed.transport.inboundBandwidth=t?8*Math.round((e.bytesReceived-this.computed.transport.bytesReceived)/(t/1e3)):0,this.computed.transport.outboundBandwidth=t?8*Math.round((e.bytesSent-this.computed.transport.bytesSent)/(t/1e3)):0,this.computed.transport.bytesReceived=e.bytesReceived,this.computed.transport.bytesSent=e.bytesSent,this.computed.transport.timestamp=e.timestamp)},i.prototype._localCandidate=function(e){this.computed.candidates.local[e.id]={type:e.candidateType,ip:e.ip,port:e.port,protocol:e.protocol}},i.prototype._remoteCandidate=function(e){this.computed.candidates.remote[e.id]={type:e.candidateType,ip:e.ip,port:e.port,protocol:e.protocol}},i.prototype._rtp=function(e,t){var n,i=this.computed[e][t.mediaType][t.id],r=this._findById(t.trackId),o=this._findById(t.codecId),s="recv"==e;i?n=(t.timestamp-i.timestamp)/1e3:(n=0,i=this.computed[e][t.mediaType][t.id]={timestamp:t.timestamp}),i.track=r,i.codec=o,"video"==t.mediaType?(i.firCount=t.firCount,i.pliCount=t.pliCount,i.nackCount=t.nackCount,s?(i.framesDecoded=t.framesDecoded,i.track&&(i.mos=a.calculateVideoScore({width:i.track.frameWidth,height:i.track.frameHeight},t,i))):i.framesEncoded=t.framesEncoded,i.qualityLimitationReason&&(i.qLimiReason=t.qualityLimitationReason)):(s&&(i.mos=a.calculateAudioScore(t,i)),i.jitter=t.jitter),s?(i.bitRate=n?8*Math.round((t.bytesReceived-i.bytesReceived)/n):0,i.packetsLost=t.packetsLost,i.packetsReceived=t.packetsReceived,i.bytesReceived=t.bytesReceived):(i.bitRate=n?8*Math.round((t.bytesSent-i.bytesSent)/n):0,i.packetsSent=t.packetsSent,i.bytesSent=t.bytesSent),i.timestamp=t.timestamp},i.prototype._inboundRtp=function(e){this._rtp("recv",e)},i.prototype._outboundRtp=function(e){this._rtp("send",e)},i.prototype._findById=function(t){var n;return this.stats.forEach(function(e){e.id==t&&(n=e)}),n},i.prototype._isSelectedCandidatePair=function(e){var t;return!0===e.nominated&&"succeeded"===e.state&&("selected"in e?e.selected:(this.stats.forEach(function(e){"transport"==e.type&&(t=e)}),!(!t||t.selectedCandidatePairId!==e.id)))},t.exports=i},{"./MeanOpinionScoreUtils":18}],31:[function(e,t,n){"use strict";var i=e("./Log"),r=e("./PubSub");function o(){}o.prototype={bind:function(e,t){return/^on/.test(e)||(e="on"+e.charAt(0).toUpperCase()+e.slice(1)),-1!=this._events.indexOf(e)?"function"!=typeof t?(i("[Streams] handler is not a function"),null):r.subscribe(e,t.bind(this)):(i("[Streams] Unknown event: "+e),null)},unbind:function(e){return"string"!=typeof e||/^on/.test(e)||(e="on"+e.charAt(0).toUpperCase()+e.slice(1)),r.unsubscribe(e)},addHandler:function(e,t){this.bind.apply(this,arguments)},removeHandler:function(){this.unbind.apply(this,arguments)},_events:["onStreamMuteChange","onStreamError","onStreamAdded","onStreamUpdated","onStreamClosed","onTrackAdded","onTrackRemoved","onStreamStatsUpdated","onDevicesUpdated"]},t.exports=new o},{"./Log":15,"./PubSub":24}],32:[function(e,t,n){"use strict";var r=e("./Log"),o=e("./PubSub"),i=e("./Binarize"),s=e("./PacketsMaker"),a=e("./PacketsRequester");function c(e,t,n,i){this._id=e,this._group=t,this._pid=n,this._file=i,this._data={},this._events=[],this._ttl_chunks=0,this._ack_chunks=0,this._transfered=!1,this._transmitted=0,this._ptransmitted=0,this._timestamp=0,this._ptimestamp=0}function d(e){for(var t=0,n=e;1<n/1e3;)t++,n/=1e3;return function(e,t){t=Math.pow(10,t);return Math.round(e*t)/t}(n,2)+" "+{1:"KB",2:"MB",3:"GB"}[t]}c.prototype={on:function(e,t){this._events[e]=t},onReceive:function(e){!function(e,t){{var n;e instanceof Blob?((n=new window.FileReader).onloadend=function(e){i.unpack(e.target.result,t)},n.readAsArrayBuffer(e)):i.unpack(e,t)}}(e.data,function(e){switch(e.type){case 7:this._progress(),this._acknowledge(e.data);break;case 1:this._getBitrate(),this._newTransfer(e.data);break;case 2:this._addPacket(e.data);break;case 3:case 4:this._sendPacket(e.data);break;case 5:this._fileSent();break;case 6:this._failed()}}.bind(this))},onError:function(){o.publish("onFileTransferAborted",this._id,this._group)},onClose:function(){this._transfered||o.publish("onFileTransferAborted",this._id,this._group)},sendFile:function(){o.publish("onFileTransferWaiting",this._pid,{id:this._id,name:this._file.name,size:d(this._file.size),url:URL.createObjectURL(this._file)},this._group);var i=new s(this._file);this._ttl_chunks=i.getPacketsNb(),i.on("buffered",function(e){this._send(1,e)}.bind(this)),this.on("acknowledgePacket",function(e){i.removePacket(e)}),this.on("sendingPacket",function(e,t){var n;e>=this._ttl_chunks?r("[TransferManager] Requested packet is out of range: ",e):(n=i.getPacket(e),t&&r("[TransferManager] Try to resend id: ",e),n?(this._send(2,n),this._transmitted+=n.chunk.byteLength||n.chunk.size):(r("[TransferManager] Delay packet: ",e),setTimeout(this._events.sendingPacket.bind(this),200,e,!0)))}.bind(this)),this._getBitrate()},_send:function(e,t){var n;t={type:e,data:t},n=function(e){this.onEmit(e)}.bind(this),i.pack(t,function(e){n(e.buffer)})},_newTransfer:function(e){this._file={name:e.fileName,size:e.fileSize,type:e.fileType},this._ttl_chunks=e.chunksNb;var t={ok:function(){this._acceptTransfer(e)}.bind(this),cancel:function(){this.onEnd()}.bind(this)};o.publish("onNewFileTransfer",this._pid,{id:this._id,name:this._file.name,size:d(this._file.size)},t)},_acceptTransfer:function(e){var t=new a;t.on("completed",function(e){this._transfered=!0,this._bitrate(0),o.publish("onFileReceived",this._id,{name:this._file.name,size:d(this._file.size),url:e})}.bind(this)),t.on("progress",function(){this._progress()}.bind(this)),t.on("acknowledge",function(e){this._send(7,{id:e})}.bind(this)),t.on("next",function(e){this._send(3,{id:e})}.bind(this)),t.on("resend",function(e){this._send(4,{id:e})}.bind(this)),t.on("end",function(){this._send(5,null)}.bind(this)),t.on("failed",function(){this._failed()}.bind(this)),this.on("incomingPacket",function(e){t.addPacket(e)}),t.init(e)},_addPacket:function(e){this._transmitted+=e.chunk.byteLength||e.chunk.size,this._events.incomingPacket(e)},_acknowledge:function(e){this._events.acknowledgePacket(e.id)},_progress:function(){var e=100*++this._ack_chunks/this._ttl_chunks;o.publish("onFileTransferProgress",this._id,Math.round(e),this._group)},_bitrate:function(e){o.publish("onFileTransferBitrate",this._id,e,this._group)},_sendPacket:function(e){this._events.sendingPacket(e.id)},_getBitrate:function(){var e=(new Date).getTime(),t=this._transmitted,n=Math.round((t-this._ptransmitted)/(e-this._ptimestamp));this._bitrate(n),this._transfered||setTimeout(this._getBitrate.bind(this),1e3),this._ptimestamp=e,this._ptransmitted=t},_fileSent:function(){this._transfered=!0,o.publish("onFileSent",this._id,this._group),this.onEnd()},_failed:function(){this.onEnd()}},t.exports=c},{"./Binarize":5,"./Log":15,"./PacketsMaker":20,"./PacketsRequester":21,"./PubSub":24}],33:[function(e,t,n){"use strict";var a=e("./Log"),c=e("./PubSub"),d=e("./Config"),u=(e("./Utils"),e("./GetScreenSharing")),l=e("./AudioActivityMonitor");function p(e){var t=!0;return e.getTracks().forEach(function(e){t="ended"===e.readyState&&t}),t}function i(){this._streams=[]}i.prototype={start:function(e,t,n){function i(e){a("[UserMedia] Start Stream failure",e),"function"==typeof n?n(e):c.publish("onStreamError",e)}var r,o,s=function(i){i.localStream=!0,i.type=r,this._streams.push(i),a("[UserMedia] Start Stream ",o,i),i.getTracks().forEach(function(n){/screen(-sharing)?/.test(r)&&(n.desc="screen-sharing"),n.onended=function(e){var t=/screen(-sharing)?/.test(n.desc);"audio"===n.kind&&l.remove(n),p(i)?(this._streams=this._streams.filter(function(e){return i.id!==e.id}),t&&c.publish("onStreamClosed",i,d.USER_ID),a("[UserMedia] Local Stream Stopped",i)):(t&&c.publish("onStreamUpdated",i,d.USER_ID),a("[UserMedia] Local Track Stopped",i))}.bind(this)}.bind(this)),"function"==typeof t?t(i,d.USER_ID):c.publish("onStreamAdded",i,d.USER_ID)}.bind(this);"object"==typeof e?(e.video?r="video":e.audio&&(r="audio"),o=e,navigator.mediaDevices.getUserMedia(o).then(s).catch(i)):"string"==typeof e&&(o=this._getConstraints(r=e),/screen(-sharing)?/.test(e)?window.navigator.mediaDevices&&"getDisplayMedia"in window.navigator.mediaDevices?navigator.mediaDevices.getDisplayMedia(o).then(function(e){s(e)}).catch(i):"getDisplayMedia"in window.navigator?navigator.getDisplayMedia({video:!0}).then(function(e){e.getTracks()[0].applyConstraints({frameRate:o.video.frameRate}),s(e)}).catch(i):u(o,s,i):navigator.mediaDevices.getUserMedia(o).then(s).catch(i))},stop:function(e,t){e&&(p(e)||e.getTracks().forEach(function(e){e.stop(),e.dispatchEvent(new Event("ended"))}),"function"==typeof t&&t(e,d.USER_ID))},isGetDisplayMediaAvailable:function(){return"getDisplayMedia"in window.navigator||"getDisplayMedia"in window.navigator.mediaDevices},getDefaultStream:function(){return this._streams.length?this._streams[0]:void 0},getStreams:function(){return this._streams},getTracks:function(){return this._streams.map(function(e){return e.getTracks()})},updateConstraints:function(n,i,r,o){n.getTracks().forEach(function(e){var t=i[e.kind];t&&e.applyConstraints(Object.assign(e.getSettings(),t)).then(function(){"function"==typeof r&&r(n)}).catch(function(e){"function"==typeof o&&o(e)})})},_getConstraints:function(e){var t,n=/screen(-sharing)?(:(browser|monitor|application|window))/,i={video:!0};if("pure-audio"==e||"audio"==e)delete i.video,i.audio=!0;else if(n.test(e)){n=(r=e.match(n))[3];n&&(i.video={displaySurface:n})}else{switch(e){case"webcamHD":case"webcam-hd":t="1080x720";break;case"webcamSD":case"webcam-sd":t="640x480";break;default:t=e}var r;(r=t.match(/([0-9]{2,4})x([0-9]{2,4})(:([0-9]{1,2}))*/))?(i.audio=!0,i.video={width:{max:r[1]},height:{max:r[2]}},r[4]&&(i.video.frameRate={max:r[4]})):a("[UserMedia] unexpected constraints format. Correct pattern should be {width}x{height}[:{frame rate}]")}return a("[UserMedia] media constraints: ",i),i}},t.exports=new i},{"./AudioActivityMonitor":4,"./Config":7,"./GetScreenSharing":14,"./Log":15,"./PubSub":24,"./Utils":34}],34:[function(e,t,n){"use strict";var r=e("./Log"),i=e("../ua-parser/ua-parser-0.7.21")(navigator.userAgent),o={name:i.browser.name.replace(/\s+/,"").toLowerCase(),version:i.browser.major,vendor:navigator.vendor.toLowerCase(),os:i.os.name.replace(/\s+/,"").toLowerCase(),osversion:i.os.version,device:i.device.model,type:i.device.type,model:i.device.model};function s(){}s.prototype={isCompatible:function(){return!("chrome"==o.name&&o.version<69||"firefox"==o.name&&o.version<52||"edge"==o.name&&o.version<79||"opera"==o.name&&o.version<56||("safari"==o.name||"mobilesafari"===o.name)&&o.version<11)&&!!((navigator.mediaDevices||navigator).getUserMedia&&window.URL&&window.RTCPeerConnection&&window.RTCSessionDescription&&window.RTCIceCandidate)},getBrowser:function(){return o},getClient:function(e){return{browser:i.browser,cpu:i.cpu,device:i.device,engine:i.engine,os:i.os}},getCallClientsId:function(e){return o.name+"/"+o.version+">"+(e?e.name+"/"+e.version:"mobile sdk")},isFirefox:function(){return"firefox"===o.name},isChrome:function(){return"chrome"===o.name},isSafari:function(){return"safari"===o.name||"mobilesafari"===o.name},isSafariIOS:function(){return"mobilesafari"===o.name&&"ios"===o.os},isOpera:function(){return"opera"===o.name},isEdge:function(){return"edge"===o.name},isEdgeORTC:function(){return"edge"===o.name&&o.version<=18},getVersion:function(){return o.version},sanitizeString:function(e){return"string"==typeof e?e.replace(/^\s+|\s+$/g,"").replace(/\s/g,"_"):e},validateString:function(e,t){if(!e&&!t)return!0;if(e&&"string"==typeof e){if(e.match(/^[a-zA-Z0-9-_\s]+$/))return!0;throw new Error("string contains unauthorized chars. Use only a-z, A-Z, 0-9, hyphen, underscore or space")}throw new Error("value can't be undefined or empty, string expected")},validateNumber:function(e,t){if(!e&&!t)return!0;if(e&&"string"==typeof e){if(e.match(/^[a-z0-9-:]+$/))return!0;throw"Error: string contains unauthorized chars. Use only a-z 0-9 - :"}throw"Error: value can't be undefined or empty, string expected"},random:function(e){for(var t=e||20,n="",i=0;i<t;i++)n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_".charAt(63*Math.random());return n},insertExtensionTag:function(e){var t=document.createElement("link");document.querySelector("head").appendChild(t),t.setAttribute("rel","chrome-webstore-item"),t.setAttribute("href","https://chrome.google.com/webstore/detail/"+e)},validateOptions:function(e,t){var n={};if(e){if("object"!=typeof e)return r("[BistriConference] Options should be an object"),n;for(var i in e)-1!=t.indexOf(i)&&(n[i]=e[i])}return n}},t.exports=new s},{"../ua-parser/ua-parser-0.7.21":37,"./Log":15}],35:[function(e,t,n){"use strict";var l=e("./Log"),i=(e("../sockjs/sockjs-0.3.4"),e("./Config"));function r(e){this._url=e,this._eventsHandlers={},this._socket=null,this._socketId=void 0,this._opened=!1,this._retry=2e3,this._maxRetry=12,this._retryCount=0,this._heartbeatCheck=25e3,this._heartbeatTimeout=5e4,this._heartbeatInterval=void 0,this._lastHeartbeat=0,this._reconnectionTimer=void 0,this._reconnectionDelay=6e4,this.connect()}r.prototype={connect:function(){var e,t,n,i,r,o,s,a,c,d,u;this._opened||(this._reconnectionTimer&&this._clearTimer(),(e=this)._socket=new SockJS(this._url+"/conference",null,{debug:!1,protocols_whitelist:["websocket","xhr-polling","iframe-xhr-polling","jsonp-polling"]}),this._socketId=this._socket._server,this._socket.onheartbeat=(t=this._socketId,n=e,function(){t==n._socketId&&(n._reconnectionTimer&&(l("[Websocket] Connection resumed, reconnection process aborted"),n._clearTimer(),n._startHeartBeatCheck(),n._fireHandler("resumed")),n._lastHeartbeat=(new Date).getTime(),n.emit("heartbeat",{}))}),this._socket.onerror=(i=this._socketId,r=e,function(e){i==r._socketId&&(l("[Websocket] Error (%s)",i),r._fireHandler("error",e))}),this._socket.onopen=(o=this._socketId,s=e,function(){o==s._socketId&&(s._retryCount=0,s._opened=!0,s._fireHandler("open"),s._startHeartBeatCheck())}),this._socket.onclose=(a=this._socketId,c=e,function(e){if(a==c._socketId)switch(l("[Websocket] Disconnection: "+e.reason+" ("+e.code+")"),c._stopHeartbeatCheck(),c._opened&&(c._opened=!1,c._socket=null,c._socketId=void 0),e.code){case 1e3:c._fireHandler("disconnect");case 56:break;case 1003:case 1007:case 1008:case 1009:case 1010:case 1001:c._fireHandler("connection-error",e);break;case 1002:case 1011:default:c._autoReconnect()}}),this._socket.onmessage=(d=this._socketId,u=e,function(e){var t;if(d==u._socketId){try{t=JSON.parse(e.data)}catch(e){l("[Websocket] Fail to parse string:",t)}t&&u._fireHandler(t.type,t.data)}}))},reconnect:function(){this._opened=!1,this._socket=null,this._socketId=void 0,this.connect()},disconnect:function(){this._socket&&this._socket.close()},on:function(e,t){"function"!=typeof t?l('[Websocket] Fail to add handler "'+e+'": function expected'):(e in this._eventsHandlers||(this._eventsHandlers[e]=[]),this._eventsHandlers[e].push(t))},emit:function(e,t){try{var n=JSON.stringify({type:e,data:t});this._socket.send(n)}catch(e){l("[Websocket] Fail to stringify JSON object:",t)}},_fireHandler:function(e,t){if(e in this._eventsHandlers)for(var n=this._eventsHandlers[e],i=0,r=n.length;i<r;i++)n[i](t)},_autoReconnect:function(){i.AUTO_RECONNECT&&((this._retryCount<this._maxRetry||!this._maxRetry)&&this._retryCount++,setTimeout(function(){this.reconnect()}.bind(this),1e3*this._fibonacci(this._retryCount)+this._randomDelay()))},_startHeartBeatCheck:function(){this._heartbeatInterval||(l("[Websocket] Start heartbeat check process"),this._heartbeatInterval=setInterval(function(){(new Date).getTime()-this._lastHeartbeat>this._heartbeatTimeout&&(l("[Websocket] No heartbeat detected. Auto-reconnection in "+this._reconnectionDelay/6e4+" minutes"),this._reconnectionTimer=setTimeout(function(){l("[Websocket] Auto-reconnection after "+this._reconnectionDelay/6e4+" minutes of inactivity"),this._autoReconnect(),this._reconnectionTimer=void 0}.bind(this),this._reconnectionDelay),this._stopHeartbeatCheck())}.bind(this),this._heartbeatCheck))},_stopHeartbeatCheck:function(){this._heartbeatInterval&&(l("[Websocket] Stop heartbeat check process"),clearInterval(this._heartbeatInterval),this._heartbeatInterval=void 0,this._lastHeartbeat=0)},_fibonacci:function(e){var t=1;return 0==e?t:1==e?t+=1:this._fibonacci(e-1)+this._fibonacci(e-2)},_clearTimer:function(){clearTimeout(this._reconnectionTimer),this._reconnectionTimer=void 0},_randomDelay:function(){return Math.round(4*Math.random())+1}},t.exports=r},{"../sockjs/sockjs-0.3.4":2,"./Config":7,"./Log":15}],36:[function(e,t,n){"use strict";e("../adapter/adapter-7.7.1");var c=e("./Log"),d=e("./Utils"),u=e("./Config"),i=e("./Sip"),r=e("./Signaling"),l=e("./SignalingChannel"),o=e("./SipSignalingChannel"),s=e("./Streams"),a=e("./DataChannels"),p=e("./FileTransfer"),f=e("./UserMedia"),h=e("./PCManager"),m=e("./PubSub"),g=e("./AudioActivityMonitor"),v=e("./MeanOpinionScore");function y(){this.version=u.VERSION,this.connected=!1,this.appId=void 0,this.appKey=void 0,this.userId=void 0,this.userName=void 0,this.autoCloseOnExit=!0,this.streams=s,this.channels=a,this.files=p,this.signaling=new r,this._rooms={},this._calls={},this._files={},this._isMicrophoneMuted=!1,this._isVideoMuted={},this._isAllSoundsMuted=!1,this._init()}function b(e,t,n,i){if(e.setAttribute("autoplay","true"),d.isSafariIOS()&&(e.setAttribute("muted",""),e.setAttribute("playsinline","playsinline")),"controls"in e&&t&&t.controls&&(e.controls="controls"),t&&t.mirror){var r="transform:rotateY( 180deg )";switch(d.getBrowser().name){case"chrome":case"safari":r="-webkit-"+r;break;case"firefox":r="-moz-"+r}e.style.cssText+=r}t&&t.fullscreen&&i&&e.addEventListener("click",function(){e.requestFullScreen?e.requestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullScreen&&e.mozRequestFullScreen()})}y.prototype={presence:{online:"1",away:"2",busy:"3",offline:"4"},init:function(e){var t=d.getBrowser();if(!(e=e||{}).appId||!e.appKey)throw new Error("appId and appKey parameters are mandatory");e.hasOwnProperty("userId")&&"string"==typeof e.userId&&(e.userId=d.sanitizeString(e.userId)),e.useSip&&(this.sip=new i(this)),this.userId=e.userId||void 0,this.userName=e.userName||void 0,this.appId=e.appId,this.appKey=e.appKey,e.hasOwnProperty("autoCloseOnExit")&&(this.autoCloseOnExit=e.autoCloseOnExit),this.signaling.init(this.appId,this.appKey,e.useSip||void 0),e.hasOwnProperty("chromeExtentionId")&&(e.chromeExtensionId=e.chromeExtentionId),u.set({userId:this.userId,chromeExtId:e.chromeExtensionId,firefoxExtId:e.firefoxExtensionId,extAutoReload:!e.hasOwnProperty("extAutoReload")||e.extAutoReload,turnServers:e.hasOwnProperty("turnServers")?e.turnServers:[],stunServers:e.hasOwnProperty("stunServers")?e.stunServers:[],forceTURN:!!e.hasOwnProperty("forceTURN")&&e.forceTURN,tcpOnly:!!e.hasOwnProperty("tcpOnly")&&e.tcpOnly,autoReconnect:!!e.hasOwnProperty("autoReconnect")&&e.autoReconnect,statsInterval:e.hasOwnProperty("statsInterval")?e.statsInterval:4,autoAcceptCall:!e.hasOwnProperty("autoAcceptCall")||e.autoAcceptCall,debug:!!e.hasOwnProperty("debug")&&e.debug,apiServer:e.apiServer}),"chrome"==t.name&&34<=t.version&&!f.isGetDisplayMediaAvailable()&&d.insertExtensionTag(e.chromeExtensionId),this.autoCloseOnExit&&"undefined"!=typeof window&&(void 0!==window.onbeforeunload?window.addEventListener("beforeunload",function(){this.disconnect()}.bind(this)):void 0!==window.onunload&&window.addEventListener("unload",function(){this.disconnect()}.bind(this)))},set:function(e){(this.appId||this.appKey||"object"!=typeof e)&&(e.userName&&(this.userName=e.userName),u.set(e))},connect:function(){this.signaling.connect(this.userId,this.userName)},disconnect:function(){this.signaling.disconnect()},joinRoom:function(e,t){if(d.validateString(e,!0)){if(t&&isNaN(Number(t)))throw new Error("capacity must an integer comprised between 2 and 256");if(Number(t)<2||256<Number(t))throw new Error("capacity must an integer comprised between 2 and 256");this.signaling.joinRoom(d.sanitizeString(e),t)}},quitRoom:function(e){e||c("[BistriConference] 'room' parameter is undefined"),d.validateString(e)&&this.signaling.quitRoom(d.sanitizeString(e))},sendCustomSignal:function(e,t,n){t||c("[BistriConference] 'room' parameter is undefined"),this.signaling.sendCustomSignal(d.sanitizeString(e),d.sanitizeString(t),n)},call:function(e,t,n){var i;t||c("[BistriConference] 'room' parameter is undefined"),d.validateString(t)&&(h.getPeer(e,t)?c('[BistriConference] Cannot call "'+e+'", call already exists'):(i=d.random(8),n=d.validateOptions(n,["sendonly","receiveonly","audio-codec","video-codec","audio-bitrate","video-bitrate","stream","force-turn","tcp-only","merge-candidates"]),this._calls[i]=n.stream,n.hasOwnProperty("stream")&&delete n.stream,this.signaling.sendSignal(d.sanitizeString(e),d.sanitizeString(t),{call:"init",id:i,client:d.getBrowser(),options:n,extra:{}}),c("[BistriConference] Send call request to remote peer",e,t)))},updateCall:function(t,n,e){var i;n||c("[BistriConference] API CHANGE WARNING: you must indicate a room name -> call( id, room )"),d.validateString(n)&&("stream"in(i=d.validateOptions(e,["audio-codec","video-codec","audio-bitrate","video-bitrate","stream","force-turn","tcp-only","merge-candidates"]))&&((e=i.stream)instanceof Array?e:[e]).forEach(function(e){"add"in e?h.addStream(d.sanitizeString(t),d.sanitizeString(n),e.add):"remove"in e?h.removeStream(d.sanitizeString(t),d.sanitizeString(n),e.remove):"update"in e?h.updateStream(d.sanitizeString(t),d.sanitizeString(n),e.update):"copy"in e&&h.copyStream(d.sanitizeString(t),d.sanitizeString(n),e.copy[0],e.copy[1])}),"audio-codec"in i&&h.updateCodec(d.sanitizeString(t),d.sanitizeString(n),"audio",i["audio-codec"]),"video-codec"in i&&h.updateCodec(d.sanitizeString(t),d.sanitizeString(n),"video",i["video-codec"]),"audio-bitrate"in i&&h.updateBitrate(d.sanitizeString(t),d.sanitizeString(n),"audio",i["audio-bitrate"]),"video-bitrate"in i&&h.updateBitrate(d.sanitizeString(t),d.sanitizeString(n),"video",i["video-bitrate"]))},openDataChannel:function(e,t,n,i){if(d.isEdgeORTC())return c("[BistriConference] Edge doesn't support data channel yet, request silently ignored");if(d.validateString(n)){var r=h.getDataChannels(d.sanitizeString(n));if(r&&r.hasOwnProperty(e)&&r[e].hasOwnProperty(t))return c('[BistriConference] Cannot open datachannel "'+e+'", datachannel already exists');this.signaling.sendSignal(d.sanitizeString(e),d.sanitizeString(n),{channel:"init",id:d.random(8),label:t,client:d.getBrowser(),options:d.validateOptions(i,["reliable","binaryType"]),extra:{}}),c("[BistriConference] Send data channel request to remote peer",e,t,n)}},sendFile:function(e,t,n,i){var r;d.validateString(t)&&(0!=n.size?(r=d.random(12),this._files[r]=n,this.signaling.sendSignal(d.sanitizeString(e),d.sanitizeString(t),{channel:"init",id:r,label:"__file_transfert_"+r,client:d.getBrowser(),file:{id:r,name:n.name,size:n.size},extra:{group:i}}),c("[BistriConference] Send file sharing request to remote peer",e,t,n)):c("[BistriConference] Cannot send empty file"))},endCall:function(e,t){var n;t||c("[BistriConference] API CHANGE WARNING: you must indicate a room name -> endCall( room )"),d.validateString(t)&&(n=d.sanitizeString(t),this.signaling.sendSignal(d.sanitizeString(e),n,{call:"stop"}),h.closePeer(d.sanitizeString(e),n),c("[BistriConference] End connection with remote peer",e,t))},endCalls:function(e){if(e||c("[BistriConference] API CHANGE WARNING: you must indicate a room name -> endCalls( room )"),d.validateString(e))for(var t=d.sanitizeString(e),n=h.getPeersId(t),i=0;i<n.length;i++)this.signaling.sendSignal(n[i],t,{call:"stop"}),h.closePeer(n[i],t)},startStream:function(e,t,n){if(t&&"function"!=typeof t||n&&"function"!=typeof n)throw new Error("successCallback/errorCallback is not a valid function, function expected");f.start(e,t,n)},updateStream:function(e,t,n,i){if(!e||!t)throw new Error("stream and constraints arguments are mandatory");f.updateConstraints(e,t,n,i)},stopStream:function(){1<arguments.length?f.stop(arguments[0],arguments[1]):(c("[BistriConference] API CHANGE WARNING: stream to stop must be specified."),f.stop(f.getDefaultStream(),arguments[0]))},getMediaSources:function(e){if(!navigator.mediaDevices||"function"!=typeof e)throw new Error(e+" is not a valid callback, function expected");navigator.mediaDevices.enumerateDevices().then(e).catch(function(e){throw new Error(e.name+": "+e.message)})},onMediaSourcesUpdated:function(e){navigator.mediaDevices&&"function"==typeof e&&(navigator.mediaDevices.ondevicechange=e)},getLocalStreams:function(){return f.getStreams()},getRemoteStreams:function(e){return e&&!d.validateString(e)?{}:h.getRemoteStreams(d.sanitizeString(e))},getLocalTracks:function(){return h.getLocalTracks()},getRemoteTracks:function(e){return e&&!d.validateString(e)?{}:h.getRemoteTracks(d.sanitizeString(e))},getPeersInRoom:function(e){return d.validateString(e)?h.getPeersId(d.sanitizeString(e)):[]},getRoomMembers:function(e){if(!d.validateString(e))return[];e=d.sanitizeString(e);return this._rooms[e]?this._rooms[e].members:[]},getDataChannels:function(e){return e&&!d.validateString(e)?{}:h.getDataChannels(d.sanitizeString(e))},getFileTransferts:function(e){return e&&!d.validateString(e)?{}:h.getFileTransferts(d.sanitizeString(e))},attachStream:function(e,t,n){var i=e&&!!e.getVideoTracks()&&!!e.getVideoTracks().length,r=e&&!!e.getAudioTracks()&&!!e.getAudioTracks().length;if((i||r)&&t){if(t&&"VIDEO"!=t.nodeName&&"AUDIO"!=t.nodeName)try{var o=document.createElement(i?"VIDEO":"AUDIO");t.appendChild(o),t=o}catch(e){c("[BistriConference] Node must be a VIDEO/AUDIO element or a container (DIV, SPAN, ...)")}r&&e.localStream&&(t.muted=!0),r&&this.isAllSoundsMuted()&&this._muteSound(e,!0),t.setAttribute("id",e.id),t.srcObject=e,b(t,n,0,i);i=t.play();return void 0!==i&&i.then(function(){}).catch(function(){}),t}},reattachStream:function(e,t){var n=e&&!!e.getVideoTracks()&&!!e.getVideoTracks().length,i=e&&!!e.getAudioTracks()&&!!e.getAudioTracks().length,r=document.getElementById(e.id);if((n||i)&&r){if(n&&"audio"==r.nodeName.toLowerCase()||!n&&"video"==r.nodeName.toLowerCase()){for(var o=r.attributes,s=document.createElement(n?"VIDEO":"AUDIO"),a=0,c=o.length;a<c;a++)s.setAttribute(o[a].name,o[a].value);r.parentNode.replaceChild(s,r),(r=s).srcObject=e}i&&e.localStream&&(r.muted=!0),i&&this.isAllSoundsMuted()&&this._muteSound(e,!0),b(r,t,0,n);n=r.play();return void 0!==n&&n.then(function(){}).catch(function(){}),r}},detachStream:function(e){e=document.getElementById(e.id);e&&e.parentNode.removeChild(e)},cloneStream:function(e){return e?e.clone():new MediaStream},mergeStream:function(e,n,i){return e.getTracks().forEach(function(t){var e=n.getTracks().find(function(e){return e.kind===t.kind});e&&(i&&(e.stop(),e.dispatchEvent(new Event("ended"))),n.removeTrack(e)),n.addTrack(t)}),n},dummyStream:function(){return new MediaStream},setTrackDescription:function(e,t,n){e=e.getTracks().find(function(e){return e.kind===t});e&&(e.desc=n)},stopTrack:function(e,t,n){var i=e.getTracks().find(function(e){return e.kind===t});i&&(i.stop(),i.dispatchEvent(new Event("ended")),n&&e.removeTrack(i))},getPresence:function(e){this.signaling.getPresence(d.sanitizeString(e))},setPresence:function(e){e=this.presence[e];if(!e)throw new Error("unkown status");this.signaling.setPresence(e)},allowMonitorAudioActivity:function(e,t){g.resume()},monitorAudioActivity:function(e,t){g.add(e,t)},removeMonitorAudioActivity:function(e){e=e.getAudioTracks();e.length&&e.forEach(function(e){g.remove(e)})},meanOpinionScore:function(e,t,n,i){v.add(e,t,n,i)},_muteSound:function(e,i){(e instanceof Array?e:[e]).forEach(function(e){for(var t=e.getAudioTracks()||[],n=0;n<t.length;n++)t[n].enabled=!i})},muteSound:function(e,t){this._muteSound(e,t)},isSoundMuted:function(e){e=e.getAudioTracks();return!!e.length&&!e[0].enabled},muteAllSounds:function(e){var t,n=this.getRemoteStreams();for(t in n)bc._muteSound(n[t],e);this._isAllSoundsMuted=e},isAllSoundsMuted:function(){return this._isAllSoundsMuted},muteVideo:function(t,e,n){var i=t.getVideoTracks()||[],r=[];this._isVideoMuted[t.id]=void 0!==e?e:!this._isVideoMuted[t.id];for(var o,s=0;s<i.length;s++)i[s].enabled=!this._isVideoMuted[t.id],r.push(i[s].id);for(o in this._rooms)this._rooms[o].members.forEach(function(e){this.signaling.sendSignal(e.id,o,{mute:this._isVideoMuted[t.id],ids:r,extra:n})}.bind(this));m.publish("onStreamMuteChange",this._isVideoMuted[t.id],this.userId,r,n)},toggleVideo:function(t,n){var i,r=t.getVideoTracks()||[],o=r.map(function(e){return e.id});for(i in this._isVideoMuted[t.id]=!this._isVideoMuted[t.id],r.forEach(function(e){e.enabled=!this._isVideoMuted[t.id]}.bind(this)),this._rooms)this._rooms[i].members.forEach(function(e){h[this._isVideoMuted[t.id]?"removeTrack":"addTrack"](d.sanitizeString(e.id),d.sanitizeString(i),r[0],t),this.signaling.sendSignal(e.id,i,{mute:this._isVideoMuted[t.id],ids:o,extra:n})}.bind(this));return m.publish("onStreamMuteChange",this._isVideoMuted[t.id],this.userId,n),this._isVideoMuted[t.id]},isVideoMuted:function(e){return e?this._isVideoMuted[e.id]:this._isVideoMuted[Object.keys(this._isVideoMuted)[0]]},muteMicrophone:function(t){this._isMicrophoneMuted=t,this.getLocalStreams().forEach(function(e){this._muteSound(e,t)}.bind(this))},isMicrophoneMuted:function(){return this._isMicrophoneMuted},isConnected:function(){return!!this.connected},isCompatible:function(){return!!d.isCompatible()},isScreenSharingCompatible:function(){if(f.isGetDisplayMediaAvailable())return!0;var e=d.getBrowser();return"chrome"==e.name&&34<=e.version||"firefox"==e.name&&33<=e.version},getWebRTCPluginURL:function(){return""},getWebRTCPluginPageId:function(){return 0},isWebRTCPluginUsed:function(){return!1},isWebRTCPluginAvailable:function(){return!1},getBrowser:function(){return d.getBrowser()},getClient:function(){return d.getClient()},getRandomId:function(){return d.random(12)},_init:function(){var a=this.signaling;m.subscribe("_onConnected",function(e){for(var t in this.connected=!0,this.userId=e.id,this.signaling.setInternalId(e.id),u.set({userId:e.id}),e.stun&&u.set({stun:e.stun}),e.turn&&u.set({turn:e.turn}),this._rooms)t.match(/^__/)||this.signaling.joinRoom(t,this._rooms[t].capacity)}.bind(this)),m.subscribe("_onDisconnected",function(e){this.signaling.clearSocket(),this.connected=!1}.bind(this)),m.subscribe("_onJoinedRoom",function(e){this._rooms[e.room]={capacity:e.capacity,members:e.members}}.bind(this)),m.subscribe("_onQuittedRoom",function(e){delete this._rooms[e.room],h.closeAllPeers(e.room)}.bind(this)),m.subscribe("_onPeerJoinedRoom",function(e){this._rooms[e.room]&&this._rooms[e.room].members.push({id:e.pid,name:e.name})}.bind(this)),m.subscribe("_onPeerQuittedRoom",function(n){this._rooms[n.room]&&this._rooms[n.room].members.forEach(function(e,t){e.id==n.pid&&this._rooms[n.room].members.splice(t,1)}.bind(this)),h.closePeer(n.pid,n.room)}.bind(this)),m.subscribe("_onSignalReceived",function(n){if(n.data&&n.data.hasOwnProperty("customSignal"))return m.publish("onCustomSignal",{pid:n.pid,room:n.room,payload:n.data.customSignal}),c("[BistriConference] Custom signal received:",n.data.customSignal,n.pid,n.room,n.data.client);if(n.data&&n.data.hasOwnProperty("warning"))return c("[BistriConference] Warning:",n.data.warning,n.pid,n.room,n.data.client);if(n.data&&n.data.hasOwnProperty("error")&&c("[BistriConference] Connection with remote peer has failed: ",n.data.error,n.pid,n.room,n.data.client),n.data&&n.data.hasOwnProperty("mute")&&m.publish("onStreamMuteChange",n.data.mute,n.pid,n.data.ids,n.data.extra),n.data&&(n.data.hasOwnProperty("call")||n.data.hasOwnProperty("channel"))){var e,t=!1;if(n.data.hasOwnProperty("turnArray")&&u.set({turn:n.data.turnArray}),n.data.hasOwnProperty("stunArray")&&u.set({stun:n.data.stunArray}),"init"===n.data.call||"init"===n.data.channel){c("[BistriConference] "+(n.data.call?"Call":"Data Channel")+" requested by remote peer",n.pid,n.room,n.data.client);var i=n.data.client;if("channel"in n.data&&(d.isEdgeORTC()||"object"==typeof i&&("edge"==i.name&&i.version<=18)))return c("[BistriConference] Remote Data Channel request has been ignored",n.pid,n.room),a.sendSignal(n.pid,n.room,{warning:"Browser doesn't support data channel yet, request ignored",client:d.getBrowser()});var r=h.getPeer(n.pid,n.room,n.data.options,n.data.extra)||h.createPeer(n.pid,n.room,!1,n.data.client,n.data.options,n.data.extra,new l(n.pid,n.room)),o={id:n.data.id,client:d.getBrowser(),options:n.data.options,extra:n.data.extra};if(o[n.data.call?"call":"channel"]="ready",n.data.call){if(!u.AUTO_CALL){var s={type:"media",pid:n.pid,room:n.room,options:n.data.options,client:n.data.client,sendonly:!!(n.data.options&&"sendonly"in n.data.options)&&n.data.options.sendonly,accept:function(e){var t;n.data.options&&"sendonly"in n.data.options&&n.data.options.sendonly||("stream"in e&&((t=e.stream)instanceof Array?t:[t]).forEach(function(e){r.addStream(e)}),"audio-bitrate"in e&&r.updateBitrate("audio",e["audio-bitrate"]),"video-bitrate"in e&&r.updateBitrate("video",e["video-bitrate"]),"audio-codec"in e&&r.updateCodec("audio",e["audio-codec"]),"video-codec"in e&&r.updateCodec("video",e["video-codec"])),a.sendSignal(n.pid,n.room,o)},reject:function(){o.call="cancel",h.closePeer(n.pid,n.room,n.data.extra),a.sendSignal(n.pid,n.room,o)}};return m.publish("onIncomingCall",s)}r.addStream(f.getDefaultStream()),n.data.options&&"audio-bitrate"in n.data.options&&r.updateBitrate("audio",n.data.options["audio-bitrate"]),n.data.options&&"video-bitrate"in n.data.options&&r.updateBitrate("video",n.data.options["video-bitrate"])}if(n.data.channel)if(o.label=n.data.label,n.data.file)m.publish("_onFileWaitingTransfer",n.data.label,n.data.file);else if(!u.AUTO_CALL){s={type:"datachannel",pid:n.pid,room:n.room,client:n.data.client,accept:function(e){a.sendSignal(n.pid,n.room,o)},reject:function(){o.call="cancel",h.closePeer(n.pid,n.room,n.data.extra),a.sendSignal(n.pid,n.room,o)}};return m.publish("onIncomingCall",s)}a.sendSignal(n.pid,n.room,o)}else if("stop"===n.data.call)h.closePeer(n.pid,n.room,n.data.extra);else{if("cancel"===n.data.call||"cancel"===n.data.channel)return this._calls[n.data.id]&&delete this._calls[n.data.id],m.publish("onCallRejected",n.pid,n.room);c("[BistriConference] "+(n.data.call?"Call":"Data Channel")+" request accepted by remote peer",n.pid,n.room,n.data.client),r=(r=h.getPeer(n.pid,n.room,n.data.options,n.data.extra))||h.createPeer(n.pid,n.room,t=!0,n.data.client,n.data.options,n.data.extra,new l(n.pid,n.room)),n.data.call?(this._calls[n.data.id]?(e=this._calls[n.data.id],delete this._calls[n.data.id]):e=f.getDefaultStream(),(e instanceof Array?e:[e]).forEach(function(e){r.addStream(e)}),n.data.options&&"audio-bitrate"in n.data.options&&r.updateBitrate("audio",n.data.options["audio-bitrate"]),n.data.options&&"video-bitrate"in n.data.options&&r.updateBitrate("video",n.data.options["video-bitrate"])):n.data.channel&&(this._files[n.data.id]?(h.createFileTransfer(n.pid,n.data.label,n.room,n.data.id,this._files[n.data.id],n.data.extra),delete this._files[n.data.id]):h.createDataChannel(n.pid,n.data.label,n.room,n.data.options,n.data.extra)),t&&r.start()}}n.data&&(n.data.hasOwnProperty("sd")||n.data.hasOwnProperty("candidate")||n.data.hasOwnProperty("eoc")||n.data.hasOwnProperty("negorequested")||n.data.hasOwnProperty("negoaccepted"))&&h.setSignal(n.pid,n.room,n.data)}.bind(this)),m.subscribe("_onCallStart",function(e){a.log("call-start",e)}),m.subscribe("_onCallStop",function(e){a.log("call-stop",e)}),m.subscribe("_onCallFail",function(e){a.log("call-fail",e)}),m.subscribe("_onDataChannelStart",function(e){a.log("datachannel-open",e)}),m.subscribe("_updateApiClient",function(e){this._updateApiClient(e)}.bind(this)),l.prototype={send:function(e){a.sendSignal(this.pid,this.room,e)},onFailed:function(e){a.sendSignal(this.pid,this.room,e)},isConnected:function(){return a._socket&&a._socket._opened}},o.prototype={send:function(e){a.sendSipSignal(this.pid,this.room,e)},onFailed:function(e){a.sendSignal(this.pid,this.room,e)}}}},t.exports=new y},{"../adapter/adapter-7.7.1":1,"./AudioActivityMonitor":4,"./Config":7,"./DataChannels":10,"./FileTransfer":11,"./Log":15,"./MeanOpinionScore":17,"./PCManager":19,"./PubSub":24,"./Signaling":26,"./SignalingChannel":27,"./Sip":28,"./SipSignalingChannel":29,"./Streams":31,"./UserMedia":33,"./Utils":34}],37:[function(e,C,w){!function(r,l){"use strict";var p="function",e="undefined",t="model",n="name",i="type",o="vendor",s="version",a="architecture",c="console",d="mobile",u="tablet",f="smarttv",h="wearable",m={extend:function(e,t){var n,i={};for(n in e)t[n]&&t[n].length%2==0?i[n]=t[n].concat(e[n]):i[n]=e[n];return i},has:function(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()},major:function(e){return"string"==typeof e?e.replace(/[^\d\.]/g,"").split(".")[0]:l},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},g={rgx:function(e,t){for(var n,i,r,o,s,a=0;a<t.length&&!o;){for(var c=t[a],d=t[a+1],u=n=0;u<c.length&&!o;)if(o=c[u++].exec(e))for(i=0;i<d.length;i++)s=o[++n],"object"==typeof(r=d[i])&&0<r.length?2==r.length?typeof r[1]==p?this[r[0]]=r[1].call(this,s):this[r[0]]=r[1]:3==r.length?typeof r[1]!=p||r[1].exec&&r[1].test?this[r[0]]=s?s.replace(r[1],r[2]):l:this[r[0]]=s?r[1].call(this,s,r[2]):l:4==r.length&&(this[r[0]]=s?r[3].call(this,s.replace(r[1],r[2])):l):this[r]=s||l;a+=2}},str:function(e,t){for(var n in t)if("object"==typeof t[n]&&0<t[n].length){for(var i=0;i<t[n].length;i++)if(m.has(t[n][i],e))return"?"===n?l:n}else if(m.has(t[n],e))return"?"===n?l:n;return e}},v={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},y={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[n,s],[/(opios)[\/\s]+([\w\.]+)/i],[[n,"Opera Mini"],s],[/\s(opr)\/([\w\.]+)/i],[[n,"Opera"],s],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim)(?:browser)?[\/\s]?([\w\.]*)/i,/(bidubrowser|baidubrowser)[\/\s]?([\w\.]+)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon)\/([\w\.-]+)/i],[n,s],[/(konqueror)\/([\w\.]+)/i],[[n,"Konqueror"],s],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[n,"IE"],s],[/(edge|edgios|edga|edg)\/((\d+)?[\w\.]+)/i],[[n,"Edge"],s],[/(yabrowser)\/([\w\.]+)/i],[[n,"Yandex"],s],[/(Avast)\/([\w\.]+)/i],[[n,"Avast Secure Browser"],s],[/(AVG)\/([\w\.]+)/i],[[n,"AVG Secure Browser"],s],[/(puffin)\/([\w\.]+)/i],[[n,"Puffin"],s],[/(focus)\/([\w\.]+)/i],[[n,"Firefox Focus"],s],[/(opt)\/([\w\.]+)/i],[[n,"Opera Touch"],s],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[n,"UCBrowser"],s],[/(comodo_dragon)\/([\w\.]+)/i],[[n,/_/g," "],s],[/(windowswechat qbcore)\/([\w\.]+)/i],[[n,"WeChat(Win) Desktop"],s],[/(micromessenger)\/([\w\.]+)/i],[[n,"WeChat"],s],[/(brave)\/([\w\.]+)/i],[[n,"Brave"],s],[/(qqbrowserlite)\/([\w\.]+)/i],[n,s],[/(QQ)\/([\d\.]+)/i],[n,s],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[n,s],[/(baiduboxapp)[\/\s]?([\w\.]+)/i],[n,s],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[n,s],[/(MetaSr)[\/\s]?([\w\.]+)/i],[n],[/(LBBROWSER)/i],[n],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[s,[n,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[s,[n,"Facebook"]],[/safari\s(line)\/([\w\.]+)/i,/android.+(line)\/([\w\.]+)\/iab/i],[n,s],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[s,[n,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[n,/(.+)/,"$1 WebView"],s],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[n,/(.+(?:g|us))(.+)/,"$1 $2"],s],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[s,[n,"Android Browser"]],[/(sailfishbrowser)\/([\w\.]+)/i],[[n,"Sailfish Browser"],s],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[n,s],[/(dolfin)\/([\w\.]+)/i],[[n,"Dolphin"],s],[/(qihu|qhbrowser|qihoobrowser|360browser)/i],[[n,"360 Browser"]],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[n,"Chrome"],s],[/(coast)\/([\w\.]+)/i],[[n,"Opera Coast"],s],[/fxios\/([\w\.-]+)/i],[s,[n,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[s,[n,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[s,n],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[n,"GSA"],s],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[n,[s,g.str,v.browser.oldsafari.version]],[/(webkit|khtml)\/([\w\.]+)/i],[n,s],[/(navigator|netscape)\/([\w\.-]+)/i],[[n,"Netscape"],s],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[n,s]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[a,"amd64"]],[/(ia32(?=;))/i],[[a,m.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[a,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[a,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[a,/ower/,"",m.lowerize]],[/(sun4\w)[;\)]/i],[[a,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+[;l]))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[a,m.lowerize]]],device:[[/\((ipad|playbook);[\w\s\),;-]+(rim|apple)/i],[t,o,[i,u]],[/applecoremedia\/[\w\.]+ \((ipad)/],[t,[o,"Apple"],[i,u]],[/(apple\s{0,1}tv)/i],[[t,"Apple TV"],[o,"Apple"],[i,f]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[o,t,[i,u]],[/(kf[A-z]+)\sbuild\/.+silk\//i],[t,[o,"Amazon"],[i,u]],[/(sd|kf)[0349hijorstuw]+\sbuild\/.+silk\//i],[[t,g.str,v.device.amazon.model],[o,"Amazon"],[i,d]],[/android.+aft([bms])\sbuild/i],[t,[o,"Amazon"],[i,f]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[t,o,[i,d]],[/\((ip[honed|\s\w*]+);/i],[t,[o,"Apple"],[i,d]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[o,t,[i,d]],[/\(bb10;\s(\w+)/i],[t,[o,"BlackBerry"],[i,d]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone|p00c)/i],[t,[o,"Asus"],[i,u]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[o,"Sony"],[t,"Xperia Tablet"],[i,u]],[/android.+\s([c-g]\d{4}|so[-l]\w+)(?=\sbuild\/|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[t,[o,"Sony"],[i,d]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[o,t,[i,c]],[/android.+;\s(shield)\sbuild/i],[t,[o,"Nvidia"],[i,c]],[/(playstation\s[34portablevi]+)/i],[t,[o,"Sony"],[i,c]],[/(sprint\s(\w+))/i],[[o,g.str,v.device.sprint.vendor],[t,g.str,v.device.sprint.model],[i,d]],[/(htc)[;_\s-]+([\w\s]+(?=\)|\sbuild)|\w+)/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[o,[t,/_/g," "],[i,d]],[/(nexus\s9)/i],[t,[o,"HTC"],[i,u]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p|vog-l29|ane-lx1|eml-l29)/i],[t,[o,"Huawei"],[i,d]],[/android.+(bah2?-a?[lw]\d{2})/i],[t,[o,"Huawei"],[i,u]],[/(microsoft);\s(lumia[\s\w]+)/i],[o,t,[i,d]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[t,[o,"Microsoft"],[i,c]],[/(kin\.[onetw]{3})/i],[[t,/\./g," "],[o,"Microsoft"],[i,d]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[t,[o,"Motorola"],[i,d]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[t,[o,"Motorola"],[i,u]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[o,m.trim],[t,m.trim],[i,f]],[/hbbtv.+maple;(\d+)/i],[[t,/^/,"SmartTV"],[o,"Samsung"],[i,f]],[/\(dtv[\);].+(aquos)/i],[t,[o,"Sharp"],[i,f]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[o,"Samsung"],t,[i,u]],[/smart-tv.+(samsung)/i],[o,[i,f],t],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[o,"Samsung"],t,[i,d]],[/sie-(\w*)/i],[t,[o,"Siemens"],[i,d]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[o,"Nokia"],t,[i,d]],[/android[x\d\.\s;]+\s([ab][1-7]\-?[0178a]\d\d?)/i],[t,[o,"Acer"],[i,u]],[/android.+([vl]k\-?\d{3})\s+build/i],[t,[o,"LG"],[i,u]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[o,"LG"],t,[i,u]],[/(lg) netcast\.tv/i],[o,t,[i,f]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[t,[o,"LG"],[i,d]],[/(lenovo)\s?(s(?:5000|6000)(?:[\w-]+)|tab(?:[\s\w]+))/i],[o,t,[i,u]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[t,[o,"Lenovo"],[i,u]],[/(lenovo)[_\s-]?([\w-]+)/i],[o,t,[i,d]],[/linux;.+((jolla));/i],[o,t,[i,d]],[/((pebble))app\/[\d\.]+\s/i],[o,t,[i,h]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[o,t,[i,d]],[/crkey/i],[[t,"Chromecast"],[o,"Google"],[i,f]],[/android.+;\s(glass)\s\d/i],[t,[o,"Google"],[i,h]],[/android.+;\s(pixel c)[\s)]/i],[t,[o,"Google"],[i,u]],[/android.+;\s(pixel( [23])?( xl)?)[\s)]/i],[t,[o,"Google"],[i,d]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:a\d|one|one[\s_]plus|note lte)?[\s_]*(?:\d?\w?)[\s_]*(?:plus)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+))\s+build/i],[[t,/_/g," "],[o,"Xiaomi"],[i,d]],[/android.+(mi[\s\-_]*(?:pad)(?:[\s_]*[\w\s]+))\s+build/i],[[t,/_/g," "],[o,"Xiaomi"],[i,u]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[t,[o,"Meizu"],[i,d]],[/(mz)-([\w-]{2,})/i],[[o,"Meizu"],t,[i,d]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})[\s)]/i],[t,[o,"OnePlus"],[i,d]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[t,[o,"RCA"],[i,u]],[/android.+[;\/\s]+(Venue[\d\s]{2,7})\s+build/i],[t,[o,"Dell"],[i,u]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[t,[o,"Verizon"],[i,u]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[o,"Barnes & Noble"],t,[i,u]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[t,[o,"NuVision"],[i,u]],[/android.+;\s(k88)\sbuild/i],[t,[o,"ZTE"],[i,u]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[t,[o,"Swiss"],[i,d]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[t,[o,"Swiss"],[i,u]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[t,[o,"Zeki"],[i,u]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[o,"Dragon Touch"],t,[i,u]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[t,[o,"Insignia"],[i,u]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[t,[o,"NextBook"],[i,u]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[o,"Voice"],t,[i,d]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[o,"LvTel"],t,[i,d]],[/android.+;\s(PH-1)\s/i],[t,[o,"Essential"],[i,d]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[t,[o,"Envizen"],[i,u]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[o,t,[i,u]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[t,[o,"MachSpeed"],[i,u]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[o,t,[i,u]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[t,[o,"Rotor"],[i,u]],[/android.+(KS(.+))\s+build/i],[t,[o,"Amazon"],[i,u]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[o,t,[i,u]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[i,m.lowerize],o,t],[/[\s\/\(](smart-?tv)[;\)]/i],[[i,f]],[/(android[\w\.\s\-]{0,9});.+build/i],[t,[o,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[s,[n,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[s,[n,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[n,s],[/rv\:([\w\.]{1,9}).+(gecko)/i],[s,n]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[n,s],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[n,[s,g.str,v.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[n,"Windows"],[s,g.str,v.os.windows.version]],[/\((bb)(10);/i],[[n,"BlackBerry"],s],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen|kaios)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|sailfish|contiki)[\/\s-]?([\w\.]*)/i],[n,s],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[n,"Symbian"],s],[/\((series40);/i],[n],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[n,"Firefox OS"],s],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[n,s],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[n,"Chromium OS"],s],[/(sunos)\s?([\w\.\d]*)/i],[[n,"Solaris"],s],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[n,s],[/(haiku)\s(\w+)/i],[n,s],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[s,/_/g,"."],[n,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[n,"Mac OS"],[s,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i,/(unix)\s?([\w\.]*)/i],[n,s]]},b=function(e,t){if("object"==typeof e&&(t=e,e=l),!(this instanceof b))return new b(e,t).getResult();var n=e||(r&&r.navigator&&r.navigator.userAgent?r.navigator.userAgent:""),i=t?m.extend(y,t):y;return this.getBrowser=function(){var e={name:l,version:l};return g.rgx.call(e,n,i.browser),e.major=m.major(e.version),e},this.getCPU=function(){var e={architecture:l};return g.rgx.call(e,n,i.cpu),e},this.getDevice=function(){var e={vendor:l,model:l,type:l};return g.rgx.call(e,n,i.device),e},this.getEngine=function(){var e={name:l,version:l};return g.rgx.call(e,n,i.engine),e},this.getOS=function(){var e={name:l,version:l};return g.rgx.call(e,n,i.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(e){return n=e,this},this};b.VERSION="0.7.21",b.BROWSER={NAME:n,MAJOR:"major",VERSION:s},b.CPU={ARCHITECTURE:a},b.DEVICE={MODEL:t,VENDOR:o,TYPE:i,CONSOLE:c,MOBILE:d,SMARTTV:f,TABLET:u,WEARABLE:h,EMBEDDED:"embedded"},b.ENGINE={NAME:n,VERSION:s},b.OS={NAME:n,VERSION:s},typeof w!=e?(w=typeof C!=e&&C.exports?C.exports=b:w).UAParser=b:"function"==typeof define&&define.amd?define(function(){return b}):r&&(r.UAParser=b);var _,S=r&&(r.jQuery||r.Zepto);S&&!S.ua&&(_=new b,S.ua=_.getResult(),S.ua.get=function(){return _.getUA()},S.ua.set=function(e){_.setUA(e);var t,n=_.getResult();for(t in n)S.ua[t]=n[t]})}("object"==typeof window?window:this)},{}],38:[function(e,t,n){"use strict";n.byteLength=function(e){var t=u(e),e=t[0],t=t[1];return 3*(e+t)/4-t},n.toByteArray=function(e){var t,n,i=u(e),r=i[0],i=i[1],o=new d(function(e,t){return 3*(e+t)/4-t}(r,i)),s=0,a=0<i?r-4:r;for(n=0;n<a;n+=4)t=c[e.charCodeAt(n)]<<18|c[e.charCodeAt(n+1)]<<12|c[e.charCodeAt(n+2)]<<6|c[e.charCodeAt(n+3)],o[s++]=t>>16&255,o[s++]=t>>8&255,o[s++]=255&t;2===i&&(t=c[e.charCodeAt(n)]<<2|c[e.charCodeAt(n+1)]>>4,o[s++]=255&t);1===i&&(t=c[e.charCodeAt(n)]<<10|c[e.charCodeAt(n+1)]<<4|c[e.charCodeAt(n+2)]>>2,o[s++]=t>>8&255,o[s++]=255&t);return o},n.fromByteArray=function(e){for(var t,n=e.length,i=n%3,r=[],o=0,s=n-i;o<s;o+=16383)r.push(function(e,t,n){for(var i,r=[],o=t;o<n;o+=3)i=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),r.push(function(e){return a[e>>18&63]+a[e>>12&63]+a[e>>6&63]+a[63&e]}(i));return r.join("")}(e,o,s<o+16383?s:o+16383));1==i?(t=e[n-1],r.push(a[t>>2]+a[t<<4&63]+"==")):2==i&&(t=(e[n-2]<<8)+e[n-1],r.push(a[t>>10]+a[t>>4&63]+a[t<<2&63]+"="));return r.join("")};for(var a=[],c=[],d="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=0,o=i.length;r<o;++r)a[r]=i[r],c[i.charCodeAt(r)]=r;function u(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");e=e.indexOf("=");return[e=-1===e?t:e,e===t?0:4-e%4]}c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63},{}],39:[function(A,e,I){!function(e){!function(){"use strict";var a=A("base64-js"),o=A("ieee754");I.Buffer=l,I.SlowBuffer=function(e){+e!=e&&(e=0);return l.alloc(+e)},I.INSPECT_MAX_BYTES=50;var t=2147483647;function r(e){if(t<e)throw new RangeError('The value "'+e+'" is invalid for option "size"');e=new Uint8Array(e);return e.__proto__=l.prototype,e}function l(e,t,n){if("number"!=typeof e)return i(e,t,n);if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return c(e)}function i(e,t,n){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!l.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|p(e,t),i=r(n),t=i.write(e,t);t!==n&&(i=i.slice(0,t));return i}(e,t);if(ArrayBuffer.isView(e))return d(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(x(e,ArrayBuffer)||e&&x(e.buffer,ArrayBuffer))return function(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');n=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n);return n.__proto__=l.prototype,n}(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var i=e.valueOf&&e.valueOf();if(null!=i&&i!==e)return l.from(i,t,n);i=function(e){if(l.isBuffer(e)){var t=0|u(e.length),n=r(t);return 0===n.length?n:(e.copy(n,0,0,t),n)}if(void 0!==e.length)return"number"!=typeof e.length||O(e.length)?r(0):d(e);if("Buffer"===e.type&&Array.isArray(e.data))return d(e.data)}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return l.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function s(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function c(e){return s(e),r(e<0?0:0|u(e))}function d(e){for(var t=e.length<0?0:0|u(e.length),n=r(t),i=0;i<t;i+=1)n[i]=255&e[i];return n}function u(e){if(t<=e)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+t.toString(16)+" bytes");return 0|e}function p(e,t){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||x(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,i=2<arguments.length&&!0===arguments[2];if(!i&&0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return E(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return k(e).length;default:if(r)return i?-1:E(e).length;t=(""+t).toLowerCase(),r=!0}}function n(e,t,n){var i,r,o,s=!1;if((t=void 0===t||t<0?0:t)>this.length)return"";if((n=void 0===n||n>this.length?this.length:n)<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":return function(e,t,n){var i=e.length;(!t||t<0)&&(t=0);(!n||n<0||i<n)&&(n=i);for(var r="",o=t;o<n;++o)r+=function(e){return e<16?"0"+e.toString(16):e.toString(16)}(e[o]);return r}(this,t,n);case"utf8":case"utf-8":return y(this,t,n);case"ascii":return function(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}(this,t,n);case"latin1":case"binary":return function(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}(this,t,n);case"base64":return i=this,o=n,0===(r=t)&&o===i.length?a.fromByteArray(i):a.fromByteArray(i.slice(r,o));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,n){for(var i=e.slice(t,n),r="",o=0;o<i.length;o+=2)r+=String.fromCharCode(i[o]+256*i[o+1]);return r}(this,t,n);default:if(s)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),s=!0}}function f(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function h(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):2147483647<n?n=2147483647:n<-2147483648&&(n=-2147483648),(n=(n=O(n=+n)?r?0:e.length-1:n)<0?e.length+n:n)>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=l.from(t,i)),l.isBuffer(t))return 0===t.length?-1:m(e,t,n,i,r);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?(r?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(e,t,n):m(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function m(e,t,n,i,r){var o=1,s=e.length,a=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;s/=o=2,a/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(r)for(var d=-1,u=n;u<s;u++)if(c(e,u)===c(t,-1===d?0:u-d)){if(u-(d=-1===d?u:d)+1===a)return d*o}else-1!==d&&(u-=u-d),d=-1;else for(u=n=s<n+a?s-a:n;0<=u;u--){for(var l=!0,p=0;p<a;p++)if(c(e,u+p)!==c(t,p)){l=!1;break}if(l)return u}return-1}function g(e,t,n,i){return P(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function v(e,t,n,i){return P(function(e,t){for(var n,i,r=[],o=0;o<e.length&&!((t-=2)<0);++o)i=e.charCodeAt(o),n=i>>8,i=i%256,r.push(i),r.push(n);return r}(t,e.length-n),e,n,i)}function y(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var o,s,a,c,d=e[r],u=null,l=239<d?4:223<d?3:191<d?2:1;if(r+l<=n)switch(l){case 1:d<128&&(u=d);break;case 2:128==(192&(o=e[r+1]))&&127<(c=(31&d)<<6|63&o)&&(u=c);break;case 3:o=e[r+1],s=e[r+2],128==(192&o)&&128==(192&s)&&2047<(c=(15&d)<<12|(63&o)<<6|63&s)&&(c<55296||57343<c)&&(u=c);break;case 4:o=e[r+1],s=e[r+2],a=e[r+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&65535<(c=(15&d)<<18|(63&o)<<12|(63&s)<<6|63&a)&&c<1114112&&(u=c)}null===u?(u=65533,l=1):65535<u&&(u-=65536,i.push(u>>>10&1023|55296),u=56320|1023&u),i.push(u),r+=l}return function(e){var t=e.length;if(t<=b)return String.fromCharCode.apply(String,e);var n="",i=0;for(;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=b));return n}(i)}I.kMaxLength=t,(l.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),l.poolSize=8192,l.from=i,l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,l.alloc=function(e,t,n){return t=t,n=n,s(e=e),!(e<=0)&&void 0!==t?"string"==typeof n?r(e).fill(t,n):r(e).fill(t):r(e)},l.allocUnsafe=c,l.allocUnsafeSlow=c,l.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==l.prototype},l.compare=function(e,t){if(x(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),x(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,i=t.length,r=0,o=Math.min(n,i);r<o;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);if(void 0===t)for(r=t=0;r<e.length;++r)t+=e[r].length;for(var n=l.allocUnsafe(t),i=0,r=0;r<e.length;++r){var o=e[r];if(x(o,Uint8Array)&&(o=l.from(o)),!l.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)f(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)f(this,t,t+3),f(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)f(this,t,t+7),f(this,t+1,t+6),f(this,t+2,t+5),f(this,t+3,t+4);return this},l.prototype.toLocaleString=l.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?y(this,0,e):n.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",t=I.INSPECT_MAX_BYTES,e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim();return this.length>t&&(e+=" ... "),"<Buffer "+e+">"},l.prototype.compare=function(e,t,n,i,r){if(x(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),(t=void 0===t?0:t)<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(r<=i&&n<=t)return 0;if(r<=i)return-1;if(n<=t)return 1;if(this===e)return 0;for(var o=(r>>>=0)-(i>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(o,s),c=this.slice(i,r),d=e.slice(t,n),u=0;u<a;++u)if(c[u]!==d[u]){o=c[u],s=d[u];break}return o<s?-1:s<o?1:0},l.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},l.prototype.indexOf=function(e,t,n){return h(this,e,t,n,!0)},l.prototype.lastIndexOf=function(e,t,n){return h(this,e,t,n,!1)},l.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-t;if((void 0===n||r<n)&&(n=r),0<e.length&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i=i||"utf8";for(var o,s,a,c=!1;;)switch(i){case"hex":return function(e,t,n,i){n=Number(n)||0;var r=e.length-n;(!i||r<(i=Number(i)))&&(i=r),(r=t.length)/2<i&&(i=r/2);for(var o=0;o<i;++o){var s=parseInt(t.substr(2*o,2),16);if(O(s))return o;e[n+o]=s}return o}(this,e,t,n);case"utf8":case"utf-8":return s=t,a=n,P(E(e,(o=this).length-s),o,s,a);case"ascii":return g(this,e,t,n);case"latin1":case"binary":return g(this,e,t,n);case"base64":return o=this,s=t,a=n,P(k(e),o,s,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return v(this,e,t,n);default:if(c)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),c=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var b=4096;function _(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(n<e+t)throw new RangeError("Trying to access beyond buffer length")}function S(e,t,n,i,r,o){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(r<t||t<o)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function C(e,t,n,i){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function w(e,t,n,i,r){return t=+t,n>>>=0,r||C(e,0,n,4),o.write(e,t,n,i,23,4),n+4}function T(e,t,n,i,r){return t=+t,n>>>=0,r||C(e,0,n,8),o.write(e,t,n,i,52,8),n+8}l.prototype.slice=function(e,t){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):n<e&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):n<t&&(t=n);t=this.subarray(e,t=t<e?e:t);return t.__proto__=l.prototype,t},l.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||_(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return i},l.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||_(e,t,this.length);for(var i=this[e+--t],r=1;0<t&&(r*=256);)i+=this[e+--t]*r;return i},l.prototype.readUInt8=function(e,t){return e>>>=0,t||_(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return e>>>=0,t||_(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return e>>>=0,t||_(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return e>>>=0,t||_(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return e>>>=0,t||_(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||_(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return(r*=128)<=i&&(i-=Math.pow(2,8*t)),i},l.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||_(e,t,this.length);for(var i=t,r=1,o=this[e+--i];0<i&&(r*=256);)o+=this[e+--i]*r;return(r*=128)<=o&&(o-=Math.pow(2,8*t)),o},l.prototype.readInt8=function(e,t){return e>>>=0,t||_(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){e>>>=0,t||_(e,2,this.length);e=this[e]|this[e+1]<<8;return 32768&e?4294901760|e:e},l.prototype.readInt16BE=function(e,t){e>>>=0,t||_(e,2,this.length);e=this[e+1]|this[e]<<8;return 32768&e?4294901760|e:e},l.prototype.readInt32LE=function(e,t){return e>>>=0,t||_(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e>>>=0,t||_(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return e>>>=0,t||_(e,4,this.length),o.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e>>>=0,t||_(e,4,this.length),o.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e>>>=0,t||_(e,8,this.length),o.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e>>>=0,t||_(e,8,this.length),o.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,n,i){e=+e,t>>>=0,n>>>=0,i||S(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,o=0;for(this[t]=255&e;++o<n&&(r*=256);)this[t+o]=e/r&255;return t+n},l.prototype.writeUIntBE=function(e,t,n,i){e=+e,t>>>=0,n>>>=0,i||S(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,o=1;for(this[t+r]=255&e;0<=--r&&(o*=256);)this[t+r]=e/o&255;return t+n},l.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||S(this,e,t,1,255,0),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||S(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||S(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||S(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||S(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeIntLE=function(e,t,n,i){e=+e,t>>>=0,i||S(this,e,t,n,(i=Math.pow(2,8*n-1))-1,-i);var r=0,o=1,s=0;for(this[t]=255&e;++r<n&&(o*=256);)e<0&&0===s&&0!==this[t+r-1]&&(s=1),this[t+r]=(e/o>>0)-s&255;return t+n},l.prototype.writeIntBE=function(e,t,n,i){e=+e,t>>>=0,i||S(this,e,t,n,(i=Math.pow(2,8*n-1))-1,-i);var r=n-1,o=1,s=0;for(this[t+r]=255&e;0<=--r&&(o*=256);)e<0&&0===s&&0!==this[t+r+1]&&(s=1),this[t+r]=(e/o>>0)-s&255;return t+n},l.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||S(this,e,t,1,127,-128),this[t]=255&(e=e<0?255+e+1:e),t+1},l.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||S(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||S(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||S(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||S(this,e,t,4,2147483647,-2147483648),this[t]=(e=e<0?4294967295+e+1:e)>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeFloatLE=function(e,t,n){return w(this,e,t,!0,n)},l.prototype.writeFloatBE=function(e,t,n){return w(this,e,t,!1,n)},l.prototype.writeDoubleLE=function(e,t,n){return T(this,e,t,!0,n)},l.prototype.writeDoubleBE=function(e,t,n){return T(this,e,t,!1,n)},l.prototype.copy=function(e,t,n,i){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n=n||0,i||0===i||(i=this.length),t>=e.length&&(t=e.length),(i=0<i&&i<n?n:i)===n)return 0;if(0===e.length||0===this.length)return 0;if((t=t||0)<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length);var r=(i=e.length-t<i-n?e.length-t+n:i)-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,i);else if(this===e&&n<t&&t<i)for(var o=r-1;0<=o;--o)e[o+t]=this[o+n];else Uint8Array.prototype.set.call(e,this.subarray(n,i),t);return r},l.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!l.isEncoding(i))throw new TypeError("Unknown encoding: "+i);var r;1===e.length&&(r=e.charCodeAt(0),("utf8"===i&&r<128||"latin1"===i)&&(e=r))}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,"number"==typeof(e=e||0))for(o=t;o<n;++o)this[o]=e;else{var s=l.isBuffer(e)?e:l.from(e,i),a=s.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<n-t;++o)this[o+t]=s[o%a]}return this};var R=/[^+/0-9A-Za-z-_]/g;function E(e,t){var n;t=t||1/0;for(var i=e.length,r=null,o=[],s=0;s<i;++s){if(55295<(n=e.charCodeAt(s))&&n<57344){if(!r){if(56319<n){-1<(t-=3)&&o.push(239,191,189);continue}if(s+1===i){-1<(t-=3)&&o.push(239,191,189);continue}r=n;continue}if(n<56320){-1<(t-=3)&&o.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&-1<(t-=3)&&o.push(239,191,189);if(r=null,n<128){if(--t<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function k(e){return a.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(R,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function P(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function x(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function O(e){return e!=e}}.call(this)}.call(this,A("buffer").Buffer)},{"base64-js":38,buffer:39,ieee754:40}],40:[function(e,t,n){n.read=function(e,t,n,i,r){var o,s,a=8*r-i-1,c=(1<<a)-1,d=c>>1,u=-7,l=n?r-1:0,p=n?-1:1,n=e[t+l];for(l+=p,o=n&(1<<-u)-1,n>>=-u,u+=a;0<u;o=256*o+e[t+l],l+=p,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=i;0<u;s=256*s+e[t+l],l+=p,u-=8);if(0===o)o=1-d;else{if(o===c)return s?NaN:1/0*(n?-1:1);s+=Math.pow(2,i),o-=d}return(n?-1:1)*s*Math.pow(2,o-i)},n.write=function(e,t,n,i,r,o){var s,a,c=8*o-r-1,d=(1<<c)-1,u=d>>1,l=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:o-1,f=i?1:-1,o=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=d):(s=Math.floor(Math.log(t)/Math.LN2),t*(i=Math.pow(2,-s))<1&&(s--,i*=2),2<=(t+=1<=s+u?l/i:l*Math.pow(2,1-u))*i&&(s++,i/=2),d<=s+u?(a=0,s=d):1<=s+u?(a=(t*i-1)*Math.pow(2,r),s+=u):(a=t*Math.pow(2,u-1)*Math.pow(2,r),s=0));8<=r;e[n+p]=255&a,p+=f,a/=256,r-=8);for(s=s<<r|a,c+=r;0<c;e[n+p]=255&s,p+=f,s/=256,c-=8);e[n+p-f]|=128*o}},{}]},{},[36])(36)});
